{"title":"记录下修改smail的骚操作以及如何重打包","uid":"65a729b015fbeb895e9e3c25a8f4953e","slug":"记录下修改smail的骚操作以及如何重打包","date":"2021-05-06T09:20:45.000Z","updated":"2021-05-06T14:23:01.029Z","comments":true,"path":"api/articles/记录下修改smail的骚操作以及如何重打包.json","keywords":null,"cover":"https://w.wallhaven.cc/full/6o/wallhaven-6olw9x.jpg","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>在被各种的重打包工具折磨之后，群里大佬推荐我看看珍惜哥的视频学学，这肯定得冲了呀，看了一小时，看完了，感觉学到一点骚操作，挺好玩的，就记录下</p>\n<h1 id=\"smail的修改\"><a href=\"#smail的修改\" class=\"headerlink\" title=\"smail的修改\"></a>smail的修改</h1><p>在patch java层的时候，我们通常是去反编译apk，然后去修改smail，之后再重新编译打包签名，得把几个过程分开来看</p>\n<h2 id=\"反编译\"><a href=\"#反编译\" class=\"headerlink\" title=\"反编译\"></a>反编译</h2><p>这里我之前就用androidkiller和apk改之理，来发编译，但是最近发现反编译没啥问题，但是好家伙，打包的时候会报错，查阅了下资料，原来是jdk14以上，默认签名是使用jdk去签名的了，不使用apktools了，所以我另外下了一个jdk8，单独设置了路径，这个问题解决了，但是有些apk，重打包还是会出现问题），这里说偏了），说回来，珍惜师傅推荐是android逆向助手，我下了一个，界面比较简洁</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210506212807.png\"></p>\n<p>这里我主要是用来反编译dex的。至于为什么不是整个apk，下面会说</p>\n<h2 id=\"修改smail\"><a href=\"#修改smail\" class=\"headerlink\" title=\"修改smail\"></a>修改smail</h2><p>先写个demo</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">package com.example.smailtest;\n\nimport androidx.appcompat.app.AppCompatActivity;\n\nimport android.os.Bundle;\nimport android.widget.TextView;\n\npublic class MainActivity extends AppCompatActivity &#123;\n\n    TextView tv;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) &#123;\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        tv&#x3D;findViewById(R.id.tvt);\n        tv.setText(Test.getXx());\n    &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">package com.example.smailtest;\n\npublic class Test &#123;\n    public static int xx&#x3D;2;\n    public static int getXx()\n    &#123;\n        return xx;\n    &#125;\n\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>将生成的apk，弄出来，反编译</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210506214140.png\"></p>\n<p>打开Test.smail文件，记事本永远的神</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210506214243.png\"></p>\n<p>语法非常简单，那么如果我想要修改getXx()方法的返回值的，或者怎么修改，我们是不是要按照手册一行一行写的呢，肯定不是的，珍惜表哥，提了一个骚操作，就是把jeb反编译好的，代码直接抄一份到androidstudio中，然后我们自己手动改好逻辑后，利用java2smail转换成smail文件，不就直接接近了我们想要的效果了吗，2333，到时候寄存器有点变化，不用管，手动调整过来就好了</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">package com.example.smailtest;\n\npublic class Test &#123;\n    public static int xx&#x3D;2;\n    public static int getXx()\n    &#123;\n        return 100000;\n    &#125;\n\n&#125;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<p>抄下来，是这样的，然后修改了一手，之后大概是我想要的效果。然后转换成smail</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210506214953.png\"></p>\n<p>直接copy到我们的smail文件中，利用逆向助手，重新编译成dex</p>\n<h2 id=\"重打包\"><a href=\"#重打包\" class=\"headerlink\" title=\"重打包\"></a>重打包</h2><p>打包不一定非要使用之前那种androidkiller和改之理整体apk编译重打包的，我们可以把apk看成zip，然后把我们修改编译后的dex，替换原来的dex，然后修改后缀为apk，这时候我们只需要签名就完事了</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210506221103.png\"></p>\n<p>重新签名，这里选择mt管理器的重打包签名，非常的稳，牛逼，这里直接手机上操作就完事了，哦对，支持正版哦，</p>\n<p>签名后，正常运行，搞定，嘿嘿</p>\n","feature":null,"text":"前言在被各种的重打包工具折磨之后，群里大佬推荐我看看珍惜哥的视频学学，这肯定得冲了呀，看了一小时，看完了，感觉学到一点骚操作，挺好玩的，就记录下 smail的修改在patch java层的时候，我们通常是去反编译apk，然后去修改smail，之后再重新编译打包签名，得把几个过程分...","link":"","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[{"name":"安卓小技巧","slug":"安卓小技巧","count":1,"path":"api/categories/安卓小技巧.json"}],"tags":[{"name":"reverse","slug":"reverse","count":19,"path":"api/tags/reverse.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#smail%E7%9A%84%E4%BF%AE%E6%94%B9\"><span class=\"toc-text\">smail的修改</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%8D%E7%BC%96%E8%AF%91\"><span class=\"toc-text\">反编译</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9smail\"><span class=\"toc-text\">修改smail</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%87%8D%E6%89%93%E5%8C%85\"><span class=\"toc-text\">重打包</span></a></li></ol></li></ol>","author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""},"mapped":true,"prev_post":{"title":"津门杯2021 wp","uid":"5f3262e9c2aa5e7df63089bc650eb7bf","slug":"津门杯2021-wp","date":"2021-05-10T02:48:37.000Z","updated":"2021-05-10T08:16:33.413Z","comments":true,"path":"api/articles/津门杯2021-wp.json","keywords":null,"cover":"https://th.wallhaven.cc/lg/72/72jwp3.jpg","text":"mobile加了360的壳子，frida-dexdump，脱下来就完事了，发现没native层, 好家伙，纯java呗），找到关键的dex开始审计 ，找到了两段逻辑，一段是加密的，一段是解密的，大概逆了一下，发现这题有两种做法，一种是白嫖解密接口，把给出的数据，通过替换xml，t...","link":"","photos":[],"count_time":{"symbolsCount":"13k","symbolsTime":"12 mins."},"categories":[{"name":"writeup","slug":"writeup","count":8,"path":"api/categories/writeup.json"}],"tags":[{"name":"reverse","slug":"reverse","count":19,"path":"api/tags/reverse.json"}],"author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""}},"next_post":{"title":"ISCC某安卓题","uid":"b380b394179f19e6fa4ccc3b184ec926","slug":"ISCC某安卓题","date":"2021-05-02T11:56:33.000Z","updated":"2021-05-02T12:16:04.086Z","comments":true,"path":"api/articles/ISCC某安卓题.json","keywords":null,"cover":"https://w.wallhaven.cc/full/28/wallhaven-281d5y.png","text":"口述下:ctf的安卓题，不能以实战的角度去逆了，毕竟从ctf角度出发，我们需要的是最短时间拿到flag，而不是把整体app代码全部分析出来，昨晚睡前，大概看了下文件就睡了，早上把逻辑理了下，就开始了，首先是java2c，这个问题，其实就是和java层的代码一样，不过是写在ndk中...","link":"","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[{"name":"writeup","slug":"writeup","count":8,"path":"api/categories/writeup.json"}],"tags":[{"name":"reverse","slug":"reverse","count":19,"path":"api/tags/reverse.json"}],"author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""}}}