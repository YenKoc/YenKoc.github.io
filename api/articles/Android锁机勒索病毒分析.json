{"title":"Android锁机勒索病毒分析","uid":"4b0b858a57a6176d5e34068e8d18965f","slug":"Android锁机勒索病毒分析","date":"2021-06-29T03:54:43.000Z","updated":"2021-06-29T08:59:31.243Z","comments":true,"path":"api/articles/Android锁机勒索病毒分析.json","keywords":null,"cover":"https://th.wallhaven.cc/lg/8o/8oev1j.jpg","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>有一说一，我拉了，好几个模拟器运行这个apk，发现没啥特别的，静态分析一看，发现里面有su等一大堆的命令，mmp，所以说没root的话，一切免谈，不打算在真机上试，直接静态分析，嘿嘿</p>\n<h1 id=\"jeb静态分析开始\"><a href=\"#jeb静态分析开始\" class=\"headerlink\" title=\"jeb静态分析开始\"></a>jeb静态分析开始</h1><p>从开始界面找起，因为这种恶意软件的启动肯定要有一个触发点，一般是在必经的地方，否则很有可能会触发不了，所以从开始界面开始操作，发现了一个很奇怪的地方</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210629123632.png\"></p>\n<p>这里出现了一个很奇怪的类名，其他我稍微跟了下，发现功能没啥大问题，这东西似乎就是遍历wifi列表，然后显示，继续跟进去这个奇奇怪怪的东西。</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210629124142.png\"></p>\n<p>继续跟进去</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210629124235.png\"></p>\n<p>还挺坏，基本就是每次复制之后，然后就删掉，最后的那个锁机的apk，就是这个叫cia.apk的东西了，不过我不想运行，所以只能本地解密后，再静态分析了。</p>\n<h1 id=\"本地解密成apk文件\"><a href=\"#本地解密成apk文件\" class=\"headerlink\" title=\"本地解密成apk文件\"></a>本地解密成apk文件</h1><p>Python2</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">f&#x3D;open(&quot;date.jar&quot;,&quot;rb&quot;)\nf2&#x3D;open(&quot;finalres.txt&quot;,&quot;wb&quot;)\ndate&#x3D;&#39;&#39;\nfor i in f.read():\n    date+&#x3D;i\nxor7&#x3D;lambda x:chr(ord(x)^(358&amp;0xff))\nfinal&#x3D;&quot;&quot;.join(map(xor7,date))\nf2.write(final)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>finalres.txt是我自己新建的一个空白文件，里面啥都没有，存放解密后的字节流的。</p>\n<p>解密后的效果:</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210629132352.png\"></p>\n<p>改下后缀，jeb就可以跑了</p>\n<h1 id=\"继续分析这个apk\"><a href=\"#继续分析这个apk\" class=\"headerlink\" title=\"继续分析这个apk\"></a>继续分析这个apk</h1><p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210629165032.png\"></p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210629165059.png\"></p>\n<p>新建了一个线程</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210629165141.png\"></p>\n<p>这里其实我网上搜了下，基本上锁机软件都有这段代码，我估计是控制屏幕的（。</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210629165227.png\"></p>\n<p>这里新起了一个service，继续看看这个service</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210629165318.png\"></p>\n<p>这里就是关键逻辑的地方了，初诺加数字，这个类是它自定义的一个类，里面全是android api的加密算法。</p>\n<p>看了下解密用的就是一个aes的算法</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210629165801.png\"></p>\n<p>这里就是最终判断的地方了，可见这位兄弟写的代码有多烂，分分钟被破（，这水平还勒索呢。。。</p>\n<p>直接hook GetMD5Code方法的返回值，为我输入的，直接没了，甚至都不需要解密。</p>\n","feature":null,"text":"前言有一说一，我拉了，好几个模拟器运行这个apk，发现没啥特别的，静态分析一看，发现里面有su等一大堆的命令，mmp，所以说没root的话，一切免谈，不打算在真机上试，直接静态分析，嘿嘿 jeb静态分析开始从开始界面找起，因为这种恶意软件的启动肯定要有一个触发点，一般是在必经的地...","link":"","photos":[],"count_time":{"symbolsCount":938,"symbolsTime":"1 mins."},"categories":[{"name":"AndroidReverse","slug":"AndroidReverse","count":9,"path":"api/categories/AndroidReverse.json"}],"tags":[{"name":"reverse","slug":"reverse","count":16,"path":"api/tags/reverse.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#jeb%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E5%BC%80%E5%A7%8B\"><span class=\"toc-text\">jeb静态分析开始</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%9C%AC%E5%9C%B0%E8%A7%A3%E5%AF%86%E6%88%90apk%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">本地解密成apk文件</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%BB%A7%E7%BB%AD%E5%88%86%E6%9E%90%E8%BF%99%E4%B8%AAapk\"><span class=\"toc-text\">继续分析这个apk</span></a></li></ol>","author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""},"mapped":true,"prev_post":{"title":"android的PMS动态代理","uid":"668f1dbfd60678f860dbea390d6a69fb","slug":"android的PMS动态代理","date":"2021-07-02T06:26:47.000Z","updated":"2021-07-02T06:54:06.525Z","comments":true,"path":"api/articles/android的PMS动态代理.json","keywords":null,"cover":"https://th.wallhaven.cc/small/28/281d5y.jpg","text":"前言目前在java层中签名验证是使用java层的api进行获取，然后进行判断，可以选择hook，也可以使用安卓本身的特性去hook，不使用任何hook框架去实现hook 代理是什么？结合我自己的理解来说，动态代理实际上就是比如你想找别人，但是你不自己去找，而是委托另一个人去找，把...","link":"","photos":[],"count_time":{"symbolsCount":"6.1k","symbolsTime":"6 mins."},"categories":[{"name":"AndroidReverse","slug":"AndroidReverse","count":9,"path":"api/categories/AndroidReverse.json"}],"tags":[{"name":"reverse","slug":"reverse","count":16,"path":"api/tags/reverse.json"}],"author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""}},"next_post":{"title":"SVC指令获取设备信息&内联汇编","uid":"90a1c6273d337dfc4b6067dd868be1ed","slug":"SVC指令获取设备信息-内联汇编","date":"2021-06-28T07:05:01.000Z","updated":"2021-06-28T15:41:55.182Z","comments":true,"path":"api/articles/SVC指令获取设备信息-内联汇编.json","keywords":null,"cover":"https://th.wallhaven.cc/lg/rd/rdyyjm.jpg","text":"前言目前越来越多的api，采用svc进行直接系统调用，syscall也不用了，直接内联汇编，然后svc，可以防止hook，不过最近在看雪也看到一篇修改内核的操作反操作的，之后打算再研究研究。 syscallsyscall可以说是系统层给用户层提供的一个调用内核态代码的api，我们...","link":"","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"AndroidReverse","slug":"AndroidReverse","count":9,"path":"api/categories/AndroidReverse.json"}],"tags":[{"name":"reverse","slug":"reverse","count":16,"path":"api/tags/reverse.json"}],"author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""}}}