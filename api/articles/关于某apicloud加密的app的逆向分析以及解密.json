{"title":"关于某apicloud加密的app的逆向分析以及解密","uid":"490dee142b27f79f3072c0e4373d70d3","slug":"关于某apicloud加密的app的逆向分析以及解密","date":"2021-04-11T16:00:43.000Z","updated":"2021-04-11T16:45:57.741Z","comments":true,"path":"api/articles/关于某apicloud加密的app的逆向分析以及解密.json","keywords":null,"cover":"https://www.wahaotu.com/uploads/allimg/202009/1600175614578817.jpg","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>同事发现了一个html和js作为主要逻辑实现的app，好家伙，并且资源文件都被加密，打开就乱码，这波我也没见过，不过看我同事在逆，我因为好奇也去逆了下，好家伙，手机果然出问题了，frida hook不到关键函数，导致卡了很久，把我方向都搞乱了，最终在我同事和我做了对比变量，后排除了代码问题，锁定是手机问题，刷机之后，恢复正常），没有什么问题是刷机解决不了的。</p>\n<h1 id=\"分析过程\"><a href=\"#分析过程\" class=\"headerlink\" title=\"分析过程\"></a>分析过程</h1><p>实际上直接面对这种，实际上很懵的，逆向如果基于开发的角度去逆向，会加快逆向的速度的，并更容易去定位到关键逻辑，这js在本地加密，那么有一种可能是发送请求，并在服务器上解密后，传回正常js然后解密，或者直接在本地就解密了，搜了下，发现这个框架叫apicloud，看了下开发流程，感觉没涉及到加解密，应该是apicloud自己的sdk，自己帮用户已经封装好了，既然已经知道了这个东西是什么，那么站在巨人的角度上，会不会更好，直接搜，发现看雪之前有大佬已经发了一篇apicloud逆向解密的文章，好奇，直接点进去</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210412001857.png\"></p>\n<p>发现了这句话，说明这个方法是我们要找的重点，直接jeb搜索</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210412002152.png\"></p>\n<p>其他的几个方法都跟了下，最终还是回调这个方法，再和之前那篇文章对比下，发现没啥差别的</p>\n<p>跟一下b.d()方法</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210412002917.png\"></p>\n<p>最终是调用了这个方法，其实就是返回文件后缀的，在调试过程中，愈发发现，很多时候要先从大逻辑开始逆，然后再深入这个大逻辑去逆向细节，也可能就是为什么我习惯f8，再f7，找到什么重要，什么根本就没必要跟。</p>\n<p>下一步跟this.b()方法</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210412003220.png\"></p>\n<p>重点是f.a()方法，在我使用frida去hook时候，发现返回值就是解密后的字节流，好家伙，那么这玩意加密的意义就不大了，</p>\n<p>代码没混淆，那么我只要hook这个方法，把字节流dump下来，不就完事了，不过这样有个问题就是那没加载的文件无法解密，所以找到核心的加密逻辑才行，继续跟进去</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210412003551.png\"></p>\n<p>核心加密跟进</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210412003801.png\"></p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210412003843.png\"></p>\n<p>再继续</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210412003929.png\"></p>\n<p>next</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210412004020.png\"></p>\n<p>发现跟进了native函数里面，ida拿出来，干它，发现是动态注册，找到结构体</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210412004238.png\"></p>\n<p>通过动态调试，发现核心加密函数</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210412004334.png\"></p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210412004430.png\"></p>\n<p>就不跟进去了，重点是分析思路，静态分析，很明显的rc4加密，把keydump下来就可以正常解密文件了，我同事也写了一个解密本地文件的cpp脚本，我就不重复造轮子了，就分享下</p>\n","feature":null,"text":"前言同事发现了一个html和js作为主要逻辑实现的app，好家伙，并且资源文件都被加密，打开就乱码，这波我也没见过，不过看我同事在逆，我因为好奇也去逆了下，好家伙，手机果然出问题了，frida hook不到关键函数，导致卡了很久，把我方向都搞乱了，最终在我同事和我做了对比变量，后...","link":"","photos":[],"count_time":{"symbolsCount":954,"symbolsTime":"1 mins."},"categories":[{"name":"app实战","slug":"app实战","count":2,"path":"api/categories/app实战.json"}],"tags":[{"name":"a-iCloud","slug":"a-iCloud","count":1,"path":"api/tags/a-iCloud.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B\"><span class=\"toc-text\">分析过程</span></a></li></ol>","author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""},"mapped":true,"prev_post":{"title":"ARM汇编（转载,主要用来查询的)","uid":"94996d3e08d5b007f0ef9d436bcc2ac8","slug":"ARM汇编（转载-主要用来查询的","date":"2021-04-13T15:40:54.000Z","updated":"2021-04-13T15:46:40.797Z","comments":true,"path":"api/articles/ARM汇编（转载-主要用来查询的.json","keywords":null,"cover":"https://www.wahaotu.com/uploads/allimg/202009/1600175614578817.jpg","text":"前言本来想自己写写，发现网上师傅们写的文章已经足够详细和优秀，就打算直接白嫖了，我是懒狗），毕竟汇编这东西还是得多看，然后平常就多查查，不然就像我之前连函数调用返回结果存储到r0，都回答错了，mmp，r0-r4优先存放函数参数的，r11其实就是x86中的ebp和x64的rbp，r...","link":"","photos":[],"count_time":{"symbolsCount":405,"symbolsTime":"1 mins."},"categories":[{"name":"ARM汇编","slug":"ARM汇编","count":1,"path":"api/categories/ARM汇编.json"}],"tags":[],"author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""}},"next_post":{"title":"MRCTF2021 MR_checkin wp","uid":"5dc0bb0dd64b2cd7c658f0c50eb1781e","slug":"MRCTF2021-MR-checkin-wp","date":"2021-04-11T14:42:07.000Z","updated":"2021-04-11T15:09:35.160Z","comments":true,"path":"api/articles/MRCTF2021-MR-checkin-wp.json","keywords":null,"cover":[],"text":"前言这次北邮赛，没咋打，唉，忙别的事，太忙了，抽不出时间，但是瞄了一眼，有安卓题，打算摸鱼会，看看怎么回事hhh，毕竟几位出题人都是我大哥，过去签个到不过分吧2333，逻辑不复杂，还是挺友好的。 分析过程jeb3打开，看看逻辑 沉思，是kotlin写的，不过逻辑俺还是看的懂的，发...","link":"","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"writeup","slug":"writeup","count":3,"path":"api/categories/writeup.json"}],"tags":[{"name":"reverse","slug":"reverse","count":3,"path":"api/tags/reverse.json"}],"author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""}}}