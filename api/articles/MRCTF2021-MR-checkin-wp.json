{"title":"MRCTF2021 MR_checkin wp","uid":"5dc0bb0dd64b2cd7c658f0c50eb1781e","slug":"MRCTF2021-MR-checkin-wp","date":"2021-04-11T14:42:07.000Z","updated":"2021-04-11T15:09:35.160Z","comments":true,"path":"api/articles/MRCTF2021-MR-checkin-wp.json","keywords":null,"cover":[],"content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>这次北邮赛，没咋打，唉，忙别的事，太忙了，抽不出时间，但是瞄了一眼，有安卓题，打算摸鱼会，看看怎么回事hhh，毕竟几位出题人都是我大哥，过去签个到不过分吧2333，逻辑不复杂，还是挺友好的。</p>\n<h1 id=\"分析过程\"><a href=\"#分析过程\" class=\"headerlink\" title=\"分析过程\"></a>分析过程</h1><h2 id=\"jeb3打开，看看逻辑\"><a href=\"#jeb3打开，看看逻辑\" class=\"headerlink\" title=\"jeb3打开，看看逻辑\"></a>jeb3打开，看看逻辑</h2><p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210411225000.png\"></p>\n<p>沉思，是kotlin写的，不过逻辑俺还是看的懂的，发现两个输入框，一个用户名一个密码，一个按钮，用来登录的，</p>\n<p>并给输入密码的控件设置了监听事件，还调用jni.test() 方法，先不管，先把大逻辑搞清楚</p>\n<h2 id=\"跟进监听事件的类\"><a href=\"#跟进监听事件的类\" class=\"headerlink\" title=\"跟进监听事件的类\"></a>跟进监听事件的类</h2><p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210411225059.png\"></p>\n<p>发现又给按钮设置了点击事件，并发现密码位数是39</p>\n<h2 id=\"跟进点击事件的类\"><a href=\"#跟进点击事件的类\" class=\"headerlink\" title=\"跟进点击事件的类\"></a>跟进点击事件的类</h2><p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210411225329.png\"></p>\n<p>发现就开始做校验了，用户名为MRCTF,密码前几个字符，是md5加密，然后对比，这玩意直接somd5解开，就完事了，重点是后半部分</p>\n<h2 id=\"跟进check方法\"><a href=\"#跟进check方法\" class=\"headerlink\" title=\"跟进check方法\"></a>跟进check方法</h2><p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210411225559.png\"></p>\n<p>发现这段逻辑，先new了一个rand类对象，同时遍历输入密码的另一部分与StringsKt,first方法返回值做异或，我把代码都看了看，这个rand是个假的随机，实际上这个类仅仅是存了一个long数组，以及StringsKt.first这个方法，里面也是对两个数字进行一些移位操作，，这题我的思路就是直接hook那个first方法不就完事了吗。。不过这题会这么容易吗，肯定有诈啊，之前那个test方法不是白执行的</p>\n<h2 id=\"跟进test方法\"><a href=\"#跟进test方法\" class=\"headerlink\" title=\"跟进test方法\"></a>跟进test方法</h2><p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210411230123.png\"></p>\n<p>跟进去so文件，习惯先看下j ni_onload方法，果然搞了一手，动态注册，那么静态注册就废掉了，看下结构体</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210411230240.png\"></p>\n<p>跟进去真正的执行函数、</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210411230445.png\"></p>\n<p>这里可以动调，但是有反调试，重打包什么的，patch太麻烦了，这里可以hook ptrace，也麻烦，直接hook art就完事了</p>\n<p>，发现就是执行了mainactivity的SetSrand函数，基本就是把之前new rand对象的两个参数改变了，好家伙</p>\n<p>但是我们思考下逻辑，你改了就改了，我们就是需要改过之后的rand对象是吧，所以根本不用操心，直接hook first函数，把返回值拿到不就完事了，不过这里需要把first函数返回值hook成我们设置的，否则无法执行，会直接退出的，把hook结果，拿到就行，放下frida脚本</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">hookMM</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#123;</span>\n    Java<span class=\"token punctuation\">.</span><span class=\"token function\">perform</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">var</span> tt<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">95</span><span class=\"token punctuation\">,</span> <span class=\"token number\">99</span><span class=\"token punctuation\">,</span> <span class=\"token number\">104</span><span class=\"token punctuation\">,</span> <span class=\"token number\">102</span><span class=\"token punctuation\">,</span> <span class=\"token number\">103</span><span class=\"token punctuation\">,</span> <span class=\"token number\">110</span><span class=\"token punctuation\">,</span> <span class=\"token number\">55</span><span class=\"token punctuation\">,</span> <span class=\"token number\">111</span><span class=\"token punctuation\">,</span> <span class=\"token number\">88</span><span class=\"token punctuation\">,</span> <span class=\"token number\">118</span><span class=\"token punctuation\">,</span> <span class=\"token number\">97</span><span class=\"token punctuation\">,</span> <span class=\"token number\">109</span><span class=\"token punctuation\">,</span> <span class=\"token number\">98</span><span class=\"token punctuation\">,</span> <span class=\"token number\">53</span><span class=\"token punctuation\">,</span> <span class=\"token number\">108</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">94</span><span class=\"token punctuation\">,</span> <span class=\"token number\">112</span><span class=\"token punctuation\">,</span> <span class=\"token number\">108</span><span class=\"token punctuation\">,</span> <span class=\"token number\">94</span><span class=\"token punctuation\">,</span> <span class=\"token number\">77</span><span class=\"token punctuation\">,</span> <span class=\"token number\">83</span><span class=\"token punctuation\">,</span> <span class=\"token number\">66</span><span class=\"token punctuation\">,</span> <span class=\"token number\">85</span><span class=\"token punctuation\">,</span> <span class=\"token number\">71</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> ttt<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        Java<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kotlin.text.StringsKt___StringsKt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">.</span><span class=\"token function\">overload</span><span class=\"token punctuation\">(</span><span class=\"token string\">'java.lang.CharSequence'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">implementation</span><span class=\"token operator\">=</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arg1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#123;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"arg1\"</span><span class=\"token punctuation\">,</span>arg1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            ttt<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>arg1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ttt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">var</span> ret<span class=\"token operator\">=</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span>arg1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n           console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ret:\"</span><span class=\"token punctuation\">,</span>ret<span class=\"token punctuation\">)</span>\n           <span class=\"token keyword\">return</span> ret<span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">//return String.fromCharCode(tt[i++]);</span>\n            \n        <span class=\"token punctuation\">&#125;</span>\n        \n        \n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n  \n    \n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token function\">setImmediate</span><span class=\"token punctuation\">(</span>hookMM<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n\n\n<h2 id=\"最后的exp\"><a href=\"#最后的exp\" class=\"headerlink\" title=\"最后的exp\"></a>最后的exp</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">w&#x3D;&quot;MRCTF&#123;Andr01d_check1n_welc0me_to_MRCTF&#125;&quot;\nprint(len(w))\n\nc&#x3D;[110, 82, 89, 87, 86, 0x5F, 6, 94, 105, 71, 80, 92, 83, 4, 93, 85, 0x6F, 65, 93, 0x6F, 0x7C, 98, 0x73, 100, 0x76]\na&#x3D;[&quot;1&quot;,&quot;1&quot;,&quot;1&quot;,&quot;2&quot;,&quot;5&quot;,&quot;4&quot;,&quot;7&quot;,&quot;0&quot;,&quot;6&quot;,&quot;0&quot;,&quot;5&quot;,&quot;0&quot;,&quot;0&quot;,&quot;4&quot;,&quot;0&quot;,&quot;0&quot;,&quot;0&quot;,&quot;5&quot;,&quot;2&quot;,&quot;0&quot;,&quot;1&quot;,&quot;0&quot;,&quot;0&quot;,&quot;0&quot;,&quot;0&quot;]\nprint(len(a))\nprint(len(c))\nflag&#x3D;&quot;&quot;\nprint(chr(c[0]^1))\n\nfor i in range(len(c)):\n    print(chr(ord(a[i])^c[i]&amp;0xff),end&#x3D;&quot;&quot;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n","feature":null,"text":"前言这次北邮赛，没咋打，唉，忙别的事，太忙了，抽不出时间，但是瞄了一眼，有安卓题，打算摸鱼会，看看怎么回事hhh，毕竟几位出题人都是我大哥，过去签个到不过分吧2333，逻辑不复杂，还是挺友好的。 分析过程jeb3打开，看看逻辑 沉思，是kotlin写的，不过逻辑俺还是看的懂的，发...","link":"","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"writeup","slug":"writeup","count":2,"path":"api/categories/writeup.json"}],"tags":[{"name":"reverse","slug":"reverse","count":2,"path":"api/tags/reverse.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B\"><span class=\"toc-text\">分析过程</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#jeb3%E6%89%93%E5%BC%80%EF%BC%8C%E7%9C%8B%E7%9C%8B%E9%80%BB%E8%BE%91\"><span class=\"toc-text\">jeb3打开，看看逻辑</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%B7%9F%E8%BF%9B%E7%9B%91%E5%90%AC%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%B1%BB\"><span class=\"toc-text\">跟进监听事件的类</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%B7%9F%E8%BF%9B%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%B1%BB\"><span class=\"toc-text\">跟进点击事件的类</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%B7%9F%E8%BF%9Bcheck%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">跟进check方法</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%B7%9F%E8%BF%9Btest%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">跟进test方法</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9C%80%E5%90%8E%E7%9A%84exp\"><span class=\"toc-text\">最后的exp</span></a></li></ol></li></ol>","author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""},"mapped":true,"prev_post":{"title":"关于某apicloud加密的app的逆向分析以及解密","uid":"490dee142b27f79f3072c0e4373d70d3","slug":"关于某apicloud加密的app的逆向分析以及解密","date":"2021-04-11T16:00:43.000Z","updated":"2021-04-11T16:04:54.050Z","comments":true,"path":"api/articles/关于某apicloud加密的app的逆向分析以及解密.json","keywords":null,"cover":"https://www.wahaotu.com/uploads/allimg/202009/1600175614578817.jpg","text":"","link":"","photos":[],"count_time":{"symbolsCount":0,"symbolsTime":"1 mins."},"categories":[{"name":"app实战","slug":"app实战","count":2,"path":"api/categories/app实战.json"}],"tags":[{"name":"a-iCloud","slug":"a-iCloud","count":1,"path":"api/tags/a-iCloud.json"}],"author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""}},"next_post":{"title":"JNI helper插件使用","uid":"7cc37a0c897d960438332a3e8c6a890d","slug":"JNI-helper插件使用","date":"2021-04-07T17:15:59.000Z","updated":"2021-04-07T17:25:53.165Z","comments":true,"path":"api/articles/JNI-helper插件使用.json","keywords":null,"cover":[],"text":"1. 前言看直播的时候，肉丝表哥讲了r2的jni 插件，讲到了jni helper，evi大佬写的一款，自动识别jni类型的插件，兼容了好几款常见的反编译工具，之前也给了github星星的，但是具体怎么使用没去看，这里刚好讲到了，我也了解了下，最终效果还不错，膜 2. 使用过程 ...","link":"","photos":[],"count_time":{"symbolsCount":381,"symbolsTime":"1 mins."},"categories":[{"name":"ida插件","slug":"ida插件","count":2,"path":"api/categories/ida插件.json"}],"tags":[{"name":"ida插件","slug":"ida插件","count":2,"path":"api/tags/ida插件.json"}],"author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""}}}