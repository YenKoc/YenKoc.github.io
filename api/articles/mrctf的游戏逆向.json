{"title":"mrctfçš„æ¸¸æˆé€†å‘","uid":"99d6abf837e88eebd0687f5f9fc4ecea","slug":"mrctfçš„æ¸¸æˆé€†å‘","date":"2021-05-24T05:57:54.000Z","updated":"2021-05-25T23:46:15.368Z","comments":true,"path":"api/articles/mrctfçš„æ¸¸æˆé€†å‘.json","keywords":null,"cover":"https://th.wallhaven.cc/small/z8/z887yw.jpg","content":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ä¹‹å‰ctfä¸­çš„æ¸¸æˆé€†å‘éƒ½æ˜¯æ¯”è¾ƒç›´æ¥ï¼Œéƒ½æ˜¯dnspyç„¶åæœç´¢å…³é”®å­—ï¼Œç„¶åå¼€å§‹é€†å‘çš„ï¼Œæ¯”è¾ƒç®€å•äº›ï¼Œè¿™é¢˜çš„è¯å’Œå…¶ä»–çš„æ¸¸æˆé¢˜è¿˜æ˜¯æœ‰å¾ˆå¤§çš„ä¸åŒçš„ï¼Œæ˜‚å“¥å‡ºçš„é¢˜ç¡®å®æœ‰è´¨é‡ï¼Œåç»­çš„å®˜æ–¹wpä¸­ä¹Ÿæœ‰æ˜‚å“¥ç”¨dllæ³¨å…¥ï¼Œç›´æ¥ç ´æ‰çš„æ“ä½œï¼Œå…ˆçœ‹å‡ é¢˜ï¼Œå¸¸è§„çš„é¢˜ï¼Œä¹‹åå†ä¸è¿™é¢˜è¿›è¡Œä¸€ä¸ªå¯¹æ¯”ã€‚</p>\n<h1 id=\"BJD-hamburger-competition\"><a href=\"#BJD-hamburger-competition\" class=\"headerlink\" title=\"BJD hamburger competition\"></a>BJD hamburger competition</h1><p>è¿™é¢˜æŒºæœ‰èŠ‚ç›®æ•ˆæœçš„ï¼Œè€å…«å¥¥åŠ›ç»™</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524142602.png\"></p>\n<p>ä¼°è®¡å°±æ˜¯æˆ‘ä»¬é€‰æ‹©æ­£ç¡®çš„é£Ÿç‰©ç»„åˆï¼Œç„¶åæ‰èƒ½getflagï¼Œä¸€çœ‹å°±æ˜¯unity3dçš„æ¸¸æˆï¼Œè¿˜æœ‰monoçš„è¿è¡Œåº“ï¼Œå¾ˆæ˜æ˜¾äº†</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524142821.png\"></p>\n<p>å› ä¸ºc#éƒ½ç¼–è¯‘åˆ°Assembly-CSharp.dllä¸­å»äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å…¥æ‰‹ç‚¹åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œdnspyå®‰æ’ä¸Š</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524143038.png\"></p>\n<p>å…ˆé€šè¿‡æœç´¢å­—ç¬¦ä¸²ï¼Œå®šä½ä¸€ä¸‹æ ¸å¿ƒé€»è¾‘</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524143228.png\"></p>\n<p>ç›´æ¥æœåˆ°äº†æ ¸å¿ƒé€»è¾‘äº†ï¼Œæˆ‘ä»¬çœ‹ä¸‹é€»è¾‘ï¼Œçœ‹çœ‹è¦æ€ä¹ˆé€†</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524143406.png\"></p>\n<p>å‘ç°é€»è¾‘å…¶å®å¾ˆç®€å•ï¼Œå’Œä¹‹å‰çŒœæƒ³çš„ä¸€æ ·ï¼Œå°±æ˜¯ä¸åŒé£Ÿæçš„ç»„åˆï¼Œä¸åŒé£Ÿæå¯¹åº”çš„ä¸åŒåˆ†æ•°ï¼Œæ°å¥½ç»„åˆæ‰å¯ä»¥getflagï¼Œå‘ç°æ˜¯é™¤äº†æ±‰å ¡é¡¶å’Œåº•ï¼Œ7ç§é£Ÿç‰©è¦é€‰4ç§ï¼Œç›´æ¥çˆ†ç ´æ‰€æœ‰æƒ…å†µï¼Œä¸è¿‡ä¹Ÿæœ‰éé¢„æœŸè§£ï¼Œå°±æ˜¯ç›´æ¥sha1è§£å¼€</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">import hashlib\ndef enc(a):\n    tmp&#x3D;997\n    for i in a:\n        if i&#x3D;&#x3D;1:\n            tmp-&#x3D;127\n        elif i&#x3D;&#x3D;2:\n            tmp*&#x3D;3\n        elif i&#x3D;&#x3D;3:\n            tmp^&#x3D;18\n        elif i&#x3D;&#x3D;4:\n            tmp+&#x3D;29\n        elif i&#x3D;&#x3D;5:\n            tmp-&#x3D;47\n        elif i&#x3D;&#x3D;6:\n            tmp*&#x3D;5\n        elif i&#x3D;&#x3D;7:\n            tmp^&#x3D;87\n    tmp^&#x3D;127\n    return str(tmp)\nindex&#x3D;[1,2,3,4,5,6,7]\nres&#x3D;[]\nfor yk1 in index:\n    for yk2 in index:\n        for yk3 in index:\n            for yk4 in index:\n                res.append(yk1)\n                res.append(yk2)\n                res.append(yk3)\n                res.append(yk4)\n                t&#x3D;enc(res).encode(&quot;utf-8&quot;)\n                if (hashlib.sha1(t).hexdigest().upper()&#x3D;&#x3D;&quot;DD01903921EA24941C26A48F2CEC24E0BB0E8CC7&quot;):\n                    print t\n                res&#x3D;[]\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"MRCTF-EZ-GAME\"><a href=\"#MRCTF-EZ-GAME\" class=\"headerlink\" title=\"MRCTF EZ_GAME\"></a>MRCTF EZ_GAME</h1><p>è¿™é¢˜æœ‰ä¸¤ç§åšæ³•ï¼Œä¸€ç§æ˜¯éªšæ“ä½œï¼Œä¸€ç§å°±æ˜¯æ­£å¸¸çš„æ€è·¯ï¼Œdllæ³¨å…¥</p>\n<p>å…ˆé‡æ¸©ä¸‹éªšæ“ä½œï¼Œä¸å¾—ä¸è¯´ï¼Œç°åœ¨çš„éªšæ“ä½œç¡®å®çŒ›ä¸”éªšï¼Œå“ˆå“ˆå“ˆ</p>\n<p>ç¬¬ä¸€æ­¥å…ˆæ‰“å¼€æ–‡ä»¶å¤¹ï¼Œçœ‹ä¸‹è¿™ä¸ªç¨‹åºçš„æ¶æ„ï¼Œä¸€çœ‹å°±æ˜¯unityï¼Œä½†æ˜¯ç°åœ¨unityè¿˜æœ‰icppï¼Œä¸ºäº†æé«˜è¿è¡Œé€Ÿåº¦ï¼Œæ‰€ä»¥éœ€è¦å»è¯†åˆ«çš„ä¸‹ï¼Œ</p>\n<p>å‘ç°å°±æ˜¯I2cppçš„</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524181254.png\"></p>\n<p>ç„¶åå‡ºé¢˜äººæœ‰ç‚¹ç‹ ï¼Œç›´æ¥åŠ çš„æ˜¯themidaçš„å£³ï¼Œä¸è®²æ­¦å¾·ï¼ï¼Œè¿™ç§é¢˜i2cppè¿˜æ˜¯æœ‰ç°æˆçš„å·¥å…·å»æŸ¥çœ‹ä¸€äº›ç±»ä¿¡æ¯çš„ï¼Œä¸è¿‡é€šè¿‡ç±»ä¿¡æ¯å»å®šä½æ ¸å¿ƒé€»è¾‘ï¼Œä¼°è®¡æ˜¯å‡‰äº†ï¼Œæ¯•ç«ŸåŠ äº†å¼ºå£³ï¼Œä¸è¿‡è¿˜æ˜¯å¯ä»¥å¯¹æˆ‘ä»¬çš„åˆ†æèµ·åˆ°å¾ˆå…³é”®çš„åœ°æ–¹çš„ï¼Œè¿™ä¸ªå·¥å…·å«II2CppDumperï¼Œæ”¾ä¸‹githubé“¾æ¥. <a href=\"https://github.com/Perfare/Il2CppDumper%EF%BC%8C%E8%AE%B0%E5%BE%97%E7%9B%B4%E6%8E%A5%E4%B8%8B%E7%BC%96%E8%AF%91%E5%A5%BD%E7%9A%84\">https://github.com/Perfare/Il2CppDumperï¼Œè®°å¾—ç›´æ¥ä¸‹ç¼–è¯‘å¥½çš„</a></p>\n<p>ç”¨æ³•å¦‚ä¸‹:</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524195928.png\"></p>\n<p>ç„¶ååœ¨ç”Ÿæˆçš„Dumpdllæ–‡ä»¶å¤¹ä¸‹é¢æ‰¾åˆ°Assemableæ–‡ä»¶ï¼Œæ‹–å…¥dnspyï¼Œå¯ä»¥æŸ¥çœ‹ä¸€äº›ç±»ä¿¡æ¯å’Œå®šä¹‰</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524200324.png\"></p>\n<p>å¯ä»¥å‘ç°è¿™é¢˜æ— æ³•ç”¨ceæå‡ºæ¥ï¼Œå› ä¸ºå‘ç°ä¸ä»…ä»…æ˜¯æ•°é‡ä¿®æ”¹äº†ï¼Œå°±å®Œäº‹äº†ï¼Œå› ä¸ºè¿™ä¸ªkeyçš„updateæ˜¯è¦æ ¹æ®åƒçš„æ˜Ÿæ˜Ÿï¼Œæ¯åƒä¸€ä¸ªï¼Œè®¡ç®—ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»åƒæ»¡105ä¸ªæ˜Ÿæ˜Ÿï¼Œupdateäº†105æ¬¡ï¼Œæ‰æ˜¯æ­£ç¡®çš„keyï¼Œè¿™ç‚¹æˆ‘ä»¬å¯ä»¥ç”¨ceåšä¸€ä¸ªéªŒè¯,å“¦å¯¹ï¼Œæœ¬æ¥è¿™äº›ä¿¡æ¯çš„rvaï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªåç§»ï¼Œç›´æ¥æ‰“å¼€idaå»çœ‹çš„ï¼Œç„¶è€ŒåŠ äº†å£³ï¼Œä½ æ‡‚çš„ï¼Œéš¾é¡¶ã€‚</p>\n<h2 id=\"ceçš„æ“ä½œ\"><a href=\"#ceçš„æ“ä½œ\" class=\"headerlink\" title=\"ceçš„æ“ä½œ\"></a>ceçš„æ“ä½œ</h2><p>å…ˆæ‰“å¼€ceï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯é£å¶äººçš„åŠ å¼ºç‰ˆï¼Œç¡®å®ğŸ‚ï¼Œå¯¹ç»“æ„ä½“ä»¥åŠç±»è¿™å—æœ‰åŠ å¼ºï¼ŒæŒºé¦™çš„ï¼Œæˆ‘ä»¬å…ˆåƒå‡ ä¸ªæ˜Ÿæ˜Ÿï¼Œç„¶åå¼€å§‹å†…å­˜æœç´¢ï¼Œçœ‹çœ‹æ˜¯å“ªé‡Œåœ¨ä¿®æ”¹</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524202808.png\"></p>\n<p>å‘ç°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Œåé¢çš„å…«ä¸ªå­—èŠ‚ä¸€ç›´åœ¨å˜åŠ¨ï¼Œç„¶åæˆ‘æ ‡æ³¨çš„åœ°æ–¹å°±æ˜¯ä¹‹å‰æˆ‘ä»¬æ­»äº¡çš„æ¬¡æ•°ï¼Œè¿™ä¸ªç»“æ„æ˜¯å¯ä»¥å®Œå…¨å¯¹åº”ä¸Šä¹‹å‰æˆ‘ä»¬ç”¨å·¥å…·æå‡ºæ¥çš„ç±»å®šä¹‰çš„ä¿¡æ¯çš„ï¼Œ</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524203201.png\"></p>\n<p>okçš„ï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„çŒœæƒ³æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•å»æ‰¾åˆ°è¿™ä¸ªupdatekeyçš„åœ°æ–¹å‘¢ï¼Œceæœ‰è¿™ä¸ªåŠŸèƒ½å»è·Ÿè¸ªæ˜¯å“ªé‡Œæ”¹å†™äº†è¿™ä¸ªåœ°å€ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ›´å¿«çš„æ‰¾åˆ°æ ¸å¿ƒé€»è¾‘ï¼Œè¿™ä¸ªå¼ºå£³ï¼Œæœ‰äº›åè°ƒè¯•ï¼Œæ‰€ä»¥éœ€è¦å»è®¾ç½®ä¸‹ce</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524204147.png\"></p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524204229.png\"></p>\n<p>ä¼šå¼¹å‡ºæ—è¾¹çš„é‚£ä¸ªçª—ï¼Œä¸ç®¡å®ƒï¼Œå†å»åƒé’»çŸ³ï¼Œå»è§¦å‘è¿™ä¸ªå†…å­˜æ–­ç‚¹ï¼ˆæˆ‘ä¼°è®¡å°±æ˜¯ä¸‹äº†ä¸€ä¸ªå†…å­˜è®¿é—®çš„æ–­ç‚¹ï¼‰,å‘ç°æˆåŠŸè§¦å‘äº†</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524204437.png\"></p>\n<p>è¿™é‡Œå¯ä»¥é€‰æ‹©ç›´æ¥æ’¸æ±‡ç¼–ï¼Œä¸è¿‡å¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯é€‰æ‹©ä»å†…å­˜ä¸­dumpä¸‹æ¥ï¼Œç„¶åidaæ‰“å¼€ï¼Œé˜…è¯»ä¼ªä»£ç å¥½ä¸€äº›</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524210142.png\"></p>\n<p>ç›´æ¥ç«ç»’å‰‘å®‰æ’ä¸Šï¼ŒæŠŠå†…å­˜å…ˆdumpä¸‹æ¥</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524210305.png\"></p>\n<p>ç”¨idaæ‰“å¼€ä¹‹åï¼Œæœ‰äº›ç»“æ„è¢«æ‰“ä¹±äº†ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»æ‰¾å‡½æ•°å¤´</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524220701.png\"></p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524220638.png\"></p>\n<p>æŠŠåˆå§‹çš„å€¼æ‹¿å‡ºæ¥ï¼Œç„¶åæœ¬åœ°å¤ç°åŠ å¯†ç®—æ³•ï¼Œå†å¡«å……å›ceå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°flagäº†ï¼Œå†²</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">#include &lt;cstdio&gt;\n#include &quot;defs.h&quot;\nvoid calc(__int64* key)\n&#123;\n    for (int i &#x3D; 0; i &lt; 4; i++)\n    &#123;\n        __int64 k &#x3D; 1, l &#x3D; 0;\n        for (__int64 j &#x3D; 0; j &lt; 64; j++)\n        &#123;      \n            l ^&#x3D; (unsigned __int64)(k &amp; *key) &gt;&gt; (j &amp; 0x3F);\n            k &#x3D; __ROL8__(k, 1);\n        &#125;\n        *key &#x3D; l | (2 * *key);\n    &#125;\n&#125;\n\nint main()\n&#123;\n    __int64 key &#x3D; 0xDEADBEEFAA114514;\n    for (int i &#x3D; 0; i &lt; 105; i++)\n        calc(&amp;key);\n    printf(&quot;0x%llX&quot;, key);\n    return 0;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>æ‹¿åˆ°æœ€ç»ˆçš„keyï¼Œç„¶åå°±æ˜¯é‡æ–°å¯åŠ¨æ¸¸æˆï¼Œç›´æ¥å¡«å……æ•°æ®ï¼Œ0xEA8451453BD5B7DD, æŠŠå¯¹åº”åç§»çš„å†…å­˜åœ°å€çš„å€¼éƒ½å¡«ä¸Šï¼Œå°±èƒ½æ‹¿åˆ°flagäº†</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524222205.png\"></p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210524222137.png\"></p>\n<h1 id=\"DLLæ³¨å…¥\"><a href=\"#DLLæ³¨å…¥\" class=\"headerlink\" title=\"DLLæ³¨å…¥\"></a>DLLæ³¨å…¥</h1><p>åˆ©ç”¨i2cppå¯¼å‡ºçš„å‡½æ•°ï¼Œç„¶åå¯ä»¥åˆ©ç”¨è¿™äº›å¯¼å‡ºå‡½æ•°ç±»ä¼¼åå°„çš„åŠŸèƒ½ï¼Œåˆå› ä¸ºæˆ‘ä»¬æŠŠdllæ³¨å…¥è¿›å»äº†ï¼Œä¹Ÿæ˜¯åŒä¸€ä¸ªè¿›ç¨‹äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å»ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ˜¯å…¨å±€çš„ï¼Œç»å¯¹æœ‰å½±å“çš„</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210525115027.png\"></p>\n<p>ä»¥ä¸Šå°±æ˜¯å¤§è‡´çš„å¯¼å‡ºå‡½æ•°ï¼Œç„¶ååˆ©ç”¨ GetProcAddress(dll_name,api_name)ï¼Œè·å–æ¯ä¸ªå¯¼å‡ºå‡½æ•°çš„åœ°å€ï¼Œç„¶åæŠŠæ¯ä¸ªapiçš„åœ°å€éƒ½å­˜æ”¾åˆ°ä¸€ä¸ªæ•°æ®ç»“æ„é‡Œé¢çš„ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯è¿™æ ·çš„</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">void getclass(PTR clazz,void *data)\n&#123;\n    char *str&#x3D;(char*)il2cpp_class_get_name(clazz);\n    if(!strcmp(str,&quot;GetFlag&quot;))\n    &#123;\n        \n        void *iter&#x3D;0;\n        PTR method&#x3D;NULL;\n        do \n        &#123;\n            method&#x3D;il2cpp_class_get_methods(clazz,&amp;iter);\n            char *name&#x3D;il2cpp_method_get_name(method);\n            \n            if(!strcmp(name,&quot;EatTokenUpdateKey&quot;))\n            &#123;\n                MessageBoxA(NULL,name,name,NULL);\n                PTR eatCookie&#x3D;il2cpp_class_get_field_from_name(clazz,&quot;eatCookie&quot;);\n                PTR goHome&#x3D;il2cpp_class_get_field_from_name(clazz,&quot;goHome&quot;);\n                PTR findAlien&#x3D;il2cpp_class_get_field_from_name(clazz,&quot;findAlien&quot;);\n                bool b&#x3D;true;\n                PTR b_ptr&#x3D;(PTR)&amp;b;\n                il2cpp_field_static_set_value(eatCookie,b_ptr);\n                il2cpp_field_static_set_value(goHome,b_ptr);\n                il2cpp_field_static_set_value(findAlien,b_ptr);\n                PTR o&#x3D;NULL;\n                PTR objs[1]&#x3D;&#123;NULL&#125;;\n                for(int i&#x3D;0;i&lt;105;i++)\n                    il2cpp_runtime_invoke(method,(PTR)&amp;o,objs);\n                return;\n            &#125;\n        &#125;while(method!&#x3D;NULL);\n        \n    &#125;\n    \n    \n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>ç„¶åè‡³äºä¸ºä»€ä¹ˆdllæ³¨å…¥ä¹‹åï¼Œå°±ä¼šå¯åŠ¨æŸä¸ªå‡½æ•°çš„å‘¢ï¼Œè¿™ä¸ªæˆ‘ä¹Ÿæ˜¯æŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œå‘ç°æ¯ä¸ªDLLéƒ½æœ‰ä¸€ä¸ªå…¥å£ç‚¹å‡½æ•°ï¼Œç³»ç»Ÿä¼šåœ¨ä¸åŒæ—¶åˆ»è¿›è¡Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚è¿™é‡Œ,å°±æ˜¯æ³¨å…¥çš„dllçš„å‡½æ•°å…¥å£ç‚¹ï¼Œ</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">BOOL APIENTRY DllMain(HMODULE hModule,DWORD  ul_reason_for_call,LPVOID lpReserved)\n&#123;\n    \n    switch (ul_reason_for_call)\n    &#123;\n        case DLL_PROCESS_ATTACH:\n            FillFunctionTable();\n            il2cpp_class_for_each(getclass,NULL); &#x2F;&#x2F;éå†æ¯ä¸ªç±»ï¼ŒæŸ¥çœ‹æ˜¯å¦æ˜¯æˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ªç±»\n            if(enable_hijack)\n            &#123;\n                main_dll&#x3D;LoadLibraryA(&quot;UnityPlayer_Original.dll&quot;);\n                if(main_dll&#x3D;&#x3D;NULL)\n                &#123;\n                    MessageBoxA(NULL,&quot;Error&quot;,&quot;Error&quot;,MB_OK);\n                    TerminateProcess(GetCurrentProcess(),0);\n                    return FALSE;\n                &#125;\n                else\n                    UnityMainCall&#x3D;(PTR (*)())GetProcAddress(main_dll,&quot;UnityMain&quot;);\n            &#125;\n            &#x2F;&#x2F;Sleep(10000);\n           \n            &#x2F;&#x2F;il2cpp_alloc(64);\n            break;\n        case DLL_PROCESS_DETACH:\n            if(enable_hijack)\n                FreeLibrary(main_dll);\n            break;\n    &#125;\n    return TRUE;\n&#125;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>è‡³äºä»€ä¹ˆæ—¶åˆ»ï¼Œæ€ä¹ˆè¾¨åˆ«ï¼Œå°±æ˜¯é ä¼ å…¥çš„ä¿¡å·å€¼ï¼Œä¸åŒæ¥è¾¨åˆ«ï¼Œæ¯”å¦‚DLL_PROCESS_ATTACHï¼Œå°±æ˜¯å½“dllè½½å…¥å†…å­˜ç©ºé—´æ—¶ï¼Œè¿›è¡Œè°ƒç”¨ï¼Œå…¶ä»–çš„è°ƒç”¨æ–¹å¼ï¼Œçœ‹ä¸‹å›¾(copyå¾—åˆ°):</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">2.æ¯ä¸ªDLLéƒ½å¯ä»¥æœ‰ä¸€ä¸ªå…¥å£ç‚¹å‡½æ•°DllMain,ç³»ç»Ÿä¼šåœ¨ä¸åŒçš„æ—¶åˆ»è°ƒç”¨æ­¤å‡½æ•°ã€‚ä»¥ä¸‹æ˜¯DllMainçš„ä¸€èˆ¬å½¢å¼ï¼š\n\nBOOL WINAPI DllMain(\n    HINSTANCE hinstDLL,  &#x2F;&#x2F; handle to DLL module\n    DWORD fdwReason,     &#x2F;&#x2F; reason for calling function\n    LPVOID lpReserved )  &#x2F;&#x2F; reserved\n&#123;\n    &#x2F;&#x2F; Perform actions based on the reason for calling.\n    switch( fdwReason ) \n    &#123; \n        case DLL_PROCESS_ATTACH:\n         &#x2F;&#x2F; Initialize once for each new process.\n         &#x2F;&#x2F; Return FALSE to fail DLL load.\n            break;\n\n        case DLL_THREAD_ATTACH:\n         &#x2F;&#x2F; Do thread-specific initialization.\n            break;\n\n        case DLL_THREAD_DETACH:\n         &#x2F;&#x2F; Do thread-specific cleanup.\n            break;\n\n        case DLL_PROCESS_DETACH:\n         &#x2F;&#x2F; Perform any necessary cleanup.\n            break;\n    &#125;\n    return TRUE;  &#x2F;&#x2F; Successful DLL_PROCESS_ATTACH.\n&#125;\nå…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ä¼ é€’è¿›æ¥çš„å‚æ•°ï¼š\n1ã€ HINSTANCE hinstDLL\nè¿™ä¸ªå‚æ•°æ˜¯è¯¥DLLå®ä¾‹çš„å¥æŸ„ï¼Œä¹Ÿå°±æ˜¯æ­¤DLLæ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´åï¼Œåœ¨è¯¥è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„ä½ç½®ã€‚\n2ã€ DWORD fdwReason\næ­¤å‚æ•°æ ‡ç¤ºäº†è°ƒç”¨DllMainå‡½æ•°çš„åŸå› ã€‚æœ‰å››ç§å€¼ï¼Œå°±æ˜¯å‡½æ•°ä¸­caseåçš„å–å€¼ã€‚å„ä¸ªå–å€¼çš„å«ä¹‰ï¼Œç¨åè®ºè¿°ã€‚\n3ã€ LPVOID lpReserved \nä¿ç•™ã€‚\n\nç°åœ¨æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹fdwReasonçš„å››ç§å–å€¼ï¼Œè¿™äº›å–å€¼ï¼Œä¹Ÿç›´æ¥åæ˜ äº†æ“ä½œç³»ç»Ÿä¼šåœ¨ä½•ç§æƒ…å†µä¸‹è°ƒç”¨DllMainã€‚\n1ã€DLL_PROCESS_ATTACH\nå½“ç³»ç»Ÿç¬¬ä¸€æ¬¡å°†ä¸€ä¸ªDLLæ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ä¸­æ—¶ï¼Œä¼šè°ƒç”¨DllMainï¼Œå¹¶ä¸ºfdwReasonä¼ å…¥DLL_PROCESS_ATTACHã€‚\næ³¨æ„ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡æ˜ å°„çš„æ—¶å€™ï¼Œæ‰ä¼šè¿™æ ·ã€‚å¦‚ä¹‹åï¼Œå¦ä¸€çº¿ç¨‹å†æ¬¡æ˜¾å¼åŠ è½½æ­¤DLLï¼Œåˆ™æ“ä½œç³»ç»Ÿåªæ˜¯å¢åŠ è¯¥DLLçš„ä½¿ç”¨è®¡æ•°ï¼Œè€Œä¸ä¼šå†æ¬¡ä½¿ç”¨DLL_PROCESS_ATTACHæ¥è°ƒç”¨DllMainã€‚\nå¯¹DLL_PROCESS_ATTACHçš„å¤„ç†ï¼Œä»£è¡¨äº†DLLçš„åˆå§‹åŒ–ã€‚\nDllMainçš„è¿”å›å€¼ï¼Œä¹Ÿæ˜¯é’ˆå¯¹DLL_PROCESS_ATTACHæ¶ˆæ¯çš„ã€‚å¯¹äºå…¶ä½™çš„ä¸‰ç§å–å€¼ï¼Œä¸èµ·ä½œç”¨ã€‚\nå¯¹äºéšå¼åŠ è½½ï¼Œå¦‚DllMainè¿”å›FALSEï¼Œåˆ™ç¨‹åºä¼šå¯åŠ¨å¤±è´¥ã€‚å¯¹äºæ˜¾å¼åŠ è½½ï¼Œåˆ™ä¼šä½¿LoadLibraryè¿”å›NULLã€‚\n2ã€DLL_PROCESS_DETACH\nå½“ç³»ç»Ÿå°†ä¸€ä¸ªDLLä»è¿›ç¨‹åœ°å€ç©ºé—´ä¸­æ’¤é”€æ˜ å°„æ—¶ï¼Œåˆ™ä¼šå‘DllMainä¼ å…¥DLL_PROCESS_DETACHã€‚æˆ‘ä»¬åº”å½“åœ¨æ­¤å¤„æ”¾ç½®ä¸€äº›æ¸…ç†ä»£ç ã€‚\nå½“ä½¿ç”¨FreeLibraryæ—¶ï¼Œå¦‚è¯¥çº¿ç¨‹çš„ä½¿ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šä½¿ç”¨DLL_PROCESS_DETACHæ¥è°ƒç”¨DllMainã€‚å¦‚ä½¿ç”¨è®¡æ•°å¤§äº0ï¼Œåˆ™åªæ˜¯å•çº¯çš„å‡å°‘è¯¥DLLçš„è®¡æ•°ã€‚\n3ã€DLL_THREAD_ATTACH\nå½“è¿›ç¨‹åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ™ç³»ç»Ÿä¼šæ£€æŸ¥å½“å‰å·²æ˜ å°„åˆ°è¯¥è¿›ç¨‹ç©ºé—´ä¸­çš„æ‰€æœ‰DLLæ˜ åƒï¼Œå¹¶ç”¨DLL_THREAD_ATTACHæ¥è°ƒç”¨æ¯ä¸ªDLLçš„DllMainã€‚\nåªæœ‰å½“æ‰€æœ‰DLLéƒ½å®Œæˆäº†å¯¹DLL_THREAD_ATTACHçš„å¤„ç†åï¼Œæ–°çº¿ç¨‹æ‰ä¼šæ‰§è¡Œå®ƒçš„çº¿ç¨‹å‡½æ•°ã€‚\nå¦å¤–ï¼Œä¸»çº¿ç¨‹ä¸å¯èƒ½ç”¨DLL_THREAD_ATTACHæ¥è°ƒç”¨DllMainï¼Œå› ä¸ºä¸»çº¿ç¨‹å¿…ç„¶æ˜¯åœ¨è¿›ç¨‹åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç”¨DLL_PROCESS_ATTACHè°ƒç”¨DllMainçš„ã€‚\n4ã€DLL_THREAD_DETACH\nçº¿ç¨‹è‹¥è¦ç»ˆæ­¢ï¼Œä¼šè°ƒç”¨ExitThreadï¼Œä½†æ˜¯æ­¤å‡½æ•°ä¸ä¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹ï¼Œè€Œæ˜¯ä¼šåˆ©ç”¨DLL_THREAD_DETACHæ¥è°ƒç”¨å½“å‰è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„æ‰€æœ‰DLLé•œåƒçš„DllMain.\nå½“æ¯ä¸ªDLLçš„DllMainéƒ½å¤„ç†å®Œåï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£çš„ç»“æŸçº¿ç¨‹ã€‚<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n","feature":null,"text":"å‰è¨€ä¹‹å‰ctfä¸­çš„æ¸¸æˆé€†å‘éƒ½æ˜¯æ¯”è¾ƒç›´æ¥ï¼Œéƒ½æ˜¯dnspyç„¶åæœç´¢å…³é”®å­—ï¼Œç„¶åå¼€å§‹é€†å‘çš„ï¼Œæ¯”è¾ƒç®€å•äº›ï¼Œè¿™é¢˜çš„è¯å’Œå…¶ä»–çš„æ¸¸æˆé¢˜è¿˜æ˜¯æœ‰å¾ˆå¤§çš„ä¸åŒçš„ï¼Œæ˜‚å“¥å‡ºçš„é¢˜ç¡®å®æœ‰è´¨é‡ï¼Œåç»­çš„å®˜æ–¹wpä¸­ä¹Ÿæœ‰æ˜‚å“¥ç”¨dllæ³¨å…¥ï¼Œç›´æ¥ç ´æ‰çš„æ“ä½œï¼Œå…ˆçœ‹å‡ é¢˜ï¼Œå¸¸è§„çš„é¢˜ï¼Œä¹‹åå†ä¸è¿™é¢˜è¿›è¡Œä¸€ä¸ªå¯¹æ¯”ã€‚ BJD hamb...","link":"","photos":[],"count_time":{"symbolsCount":"8k","symbolsTime":"7 mins."},"categories":[{"name":"gameReverse","slug":"gameReverse","count":1,"path":"api/categories/gameReverse.json"}],"tags":[{"name":"reverse","slug":"reverse","count":22,"path":"api/tags/reverse.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">å‰è¨€</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#BJD-hamburger-competition\"><span class=\"toc-text\">BJD hamburger competition</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#MRCTF-EZ-GAME\"><span class=\"toc-text\">MRCTF EZ_GAME</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ce%E7%9A%84%E6%93%8D%E4%BD%9C\"><span class=\"toc-text\">ceçš„æ“ä½œ</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#DLL%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">DLLæ³¨å…¥</span></a></li></ol>","author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""},"mapped":true,"prev_post":{"title":"windowsä¸Šåè°ƒè¯•çš„ä¸€äº›æ€»ç»“","uid":"29c90278776b9ceb230f70e3bee57549","slug":"windowsä¸Šåè°ƒè¯•çš„ä¸€äº›æ€»ç»“","date":"2021-05-27T17:25:12.000Z","updated":"2021-06-04T06:01:07.572Z","comments":true,"path":"api/articles/windowsä¸Šåè°ƒè¯•çš„ä¸€äº›æ€»ç»“.json","keywords":null,"cover":"https://w.wallhaven.cc/full/57/wallhaven-57ly31.jpg","text":"å‰è¨€åè°ƒè¯•ï¼Œåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯é™æ€åè°ƒè¯•ï¼Œå¦ä¸€ç§æ˜¯åŠ¨æ€åè°ƒè¯•ï¼Œè¿™ä¸¤è€…ä¸»è¦çš„ç›®çš„ä¹Ÿä¸åŒï¼Œç¬¬ä¸€ç§çš„æ ¸å¿ƒç›®çš„æ˜¯æ£€æµ‹è°ƒè¯•å™¨ï¼Œè€Œç¬¬äºŒç§çš„æ ¸å¿ƒç›®çš„å…¶å®å°±æ˜¯ä¸ºäº†éšè—ä»£ç å’Œæ•°æ®çš„ï¼Œç¬¬ä¸€ç§çš„ç±»ä¼¼xxdebugpresentï¼Œç¬¬äºŒç§ç±»ä¼¼åŒè¿›ç¨‹ä¿æŠ¤ï¼Œå¼‚å¸¸å¤„ç†ç­‰åè°ƒè¯•æ‰‹æ®µï¼Œç¬¬ä¸€ç§çš„è¯å®é™…ä¸Šä¸€æ¬¡ç ´è§£ç»“æŸåï¼Œ...","link":"","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[{"name":"é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†","slug":"é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†","count":1,"path":"api/categories/é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†.json"}],"tags":[{"name":"åè°ƒè¯•","slug":"åè°ƒè¯•","count":1,"path":"api/tags/åè°ƒè¯•.json"}],"author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""}},"next_post":{"title":"pintool in CTF","uid":"884cdb3da3fbfd31ea764ff186f03018","slug":"pintool-in-CTF","date":"2021-05-22T12:28:18.000Z","updated":"2021-05-24T05:55:57.655Z","comments":true,"path":"api/articles/pintool-in-CTF.json","keywords":null,"cover":"https://th.wallhaven.cc/small/6o/6oqzgq.jpg","text":"å‰è¨€çªç„¶å‘ç°pintoolså¯¹ä¸€äº›å•å­—èŠ‚éªŒè¯çš„é¢˜ç›®è¿˜æŒºå¥½ä½¿çš„ï¼Œæ‰€ä»¥å°±æ‰“ç®—æ•´æ•´å­¦å­¦ï¼Œå”‰ï¼Œå°±æ˜¯ç©ï¼Œ2333 å®‰è£…(ubuntu16.04)ä¸è¦é—®æˆ‘ï¼Œkaliæ€ä¹ˆè£…ï¼Œåº”è¯¥æ˜¯ä¸€æ ·çš„ï¼‰,æ— è„‘è¾“å…¥ä¸‹é¢çš„shellå‘½ä»¤å°±å®Œäº‹äº† wget -c https:&#x2F;&#x2F;softwar...","link":"","photos":[],"count_time":{"symbolsCount":"5.5k","symbolsTime":"5 mins."},"categories":[{"name":"pintool","slug":"pintool","count":1,"path":"api/categories/pintool.json"}],"tags":[{"name":"reverse","slug":"reverse","count":22,"path":"api/tags/reverse.json"}],"author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""}}}