{"title":"rctf 2018 Simple vm","uid":"f39a6fe1a2cc6526ddedf18113d11661","slug":"rctf-2018-Simple-vm","date":"2021-05-21T02:23:22.000Z","updated":"2021-05-21T07:51:03.131Z","comments":true,"path":"api/articles/rctf-2018-Simple-vm.json","keywords":null,"cover":[],"content":"<p>给了两个文件，一个是vm，一个是opcode文件，ida打开后</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210521102734.png\"></p>\n<p>打开了bin文件，然后将文件内容读取出来，继续进入下一个函数里面分析</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210521102857.png\"></p>\n<p>是一个非常明显的while switch case的解释器，ptr存着就是上面读取的opcode文件内存，这就是属于是那种已经给定了opcode，我们需要逆向解释器，结合opcode文件，推出flag，这里我就不打算把映射搞出来了，我这里的手法就是去跟踪数据流，也就是我的输入究竟经过了什么样的处理？ 需要去搞明白，为了加快我的调试速度，我先把伪代码抠下来，然后把伪代码的执行流程进行了打印</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">#include&lt;iostream&gt;\n#include&lt;cstring&gt;\n#include&lt;map&gt;\n#include &quot;defs.h&quot;\nusing namespace std;\nconst int maxm&#x3D;2e3+5;\n\nint main()&#123;\n    __int64 v0; &#x2F;&#x2F; rax\n    _BYTE *v1; &#x2F;&#x2F; rbp\n    int v2; &#x2F;&#x2F; ebx\n    __int64 v4; &#x2F;&#x2F; rdx\n    __int64 v5; &#x2F;&#x2F; rax\n    __int64 v6; &#x2F;&#x2F; rax\n    __int64 v7; &#x2F;&#x2F; rax\n    __int64 v8; &#x2F;&#x2F; rax\n    __int64 v9; &#x2F;&#x2F; rax\n    int v10; &#x2F;&#x2F; eax\n    __int64 v11; &#x2F;&#x2F; rax\n    char v12; &#x2F;&#x2F; dl\n    int v13; &#x2F;&#x2F; eax\n    int v14; &#x2F;&#x2F; eax\n    _BYTE *v15; &#x2F;&#x2F; rax\n    __int64 v16; &#x2F;&#x2F; rax\n    __int64 v17; &#x2F;&#x2F; rax\n    __int64 v18; &#x2F;&#x2F; rax\n    unsigned char ptr[396] &#x3D; &#123;\n            0x01, 0x30, 0x00, 0x00, 0x00, 0x10, 0x18, 0x43, 0x14, 0x15, 0x47, 0x40, 0x17, 0x10, 0x1D, 0x4B,\n            0x12, 0x1F, 0x49, 0x48, 0x18, 0x53, 0x54, 0x01, 0x57, 0x51, 0x53, 0x05, 0x56, 0x5A, 0x08, 0x58,\n            0x5F, 0x0A, 0x0C, 0x58, 0x09, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x00, 0x00, 0x00, 0x00,\n            0x15, 0x00, 0x01, 0x00, 0x00, 0x0E, 0x12, 0x0B, 0x0C, 0x00, 0x01, 0x00, 0x00, 0x35, 0x00, 0x00,\n            0x00, 0x66, 0x15, 0x10, 0x01, 0x00, 0x00, 0x0E, 0x0A, 0x66, 0x16, 0x0C, 0x10, 0x01, 0x00, 0x00,\n            0x47, 0x00, 0x00, 0x00, 0x66, 0x03, 0x40, 0x01, 0x00, 0x00, 0x10, 0x11, 0xF1, 0x00, 0x00, 0x00,\n            0x13, 0x04, 0x43, 0x01, 0x00, 0x00, 0x08, 0x04, 0x41, 0x01, 0x00, 0x00, 0x10, 0x03, 0x40, 0x01,\n            0x00, 0x00, 0x08, 0x04, 0x42, 0x01, 0x00, 0x00, 0x03, 0x41, 0x01, 0x00, 0x00, 0x03, 0x43, 0x01,\n            0x00, 0x00, 0x08, 0x10, 0x03, 0x42, 0x01, 0x00, 0x00, 0x08, 0x04, 0x44, 0x01, 0x00, 0x00, 0x66,\n            0x03, 0x40, 0x01, 0x00, 0x00, 0x11, 0xF1, 0x00, 0x00, 0x00, 0x10, 0x03, 0x44, 0x01, 0x00, 0x00,\n            0x16, 0x05, 0x40, 0x01, 0x00, 0x00, 0x0E, 0x06, 0x40, 0x01, 0x00, 0x00, 0x0C, 0x45, 0x01, 0x00,\n            0x00, 0x55, 0x00, 0x00, 0x00, 0x66, 0x03, 0x46, 0x01, 0x00, 0x00, 0x11, 0x05, 0x00, 0x00, 0x00,\n            0x13, 0x10, 0x03, 0x46, 0x01, 0x00, 0x00, 0x11, 0x11, 0x01, 0x00, 0x00, 0x13, 0x17, 0x18, 0x60,\n            0x01, 0x00, 0x00, 0x0C, 0x46, 0x01, 0x00, 0x00, 0xB6, 0x00, 0x00, 0x00, 0x01, 0x76, 0x01, 0x00,\n            0x00, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n            0x0A, 0x49, 0x6E, 0x70, 0x75, 0x74, 0x20, 0x46, 0x6C, 0x61, 0x67, 0x3A, 0x00, 0x00, 0x00, 0x0F,\n            0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n            0x20, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n            0x05, 0x57, 0x72, 0x6F, 0x6E, 0x67, 0x0A, 0x52, 0x69, 0x67, 0x68, 0x74, 0x0A, 0x00, 0x00, 0x00,\n            0x15, 0x50, 0x01, 0x00, 0x00, 0x0E, 0x12, 0x0B, 0x0C, 0x50, 0x01, 0x00, 0x00, 0x65, 0x01, 0x00,\n            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x15, 0x56, 0x01, 0x00, 0x00, 0x0E, 0x12, 0x0B, 0x0C, 0x50,\n            0x01, 0x00, 0x00, 0x7B, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00\n    &#125;;\n    unsigned int test&#x3D;~(0xffffffdf&amp;0x31);\n    printf(&quot;%d\\n&quot;,test);\n    v0 &#x3D; 0LL;\n    v1 &#x3D; ptr;\n    int dword_6010A4&#x3D;0;\n    int dword_601090&#x3D;0x18c;\n    int c;\n    while ( 1 )\n    &#123;\n        v2 &#x3D; v0 + 1;\n        switch ( v1[v0] )\n        &#123;\n            case 0:\n                return *(unsigned int *)&amp;v1[v2];\n                printf(&quot;over!&quot;);\n            case 1:\n                goto LABEL_35;\n            case 2:\n                v4 &#x3D; v2;\n                v2 &#x3D; v0 + 9;\n                v1[*(int *)&amp;v1[v4]] &#x3D; *(_DWORD *)&amp;v1[(int)v0 + 5];\n                printf(&quot;v4 &#x3D; v2;\\n&quot;\n                       &quot; v2 &#x3D; v0 + 9;\\n&quot;\n                       &quot;v1[*(int *)&amp;v1[v4]] &#x3D; *(_DWORD *)&amp;v1[(int)v0 + 5];\\n&quot;);\n                break;\n            case 3:\n                v5 &#x3D; v2;\n                v2 +&#x3D; 4;\n                v6 &#x3D; *(int *)&amp;v1[v5];\n                printf(&quot; v5 &#x3D; v2;\\n&quot;\n                       &quot; v2 +&#x3D; 4;\\n&quot;\n                       &quot;v6 &#x3D; *(int *)&amp;v1[v5];\\n&quot;);\n                goto LABEL_27;\n            case 4:\n                v7 &#x3D; v2;\n                v2 +&#x3D; 4;\n                v8 &#x3D; *(int *)&amp;v1[v7];\n                printf(&quot;v7 &#x3D; v2;\\n&quot;\n                       &quot;v2 +&#x3D; 4;\\n&quot;\n                       &quot;v8 &#x3D; *(int *)&amp;v1[v7];\\n&quot;);\n                goto LABEL_31;\n            case 5:\n                v9 &#x3D; v2;\n                v2 +&#x3D; 4;\n                v10 &#x3D; (char)v1[*(int *)&amp;v1[v9]];\n                printf(&quot; v9 &#x3D; v2;\\n&quot;\n                       &quot; v2 +&#x3D; 4;\\n&quot;\n                       &quot; v10 &#x3D; (char)v1[*(int *)&amp;v1[v9]];\\n&quot;);\n                goto LABEL_21;\n            case 6:\n                v11 &#x3D; v2;\n                v12 &#x3D; dword_6010A4;\n                v2 +&#x3D; 4;\n                v8 &#x3D; *(int *)&amp;v1[v11];\n                printf(&quot; v11 &#x3D; v2;\\n&quot;\n                       &quot; v12 &#x3D; dword_6010A4;\\n&quot;\n                       &quot; v2 +&#x3D; 4;\\n&quot;\n                       &quot; v8 &#x3D; *(int *)&amp;v1[v11];\\n&quot;);\n                goto LABEL_9;\n            case 7:\n                v13 &#x3D; dword_6010A4;\n                printf(&quot;v13 &#x3D; dword_6010A4;\\n&quot;);\n                goto LABEL_23;\n            case 8:\n                v14 &#x3D; ~(dword_6010A4 &amp; c);\n                printf(&quot;v14 &#x3D; ~(dword_6010A4 &amp; c);\\n&quot;);\n                goto LABEL_12;\n            case 0xA:\n                v14 &#x3D; getchar();\n                printf(&quot;v14 &#x3D; getchar();\\n&quot;);\n                goto LABEL_12;\n            case 0xB:\n                putchar(c);\n                printf(&quot;\\n&quot;);\n                printf(&quot;putchar(c);\\n&quot;);\n                break;\n            case 0xC:\n                v15 &#x3D; &amp;v1[*(int *)&amp;v1[v2]];\n                if ( *v15 )\n                &#123;\n                    v2 &#x3D; *(_DWORD *)&amp;v1[v2 + 4];\n                    --*v15;\n                &#125;\n                else\n                &#123;\n                    v2 +&#x3D; 8;\n                &#125;\n                printf(&quot;v15 &#x3D; &amp;v1[*(int *)&amp;v1[v2]];\\n&quot;\n                       &quot;                if ( *v15 )\\n&quot;\n                       &quot;                &#123;\\n&quot;\n                       &quot;                    v2 &#x3D; *(_DWORD *)&amp;v1[v2 + 4];\\n&quot;\n                       &quot;                    --*v15;\\n&quot;\n                       &quot;                &#125;\\n&quot;\n                       &quot;                else\\n&quot;\n                       &quot;                &#123;\\n&quot;\n                       &quot;                    v2 +&#x3D; 8;\\n&quot;\n                       &quot;                &#125;\\n&quot;);\n                break;\n            case 0xD:\n                ++c;\n                printf(&quot;++c\\n&quot;);\n                break;\n            case 0xE:\n                ++dword_6010A4;\n                printf(&quot;++dword_6010A4;\\n&quot;);\n                break;\n            case 0xF:\n                v14 &#x3D; dword_6010A4;\n                printf(&quot;v14 &#x3D; dword_6010A4;\\n&quot;);\n                goto LABEL_12;\n            case 0x10:\n                v10 &#x3D; c;\n                printf(&quot;v10&#x3D;c\\n&quot;);\n                goto LABEL_21;\n            case 0x11:\n                v16 &#x3D; v2;\n                v2 +&#x3D; 4;\n                v13 &#x3D; *(_DWORD *)&amp;v1[v16];\n                printf(&quot; v16 &#x3D; v2;\\n&quot;\n                       &quot;                v2 +&#x3D; 4;\\n&quot;\n                       &quot;                v13 &#x3D; *(_DWORD *)&amp;v1[v16];\\n&quot;);\n            LABEL_23:\n                c +&#x3D; v13;\n                printf(&quot;c+&#x3D;v13\\n&quot;);\n                break;\n            case 0x12:\n                printf(&quot; v6 &#x3D; dword_6010A4;\\n&quot;\n                       &quot; goto LABEL_27;\\n&quot;);\n                v6 &#x3D; dword_6010A4;\n                goto LABEL_27;\n\n            case 0x13:\n                v6 &#x3D; c;\n                printf(&quot;v6&#x3D;c\\n&quot;);\n            LABEL_27:\n                v14 &#x3D; (char)v1[v6];\n                printf(&quot;v14 &#x3D; (char)v1[v6];\\n&quot;\n                       &quot;goto LABEL_12;\\n&quot;);\n                goto LABEL_12;\n\n            case 0x14:\n                v17 &#x3D; v2;\n                v2 +&#x3D; 4;\n                v14 &#x3D; *(_DWORD *)&amp;v1[v17];\n                printf(&quot;v17 &#x3D; v2;\\n&quot;\n                       &quot;v2 +&#x3D; 4;\\n&quot;\n                       &quot;v14 &#x3D; *(_DWORD *)&amp;v1[v17];\\n&quot;\n                       &quot;goto LABEL_12;\\n&quot;);\n                goto LABEL_12;\n\n            case 0x15:\n                v18 &#x3D; v2;\n                v2 +&#x3D; 4;\n                v10 &#x3D; *(_DWORD *)&amp;v1[v18];\n                printf(&quot;v18 &#x3D; v2;\\n&quot;\n                       &quot;v2 +&#x3D; 4;\\n&quot;\n                       &quot;v10 &#x3D; *(_DWORD *)&amp;v1[v18];\\n&quot;);\n            LABEL_21:\n                dword_6010A4 &#x3D; v10;\n                printf(&quot;dword_6010A4 &#x3D; v10;\\n&quot;);\n                break;\n            case 0x16:\n                v8 &#x3D; dword_6010A4;\n                printf(&quot;v8 &#x3D; dword_6010A4;\\n&quot;);\n            LABEL_31:\n                v12 &#x3D; c;\n                printf(&quot;v12&#x3D;c\\n&quot;);\n            LABEL_9:\n                v1[v8] &#x3D; v12;\n                printf(&quot;v1[v8]&#x3D;v12\\n&quot;);\n                break;\n            case 0x17:\n                v14 &#x3D; c - dword_6010A4;\n                printf(&quot;v14 &#x3D; c - dword_6010A4;\\n&quot;);\n            LABEL_12:\n                c &#x3D; v14;\n                printf(&quot;c&#x3D;v14\\n&quot;);\n                break;\n            case 0x18:\n                if ( c )\n                    LABEL_35:\n                    v2 &#x3D; *(_DWORD *)&amp;v1[v2];\n                else\n                    v2 &#x3D; v0 + 5;\n                printf(&quot; if ( c )\\n&quot;\n                       &quot;                    LABEL_35:\\n&quot;\n                       &quot;                    v2 &#x3D; *(_DWORD *)&amp;v1[v2];\\n&quot;\n                       &quot;                else\\n&quot;\n                       &quot;                    v2 &#x3D; v0 + 5;\\n&quot;);\n                break;\n            default:\n                break;\n        &#125;\n        if ( v2 &gt;&#x3D; dword_601090 )\n            return 0LL;\n        v0 &#x3D; v2\n        printf(&quot;v0&#x3D;v2\\n&quot;);\n    &#125;\n&#125;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>在getchar()方法上，开始下断点，然后根据数据流，发现将输入存在某段内存空间中,在这段内存空间，下一个内存访问断点</p>\n<p>发现在这断下来了，</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210521104725.png\"></p>\n<p>v14的值就是我们的第一个内存空间的值，继续往下跟踪</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">c&#x3D;v14\nv12&#x3D;c\nv1[v8]&#x3D;v12<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>好家伙，又复制到别的地方去了，估计是怕直接在原内存中进行操作的话，容易直接被内存断点打破2333，我们把内存访问断点再一次的设定在这，2333</p>\n<p>​    <img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210521110247.png\"></p>\n<p>跟一下这个v14</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">c&#x3D;v14\nv12&#x3D;c\nv1[v8]&#x3D;v12 &#x2F;&#x2F;存放到别的地方去\n\nv14&#x3D;~(dword_10A4&amp; c) &#x2F;&#x2F;0x20&amp;str[0]\nc&#x3D;v14\nv12&#x3D;c\nv1[v8]&#x3D;v12 &#x2F;&#x2F;v8&#x3D;0x141<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>把数据放到这段内存里了g</p>\n<p>t1=~(0x20+i&amp;str[i]);</p>\n<p>t2=~((0x20+i)&amp;t1);</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">v14&#x3D;~(dword_6010a4&amp;c)\nc&#x3D;v14\nv12&#x3D;c\nv1[v8]&#x3D;v12 &#x2F;&#x2F;v8&#x3D;142 t2存进去\n\nv14&#x3D;v1[v6] &#x2F;&#x2F;v6&#x3D;141 也就是t1取出\nc&#x3D;v14\nv14&#x3D;v1[v6] &#x2F;&#x2F;v6&#x3D;140 把输入取出\nc&#x3D;v14\nv14&#x3D;~(dword_6010a4&amp;c)  t1&amp;str[i]\nc&#x3D;v14\nv10&#x3D;c\ndword_6010a4&#x3D;v10\nv14&#x3D;v1[v6] &#x2F;&#x2F;v6&#x3D;0x142 把t2取出\nc&#x3D;v14\nv14&#x3D;~(dword_6010A4&amp;c); t3&amp;t2\nc&#x3D;v14\nv12&#x3D;c\nv1[v8]&#x3D;v14 v8&#x3D;0x144\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>说明是一波单字节操作，将0x144的最后加密部分存放到0x112中了 ,每一次调试的过程中知道了dword在那个等式中就是0x20+i</p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210521150837.png\"></p>\n<p><img src=\"https://raw.githubusercontent.com/YenKoc/YenKoc_tuchuang/main/images20210521150901.png\"></p>\n<p>这里就是做判断的地方，好家伙，还是倒着来判断的），不过之前我们已经把算法分析出来了，直接爆破就完事了，反正是单字节的</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">#include&lt;iostream&gt;\n#include&lt;cstring&gt;\n#include&lt;map&gt;\n#include &quot;defs.h&quot;\nusing namespace std;\nconst int maxm&#x3D;2e3+5;\n\nint main()&#123;\n\n    int res[] &#x3D; &#123;0x10,0x18,0x43,0x14,0x15,0x47,0x40,0x17,0x10,0x1d,0x4b,0x12,0x1f,0x49,0x48,0x18,0x53,0x54,0x1,0x57,0x51,0x53,0x5,0x56,0x5a,0x8,0x58,0x5f,0xa,0xc,0x58,0x9&#125;;\n\n    for(int i&#x3D;0;i&lt;32;i++)\n    &#123;\n        for(int j&#x3D;0;j&lt;256;j++)\n        &#123;\n        int t1&#x3D;~((0x20+i)&amp;j);\n        int t2&#x3D;~((0x20+i)&amp;t1);\n        int t3&#x3D;~(t1&amp;j);\n        int t4&#x3D;~(t3&amp;t2);\n        if(t4&#x3D;&#x3D;res[i])\n        &#123;\n            printf(&quot;%c&quot;,j);\n            break;\n        &#125;\n        &#125;\n    &#125;\n&#125;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>再介绍一种z3的使用</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">from z3 import *\ndef tt(inp,i):\n    t1&#x3D;~((0x20+i)&amp;inp)\n    t2&#x3D;~((0x20+i)&amp;t1)\n    t3&#x3D;~(t1&amp;inp)\n    t4&#x3D;~(t3&amp;t2)\n    return t4\nres&#x3D; [0x10,0x18,0x43,0x14,0x15,0x47,0x40,0x17,0x10,0x1d,0x4b,0x12,0x1f,0x49,0x48,0x18,0x53,0x54,0x1,0x57,0x51,0x53,0x5,0x56,0x5a,0x8,0x58,0x5f,0xa,0xc,0x58,0x9]\n\ns&#x3D;Solver()\ninputs&#x3D;[BitVec((&#39;w%d&#39;%i),8) for i in range(32)]\nfor yk in range(32):\n    s.add(tt(inputs[yk],yk)&#x3D;&#x3D;res[yk])\nif s.check()&#x3D;&#x3D;sat:\n    model&#x3D;s.model()\n    str&#x3D;[chr(model[inputs[j]].as_long().real) for j in range(32)]\n    print &quot;&quot;.join(str)\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n","feature":null,"text":"给了两个文件，一个是vm，一个是opcode文件，ida打开后 打开了bin文件，然后将文件内容读取出来，继续进入下一个函数里面分析 是一个非常明显的while switch case的解释器，ptr存着就是上面读取的opcode文件内存，这就是属于是那种已经给定了opcode，...","link":"","photos":[],"count_time":{"symbolsCount":"14k","symbolsTime":"13 mins."},"categories":[{"name":"writeup","slug":"writeup","count":8,"path":"api/categories/writeup.json"}],"tags":[{"name":"reverse","slug":"reverse","count":13,"path":"api/tags/reverse.json"}],"toc":"","author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""},"mapped":true,"prev_post":{"title":"pintool in CTF","uid":"884cdb3da3fbfd31ea764ff186f03018","slug":"pintool-in-CTF","date":"2021-05-22T12:28:18.000Z","updated":"2021-05-22T13:24:10.554Z","comments":true,"path":"api/articles/pintool-in-CTF.json","keywords":null,"cover":"https://th.wallhaven.cc/small/6o/6oqzgq.jpg","text":"前言突然发现pintools对一些单字节验证的题目还挺好使的，所以就打算整整学学，唉，就是玩，2333 安装(ubuntu16.04)不要问我，kali怎么装，应该是一样的）,无脑输入下面的shell命令就完事了 wget -c https:&#x2F;&#x2F;softwar...","link":"","photos":[],"count_time":{"symbolsCount":"5.5k","symbolsTime":"5 mins."},"categories":[{"name":"pintool","slug":"pintool","count":1,"path":"api/categories/pintool.json"}],"tags":[{"name":"reverse","slug":"reverse","count":13,"path":"api/tags/reverse.json"}],"author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""}},"next_post":{"title":"看雪ctf 第二题 南冥神功","uid":"43f61f74963677e07981d8eac779d6cf","slug":"看雪ctf-第二题-南冥神功","date":"2021-05-12T02:44:04.000Z","updated":"2021-05-12T02:44:30.770Z","comments":true,"path":"api/articles/看雪ctf-第二题-南冥神功.json","keywords":null,"cover":null,"text":"","link":"","photos":[],"count_time":{"symbolsCount":0,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"YenKoc","avatar":"https://avatars.githubusercontent.com/u/52554268?s=400&u=e21e2b4ac372eaf3c2bc9c720c1ac24f974e936a&v=4","link":""}}}