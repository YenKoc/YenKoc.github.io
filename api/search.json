[{"id":"6946deb52774246dc7e3f9d367660594","title":"unicornè‡ªåŠ¨åŒ–è§£å†³è¿·å®«é—®é¢˜","content":"unicornç®€å•ä½¿ç”¨unicornæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„æ¨¡æ‹Ÿæ‰§è¡Œæ¡†æ¶ï¼Œåœ¨æˆ‘æœ€è¿‘ä½¿ç”¨çœ‹æ¥ï¼Œæ˜¯å…·æœ‰å¯¹å†…å­˜å’ŒæŒ‡ä»¤æœ‰ç€å®Œå…¨æ“çºµæƒçš„æ¡†æ¶ï¼Œå…·æœ‰å¾ˆé«˜çš„å¯å®šåˆ¶åŒ–ï¼Œæ˜¯ä¸€ç§å¤©ç„¶çš„æ²™ç›’\nfrom unicorn import *\nfrom unicorn.arm_const import *\nARM_CODE &#x3D; b&quot;\\x37\\x00\\xa0\\xe3\\x03\\x10\\x42\\xe0&quot;\ndef hook_code(uc,address,size,user_data):\n    print(&quot;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size &#x3D; 0x%x&quot;% (address,size))\n\ndef test_arm():\n    print(&quot;Emulate ARM code&quot;)\n    try:\n        mu&#x3D;Uc(UC_ARCH_ARM,UC_MODE_ARM) # åˆ›å»ºä¸€ä¸ªucå¯¹è±¡\n        #map 2MB memory for this emulation  è¿™é‡Œåº”è¯¥æ˜¯ç¬”è¯¯äº†ï¼Œä¸æ˜¯2mbï¼Œ64mbäº†\n        ADDRESS&#x3D;0x10000 # æˆ‘ä»¬éœ€è¦å°†æ‰§è¡Œçš„ä»£ç è½½å…¥unicornçš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œunicornè™šæ‹Ÿæœºå®ä¾‹åˆå§‹å†…å­˜æ˜¯æ²¡æœ‰ä»»ä½•æ˜ å°„çš„ï¼Œåœ¨è¯»å†™å†…å­˜ä¸­ï¼Œä¹Ÿéœ€è¦å…ˆæ˜ å°„ä¸€æ®µå†…å­˜\n        mu.mem_map(ADDRESS,2*0x10000)\n        #å°†ä¹‹å‰ç¼–å†™çš„æŒ‡ä»¤å†™å…¥åˆ°è™šæ‹Ÿå†…å­˜ä¸­ï¼Œå¿…é¡»æ˜¯pythonçš„byteç±»å‹\n        mu.mem_write(ADDRESS,ARM_CODE)\n        #ç»™è™šæ‹Ÿå¯„å­˜å™¨èµ‹å€¼\n        mu.reg_write(UC_ARM_REG_R0,0x1234)\n        mu.reg_write(UC_ARM_REG_R2,0x6789)\n        mu.reg_write(UC_ARM_REG_R3,0x3333)\n        #æ·»åŠ æŒ‡ä»¤çº§çš„hook\n        mu.hook_add(UC_HOOK_CODE,hook_code,begin&#x3D;ADDRESS,end&#x3D;ADDRESS)\n        mu.emu_start(ADDRESS,ADDRESS+len(ARM_CODE))\n        r0&#x3D;mu.reg_read(UC_ARM_REG_R0)\n        r1&#x3D;mu.reg_read(UC_ARM_REG_R1)\n        print(&quot;&gt;&gt;&gt; r0&#x3D;0x%x&quot;%r0)\n        print(&quot;&gt;&gt;&gt; r1&#x3D;0x%x&quot;%r1)\n    except UcError as e:\n        print(&quot;ERROR:%s&quot;%e)\n\ntest_arm()\n# mov r0, #0x37;\n# sub r1, r2, r3\nprint(0x1234)\n\næ ¹æ®ä»£ç ç†è§£æ„æ€ï¼Œå®é™…ä¸Šunicornå’Œæˆ‘ä»¬å¸¸è§çš„æœºå™¨æ˜¯ä¸€æ ·ï¼Œä¸è¿‡ä¸€åˆ‡çš„å·¥ä½œéœ€è¦æˆ‘ä»¬è‡ªå·±å¼€å±•äº†ï¼Œæ¯”å¦‚é¡ºåºæ˜¯å…ˆåˆ›å»ºæ¨¡æ‹Ÿå™¨å®ä¾‹ï¼ˆåˆ›å»ºä¸€å°cpuï¼‰ï¼Œå†ç”³è¯·å†…å­˜å’Œæ ˆï¼ˆcpuçš„å¸¸è§„æ“ä½œï¼‰ï¼ŒæŠŠä»£ç åŠ è½½è¿›å†…å­˜ï¼ˆè½½å…¥ï¼‰ï¼Œå®šåˆ¶åŒ–ï¼ŒæŒ‡ä»¤hook or å†…å­˜è®¿é—®hookï¼Œæ‰§è¡Œè½½å…¥ä»£ç ï¼Œæ¥ç®¡ç¨‹åºï¼Œæµç¨‹ç±»ä¼¼ï¼Œç”±äºæˆ‘ä»¬å¯¹å†…å­˜æœ‰å®Œå…¨æ”¯é…ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå°±å¯ä»¥é€šè¿‡ä¿®æ”¹å¯„å­˜å™¨æ¥æ§åˆ¶ç¨‹åºæµç¨‹ï¼Œç®€å•ä»‹ç»å®Œï¼Œä¸‹é¢åˆ°æ­£é¢˜\nä»ç¾å›¢ctf mazeè¿™é¢˜æ¥çœ‹unicornçš„ä½¿ç”¨è¿™é¢˜å½“åˆæˆ‘æ˜¯ç”¨pintoolsè·‘çš„ï¼Œå¥½å®¶ä¼™ï¼Œæ²¡æŠŠæˆ‘ç´¯æ­»ï¼Œå¤§æ¦‚èŠ±äº†ä¸‰ä¸ªå°æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨åŒ–çš„ğŸ˜­äº†ï¼Œæ‰€ä»¥ç°åœ¨å¾—æŠŠè‡ªåŠ¨åŒ–æèµ·æ¥äº†ï¼ŒåŠªåŠ›å­¦ä¹ ï¼ï¼\nå…ˆä»ä»£ç ç»“æ„æ¥è¯´\n\næœ‰ä¸€ç™¾ä¸ªè¿·å®«ï¼Œè¿·å®«é•¿ä»€ä¹ˆæ ·å‘¢\n\n\nå‘ç°è¿·å®«å‰é¢æ˜¯åœ¨åˆå§‹åŒ–ï¼Œç„¶åæ¯ä¸ªè¿·å®«æ–¹å‘é”®ä¸ä¸€æ ·ï¼ŒåŒæ—¶è¦æ»¡è¶³ifä¸­çš„æ¡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æ€è·¯è‚¯å®šæ˜¯\næå–å‡º100ä¸ªè¿·å®«å’Œæ–¹å‘é”®ï¼Œåœ¨æœ¬åœ°è·‘dfså¯¹å§ï¼Œé‚£ä¹ˆæ€ä¹ˆå»å®ç°ï¼Œå®Œå…¨å¯ä»¥åŸºäºunicornï¼Œunicornå¯¹å†…å­˜å’Œå¯„å­˜å™¨æœ‰å®Œå…¨æ”¯é…æƒï¼Œè¿·å®«å’Œæ–¹å‘é”®ï¼Œéƒ½åœ¨æ ˆä¸Šï¼Œé‚£å¯¹æˆ‘ä»¬æ¥è¯´ä¸å°±æ˜¯å¾ˆè½»æ¾æå®šå—ï¼Œç„¶åè¿˜éœ€è¦æ‰¾ä¸€ä¸ªæš‚åœç‚¹ï¼Œåœ¨é‚£ä¸ªç‚¹å°±åœä¸‹dumpä¸‹æ•°æ®ï¼Œè¿™é‡Œé€‰æ‹©æ˜¯getcharï¼ˆï¼‰ï¼Œä¸€ä¸ªæ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å¯¼å…¥libcï¼Œå¦ä¸€ä¸ªåŸå› å°±æ˜¯getcharä¼šå…ˆè·³è½¬åˆ°pltè¡¨ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„åœ°ç‚¹ï¼Œå¹¶ä¸ä¼šæ ¹æ®è¿·å®«æ›´æ”¹ï¼Œå®Œå…¨ç¬¦åˆæˆ‘ä»¬è‡ªåŠ¨åŒ–çš„è¦æ±‚ï¼Œä½†æ˜¯è·³åˆ°pltè¡¨ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦æ‰‹åŠ¨leave retï¼Œè¿™é‡Œéœ€è¦å»å¤„ç†ï¼Œå‰©ä¸‹é—®é¢˜å°±æ˜¯rdrandï¼Œè¿™æŒ‡ä»¤unicornæ”¯æŒä¸å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»è·³è¿‡ï¼Œ\nå…¶ä»–å°±æ˜¯å¾ˆå¸¸è§„çš„è„šæœ¬ç¼–å†™ï¼Œå¦å¤–pwntoolsè¿™é‡Œçš„è§£åŒ…ç¨‹åºçœŸä¸é”™ï¼Œu32ï¼Œu64ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯å¯ä»¥å°†å­—èŠ‚æµï¼Œè½¬æ¢æˆæ•´æ•°çš„ï¼Œå› ä¸ºunicornå†™å…¥å’Œè¯»å‡ºéƒ½æ˜¯å­—èŠ‚æµï¼Œæ‰€ä»¥u32ï¼Œu64å¤©ç„¶å°±é€‚åˆunicornï¼Œå¾ˆnice\n\nå‰©ä¸‹å°±æ˜¯æ”¾ä¸‹è„šæœ¬çš„é—®é¢˜äº†\nfrom unicorn import *\nfrom unicorn.x86_const import *\nfrom pwn import *\nbaseAddr&#x3D;0\ncodeStart&#x3D;baseAddr\ncodeSize&#x3D;0x100000\nstackStart&#x3D;0x7F00000000\nstackSize&#x3D;0x100000\nfile_code&#x3D;&quot;&quot;\nmainAddr&#x3D;0x00000000000A6AA8\nmainEnd&#x3D;0x00000000000A7344\n#æœ€ç»ˆçš„ç»“æœ\nres&#x3D;&quot;&quot;\nans&#x3D;&quot;&quot;\nstr_dir&#x3D;&quot;&quot;\nmaze_map&#x3D;[]\ndx &#x3D; [0, 0, -1, 1]\ndy &#x3D; [-1, 1, 0, 0]\ndef dfs(f_x,f_y,x,y,i):\n    global ans,dx,dy,str_dir,maze_map\n    if i&#x3D;&#x3D;15:\n        return True\n    for yk in range(4):\n        tmp_x&#x3D;x+dx[yk]\n        tmp_y&#x3D;y+dy[yk]\n        if (0&lt;&#x3D;tmp_x&lt;25) and (0&lt;&#x3D;tmp_y&lt;25) and not (f_x&#x3D;&#x3D;x and f_y&#x3D;&#x3D;y) and (chr(maze_map[25*tmp_y+tmp_x]&amp;0xff)&#x3D;&#x3D;&#39;.&#39;):\n            if dfs(x,y,tmp_x,tmp_y,i+1):\n                ans&#x3D;str_dir[yk]+ans\n                return True\n    return False\ndef hook_code(uc,address,size,user_data):\n    assert isinstance(uc,Uc)\n    global str_dir,maze_map,ans,res\n    cur_map&#x3D;[]\n    cur_code&#x3D;uc.mem_read(address,4)\n        # rdrand()\n    if cur_code&#x3D;&#x3D;b&quot;\\x48\\x0f\\xc7\\xf0&quot;:\n        uc.reg_write(UC_X86_REG_RIP,address+4)\n        # printf()\n    if address&#x3D;&#x3D;0x640:\n        printf_rsp&#x3D;uc.reg_read(UC_X86_REG_RSP)\n        printf_ret_addr&#x3D;u64(uc.mem_read(printf_rsp,8))\n        uc.reg_write(UC_X86_REG_RSP,printf_rsp+8)\n        uc.reg_write(UC_X86_REG_RIP,printf_ret_addr)\n        # getchar() æå–æ•°æ®çš„å…³é”®å‡½æ•°\n    if address&#x3D;&#x3D;0x650:\n        getchar_rsp&#x3D;uc.reg_read(UC_X86_REG_RSP)\n        uc.reg_write(UC_X86_REG_RSP,getchar_rsp+8)\n        getchar_rbp&#x3D;uc.reg_read(UC_X86_REG_RBP)\n        # æ–¹å‘é”®\n        cur_dir&#x3D;uc.mem_read(getchar_rbp-0x9f9,4).decode()\n        cur_map&#x3D;uc.mem_read(getchar_rbp-0xc6a,0x625)\n        xor_map&#x3D;uc.mem_read(getchar_rbp-0x9D0,0x9c4)\n        # èµ·ç‚¹\n        first_y&#x3D;u32(uc.mem_read(getchar_rbp-0x9f0,4))\n        first_x&#x3D;u32(uc.mem_read(getchar_rbp-0x9f4,4))\n        cur_map&#x3D;list(cur_map)\n        for yks in range(0,0x9C4,4):\n            cur_map[yks&#x2F;&#x2F;4]^&#x3D;u32(xor_map[yks:yks+4])\n        for i in range(25):\n            line_data &#x3D; &quot;&quot;\n            for j in range(25):\n                line_data +&#x3D; chr(cur_map[i * 25 + j])\n            print(line_data)\n        str_dir&#x3D;cur_dir\n        maze_map&#x3D;cur_map\n        ans&#x3D;&quot;&quot;\n        dfs(-1,-1,first_x,first_y,0)\n        res+&#x3D;ans\n        cur_rbp&#x3D;uc.reg_read(UC_X86_REG_RBP)\n        cur_rsp&#x3D;uc.reg_read(UC_X86_REG_RSP)\n        new_rbp&#x3D;u64(uc.mem_read(cur_rbp,8))\n        ret_addr&#x3D;u64(uc.mem_read(cur_rbp+8,8))\n        uc.reg_write(UC_X86_REG_RBP,new_rbp)\n        uc.reg_write(UC_X86_REG_RSP,cur_rbp+0x10)\n        uc.reg_write(UC_X86_REG_RIP,ret_addr)\n# åˆå§‹åŒ–unicornçš„ç¯å¢ƒ\ndef init(uc):\n    uc.mem_map(codeStart,codeSize,UC_PROT_ALL)\n    uc.mem_map(stackStart,stackSize,UC_PROT_ALL)\n    #æŠŠä»£ç æ‰”è¿›å»\n    uc.mem_write(codeStart,file_code)\n    #è°ƒæ•´å †æ ˆ\n   # uc.reg_write(UC_X86_REG_RBP,stackStart)\n    uc.reg_write(UC_X86_REG_RSP,stackStart+0x1000)\n    uc.hook_add(UC_HOOK_CODE, hook_code)\nwith open(&quot;100mazes&quot;,&quot;rb&quot;) as e:\n    file_code&#x3D;e.read()\n# åˆ›å»ºucå¯¹è±¡\nuc&#x3D;Uc(UC_ARCH_X86,UC_MODE_64)\n# åˆå§‹åŒ–\ninit(uc)\n# æ·»åŠ æŒ‡ä»¤çš„å›è°ƒ\n\ntry:\n    uc.emu_start(mainAddr, mainEnd)\n    print(res)\nexcept Exception as e:\n    print(e)\n\n","slug":"unicornè‡ªåŠ¨åŒ–è§£å†³è¿·å®«é—®é¢˜","date":"2021-08-02T04:11:18.000Z","categories_index":"unicorn","tags_index":"reverse","author_index":"YenKoc"},{"id":"826b11e5304e0be8ab8c923b8486f9df","title":"unidbgåollvmå­—ç¬¦ä¸²æ··æ·†(äºŒ)","content":"å‰è¨€æœ‰ç¢°åˆ°è¿‡ollvmçš„å­—ç¬¦ä¸²åŠ å¯†ï¼Œå¾ˆå¸¸è§çš„ç‰¹å¾å°±åœ¨äºåœ¨initæˆ–è€…init arrayæ®µé‡Œé¢ä¼šæœ‰å¾ˆå¤šå­—ç¬¦ä¸²è§£å¯†çš„å‡½æ•°ï¼Œå¯¹æŠ—çš„æ‰‹æ³•ä¹Ÿæ˜¯å¾ˆå¤šç§çš„ï¼ŒåŠ è½½å†…å­˜dumpï¼Œæˆ–è€…æ¨¡æ‹Ÿæ‰§è¡Œpatchæ‰ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ä½¿ç”¨æ¨¡æ‹Ÿæ‰§è¡Œunidbgæ¥hookå‡ºæ¯æ¬¡å­—ç¬¦ä¸²è§£å¯†å†™å…¥çš„å†…å­˜åœ°å€ä»¥åŠvalue\nä»£ç ç¼–å†™è¿™é‡Œæˆ‘ç‰¹æ„å»å­¦äº†åŸå§‹unicornçš„æ“ä½œï¼Œå‘ç°unicornæœ¬èº«å°±æ”¯æŒå¯¹å†…å­˜è®¿é—®çš„hookï¼ŒåŸºæœ¬å°±æ˜¯ä¸€ä¸ªç±»å‹ï¼Œä¸€ä¸ªå›è°ƒï¼Œåœ¨unidbgä¸Šä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œç›´æ¥æ”¾ä¸‹ä»£ç , åŸç†ä¹Ÿæ˜¯ä¸éš¾çš„ï¼Œå°±æ˜¯è®°å½•ä¸‹è®¿é—®åœ°å€ï¼Œä»¥åŠå€¼ï¼Œå†ç®—å‡ºåç§»ï¼Œpatchç”Ÿæˆæ–°æ–‡ä»¶ï¼Œä¸»è¦å‘ç‚¹å°±æ˜¯è¿™é‡Œå‡å»åŸºåœ°å€åï¼Œåç§»åœ¨idaä¸­æ˜¯å‡†çš„ï¼Œä¸è¿‡å¯¹äºæ–‡ä»¶çš„åç§»éœ€è¦å†å‡å°‘0x1000\nDeStrWriteHook.java\npackage com.xc;\n\nimport com.github.unidbg.arm.backend.Backend;\nimport com.github.unidbg.arm.backend.WriteHook;\nimport unicorn.Unicorn;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class DeStrWriteHook implements WriteHook &#123;\n    &#x2F;&#x2F;æ‰¾ä¸ªkey-valueæ•°æ®ç»“æ„æ¥è¿›è¡Œå­˜å‚¨\n    public Map&lt;Long,byte[]&gt; dstr_datas&#x3D;new HashMap&lt;Long,byte[]&gt;();\n    &#x2F;&#x2F;longç±»å‹è½¬æ¢æˆå°ç«¯\n    public byte[] long2little(long value)\n    &#123;\n        byte[] yks&#x3D;new byte[8];\n        yks[0]&#x3D;(byte)(value&amp;0xff);\n        yks[1]&#x3D;(byte)(value&gt;&gt;8&amp;0xff);\n        yks[2]&#x3D;(byte) (value&gt;&gt;16&amp;0xff);\n        yks[3]&#x3D;(byte) (value&gt;&gt;24&amp;0xff);\n        yks[4]&#x3D;(byte)(value&gt;&gt;32&amp;0xff);\n        yks[5]&#x3D;(byte)(value&gt;&gt;40&amp;0xff);\n        yks[6]&#x3D;(byte)(value&gt;&gt;48&amp;0xff);\n        yks[7]&#x3D;(byte) (value&gt;&gt;56&amp;0xff);\n        return yks;\n    &#125;\n    &#x2F;&#x2F;longç±»å‹è½¬æ¢æˆå¤§ç«¯\n    public byte[] long2big(long value)\n    &#123;\n        byte[] yks&#x3D;new byte[8];\n        yks[7]&#x3D;(byte)(value&amp;0xff);\n        yks[6]&#x3D;(byte)(value&gt;&gt;8&amp;0xff);\n        yks[5]&#x3D;(byte) (value&gt;&gt;16&amp;0xff);\n        yks[4]&#x3D;(byte) (value&gt;&gt;24&amp;0xff);\n        yks[3]&#x3D;(byte)(value&gt;&gt;32&amp;0xff);\n        yks[2]&#x3D;(byte)(value&gt;&gt;40&amp;0xff);\n        yks[1]&#x3D;(byte)(value&gt;&gt;48&amp;0xff);\n        yks[0]&#x3D;(byte) (value&gt;&gt;56&amp;0xff);\n        return yks;\n    &#125;\n    @Override\n    public void hook(Backend backend, long address, int size, long value, Object user) &#123;\n        &#x2F;&#x2F;å†™å…¥åœ°å€ï¼Œå†™å…¥æ•°æ®çš„é•¿åº¦ï¼Œå†™å…¥è¯¥åœ°å€çš„å€¼\n        byte[] writedata&#x3D;long2little(value);\n        byte[] newWritedata&#x3D;new byte[size];\n        System.arraycopy(writedata,0,newWritedata,0,size);\n        dstr_datas.put(address,newWritedata);\n    &#125;\n\n    @Override\n    public void onAttach(Unicorn.UnHook unHook) &#123;\n\n    &#125;\n\n    @Override\n    public void detach() &#123;\n\n    &#125;\n&#125;\n\n\nDestrOlllvm.javaï¼ˆä¸»é€»è¾‘ï¼‰\npackage com.xc;\n\nimport com.github.unidbg.AndroidEmulator;\nimport com.github.unidbg.Module;\nimport com.github.unidbg.linux.android.AndroidEmulatorBuilder;\nimport com.github.unidbg.linux.android.AndroidResolver;\nimport com.github.unidbg.linux.android.dvm.AbstractJni;\nimport com.github.unidbg.linux.android.dvm.DalvikModule;\nimport com.github.unidbg.linux.android.dvm.VM;\nimport com.github.unidbg.memory.Memory;\n\nimport java.io.*;\nimport java.util.Map;\n\npublic class DestrOllvm extends AbstractJni&#123;\n    private final AndroidEmulator emulator;\n    private final VM vm;\n    private final Module module;\n    private static DeStrWriteHook deStrWriteHook;\n    public  DestrOllvm()\n    &#123;\n        emulator&#x3D; AndroidEmulatorBuilder.for32Bit().build();\n        System.out.println(&quot;å½“å‰è¿›ç¨‹pid:&quot;+emulator.getPid());\n        final Memory memory&#x3D; emulator.getMemory();\n        memory.setLibraryResolver(new AndroidResolver(23));\n        deStrWriteHook&#x3D;new DeStrWriteHook();\n        emulator.getBackend().hook_add_new(deStrWriteHook,0,Long.MAX_VALUE,null);\n        vm&#x3D;emulator.createDalvikVM();\n        vm.setVerbose(false); &#x2F;&#x2F;æ‰“å°jniè°ƒç”¨ç»†èŠ‚\n        DalvikModule dm&#x3D;vm.loadLibrary(new File(&quot;unidbg-android&#x2F;src&#x2F;main&#x2F;java&#x2F;DeStrOllvm&#x2F;obf.so&quot;),true);\n        module&#x3D;dm.getModule();\n        vm.setJni(this); &#x2F;&#x2F;è®¾ç½®jniæ¥å£\n        dm.callJNI_OnLoad(emulator);\n    &#125;\n    public static String byte2string(byte[] input)\n    &#123;\n        String ret&#x3D;&quot;&quot;;\n        for(int i&#x3D;0;i&lt;input.length;i++)\n        &#123;\n            int v&#x3D;input[i]&amp;0xff;\n            ret+&#x3D;(Integer.toHexString(v));\n        &#125;\n        return ret;\n    &#125;\n    public static byte[] readFile(String strFile)\n    &#123;\n        try&#123;\n            InputStream is&#x3D;new FileInputStream(strFile);\n            int iAvail&#x3D;is.available();\n            byte[] bytes&#x3D;new byte[iAvail];\n            is.read(bytes); &#x2F;&#x2F;å°†æ–‡ä»¶çš„å­—èŠ‚æµè¯»å–byteæ•°ç»„ä¸­\n            is.close();\n            return bytes;\n        &#125; catch (Exception e) &#123;\n            e.printStackTrace();\n        &#125;\n        return null;\n    &#125;\n    public static void writeFile(byte[] data,String savefile)\n    &#123;\n        try&#123;\n            FileOutputStream fos&#x3D;new FileOutputStream(savefile);\n            BufferedOutputStream bos&#x3D;new BufferedOutputStream(fos);\n            bos.write(data,0,data.length);\n            bos.flush();\n            bos.close();\n\n        &#125;catch (Exception e)\n        &#123;\n            e.printStackTrace();\n        &#125;\n    &#125;\n    public static void main(String[] args) &#123;\n        DestrOllvm destrOllvm&#x3D;new DestrOllvm();\n        &#x2F;&#x2F;patchåçš„æ–‡ä»¶ç”Ÿæˆä½ç½®\n         String savepath&#x3D;&quot;unidbg-android&#x2F;src&#x2F;main&#x2F;java&#x2F;DeStrOllvm&#x2F;obf_new.so&quot;;\n         byte[] sodata&#x3D;readFile(&quot;unidbg-android&#x2F;src&#x2F;main&#x2F;java&#x2F;DeStrOllvm&#x2F;obf.so&quot;);\n         long base_addr&#x3D;destrOllvm.module.base;\n         long module_size&#x3D;destrOllvm.module.size;\n        ByteArrayOutputStream byteArrayOutputStream&#x3D;new ByteArrayOutputStream();\n         for(Map.Entry&lt;Long,byte[]&gt; item:deStrWriteHook.dstr_datas.entrySet())&#123;\n             if(item.getKey()&gt;base_addr&amp;&amp;item.getKey()&lt;base_addr+module_size) &#123;\n                 Long offset &#x3D; item.getKey() - base_addr - 0x1000;\n                 byteArrayOutputStream&#x3D;new ByteArrayOutputStream();\n                 System.out.println(String.format(&quot;address:0x%x data:%s&quot;, offset, byte2string(item.getValue())));\n                 &#x2F;&#x2F;å…ˆæŠŠå‰é¢éƒ¨åˆ†å–å‡ºæ¥\n                 byte[] front &#x3D; new byte[offset.intValue()];\n                 System.arraycopy(sodata, 0, front, 0, offset.intValue());\n                 &#x2F;&#x2F;ç„¶åæŠŠååŠéƒ¨åˆ†çš„å¤§å°è®¡ç®—å‡ºæ¥\n                 int endsize &#x3D; sodata.length - offset.intValue() - item.getValue().length;\n                 &#x2F;&#x2F;æŠŠååŠéƒ¨åˆ†çš„å–å‡º\n                 byte[] last &#x3D; new byte[endsize];\n                 System.arraycopy(sodata, offset.intValue() + item.getValue().length, last, 0, endsize);\n                 &#x2F;&#x2F;å°†ä¸‰ä¸ªä½ç½®çš„æ•°æ®å¡«å……ä¸Š\n                 byteArrayOutputStream.write(front, 0, front.length);\n                 byteArrayOutputStream.write(item.getValue(), 0, item.getValue().length);\n                 byteArrayOutputStream.write(last, 0, last.length);\n                 &#x2F;&#x2F;æœ€åä¿å­˜ä¸Š\n                 sodata &#x3D; byteArrayOutputStream.toByteArray();\n             &#125;\n         &#125;\n            writeFile(byteArrayOutputStream.toByteArray(),savepath);\n    &#125;\n&#125;\n\n\næ•ˆæœæ²¡è¿è¡Œå‰\n\nè¿è¡Œå\n\næ•ˆæœæ¥è¯´ï¼Œè¿˜æ˜¯ä¸é”™çš„\n","slug":"unidbgåollvmå­—ç¬¦ä¸²æ··æ·†-äºŒ","date":"2021-08-01T10:21:28.000Z","categories_index":"unidbg","tags_index":"reverse","author_index":"YenKoc"},{"id":"6a44b632aa8a379a96226b3336a01d5f","title":"unidbgå®ä¾‹ä½¿ç”¨ä»¥åŠé‡åˆ°çš„é—®é¢˜(-)","content":"å‰è¨€å¯¹æŸç¨‹appçš„soè¿›è¡Œæ¨¡æ‹Ÿæ‰§è¡Œï¼ŒåŠ æ·±å¯¹unidbgçš„ç†è§£å’Œä½¿ç”¨(ä¸æä¾›æ ·æœ¬)\nå¼€å§‹åˆ†æ\næ‰¾åˆ°æˆ‘ä»¬çš„ç›®æ ‡\n\næ‰“ç®—æ˜¯æ¨¡æ‹Ÿæ‰§è¡Œè¿™ä¸ªjniå‡½æ•°ï¼Œå†æ‰¾åˆ°è¿™ä¸ªåŠ è½½çš„so\n\n\n\nâ€‹         è¿™ä¸ªjniå‡½æ•°å‚æ•°æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿”å›å€¼ä¹Ÿæ˜¯å­—ç¬¦ä¸²\n\nç”¨frida hookä¸‹ï¼Œçœ‹çœ‹å•¥æƒ…å†µ\n\nå‘ç°å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ä¸€ç›´åœ¨å˜åŠ¨ï¼Œç¬¬äºŒä¸ªå‚æ•°getdataå€’æ˜¯ä¸å˜ï¼Œè¿”å›å€¼ä¹Ÿåœ¨ä¸æ–­çš„å˜åŠ¨\n\n\nunidbgå¼€å§‹ç¼–å†™package com.xc;\n\nimport com.github.unidbg.AndroidEmulator;\nimport com.github.unidbg.linux.android.AndroidEmulatorBuilder;\nimport com.github.unidbg.linux.android.AndroidResolver;\nimport com.github.unidbg.linux.android.dvm.AbstractJni;\nimport com.github.unidbg.linux.android.dvm.DalvikModule;\nimport com.github.unidbg.linux.android.dvm.VM;\nimport com.github.unidbg.memory.Memory;\n\nimport java.io.File;\n\npublic class SignTestUtil extends AbstractJni &#123;\n    private final AndroidEmulator emulator;\n    private final VM vm;\n    SignTestUtil()\n    &#123;\n        emulator&#x3D; AndroidEmulatorBuilder.for32Bit().build();\n        final Memory memory&#x3D; emulator.getMemory();\n        memory.setLibraryResolver(new AndroidResolver(23));\n\n        vm&#x3D;emulator.createDalvikVM(new File(&quot;unidbg-android&#x2F;src&#x2F;main&#x2F;java&#x2F;xc&#x2F;xc 8-38-2.apk&quot;));\n         vm.setVerbose(true);\n        DalvikModule dm&#x3D;vm.loadLibrary(new File(&quot;unidbg-android&#x2F;src&#x2F;main&#x2F;java&#x2F;xc&#x2F;libscmain.so&quot;),true);\n        vm.setJni(this);\n        dm.callJNI_OnLoad(emulator);\n    &#125;\n\n    public static void main(String[] args) &#123;\n        SignTestUtil st&#x3D;new SignTestUtil();\n    &#125;\n&#125;\n\n\nè¿™é‡Œå…ˆç¼–å†™çš„æ˜¯åŠ è½½åˆ°æ¨¡æ‹Ÿå†…å­˜ï¼Œä»¥åŠæ‰§è¡Œå®Œjnionloadï¼Œå°±æ˜¯åˆå§‹åŒ–çš„æ„æ€ï¼Œçœ‹çœ‹æ‰§è¡Œä¼šå‘ç”Ÿä»€ä¹ˆ\n\nå…ˆçœ‹ç¬¬ä¸€ä¸ªæŠ¥é”™ï¼Œå®é™…ä¸Šå¯ä»¥å‘ç°æ˜¯ç¼ºå°‘äº†ä¾èµ–åº“ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯ç›¸å¯¹äºæˆ‘ä»¬çš„soçš„å¯¼å…¥å‡½æ•°ï¼Œä¹Ÿæ˜¯ä¾èµ–åº“çš„å¯¼å‡ºå‡½æ•°ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ‰§è¡Œå¯¼å…¥å‡½æ•°ï¼Œé‚£ä¹ˆä¾èµ–çš„åº“è‚¯å®šä¹Ÿæ˜¯éœ€è¦åŠ è½½åˆ°å†…å­˜ä¸­çš„ï¼Œidaæ‰“å¼€è¿™ä¸ªsoæ–‡ä»¶ï¼ŒæŸ¥çœ‹å¯¼å…¥çš„å‡½æ•°\n\nå®‰å“æ²¡æœ‰æ‡’åŠ è½½ï¼Œæ‰€ä»¥ä¸€æ—¦soåŠ è½½è¿›æ¥ï¼Œå…¶ä»–ä¾èµ–çš„åº“åŒæ—¶ä¹Ÿéœ€è¦åŠ è½½è¿›æ¥ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹æ‰ä¼šæŠ¥é”™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»è§£å†³è¿™ä¸ªåŠ è½½ç¼ºå¤±çš„é—®é¢˜ã€‚\nä¸ºä»€ä¹ˆå…¶ä»–soæ²¡æœ‰åŠ è½½è¿›æ¥ï¼Œå®é™…ä¸Šæ˜¯unidbgæœ¬èº«å°±æœ‰é¢„ç½®äº†soæ–‡ä»¶ï¼Œåœ¨è¿™é‡Œ\n\nå¹¶æ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„soï¼Œä¸ºä»€ä¹ˆunidbgæ²¡æœ‰è¿™ä¸ªsoæ–‡ä»¶ï¼Œå®é™…ä¸Šæ˜¯å› ä¸ºlibandroid.soæ–‡ä»¶æ‰€ä¾èµ–çš„soå®åœ¨å¤ªå¤šäº†ï¼Œå¦‚æœä¾èµ–çš„soåˆæœ‰ä¾èµ–çš„soï¼Œé‚£ä¹ˆåªä¼šéœ€è¦è¶Šæ¥è¶Šå¤šçš„soï¼Œæ‰€ä»¥è¿™ä¸ªsoå¹¶ä¸æ˜¯é»˜è®¤çš„soï¼ˆè¿™é‡ŒæŒ‡èµ°å®‰å“é‚£å¥—çš„ï¼‰\né‚£ä¹ˆè§£å†³çš„æ–¹å¼ï¼ŒæŒ‰é¾™å“¥çš„è¯´æ³•æ˜¯æœ‰ä¸¤ç§\nä¸€ç§æ˜¯hookï¼Œåœ¨libscmainä¸­hook libandroid.soçš„å‡½æ•°ï¼Œæˆ–è€…ç›´æ¥æŠŠé‚£ä¸ªsoåŠ è½½è¿›æ¥ï¼Œç„¶åhook å„ç§å‡½æ•°ï¼Œç„¶åè‡ªå·±å®ç°è¿™äº›å‡½æ•°çš„é€»è¾‘ï¼Œç»™äºˆæ­£ç¡®çš„è¿”å›å€¼\nå¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨unidbgæä¾›çš„virtualModuleæœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„soï¼Œæ‰‹åŠ¨å®ç°å…¶ä¸­çš„å‡½æ•°ï¼Œç„¶ååŠ è½½åˆ°å†…å­˜ï¼ˆè¿™é‡Œç»è¿‡æˆ‘ç†è§£ï¼Œä¸€èˆ¬æ­£å¸¸æŒ‰å®‰å“é‚£å¥—ï¼Œå¦‚æœåŠ è½½ä¸€ä¸ªsoï¼Œå¯¹åº”ä¾èµ–soä¹Ÿéœ€è¦åŠ è½½è¿›æ¥ï¼Œé‚£ä¹ˆä¼šä¸€ç›´é™·å…¥ä¸€ä¸ªå¾ˆå°´å°¬çš„åœ°æ­¥ï¼Œéœ€è¦ä¸€ç›´å¯¼å…¥ï¼Œä½†æ˜¯è™šæ‹Ÿsoä¼¼ä¹æ‘†è„±å®‰å“è¿™å¥—é™åˆ¶ï¼Œè½½å…¥åï¼Œåªéœ€è¦å®ç°å¯¹åº”çš„å¯¼å…¥å‡½æ•°é€»è¾‘ï¼Œå°±å¯ä»¥æ‘†è„±å›°å¢ƒï¼Œä½†æ˜¯å¦‚æœè¿™å¥—æºç ç»§ç»­å¼•ç”¨å…¶ä»–soå‘¢ï¼Œå¼•å…¥è¿™ä¸ªæ€è€ƒï¼‰\nè¿™é‡Œåˆšå¥½unidbgæä¾›äº†ä¸¤ä¸ªç°æˆçš„virtualsoï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ã€‚\n\n\nåŸºæœ¬ä¸Šå°±æ˜¯æ ¹æ®å®‰å“æºç ï¼Œå®ç°äº†å¯¼å…¥å‡½æ•°çš„é€»è¾‘ï¼ŒçœŸä¸é”™ï¼Œå¦‚æœè¿˜éœ€è¦å…¶ä»–æ¨¡å—çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åŒæ ·éœ€è¦ç…§ç€å®‰å“æºç ï¼Œå®ç°å¯¹åº”é€»è¾‘ï¼ˆæ„Ÿè°¢é¾™å“¥ï¼‰\nå°†è™šæ‹ŸsoåŠ è½½åˆ°å†…å­˜\nå°±åŠ ä¸€è¡Œä»£ç ï¼Œä½†æ˜¯åŠ è½½ä¾èµ–å¿…é¡»åœ¨è¢«ä¾èµ–çš„å‰é¢\nå†æ¬¡è¿è¡Œï¼Œå‘ç°æŠ¥é”™æ¶ˆå¤±äº†ä¸€è¡Œ\n\nç³»ç»Ÿè°ƒç”¨æŠ¥é”™ä»”ç»†çœ‹ä¸Šæ–‡ä¿¡æ¯ï¼Œå‘ç°æ˜¯soä¸­è°ƒç”¨äº†syscallï¼Œopenatï¼Œæ‰“å¼€äº†/proc/16148/statusï¼Œè¿™ä¸ªæ–‡ä»¶å¾ˆç†Ÿæ‚‰äº†ï¼Œä¸€èˆ¬ç”¨æ¥åè°ƒè¯•çš„ï¼Œä¸­é—´æ•°å­—è‚¯å®šå°±æ˜¯pidï¼Œä¸è¿‡è¿™ä¸ªpidæ˜¯æ‰“å¼•å·çš„\nä¸‹é¢è¿˜æœ‰ä¸€ä¸ªè¯»å–cmdlineçš„ï¼Œè¿™ç©æ„æ˜¯è¿”å›è¿›ç¨‹åçš„ï¼Œæ˜¯ç”¨æ¥é˜²æ­¢é‡æ‰“åŒ…çš„\nunidbgå¹¶æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯¹æ–‡ä»¶è®¿é—®çš„apiå…¨éƒ¨è¿›è¡Œioé‡å®šå‘ã€‚\npackage com.xc;\n\nimport com.github.unidbg.AndroidEmulator;\nimport com.github.unidbg.Emulator;\nimport com.github.unidbg.file.FileResult;\nimport com.github.unidbg.file.IOResolver;\nimport com.github.unidbg.linux.android.AndroidEmulatorBuilder;\nimport com.github.unidbg.linux.android.AndroidResolver;\nimport com.github.unidbg.linux.android.dvm.AbstractJni;\nimport com.github.unidbg.linux.android.dvm.DalvikModule;\nimport com.github.unidbg.linux.android.dvm.VM;\nimport com.github.unidbg.memory.Memory;\nimport com.github.unidbg.virtualmodule.android.AndroidModule;\n\nimport java.io.File;\n\npublic class SignTestUtil extends AbstractJni implements IOResolver &#123;\n    private final AndroidEmulator emulator;\n    private final VM vm;\n    SignTestUtil()\n    &#123;\n        emulator&#x3D; AndroidEmulatorBuilder.for32Bit().build();\n        &#x2F;&#x2F;2. ç»‘å®šIOé‡å®šå‘æ¥å£\n        emulator.getSyscallHandler().addIOResolver(this);\n        System.out.println(&quot;å½“å‰è¿›ç¨‹pid:&quot;+emulator.getPid());\n        final Memory memory&#x3D; emulator.getMemory();\n        memory.setLibraryResolver(new AndroidResolver(23));\n\n        vm&#x3D;emulator.createDalvikVM(new File(&quot;unidbg-android&#x2F;src&#x2F;main&#x2F;java&#x2F;xc&#x2F;xc 8-38-2.apk&quot;));\n         vm.setVerbose(true);\n         new AndroidModule(emulator,vm).register(memory);\n        DalvikModule dm&#x3D;vm.loadLibrary(new File(&quot;unidbg-android&#x2F;src&#x2F;main&#x2F;java&#x2F;xc&#x2F;libscmain.so&quot;),true);\n        vm.setJni(this);\n        dm.callJNI_OnLoad(emulator);\n    &#125;\n\n    public static void main(String[] args) &#123;\n        SignTestUtil st&#x3D;new SignTestUtil();\n    &#125;\n\n\n    @Override\n    public FileResult resolve(Emulator emulator, String pathname, int oflags) &#123;\n        System.out.println(&quot;è®¿é—®:&quot;+pathname);\n        return null;\n    &#125;\n&#125;\n\n\nå…ˆéšä¾¿åœ¨æœ¬ç±»å®ç°ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æ–°å»ºä¸€ä¸ªæ–°ç±»å®ç°ï¼Œä¸è¿‡é¾™å“¥æ˜¨æ™šè·Ÿæˆ‘è®¨è®ºäº†ä¸‹ï¼Œä¼šæœ‰ä¸€äº›å†²çªï¼Œå…·ä½“è¿˜å¾—ç»§ç»­æ·±å…¥å­¦ä¹ ä¸€æ‰‹å†è¯´ï¼Œå…ˆè¿è¡Œä¸‹æ‰“å°\n\nå‘ç°å®ç°äº†è¿™ä¸ªæ¥å£åï¼Œå¯¹ioçš„æ“ä½œï¼Œä¼¼ä¹éƒ½å¼€å§‹ç»è¿‡è¿™é‡Œäº†ï¼Œä¼°è®¡æ˜¯åšäº†ä¸€å±‚hookå›è°ƒï¼Œå‰é¢stdinç­‰éƒ½æ˜¯libcåˆå§‹åŒ–çš„ï¼Œä¸ç”¨ç®¡ï¼Œokï¼Œæ¥ä¸‹æ¥éœ€è¦å¯¹æä¸€æ‰‹é‡å®šå‘äº†ï¼Œè‡ªå·±å®ç°ä¸€æ‰‹\n  @Override\n    public FileResult resolve(Emulator emulator, String pathname, int oflags) &#123;\n        if((&quot;proc&#x2F;&quot;+emulator.getPid()+&quot;&#x2F;cmdline&quot;).equals(pathname))\n        &#123;\n            return FileResult.success(new ByteArrayFileIO(oflags,pathname,&quot;ctrip.android.view&quot;.getBytes()));\n            &#x2F;&#x2F;return FileResult.success(new SimpleFileIO(oflags,new File(&quot;å°†è¿›ç¨‹åå®Œå…¨å†™å…¥åçš„é‚£ä¸ªæ–‡ä»¶&quot;),pathname));\n        &#125;\n        return null;\n    &#125;\n&#125;\n\næœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯å†™å…¥æ–‡ä»¶ï¼Œç„¶åä»¥æ–‡ä»¶çš„å½¢å¼ï¼Œå¦ä¸€ç§å°±æ˜¯ç›´æ¥å­—ç¬¦ä¸²å½¢å¼ï¼Œæˆ‘å°±æ¯”è¾ƒç²—æš´ä¸€ç‚¹äº†ï¼Œå­—ç¬¦ä¸²å¾ˆç®€æ´ï¼Œæˆ–è€…ç›´æ¥adb pullä¸‹æ¥å¯¹åº”çš„æ–‡ä»¶ï¼Œå˜¿å˜¿ï¼Œæ›´çœäº‹\nç»§ç»­è¡¥status\nif ((&quot;proc&#x2F;&quot; + emulator.getPid() + &quot;&#x2F;status&quot;).equals(pathname)) \n&#123; \n\treturn FileResult.success(new ByteArrayFileIO(oflags, pathname, (&quot;Name: ip.android.view\\n&quot; + &quot;State: R (running)\\n&quot; + &quot;Tgid: &quot;+emulator.getPid()+&quot;\\n&quot; + &quot;Pid: &quot;+emulator.getPid()+&quot;\\n&quot; + &quot;PPid: 3000\\n&quot; + &quot;TracerPid: 0\\n&quot; + &quot;Uid: 10163 10163 10163 10163\\n&quot; + &quot;Gid: 10163 10163 10163 10163\\n&quot; + &quot;FDSize: 512\\n&quot; + &quot;Groups: 3002 3003 9997 20163 50163\\n&quot; + &quot;VmPeak: 2319784 kB\\n&quot; + &quot;VmSize: 2240148 kB\\n&quot; + &quot;VmLck: 0 kB\\n&quot; + &quot;VmPin: 0 kB\\n&quot; + &quot;VmHWM: 413060 kB\\n&quot; + &quot;VmRSS: 310988 kB\\n&quot; + &quot;VmData: 427160 kB\\n&quot; + &quot;VmStk: 8192 kB\\n&quot; + &quot;VmExe: 20 kB\\n&quot; + &quot;VmLib: 200676 kB\\n&quot; + &quot;VmPTE: 2100 kB\\n&quot; + &quot;VmSwap: 3356 kB\\n&quot; +\n&quot;Threads: 149\\n&quot; + &quot;SigQ: 1&#x2F;6517\\n&quot; + &quot;SigPnd: 0000000000000000\\n&quot; + &quot;ShdPnd: 0000000000000000\\n&quot; + &quot;SigBlk: 0000000000001204\\n&quot; + &quot;SigIgn: 0000000000000000\\n&quot; + &quot;SigCgt: 00000006400096fc\\n&quot; + &quot;CapInh: 0000000000000000\\n&quot; + &quot;CapPrm: 0000000000000000\\n&quot; + &quot;CapEff: 0000000000000000\\n&quot; + &quot;CapBnd: 0000000000000000\\n&quot; + &quot;CapAmb: 0000000000000000\\n&quot; + &quot;Seccomp: 2\\n&quot; + &quot;Cpus_allowed: 0f\\n&quot; + &quot;Cpus_allowed_list: 0-3\\n&quot; + &quot;Mems_allowed: 1\\n&quot; + &quot;Mems_allowed_list: 0\\n&quot; + &quot;voluntary_ctxt_switches: 6918\\n&quot; + &quot;nonvoluntary_ctxt_switches: 4988&quot;).getBytes())); \n&#125;\n\næ³¨æ„çš„ç‚¹åœ¨äºä¸¤ç‚¹ï¼Œä¸€ç‚¹æ˜¯ä¿è¯æ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œé¿å…å‡ºé”™ï¼Œå¦ä¸€ç‚¹å°±æ˜¯è¿›ç¨‹idè¦ç»Ÿä¸€ï¼Œæ—¢ç„¶åœ¨unicornä¸Šè·‘ï¼Œå°±è¦éµå®ˆunicornçš„è§„åˆ™\nå†æ¬¡è¿è¡Œ\n\nå·²ç»æ²¡æœ‰æŠ¥é”™äº†ï¼ŒæŒºå®Œç¾çš„ã€‚\næ­£å¼è¿è¡Œjniå‡½æ•°åˆ©ç”¨æ¨ç¥çš„è„šæœ¬ï¼Œè·‘å‡ºåŠ¨æ€æ³¨å†Œå…³ç³»\nfunction LogPrint(log) &#123;\n    var theDate &#x3D; new Date();\n    var hour &#x3D; theDate.getHours();\n    var minute &#x3D; theDate.getMinutes();\n    var second &#x3D; theDate.getSeconds();\n    var mSecond &#x3D; theDate.getMilliseconds();\n\n    hour &lt; 10 ? hour &#x3D; &quot;0&quot; + hour : hour;\n    minute &lt; 10 ? minute &#x3D; &quot;0&quot; + minute : minute;\n    second &lt; 10 ? second &#x3D; &quot;0&quot; + second : second;\n    mSecond &lt; 10 ? mSecond &#x3D; &quot;00&quot; + mSecond : mSecond &lt; 100 ? mSecond &#x3D; &quot;0&quot; + mSecond : mSecond;\n    var time &#x3D; hour + &quot;:&quot; + minute + &quot;:&quot; + second + &quot;:&quot; + mSecond;\n    var threadid &#x3D; Process.getCurrentThreadId();\n    console.log(&quot;[&quot; + time + &quot;]&quot; + &quot;-&gt;threadid:&quot; + threadid + &quot;--&quot; + log);\n\n&#125;\n\nfunction printNativeStack(context, name) &#123;\n    &#x2F;&#x2F;Debug.\n  &#x2F;&#x2F;  var array &#x3D; Thread.backtrace(context, Backtracer.ACCURATE);\n    &#x2F;&#x2F;var first &#x3D; DebugSymbol.fromAddress(array[0]);\n    Thread.backtrace(context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join(&quot;\\n&quot;);\n    &#x2F;*if (first.toString().indexOf(&#39;libopenjdk.so!NET_Send&#39;) &lt; 0) &#123;\n        var trace &#x3D; \n        LogPrint(&quot;-----------start:&quot; + name + &quot;--------------&quot;);\n        LogPrint(trace);\n        LogPrint(&quot;-----------end:&quot; + name + &quot;--------------&quot;);\n    &#125;\n    *&#x2F;\n\n&#125;\n\nfunction printJavaStack(name) &#123;\n    Java.perform(function () &#123;\n        var Exception &#x3D; Java.use(&quot;java.lang.Exception&quot;);\n        var ins &#x3D; Exception.$new(&quot;Exception&quot;);\n        var straces &#x3D; ins.getStackTrace();\n        if (straces !&#x3D; undefined &amp;&amp; straces !&#x3D; null) &#123;\n            var strace &#x3D; straces.toString();\n            var replaceStr &#x3D; strace.replace(&#x2F;,&#x2F;g, &quot; \\n &quot;);\n            LogPrint(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot; + name + &quot; Stack strat&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);\n            LogPrint(replaceStr);\n            LogPrint(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot; + name + &quot; Stack end&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; \\n &quot;);\n            Exception.$dispose();\n        &#125;\n    &#125;);\n&#125;\n\nfunction isprintable(value) &#123;\n    if (value &gt;&#x3D; 32 &amp;&amp; value &lt;&#x3D; 126) &#123;\n        return true;\n    &#125;\n    return false;\n&#125;\n\nfunction hook_RegisterNatives() &#123;\n    var symbols &#x3D; Module.enumerateSymbolsSync(&quot;libart.so&quot;);\n    var addrRegisterNatives &#x3D; null;\n    for (var i &#x3D; 0; i &lt; symbols.length; i++) &#123;\n        var symbol &#x3D; symbols[i];\n        \n        &#x2F;&#x2F;_ZN3art3JNI15RegisterNativesEP7_JNIEnvP7_jclassPK15JNINativeMethodi\n        if (symbol.name.indexOf(&quot;art&quot;) &gt;&#x3D; 0 &amp;&amp;\n                symbol.name.indexOf(&quot;JNI&quot;) &gt;&#x3D; 0 &amp;&amp; \n                symbol.name.indexOf(&quot;RegisterNatives&quot;) &gt;&#x3D; 0 &amp;&amp; \n                symbol.name.indexOf(&quot;CheckJNI&quot;) &lt; 0) &#123;\n            addrRegisterNatives &#x3D; symbol.address;\n            console.log(&quot;RegisterNatives is at &quot;, symbol.address, symbol.name);\n        &#125;\n    &#125;\n\n    if (addrRegisterNatives !&#x3D; null) &#123;\n        Interceptor.attach(addrRegisterNatives, &#123;\n            onEnter: function (args) &#123;\n                console.log(&quot;[RegisterNatives] method_count:&quot;, args[3]);\n                var env &#x3D; args[0];\n                var java_class &#x3D; args[1];\n                var class_name &#x3D; Java.vm.tryGetEnv().getClassName(java_class);\n                &#x2F;&#x2F;console.log(class_name);\n\n                var methods_ptr &#x3D; ptr(args[2]);\n\n                var method_count &#x3D; parseInt(args[3]);\n                for (var i &#x3D; 0; i &lt; method_count; i++) &#123;\n                    var name_ptr &#x3D; Memory.readPointer(methods_ptr.add(i * Process.pointerSize * 3));\n                    var sig_ptr &#x3D; Memory.readPointer(methods_ptr.add(i * Process.pointerSize * 3 + Process.pointerSize));\n                    var fnPtr_ptr &#x3D; Memory.readPointer(methods_ptr.add(i * Process.pointerSize * 3 + Process.pointerSize * 2));\n\n                    var name &#x3D; Memory.readCString(name_ptr);\n                    var sig &#x3D; Memory.readCString(sig_ptr);\n                    var find_module &#x3D; Process.findModuleByAddress(fnPtr_ptr);\n                    console.log(&quot;[RegisterNatives] java_class:&quot;, class_name, &quot;name:&quot;, name, &quot;sig:&quot;, sig, &quot;fnPtr:&quot;, fnPtr_ptr, &quot;module_name:&quot;, find_module.name, &quot;module_base:&quot;, find_module.base, &quot;offset:&quot;, ptr(fnPtr_ptr).sub(find_module.base));\n\n                &#125;\n            &#125;\n        &#125;);\n    &#125;\n&#125;\n\nsetImmediate(hook_RegisterNatives);\n\næ‰¾åˆ°æˆ‘ä»¬æ‰€è¦çš„å‡½æ•°åç§»ï¼Œç°åœ¨å¾ˆå¤šsoéƒ½åŠ å›ºäº†ï¼Œidaæ‰“å¼€å¯¹åº”åç§»ï¼Œéƒ½æ— æ³•è¯†åˆ«å‡ºå‡½æ•°äº†\n[RegisterNatives] java_class: ctrip.android.security.SecurityUtil name: simpleSign sig: ([BLjava/lang/String;)Ljava/lang/String; fnPtr: 0xc8c929d9 module_name: libscmain.so module_base: 0xc8c0c000 offset: 0x869d9\nä¸è¿‡åŠ è½½å†…å­˜ä¸­ï¼Œå°±å¥½å¾ˆå¤šäº†ï¼Œå¼€å§‹æ‹¼æ¥å‚æ•°\npublic void callSimpleSign()\n &#123;\n     List&lt;Object&gt; list&#x3D;new ArrayList&lt;&gt;(10);\n     list.add(vm.getJNIEnv());\n     list.add(0);\n     String input&#x3D;&quot;7be9f13e7f5426d139cb4e5dbb1fdba7&quot;;\n     byte[] inputByte&#x3D;input.getBytes(StandardCharsets.UTF_8);\n     ByteArray inputByteArray&#x3D;new ByteArray(vm,inputByte);\n     list.add(vm.addLocalObject(inputByteArray));\n     list.add(vm.addLocalObject(new StringObject(vm,&quot;getdata&quot;)));\n     Number number&#x3D;module.callFunction(emulator,0x869d9,list.toArray())[0];\n     System.out.println(vm.getObject(number.intValue()).getValue().toString());\n &#125;\n\né¾™å“¥è¯´è¿™ç§è‡ªæˆ‘å°è£…ï¼Œä¸ç”¨unidbgæœ¬èº«æä¾›çš„apiï¼Œæ›´åŠ çµæ´»ï¼ŒæŠ—é£é™©æ›´é«˜ï¼Œè¿˜è¡Œ233ï¼Œå…¶å®ä¸Šè¿™ä¸ªæ“ä½œå»unidbgæºç ä¼šå‘ç°ï¼Œå…¶å®æ˜¯ä¸€æ ·çš„2333ï¼Œunidbgæ¯”è¾ƒæ‡’äºº\nå‡ ç‚¹æ³¨æ„\n\nä¼ å…¥nativeçš„javaå‚æ•°ï¼Œé™¤äº†å…«ä¸ªåŸºæœ¬ç±»å‹å¤–(byte, char,short,int,long,float,double,boolean)ï¼Œéƒ½å¿…é¡»vm.addLocalObjectæ·»åŠ åˆ°å±€éƒ¨å¼•ç”¨ä¸­å»\nå‚æ•°1æ˜¯jnienvï¼Œå‚æ•°2æ˜¯jobjectï¼Œå› ä¸ºjobjectä¸€èˆ¬ä¸æ€ä¹ˆæ ·ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ä¼ ç©ºï¼Œè™½ç„¶æ˜¯æœ‰ä¸€ç‚¹å°é£é™©çš„ï¼Œä¸‡ä¸€æœ‰ç”¨å’‹åŠ2333\n\nè¿è¡Œç»“æœ\næˆåŠŸè¿è¡Œï¼Œå¹¶æ‰“å°\nåŒæ—¶é¾™å“¥ä¹Ÿæå‡º:\nunidbgä¸æ˜¯ä¸‡èƒ½çš„\nunidbgéœ€è¦ä½¿ç”¨ç»„åˆæ‹³\nunidbgé€‚åˆç®—æ³•è¿˜åŸï¼Œç¯å¢ƒç¨³å®šï¼ŒåŸºäºunicornçš„hookï¼Œå› ä¸ºunidbgéœ€è¦è¡¥ç¯å¢ƒï¼Œä¹Ÿå°±è¦æ±‚æˆ‘ä»¬å¯¹ç®—æ³•ä»ä¸€æ— æ‰€çŸ¥å˜æˆè‡³å°‘äº†è§£ï¼Œæ ·æœ¬ä»é»‘ç›’å˜æˆäº†ç°ç›’\n\n","slug":"unidbgå®ä¾‹ä½¿ç”¨ä»¥åŠé‡åˆ°çš„é—®é¢˜","date":"2021-07-30T13:44:05.000Z","categories_index":"unidbg","tags_index":"reverse","author_index":"YenKoc"},{"id":"0558c37e07e30bb941d09a486e640b0f","title":"ä¿®æ”¹ro.debuggableçš„å‘ä»¥åŠæœ‰æ•ˆæ–¹å¼","content":"æœ‰æ•ˆæ–¹å¼\nandroid8.1 pixelå®Œç¾ä¿®æ”¹ï¼Œç„¶åmpropï¼Œä»¥åŠxdebuggableï¼Œæˆ‘éƒ½ä½¿ç”¨äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸è¡Œï¼Œå»ºè®®ç”¨è¿™ä¸ªé¢å…·æ¥æï¼Œæˆ‘æ˜¯ç”¨å¡åˆ·çš„ï¼Œgithubä¸Šä¸‹è½½ï¼Œç„¶åæ¨¡å—å®‰è£…\nhttps://github.com/Magisk-Modules-Repo/MagiskHidePropsConf/releases/tag/v5.4.0\n","slug":"ä¿®æ”¹ro-debuggableçš„å‘ä»¥åŠæœ‰æ•ˆæ–¹å¼","date":"2021-07-28T07:33:43.000Z","categories_index":"AndroidReverse","tags_index":"reverse","author_index":"YenKoc"},{"id":"48c7547c87104b3665dc18f2c480b135","title":"2015é˜¿é‡Œç§»åŠ¨å®‰å…¨æŒ‘æˆ˜èµ›5é“é¢˜writeup","content":"Alicrackme_1jebæ‰“å¼€\n\né€»è¾‘éå¸¸ç®€å•å°±æ˜¯è°ƒç”¨äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿”å›ä¸€å¼ è¡¨ï¼Œå’Œå¯†æ–‡ï¼Œè€Œæˆ‘ä»¬çš„è¾“å…¥æ˜¯ä½œä¸ºè¡¨çš„ä¸‹æ ‡å»è¿›è¡Œæ£€ç´¢ã€‚\nä¸è¿‡åœ¨ç”¨frida dumpä¸‹ç»“æœåï¼Œå‘ç°ç«Ÿç„¶æ˜¯ä¸­æ–‡ï¼Œæˆ‘è¿˜æƒ³è½¬æ¢æˆå­—èŠ‚æ•°ç»„ï¼Œåé¢å‘ç°ä¸€ä¸ªç´¢å¼•å¯¹ä¸€ä¸ªä¸­æ–‡ï¼Œ\nç›´æ¥å†™è„šæœ¬æ’¸å°±è¡Œ\npublic class getFlag&#123;\n    public static void main(String[] args) &#123;\n        String table&#x3D;&quot;ä¸€ä¹™äºŒåä¸å‚ä¸ƒåœäººå…¥å…«ä¹å‡ å„¿äº†åŠ›ä¹ƒåˆ€åˆä¸‰äºå¹²äºå£«å·¥åœŸæ‰å¯¸ä¸‹å¤§ä¸ˆä¸ä¸‡ä¸Šå°å£å·¾å±±åƒä¹å·äº¿ä¸ªå‹ºä¹…å‡¡åŠå¤•ä¸¸ä¹ˆå¹¿äº¡é—¨ä¹‰ä¹‹å°¸å¼“å·±å·²å­å«ä¹Ÿå¥³é£åˆƒä¹ å‰é©¬ä¹¡ä¸°ç‹äº•å¼€å¤«å¤©æ— å…ƒä¸“äº‘æ‰è‰ºæœ¨äº”æ”¯å…ä¸å¤ªçŠ¬åŒºå†å°¤å‹åŒ¹è½¦å·¨ç‰™å±¯æ¯”äº’åˆ‡ç“¦æ­¢å°‘æ—¥ä¸­å†ˆè´å†…æ°´è§åˆç‰›æ‰‹æ¯›æ°”å‡é•¿ä»ä»€ç‰‡ä»†åŒ–ä»‡å¸ä»ä»…æ–¤çˆªåä»‹çˆ¶ä»ä»Šå‡¶åˆ†ä¹å…¬ä»“æœˆæ°å‹¿æ¬ é£ä¸¹åŒ€ä¹Œå‡¤å‹¾æ–‡å…­æ–¹ç«ä¸ºæ–—å¿†è®¢è®¡æˆ·è®¤å¿ƒå°ºå¼•ä¸‘å·´å­”é˜ŸåŠä»¥å…äºˆåŠåŒä¹¦å¹»ç‰åˆŠç¤ºæœ«æœªå‡»æ‰“å·§æ­£æ‰‘æ‰’åŠŸæ‰”å»ç”˜ä¸–å¤èŠ‚æœ¬æœ¯å¯ä¸™å·¦å‰å³çŸ³å¸ƒé¾™å¹³ç­è½§ä¸œå¡åŒ—å ä¸šæ—§å¸…å½’ä¸”æ—¦ç›®å¶ç”²ç”³å®ç”µå·ç”°ç”±å²åªå¤®å…„å¼å«å¦å¨å¹å››ç”Ÿå¤±ç¦¾ä¸˜ä»˜ä»—ä»£ä»™ä»¬ä»ªç™½ä»”ä»–æ–¥ç“œä¹ä¸›ä»¤ç”¨ç”©å°ä¹&quot;;\n                String pw&#x3D;&quot;ä¹‰å¼“ä¹ˆä¸¸å¹¿ä¹‹&quot;;\n                String flag&#x3D;&quot;&quot;;\n                for(int i&#x3D;0;i&lt;pw.length();i++)\n                &#123;\n                    flag+&#x3D;(char)table.indexOf(pw.charAt(i));\n                &#125;\n                System.out.println(flag);\n&#125;\n&#125;\n\n\nflag: 581026\nAlicrackme_2è¿™é¢˜å…¶å®æ²¡å•¥å¤ªå¤§éš¾ç‚¹ï¼Œæ ¸å¿ƒå°±æ˜¯è¦å¤šåŠ¨è°ƒï¼Œæ¯•ç«Ÿå¾ˆå¤šä½ç½®ï¼Œä»–æ˜¯é€šè¿‡ç¨‹åºå»è¿›è¡Œå¡«å……ï¼Œç„¶åè·³è½¬ï¼Œå¦‚æœä¸çŸ¥é“é‚£ä¸ªä½ç½®çš„è¯ï¼Œå…¶å®å¾ˆéš¾å»ç†è§£ä»€ä¹ˆæ„æ€\n\nè¿™é‡Œæ˜¯æ ¸å¿ƒé€»è¾‘ï¼Œæˆ‘è¿™é‡Œå¡äº†å¾ˆä¹…æ˜¯è¦è°ƒè¯•jniloadæ–¹æ³•çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€äº›ç‰¹æ®Šçš„æ‰‹æ³•\nè¿™é‡Œç®€å•è¯´ä¸‹idaçš„åŠ¨æ€è°ƒè¯•ï¼Œå…ˆæ‰‹æœºæœåŠ¡å™¨èµ·ä¸€ä¸ªserverï¼Œç„¶åidaè¿™é‡Œç¡®ä¿å¯ä»¥attachï¼Œ\nç„¶åadb shell am start -D -n åŒ…å/.å¯åŠ¨çš„ç»„ä»¶å\næ¥ä¸‹æ¥å°±æ˜¯ attachä¸Šå»ï¼Œè¿™é‡Œä¼šè¿›å…¥åˆ°libc.soï¼Œä¸ç®¡å®ƒç›´æ¥f9\nadb shell ps | grep com.yaotong.crackmeï¼ˆåŒ…åï¼‰\næŸ¥çœ‹è¿›ç¨‹idï¼Œå–å‡ºè¿›ç¨‹id\nadb forward tcp:8700 jdwp: pidï¼ˆä»ä¸Šé¢å–å‡ºçš„)\njdb -connect com.sun.jdi.SocketAttach:hostname=127.0.0.1,port=8700\nç„¶åå°±ä¼šåˆ°linkerä¸Šäº†ï¼Œå¦‚æœè¿™æ—¶å€™soåŠ è½½è¿›æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªç„¶è€Œç„¶çš„åˆ°\ninitæ®µï¼Œinit arrayï¼Œjni_onloadå»è°ƒè¯•ï¼Œç„¶åjni_onloadæ‰§è¡Œå®Œï¼Œ\næˆ‘ä»¬å°±æ­£å¸¸è¾“å…¥ä¸‹æ–­ç‚¹å°±è¡Œ\n\nåé¢ä¸‰é“é¢˜å› æ¶æ„é—®é¢˜ï¼Œæ²¡æ³•æï¼Œæˆ‘çš„å¤‡ç”¨è°ƒæœºè¿˜æ²¡åˆ°ï¼Œéœ€è¦ç­‰ç­‰äº†","slug":"é˜¿é‡Œç§»åŠ¨å®‰å…¨æŒ‘æˆ˜èµ›5é“é¢˜","date":"2021-07-28T03:15:34.000Z","categories_index":"AndroidReverse","tags_index":"reverse","author_index":"YenKoc"},{"id":"81adc87c645a49aab325f38e6f3026a2","title":"Xposedç¼–å†™inlinehookæ¡†æ¶æ’ä»¶02","content":"å‰è¨€åæ§½ä¸‹ï¼Œå¦ˆçš„ï¼Œåº”è¯¥æ˜¯æ¡†æ¶æœ¬èº«çš„bugï¼Œå¥½åƒhookè‡ªå·±ç¼–å†™çš„å‡½æ•°æ— å‚æ•°çš„è¯ï¼Œå°±ä¼šè«åæŠ¥é”™ï¼Œè¿™é‡Œè€½è¯¯äº†æˆ‘å‡ ä¸ªå°æ—¶ï¼Œæœ€ç»ˆæ‰å‘ç°äº†è¿™ä¸ªé—®é¢˜ï¼Œé¬¼çŸ¥é“æˆ‘å¼€å…³æœºäº†å‡ æ¬¡å¦ˆçš„ã€‚\næ­£å¼å¼€å§‹\nè¢«hookçš„appçš„æ ¸å¿ƒé€»è¾‘\n#include &lt;jni.h&gt;\n#include &lt;string&gt;\n#include &lt;string.h&gt;\n#include &quot;android&#x2F;log.h&quot;\nint myr0(char* str) &#123;\n    if (strstr(str, &quot;YenKoc&quot;) !&#x3D; nullptr) &#123;\n\n        __android_log_print(4, &quot;YenKoc&quot;, &quot;i am  success&quot;);\n\n\n    &#125; else &#123;\n\n        __android_log_print(4, &quot;YenKoc&quot;, &quot;i ma fail&quot;);\n    &#125;\n    return reinterpret_cast&lt;int&gt;(strstr(str, &quot;YenKoc&quot;));\n&#125;\n\nextern &quot;C&quot; JNIEXPORT jstring JNICALL\nJava_com_example_hooksoexample01_MainActivity_stringFromJNI(\n        JNIEnv* env,\n        jobject &#x2F;* this *&#x2F;) &#123;\n    std::string hello &#x3D; &quot;Hello from C++&quot;;\n    if(myr0(&quot;123456789&quot;))&#123;\n        __android_log_print(4,&quot;YenKoc&quot;,&quot;myr0 is true  &quot;);\n    &#125;\n    else &#123;\n\n        __android_log_print(4,&quot;YenKoc&quot;,&quot;myr0 is false&quot;);\n    &#125;\n\n    return env-&gt;NewStringUTF(hello.c_str());\n&#125;\n\nhookçš„é€»è¾‘\nè¿™é‡Œéœ€è¦å…ˆæ˜ç¡®ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬çš„hookçš„soï¼Œä¸åƒä¸Šä¸€ç¯‡æ˜¯hook libcçš„soï¼Œlibcçš„soæ˜¯åœ¨å®‰å“çš„ç™½åå•ä¸­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨dlopenæ‰“å¼€ï¼Œä½†æ˜¯æˆ‘ä»¬çš„soä¸åœ¨ç™½åå•ï¼Œé‚£ä¹ˆåªèƒ½åˆ©ç”¨æŸ¥çœ‹å†…å­˜ç©ºé—´ï¼Œæ ¹æ®ç¬¦å·è¡¨ï¼Œæˆ–è€…åç§»å®ç°äº†ï¼Œè¿™é‡Œä¹Ÿæ˜¯ç”¨çš„åˆ«çš„å¤§ä½¬å¼€æºçš„æ¡†æ¶å¯¼å…¥ä¸€æ‰‹å°±è¡Œ\n\ncmakeè®°å¾—å¯¼å…¥\nå‰©ä¸‹å°±æ˜¯ç¼–å†™çœŸæ­£hooké€»è¾‘äº†\n#include &lt;jni.h&gt;\n#include &lt;string&gt;\nextern &quot;C&quot;&#123;\n    #include &quot;inlinehookk&#x2F;inlineHook.h&quot;\n    #include &quot;dlfcn&#x2F;dlfcn_compat.h&quot;\n    #include &quot;dlfcn&#x2F;dlfcn_nougat.h&quot;\n&#125;\n\n\n#include &quot;android&#x2F;log.h&quot;\n#include &lt;stdio.h&gt;\n#include &lt;dlfcn.h&gt;\n\nint (*old_judge)() &#x3D; NULL;\n\nint new_judge()\n&#123;\n    __android_log_print(4,&quot;YenKoc&quot;,&quot;i hook success %s&quot;);\n\n    return 1;\n\n&#125;\n\nint hook()\n&#123;\n   void* handle&#x3D; dlopen_compat(&quot;&#x2F;data&#x2F;app&#x2F;com.example.hooksoexample01-Ox57xIxBDLPq0xQ-MNJm-g&#x3D;&#x3D;&#x2F;lib&#x2F;arm&#x2F;libnative-lib.so&quot;,RTLD_NOW);\n   void* judgeaddr&#x3D;dlsym_compat(handle,&quot;_Z4myr0v&quot;);\n   __android_log_print(4,&quot;YenKoc&quot;,&quot; i hook success libaddr:%s&quot;,handle);\n    __android_log_print(4,&quot;YenKoc&quot;,&quot; i hook success funcaddr:%x&quot;,judgeaddr);\n    if (registerInlineHook((uint32_t) judgeaddr, (uint32_t) new_judge, (uint32_t **) &amp;old_judge) !&#x3D; ELE7EN_OK) &#123;\n        return -1;\n    &#125;\n    if (inlineHook((uint32_t) judgeaddr) !&#x3D; ELE7EN_OK) &#123;\n        return -1;\n    &#125;\n\n    return 0;\n&#125;\n\nint unHook()\n&#123;\n    if (inlineUnHook((uint32_t) puts) !&#x3D; ELE7EN_OK) &#123;\n        return -1;\n    &#125;\n\n    return 0;\n&#125;\nextern &quot;C&quot; void _init(void) &#123;\n    __android_log_print(4,&quot;YenKoc&quot;,&quot; i enter into init&quot;);\n     hook();\n&#125;\n\n\n&#x2F;&#x2F; ç¼–è¯‘ç”Ÿæˆååœ¨.init_arrayæ®µ [åå­—å¯ä»¥æ›´æ”¹]\n&#x2F;*__attribute__((__constructor__)) static void pp_init() &#123;\n    PPLOGD(&quot;Enter pp_init......&quot;);\n&#125;\n *&#x2F;\n&#x2F;&#x2F; jni_onloadæ–¹æ³•\n&#x2F;*\njint JNI_OnLoad(JavaVM *vm, void *reserved) &#123;\n\n    JNIEnv *env &#x3D; NULL;\n\n    if (vm-&gt;GetEnv((void **) &amp;env, JNI_VERSION_1_4) !&#x3D; JNI  _OK) &#123;  &#x2F;&#x2F;åˆ¤æ–­ JNI ç‰ˆæœ¬æ˜¯å¦ä¸ºJNI_VERSION_1_4\n        return JNI_EVERSION;\n    &#125;\n\n\n\n    return JNI_VERSION_1_4;\n&#125;\n *&#x2F;\nextern &quot;C&quot; JNIEXPORT jstring JNICALL\nJava_com_example_kanxuexposedso1_MainActivity_stringFromJNI(\n        JNIEnv* env,\n        jobject &#x2F;* this *&#x2F;) &#123;\n    std::string hello &#x3D; &quot;Hello from C++&quot;;\n    return env-&gt;NewStringUTF(hello.c_str());\n&#125;\n\nè¿™é‡Œè®²å‡ ç‚¹ï¼Œä¸€ä¸ªæ˜¯å…³äºè·¯å¾„é—®é¢˜ï¼Œè·¯å¾„çš„è¯ï¼Œå®é™…ä¸Šå°±æ˜¯/da ta/app/åŒ…åçš„å˜åŒ–/lib/arm/ä¸‹çš„soæ–‡ä»¶åï¼Œè¿™é‡Œç›´æ¥adbè¿›å…¥æŸ¥çœ‹å°±å¥½äº†ï¼Œé—®é¢˜ä¸€èˆ¬ä¸å¤§ï¼Œç„¶åå°±æ˜¯ç¬¦å·åï¼Œc++æ˜¯æœ‰ç¬¦å·ä¿®é¥°ï¼Œç›´æ¥idaæ‰“å¼€çœ‹ï¼Œæˆ–è€…objectionä¹Ÿå¯ä»¥ï¼Œç›®å‰è¿˜æ˜¯ä¸ºäº†å»å¯»æ‰¾åœ°å€ï¼Œå‰©ä¸‹å°±æ˜¯æˆ‘ä»¬å°†hooké€»è¾‘éƒ½æ”¾åœ¨initæ®µäº†ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥å¯åŠ¨ï¼Œå…¶ä»–initarrayå’Œjnionloadä¹Ÿåœ¨é‡Œé¢ã€‚\n\nxposedé€»è¾‘\npackage com.example.kanxuexposedso1;\n\nimport android.util.Log;\n\nimport de.robv.android.xposed.IXposedHookLoadPackage;\nimport de.robv.android.xposed.XC_MethodHook;\nimport de.robv.android.xposed.XposedBridge;\nimport de.robv.android.xposed.XposedHelpers;\nimport de.robv.android.xposed.callbacks.XC_LoadPackage;\n\npublic class Xmodule implements IXposedHookLoadPackage &#123;\n    @Override\n    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam lpparam) throws Throwable &#123;\n        if(lpparam.packageName.equals(&quot;com.example.hooksoexample01&quot;))\n        &#123;\n            Class systemClass&#x3D;lpparam.classLoader.loadClass(&quot;java.lang.Runtime&quot;);\n            XposedBridge.hookAllMethods(systemClass, &quot;loadLibrary0&quot;, new XC_MethodHook() &#123;\n                @Override\n                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;\n                    super.beforeHookedMethod(param);\n                &#125;\n\n                @Override\n                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;\n                    super.afterHookedMethod(param);\n                    String libname&#x3D;(String)param.args[1];\n                    Log.e(&quot;YenKoc::&quot;,libname);\n                    if(libname.indexOf(&quot;native-lib&quot;)!&#x3D;-1)\n                    &#123;\n                        System.load(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;b.so&quot;);\n                    &#125;\n\n\n                &#125;\n            &#125;);\n\n        &#125;\n    &#125;\n&#125;\n\n\nè¿™é‡ŒindexOfå·®ç‚¹æŠŠæˆ‘å‘äº†ï¼Œè¿™é‡Œæ˜¯æŒ‡æ‹¬å·é‡Œé¢çš„åœ¨libnameä¸­çš„ä¸‹æ ‡ï¼Œä¹‹å‰ä¸€ç›´æåäº†ã€‚\n\n\n","slug":"Xposedç¼–å†™inlinehookæ¡†æ¶æ’ä»¶02","date":"2021-07-26T08:35:24.000Z","categories_index":"AndroidReverse","tags_index":"xposed","author_index":"YenKoc"},{"id":"2baa56a271382e4f44c5cafacec7639e","title":"xposedæ’ä»¶ç¼–å†™01","content":"å‰ç½®å‡†å¤‡ä¸¤ä¸ªapkï¼ˆä¸€ä¸ªxposedæ¨¡å—ï¼Œä¸€ä¸ªè¦hookçš„apkï¼‰\nxposedæ¨¡å—å‡†å¤‡\nç›´æ¥é€‰æ‹©nativec++åˆ›å»ºå°±è¡Œï¼Œç„¶åå°±æ˜¯é…ç½®éœ€è¦æ³¨æ„\nåœ¨appç›®å½•ä¸‹çš„build.gradleæ–‡ä»¶ä¸­ä¿®æ”¹è¿™å‡ ç‚¹\nexternalNativeBuild &#123;\n           cmake &#123;\n               cppFlags &quot;&quot;\n           &#125;\n           ndk&#123;\n               abiFilters &quot;armeabi-v7a&quot;\n           &#125;\n       &#125;\n\nrepositories &#123;\n    jcenter()\n&#125;\n\ndependencies &#123;\n    compileOnly &#39;de.robv.android.xposed:api:82&#39;\n    compileOnly &#39;de.robv.android.xposed:api:82:sources&#39;\n&#125;\n\nç„¶ååœ¨AndroidManifest.xmlçš„applicationæ ‡ç­¾ä¸‹åŠ å…¥\n&lt;meta-data android:name&#x3D;&quot;xposedmodule&quot; android:value&#x3D;&#39;true&#39;&#x2F;&gt;\n      &lt;meta-data android:name&#x3D;&quot;xposeddescription&quot; android:value&#x3D;&quot;kanxueso1&quot;&#x2F;&gt;\n      &lt;meta-data android:name&#x3D;&quot;xposedminversion&quot; android:value&#x3D;&quot;82&quot;&#x2F;&gt;\n      \nå¼€å§‹ç¼–å†™hooké€»è¾‘\nè¿™é‡Œé€‰æ‹©æ˜¯å¥—eä½¬çš„inlinehookæ¡†æ¶ï¼Œæœ‰è½®å­å°±ä¸Šè½®å­ï¼Œ\n\ncmakeé‡Œé¢ä¹Ÿéœ€è¦æ”¹ä¸‹ï¼ŒæŠŠè¿™äº›æ–‡ä»¶ä¾èµ–å¯¼å…¥è¿›å»\nadd_library( # Sets the name of the library.\n             native-lib\n\n             # Sets the library as a shared library.\n             SHARED\n\n             # Provides a relative path to your source file(s).\n            inlinehookk&#x2F;inlineHook.cpp\n            inlinehookk&#x2F;inlineHook.h\n            inlinehookk&#x2F;relocate.cpp\n            inlinehookk&#x2F;relocate.h\n\n             native-lib.cpp\n            )\n\n#include &lt;jni.h&gt;\n#include &lt;string&gt;\nextern &quot;C&quot;&#123;\n    #include &quot;inlinehookk&#x2F;inlineHook.h&quot;\n&#125;\n#include &quot;android&#x2F;log.h&quot;\n#include &lt;stdio.h&gt;\n#include &lt;dlfcn.h&gt;\n\nint (*old_strstr)(const char *,const char *) &#x3D; NULL;\n\nint new_strstr(const char *string,const char* myStr)\n&#123;\n    __android_log_print(4,&quot;YenKoc&quot;,&quot;i hook success %s&quot;,myStr);\n    if(!strcmp(myStr,&quot;YenKoc&quot;))\n    &#123;\n        return 100;\n    &#125;else&#123;\n        return old_strstr(string,myStr);\n    &#125;\n\n&#125;\n\nint hook()\n&#123;\n   void* handle&#x3D; dlopen(&quot;libc.so&quot;,RTLD_NOW);\n   void* strstraddr&#x3D;dlsym(handle,&quot;strstr&quot;);\n    if (registerInlineHook((uint32_t) strstraddr, (uint32_t) new_strstr, (uint32_t **) &amp;old_strstr) !&#x3D; ELE7EN_OK) &#123;\n        return -1;\n    &#125;\n    if (inlineHook((uint32_t) strstraddr) !&#x3D; ELE7EN_OK) &#123;\n        return -1;\n    &#125;\n\n    return 0;\n&#125;\n\nint unHook()\n&#123;\n    if (inlineUnHook((uint32_t) puts) !&#x3D; ELE7EN_OK) &#123;\n        return -1;\n    &#125;\n\n    return 0;\n&#125;\nextern &quot;C&quot; JNIEXPORT jstring JNICALL\nJava_com_example_kanxuexposedso1_MainActivity_stringFromJNI(\n        JNIEnv* env,\n        jobject &#x2F;* this *&#x2F;) &#123;\n    std::string hello &#x3D; &quot;Hello from C++&quot;;\n    hook();\n    return env-&gt;NewStringUTF(hello.c_str());\n&#125;extern &quot;C&quot;\nJNIEXPORT void JNICALL\nJava_com_example_kanxuexposedso1_Xmodule_hookhook(JNIEnv *env, jobject thiz) &#123;\n    hook();\n&#125;\n\nxposedè¿™é‡Œå…ˆæ³¨å†Œä¸€ä¸ªnativeå‡½æ•°ï¼Œæ–¹ä¾¿è°ƒç”¨ï¼Œä¸è¿‡ä¸å¯èƒ½ç›´æ¥è°ƒç”¨çš„ï¼Œæ¯æ¬¡hookç”¨çš„éƒ½æ˜¯è¢«hook appçš„classloaderï¼Œä¼šæ‰¾ä¸åˆ°ä»£ç æ‰§è¡Œçš„ï¼Œè¯´ç™½äº†ï¼Œè¿›ç¨‹å†…å­˜ä¸­æ ¹æœ¬æ²¡ä½ é‚£æ®µä»£ç ï¼Œæ‰§è¡Œä¸ªé”¤å­ï¼ˆï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¾—æ˜¯å°†soæ³¨å…¥è¿›å»\npackage com.example.kanxuexposedso1;\n\nimport de.robv.android.xposed.IXposedHookLoadPackage;\nimport de.robv.android.xposed.XC_MethodHook;\nimport de.robv.android.xposed.XposedBridge;\nimport de.robv.android.xposed.XposedHelpers;\nimport de.robv.android.xposed.callbacks.XC_LoadPackage;\n\npublic class Xmodule implements IXposedHookLoadPackage &#123;\n    public native void hookhook();\n    @Override\n    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam lpparam) throws Throwable &#123;\n        if(lpparam.packageName.equals(&quot;com.example.hooksoexample01&quot;))\n        &#123;\n            Class systemClass&#x3D;lpparam.classLoader.loadClass(&quot;java.lang.Runtime&quot;);\n            XposedBridge.hookAllMethods(systemClass, &quot;loadLibrary0&quot;, new XC_MethodHook() &#123;\n                @Override\n                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;\n                    super.beforeHookedMethod(param);\n                &#125;\n\n                @Override\n                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;\n                    super.afterHookedMethod(param);\n                    System.load(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;a.so&quot;);\n                    hookhook();\n                &#125;\n            &#125;);\n\n        &#125;\n    &#125;\n&#125;\n\n\nè¿™é‡Œçš„soæ–‡ä»¶ï¼Œæ˜¯æˆ‘å°†ç¼–è¯‘åçš„apkä¸­çš„soæ–‡ä»¶å–å‡ºäº†ï¼ˆï¼Œæ¯æ¬¡appå¯åŠ¨è‡ªåŠ¨æ³¨å…¥soåˆ°å†…å­˜ä¸­\n\nè¢«hookçš„appçš„æ ¸å¿ƒé€»è¾‘\n#include &lt;jni.h&gt;\n#include &lt;string&gt;\n\nextern &quot;C&quot; JNIEXPORT jstring JNICALL\nJava_com_example_hooksoexample01_MainActivity_stringFromJNI(\n        JNIEnv* env,\n        jobject &#x2F;* this *&#x2F;) &#123;\n    std::string hello &#x3D; &quot;Hello from C++&quot;;\n    if(strstr(&quot;fast&quot;,&quot;YenKoc&quot;)!&#x3D;nullptr)\n    &#123;\n        hello&#x3D;&quot;you are hooked&quot;;\n    &#125;\n\n    return env-&gt;NewStringUTF(hello.c_str());\n&#125;\n\nåˆ°æ­¤ä¸ºæ­¢ï¼ŒåŸºæœ¬ä¸Šhookå®Œæˆï¼Œå±å¹•å°±ä¸æˆªå›¾äº†ï¼Œç»“æœæ˜¯you are hookedï¼Œä¸è¿‡è¿™æ¬¡å¯¹æˆ‘æ¥è¯´ï¼Œæœ‰äº†ä¸€äº›æ„Ÿæ‚Ÿå§2333\n\n\næ€»ç»“ä¹‹å‰å°±æœ‰æƒ³è¿‡å°±æ˜¯inlinehookè¿™ä¸œè¥¿ï¼Œæˆ‘è¦å¦‚ä½•å»åŠ å…¥åˆ°æˆ‘çš„é€»è¾‘ä¸Šï¼Œä¹‹å‰é™·å…¥å°±æ˜¯åœ¨è‡ªå·±å¼€å‘çš„appä¸­åŠ å…¥inlinehookæ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯å»hookå…¶ä»–appæ—¶ï¼Œæ€»ä¼šæ„Ÿè§‰å¾ˆè¿·èŒ«ï¼Œä½†æ˜¯ç»è¿‡ä¸‹åˆçš„ç»ƒä¹ ï¼Œæ…¢æ…¢æœ‰äº†æ„Ÿè§‰ï¼Œå‘ç°æˆ‘å¯¹æœ¬è´¨çš„ä¸œè¥¿ä¹‹å‰æ˜¯æ²¡æœ‰å»ç†è§£ï¼Œå®é™…ä¸Šæˆ‘ä»¬å»inlinehookè‚¯å®šæ˜¯æ‰¾åˆ°æŸä¸ªå‡½æ•°çš„åœ°å€ï¼Œç„¶åæ¶è®¾è·³æ¿ï¼Œä¹‹å‰åœ¨è‡ªå·±å¼€å‘çš„appæ˜¯å®Œå…¨å¯ä»¥å®ç°çš„ï¼Œå› ä¸ºæˆ‘ä»¬hooké€»è¾‘ä¹Ÿæ˜¯å†™åœ¨æœ¬èº«çš„appè¿›ç¨‹ä¸­çš„ï¼Œè€Œä¸”æ˜¯ç”±æˆ‘ä»¬è‡ªå·±å†³å®šæ˜¯å¦è°ƒç”¨çš„ï¼Œä½†æ˜¯hookåˆ«çš„appï¼Œæˆ‘ä»¬çš„hooké€»è¾‘æ˜¯å†™åœ¨åˆ«çš„åœ°æ–¹çš„ï¼Œæ— æ³•è¿›å»appè¿›ç¨‹ï¼Œè¿è¿›ç¨‹ç©ºé—´éƒ½è¿›ä¸å»ï¼Œè°ˆä½•hookï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬éœ€è¦å»æŠŠhookçš„é€»è¾‘æ³¨å…¥åˆ°appçš„è¿›ç¨‹å†…å­˜ï¼Œè¿™æ ·æˆ‘ä»¬çš„hooké€»è¾‘å’Œè¢«hookçš„åœ°æ–¹å¤„åœ¨äº†ä¸€ä¸ªç©ºé—´ä¸­ï¼Œæˆ‘ä»¬çš„hooké€»è¾‘æ˜¯å¯ä»¥å¯¹å®ƒè¿›è¡Œæ“ä½œçš„ï¼Œå‰©ä¸‹çš„é—®é¢˜å°±æ˜¯è°ƒç”¨èµ·hooké€»è¾‘äº†ï¼Œè¿™é‡Œxposedè®¾ç½®nativeå‡½æ•°ï¼Œä¹Ÿæ˜¯ä¸ºäº†è°ƒç”¨èµ·æ¥ï¼Œæ¯•ç«Ÿæ³¨å…¥è¿›å»åï¼Œæˆ‘ä»¬å¦‚æœä¸æä¾›æ¥å£å‡ºæ¥ï¼Œå…¶å®å¾ˆéš¾å»æ“ä½œçš„ï¼Œä½†æ˜¯æˆ‘åˆæƒ³åˆ°äº†ï¼Œå°±æ˜¯dllæ³¨å…¥ä¸­ï¼Œæ¯æ¬¡æ³¨å…¥æ˜¯ä¸æ˜¯ä¼šè‡ªåŠ¨æ‰§è¡ŒæŸç§å…¥å£å‡½æ•°xxmainï¼Œä½œä¸ºç±»linuxå¹³å°ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œsoæ–‡ä»¶è½½å…¥å†…å­˜ä¸­ï¼Œä¼šå…ˆæ‰§è¡Œinitã€‚initarrayæ®µå‡½æ•°ï¼Œå†æ‰§è¡Œjni_onloadå‡½æ•°ï¼Œè¿™äº›å‡½æ•°æ— éœ€äººä¸ºè°ƒç”¨ï¼Œæ˜¯ç”±linkerå®Œæˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†hooké€»è¾‘å†™åœ¨è¿™å‡ ä¸ªåœ°æ–¹ï¼Œè®©å®ƒè‡ªå·±æ‰§è¡Œå°±è¡Œã€‚\n","slug":"xposedæ’ä»¶ç¼–å†™01","date":"2021-07-25T11:46:40.000Z","categories_index":"AndroidReverse","tags_index":"xposed","author_index":"YenKoc"},{"id":"668f1dbfd60678f860dbea390d6a69fb","title":"androidçš„PMSåŠ¨æ€ä»£ç†","content":"å‰è¨€ç›®å‰åœ¨javaå±‚ä¸­ç­¾åéªŒè¯æ˜¯ä½¿ç”¨javaå±‚çš„apiè¿›è¡Œè·å–ï¼Œç„¶åè¿›è¡Œåˆ¤æ–­ï¼Œå¯ä»¥é€‰æ‹©hookï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å®‰å“æœ¬èº«çš„ç‰¹æ€§å»hookï¼Œä¸ä½¿ç”¨ä»»ä½•hookæ¡†æ¶å»å®ç°hook\nä»£ç†æ˜¯ä»€ä¹ˆï¼Ÿç»“åˆæˆ‘è‡ªå·±çš„ç†è§£æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†å®é™…ä¸Šå°±æ˜¯æ¯”å¦‚ä½ æƒ³æ‰¾åˆ«äººï¼Œä½†æ˜¯ä½ ä¸è‡ªå·±å»æ‰¾ï¼Œè€Œæ˜¯å§”æ‰˜å¦ä¸€ä¸ªäººå»æ‰¾ï¼ŒæŠŠäº‹æƒ…äº¤ç»™å¦ä¸€ä¸ªäººå»åŠçš„ï¼Œè¿™é‡Œæ³¨æ„ç»†èŠ‚ï¼Œå°±æ˜¯å½“ä½ æŠŠäº‹æƒ…å§”æ‰˜ç»™åˆ«äººçš„æ—¶å€™ï¼Œåˆ«äººä¼šæ€ä¹ˆå»åŠè¿™ä»¶äº‹ï¼Œä½ æ˜¯ç®¡ä¸ç€çš„ï¼Œä¸éœ€è¦ä½ å»ç®¡ï¼Œä»–åªéœ€è¦æŠŠäº‹æƒ…åšå®Œå°±è¡Œï¼Œè‡³äºdiyäº›å…¶ä»–æ“ä½œä¹Ÿæ˜¯å±äºæ­£å¸¸æ“ä½œã€‚\nç”¨ä»£ç è¯´æ˜ä¸‹\n&#x2F;&#x2F;å…±åŒå®ç°çš„æ¥å£\npublic interface IHelloWorld &#123;\n    public void helloWorld(String str);\n&#125;\n \n&#x2F;&#x2F;çœŸå®å¯¹è±¡\npublic class RealSubject implements IHelloWorld &#123;\n    @Override\n    public void helloWorld() &#123;\n        System.out.println(&quot;RealSubject say hello world&quot;);\n    &#125;\n&#125;\n \n&#x2F;&#x2F;ä»£ç†å¯¹è±¡\npublic class Proxy implements IHelloWorld &#123;    \n    private IHelloWorld subject;\n \n    public Proxy(IHelloWorld subject) &#123;\n        this.subject &#x3D; subject;\n    &#125;\n \n    @Override\n    public void helloWorld() &#123;\n        &#x2F;&#x2F;ä»£ç†ç±»çš„ç§è´§\n        System.out.println(&quot;Proxy say hello world&quot;);  \n     \n        &#x2F;&#x2F;è¢«ä»£ç†å¯¹è±¡çš„çœŸå®è°ƒç”¨\n        subject.helloWorld();\n    &#125;\n&#125;\n \n \n&#x2F;&#x2F;å®é™…è°ƒç”¨\npublic static void main(String[] args) &#123;\n    &#x2F;&#x2F;è¢«ä»£ç†çš„å¯¹è±¡\n    RealSubject realSubject &#x3D; new RealSubject();\n \n    &#x2F;&#x2F;ä»£ç†ç±»å¯¹è±¡\n    Proxy proxy &#x3D; new Proxy(realSubject);\n \n    &#x2F;&#x2F;è°ƒç”¨ä»£ç†ç±»å¯¹è±¡çš„æ–¹æ³•\n    proxySubject.helloWorld();\n&#125;\n\nå…¶å®ä»£ç å†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œè¿™æ˜¯é™æ€ä»£ç†ï¼Œæˆ‘åªæ˜¯ç”¨è¿™ä¸ªä¸¾ä¾‹ï¼Œæœ¬æ¥ç›´æ¥è°ƒç”¨çš„ä¸æ˜¯å¾ˆæ–¹ä¾¿å—ï¼Œä¸ºä»€ä¹ˆå‡ºç°äº†ä¸€ä¸ªä»£ç†ï¼Œå®é™…åœ¨ä»£ç†å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æçš„äº‹æƒ…å°±å¾ˆå¤šäº†ï¼Œå¯ä»¥åœ¨æœ¬æ¥è°ƒç”¨çš„æ–¹æ³•ä¸­åŠ å…¥å¦å¤–å®šåˆ¶çš„ä»£ç ï¼Œå˜¿å˜¿ï¼ŒåŠ ä¸Šä¸€ä¸ªæ˜¯åŒä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆæ–¹æ³•åéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå®é™…ä¸Šå°±æ˜¯hookäº†ã€‚ã€‚\nåŠ¨æ€ä»£ç†åŠ¨æ€ä»£ç†æ¨¡å¼æ˜¯å’Œé™æ€ä»£ç†æ¨¡å¼å·®ä¸å¤šï¼Œä¸è¿‡å°±æ˜¯ä¸åœ¨æˆ‘ä»¬è‡ªå·±å®šä¹‰ä»£ç†å¯¹è±¡äº†ï¼Œå®ç°æ¥å£å°±å¯ä»¥è‡ªåŠ¨ç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œç»“åˆä»£ç \nObject proxy&#x3D; Proxy.newProxyInstance(iPackageManagerInterface.getClassLoader(),new Class&lt;?&gt;[]&#123;iPackageManagerInterface&#125;,new PMSHookBinderInvocationHandler(sPackagerManager,signed,appPkgName,0));\n            sPackageManagerField.set(currentActivityThread,proxy);\n\nnew PMSé‚£è¡Œä»£ç å°±æ˜¯å®ç°äº†InvocationHandlerè¿™ä¸ªæ¥å£çš„ï¼Œè°ƒç”¨è¿™ä¸ªProxy.newProxyInstanceæ–¹æ³•è‡ªåŠ¨ç”Ÿæˆäº†ä»£ç†å¯¹è±¡ï¼Œå¦å¤–å®ç°æ¥å£çš„é‚£ä¸ªç±»ï¼Œå®é™…ä¸Šæ˜¯å½»åº•è¡¥å……äº†ä»£ç†å¯¹è±¡çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯å¸®åŸå¯¹è±¡å®ç°åŠŸèƒ½ï¼ŒåŒæ—¶åŠ å…¥æˆ‘ä»¬çš„hookä»£ç ï¼Œå½“è¿™ä¸ªä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³•æ—¶ï¼Œä¼šå…ˆè·‘åˆ°æˆ‘ä»¬å®ç°æ¥å£çš„é‚£ä¸ªå¯¹è±¡ä¸­çš„invokeæ–¹æ³•ã€‚\nandroidé‡Œé¢çš„pmsåŠ¨æ€ä»£ç†å®ç°package com.example.puatest;\n\nimport android.content.pm.PackageInfo;\nimport android.content.pm.PackageManager;\nimport android.content.pm.Signature;\nimport android.text.method.SingleLineTransformationMethod;\nimport android.util.Log;\n\nimport java.lang.reflect.InvocationHandler;\nimport java.lang.reflect.Method;\n\npublic class PMSHookBinderInvocationHandler implements InvocationHandler &#123;\n    private Object base;\n    public final static String yk&#x3D;&quot;YenKoc&quot;;\n\n    &#x2F;&#x2F;åº”ç”¨æ­£ç¡®çš„ç­¾åä¿¡æ¯\n    private String SIGN;\n    private String appPkgName&#x3D;&quot;&quot;;\n    public PMSHookBinderInvocationHandler(Object sPackagerManager, String signed, String appPkgName, int i) &#123;\n        try&#123;\n            this.base&#x3D;sPackagerManager;\n            this.SIGN&#x3D;signed;\n            this.appPkgName&#x3D;appPkgName;\n        &#125;catch (Exception e)\n        &#123;\n            e.printStackTrace();\n        &#125;\n    &#125;\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;\n            Log.i(&quot;YenKoc&quot;,&quot;è°ƒç”¨äº†ä»£ç†æ–¹æ³•&quot;);\n        if(&quot;getPackageInfo&quot;.equals(method.getName()))&#123;\n            String pkgName&#x3D;(String)args[0];\n            Integer flag&#x3D;(Integer)args[1];\n            if(flag&#x3D;&#x3D; PackageManager.GET_SIGNATURES&amp;&amp;appPkgName.equals(pkgName))\n            &#123;\n                Signature sign&#x3D;new Signature(SIGN);\n                &#x2F;&#x2F;è°ƒç”¨åŸæ¥çš„æ–¹æ³•\n                PackageInfo info&#x3D;(PackageInfo)method.invoke(base,args);\n                info.signatures[0]&#x3D;sign;\n                return info;\n            &#125;\n        &#125;\n        return method.invoke(base,args);\n    &#125;\n&#125;\n\n\n\n\npackage com.example.puatest;\n\nimport android.content.Context;\nimport android.content.pm.PackageManager;\n\nimport java.lang.reflect.Field;\nimport java.lang.reflect.Method;\nimport java.lang.reflect.Proxy;\n\npublic class ServiceManagerWrapper &#123;\n    public final static String yk&#x3D;&quot;YenKoc&quot;;\n\n    public static void hookPMS(Context context,String signed,String appPkgName,int hashcode)\n    &#123;\n        try&#123;\n            Class&lt;?&gt; activityThreadClass&#x3D;Class.forName(&quot;android.app.ActivityThread&quot;);\n            Method currentActivityThreadMethod&#x3D;activityThreadClass.getDeclaredMethod(&quot;currentActivityThread&quot;);\n            Object currentActivityThread&#x3D;currentActivityThreadMethod.invoke(null);\n            &#x2F;&#x2F;è·å–ActivityThreadé‡Œé¢åŸå§‹sPackageManager\n            Field sPackageManagerField&#x3D;activityThreadClass.getDeclaredField(&quot;sPackageManager&quot;);\n            sPackageManagerField.setAccessible(true);\n            Object sPackagerManager&#x3D;sPackageManagerField.get(currentActivityThread);\n            &#x2F;&#x2F;å‡†å¤‡å¥½ä»£ç†å¯¹è±¡\n            Class&lt;?&gt; iPackageManagerInterface&#x3D;Class.forName(&quot;android.content.pm.IPackageManager&quot;);\n            Object proxy&#x3D; Proxy.newProxyInstance(iPackageManagerInterface.getClassLoader(),new Class&lt;?&gt;[]&#123;iPackageManagerInterface&#125;,new PMSHookBinderInvocationHandler(sPackagerManager,signed,appPkgName,0));\n            sPackageManagerField.set(currentActivityThread,proxy);\n            &#x2F;&#x2F;æ›¿æ¢applicationpackageManageré‡Œé¢çš„mPMå¯¹è±¡\n            PackageManager pm&#x3D;context.getPackageManager();\n            Field mPmField&#x3D;pm.getClass().getField(&quot;mPM&quot;);\n            mPmField.setAccessible(true);\n            mPmField.set(pm,proxy);\n\n        &#125;catch (Exception e)&#123;\n            e.printStackTrace();\n        &#125;\n    &#125;\n    public  static void hookPMS(Context base)\n    &#123;\n        String sigg&#x3D;&quot;12342355&quot;;\n        hookPMS(base,sigg,&quot;com.example.puatest&quot;,0);\n    &#125;\n\n&#125;\n\n\npackage com.example.puatest;\n\nimport android.app.Application;\nimport android.content.Context;\nimport android.util.Log;\n\npublic class wrapApplication extends Application &#123;\n    @Override\n    protected void attachBaseContext(Context base) &#123;\n        Log.i(&quot;YenKoc&quot;,&quot;è¿›å…¥&quot;);\n        ServiceManagerWrapper.hookPMS(base);\n        super.attachBaseContext(base);\n    &#125;\n&#125;\n\n\n","slug":"androidçš„PMSåŠ¨æ€ä»£ç†","date":"2021-07-02T06:26:47.000Z","categories_index":"AndroidReverse","tags_index":"reverse","author_index":"YenKoc"},{"id":"4b0b858a57a6176d5e34068e8d18965f","title":"Androidé”æœºå‹’ç´¢ç—…æ¯’åˆ†æ","content":"å‰è¨€æœ‰ä¸€è¯´ä¸€ï¼Œæˆ‘æ‹‰äº†ï¼Œå¥½å‡ ä¸ªæ¨¡æ‹Ÿå™¨è¿è¡Œè¿™ä¸ªapkï¼Œå‘ç°æ²¡å•¥ç‰¹åˆ«çš„ï¼Œé™æ€åˆ†æä¸€çœ‹ï¼Œå‘ç°é‡Œé¢æœ‰suç­‰ä¸€å¤§å †çš„å‘½ä»¤ï¼Œmmpï¼Œæ‰€ä»¥è¯´æ²¡rootçš„è¯ï¼Œä¸€åˆ‡å…è°ˆï¼Œä¸æ‰“ç®—åœ¨çœŸæœºä¸Šè¯•ï¼Œç›´æ¥é™æ€åˆ†æï¼Œå˜¿å˜¿\njebé™æ€åˆ†æå¼€å§‹ä»å¼€å§‹ç•Œé¢æ‰¾èµ·ï¼Œå› ä¸ºè¿™ç§æ¶æ„è½¯ä»¶çš„å¯åŠ¨è‚¯å®šè¦æœ‰ä¸€ä¸ªè§¦å‘ç‚¹ï¼Œä¸€èˆ¬æ˜¯åœ¨å¿…ç»çš„åœ°æ–¹ï¼Œå¦åˆ™å¾ˆæœ‰å¯èƒ½ä¼šè§¦å‘ä¸äº†ï¼Œæ‰€ä»¥ä»å¼€å§‹ç•Œé¢å¼€å§‹æ“ä½œï¼Œå‘ç°äº†ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„åœ°æ–¹\n\nè¿™é‡Œå‡ºç°äº†ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ç±»åï¼Œå…¶ä»–æˆ‘ç¨å¾®è·Ÿäº†ä¸‹ï¼Œå‘ç°åŠŸèƒ½æ²¡å•¥å¤§é—®é¢˜ï¼Œè¿™ä¸œè¥¿ä¼¼ä¹å°±æ˜¯éå†wifiåˆ—è¡¨ï¼Œç„¶åæ˜¾ç¤ºï¼Œç»§ç»­è·Ÿè¿›å»è¿™ä¸ªå¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ã€‚\n\nç»§ç»­è·Ÿè¿›å»\n\nè¿˜æŒºåï¼ŒåŸºæœ¬å°±æ˜¯æ¯æ¬¡å¤åˆ¶ä¹‹åï¼Œç„¶åå°±åˆ æ‰ï¼Œæœ€åçš„é‚£ä¸ªé”æœºçš„apkï¼Œå°±æ˜¯è¿™ä¸ªå«cia.apkçš„ä¸œè¥¿äº†ï¼Œä¸è¿‡æˆ‘ä¸æƒ³è¿è¡Œï¼Œæ‰€ä»¥åªèƒ½æœ¬åœ°è§£å¯†åï¼Œå†é™æ€åˆ†æäº†ã€‚\næœ¬åœ°è§£å¯†æˆapkæ–‡ä»¶Python2\nf&#x3D;open(&quot;date.jar&quot;,&quot;rb&quot;)\nf2&#x3D;open(&quot;finalres.txt&quot;,&quot;wb&quot;)\ndate&#x3D;&#39;&#39;\nfor i in f.read():\n    date+&#x3D;i\nxor7&#x3D;lambda x:chr(ord(x)^(358&amp;0xff))\nfinal&#x3D;&quot;&quot;.join(map(xor7,date))\nf2.write(final)\n\nfinalres.txtæ˜¯æˆ‘è‡ªå·±æ–°å»ºçš„ä¸€ä¸ªç©ºç™½æ–‡ä»¶ï¼Œé‡Œé¢å•¥éƒ½æ²¡æœ‰ï¼Œå­˜æ”¾è§£å¯†åçš„å­—èŠ‚æµçš„ã€‚\nè§£å¯†åçš„æ•ˆæœ:\n\næ”¹ä¸‹åç¼€ï¼Œjebå°±å¯ä»¥è·‘äº†\nç»§ç»­åˆ†æè¿™ä¸ªapk\n\næ–°å»ºäº†ä¸€ä¸ªçº¿ç¨‹\n\nè¿™é‡Œå…¶å®æˆ‘ç½‘ä¸Šæœäº†ä¸‹ï¼ŒåŸºæœ¬ä¸Šé”æœºè½¯ä»¶éƒ½æœ‰è¿™æ®µä»£ç ï¼Œæˆ‘ä¼°è®¡æ˜¯æ§åˆ¶å±å¹•çš„ï¼ˆã€‚\n\nè¿™é‡Œæ–°èµ·äº†ä¸€ä¸ªserviceï¼Œç»§ç»­çœ‹çœ‹è¿™ä¸ªservice\n\nè¿™é‡Œå°±æ˜¯å…³é”®é€»è¾‘çš„åœ°æ–¹äº†ï¼Œåˆè¯ºåŠ æ•°å­—ï¼Œè¿™ä¸ªç±»æ˜¯å®ƒè‡ªå®šä¹‰çš„ä¸€ä¸ªç±»ï¼Œé‡Œé¢å…¨æ˜¯android apiçš„åŠ å¯†ç®—æ³•ã€‚\nçœ‹äº†ä¸‹è§£å¯†ç”¨çš„å°±æ˜¯ä¸€ä¸ªaesçš„ç®—æ³•\n\nè¿™é‡Œå°±æ˜¯æœ€ç»ˆåˆ¤æ–­çš„åœ°æ–¹äº†ï¼Œå¯è§è¿™ä½å…„å¼Ÿå†™çš„ä»£ç æœ‰å¤šçƒ‚ï¼Œåˆ†åˆ†é’Ÿè¢«ç ´ï¼ˆï¼Œè¿™æ°´å¹³è¿˜å‹’ç´¢å‘¢ã€‚ã€‚ã€‚\nç›´æ¥hook GetMD5Codeæ–¹æ³•çš„è¿”å›å€¼ï¼Œä¸ºæˆ‘è¾“å…¥çš„ï¼Œç›´æ¥æ²¡äº†ï¼Œç”šè‡³éƒ½ä¸éœ€è¦è§£å¯†ã€‚\n","slug":"Androidé”æœºå‹’ç´¢ç—…æ¯’åˆ†æ","date":"2021-06-29T03:54:43.000Z","categories_index":"AndroidReverse","tags_index":"reverse","author_index":"YenKoc"},{"id":"90a1c6273d337dfc4b6067dd868be1ed","title":"SVCæŒ‡ä»¤è·å–è®¾å¤‡ä¿¡æ¯&å†…è”æ±‡ç¼–","content":"å‰è¨€ç›®å‰è¶Šæ¥è¶Šå¤šçš„apiï¼Œé‡‡ç”¨svcè¿›è¡Œç›´æ¥ç³»ç»Ÿè°ƒç”¨ï¼Œsyscallä¹Ÿä¸ç”¨äº†ï¼Œç›´æ¥å†…è”æ±‡ç¼–ï¼Œç„¶åsvcï¼Œå¯ä»¥é˜²æ­¢hookï¼Œä¸è¿‡æœ€è¿‘åœ¨çœ‹é›ªä¹Ÿçœ‹åˆ°ä¸€ç¯‡ä¿®æ”¹å†…æ ¸çš„æ“ä½œåæ“ä½œçš„ï¼Œä¹‹åæ‰“ç®—å†ç ”ç©¶ç ”ç©¶ã€‚\nsyscallsyscallå¯ä»¥è¯´æ˜¯ç³»ç»Ÿå±‚ç»™ç”¨æˆ·å±‚æä¾›çš„ä¸€ä¸ªè°ƒç”¨å†…æ ¸æ€ä»£ç çš„apiï¼Œæˆ‘ä»¬ä½¿ç”¨openï¼Œreadç­‰å‡½æ•°ï¼Œå®é™…ä¸Šæœ€åä¹Ÿä¼šè°ƒç”¨åˆ°syscallè¿™ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä¸å»ä½¿ç”¨libcä¸­çš„å‡½æ•°æ—¶ï¼Œå› ä¸ºå¤ªå®¹æ˜“è¢«hookï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥åŒæ ·å®ç°å®ƒçš„åº•å±‚å‡½æ•°ï¼Œè¿›è€Œå®ç°ç›¸åŒæ•ˆæœï¼ŒåŒæ—¶è¿˜ä¸å®¹æ˜“è¢«hook,å®é™…ä¸Šsyscallåº•å±‚è¿˜æ˜¯è°ƒç”¨svcè¿›å…¥å†…æ ¸æ€çš„ï¼ŒæŠŠlibc.soä»æˆ‘çš„çš®é‹ä¸Šæ‰’ä¸‹æ¥ï¼Œidaåæ±‡ç¼–çœ‹çœ‹ã€‚\n\nä¸Šé¢æ˜¯f5çš„æ ·å­ï¼Œå®é™…ä¸Šçš„æ±‡ç¼–ã€‚\n\næ‰€ä»¥æ ¹æ®è¿™é‡Œï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æ¨¡ä»¿è¿™ç§å†™æ³•ï¼Œè‡ªå·±æ„é€ åº•å±‚å‡½æ•°ï¼Œä»¥é˜²æ­¢è¢«è½»æ˜“hookï¼Œæ¯•ç«Ÿå†…æ ¸æ€çš„å†…å­˜æ˜¯ä¸èƒ½åŠ¨çš„ã€‚\nå…ˆå¯¼å…¥ä¸€æ‰‹å¤´æ–‡ä»¶ï¼Œè®²é“ç†å‘ç°æœ‰æ—¶å€™å¤´æ–‡ä»¶æ²¡å¯¼å…¨å°±å¾ˆçƒ¦ï¼Œæ‰€ä»¥å¹²è„†ç›´æ¥å…¨éƒ¨å¯¼å…¥å¸¸ç”¨çš„ï¼Œæ–¹ä¾¿233\n#include &lt;jni.h&gt;\n#include &lt;dlfcn.h&gt;\n#include &lt;android&#x2F;log.h&gt;\n#include &lt;malloc.h&gt;\n#include &lt;stdbool.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;regex&gt;\n#include &lt;bits&#x2F;getopt.h&gt;\n#include &lt;asm&#x2F;unistd.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;asm&#x2F;fcntl.h&gt;\n#include&lt;fcntl.h&gt;\n\n#include&lt;sys&#x2F;types.h&gt;\n#include&lt;sys&#x2F;stat.h&gt;\n\n#include &lt;unistd.h&gt;\n#include &lt;sys&#x2F;syscall.h&gt;\n#include &lt;sys&#x2F;types.h&gt;\n#include &lt;sys&#x2F;stat.h&gt;\n#include &lt;fcntl.h&gt;\n\nç„¶åæˆ‘ä»¬è‡ªå·±è‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œ\n\nè¿™é‡Œæœ‰ä¸ªå‘ç‚¹ï¼Œå°±æ˜¯å¦‚æœä¸è®¾ç½®ä½ ç¼–è¯‘çš„æ˜¯å‡ ä½çš„ï¼Œé‚£ä¹ˆå‚æ•°æ˜¯æ— æ³•å†™__NT_openï¼Œç¼–è¯‘ä¼šä¸€ç›´é€šä¸è¿‡ï¼Œå°±è®¾ç½®å°±æ˜¯åœ¨\n\nARMå†…è”æ±‡ç¼–æ²‰æ€ï¼Œå‘ç°å¾ˆå¤šsyscallï¼Œä¸ºäº†é˜²æ­¢è¢«libcä¸­ç›´æ¥hookï¼Œç›´æ¥è‡ªå·±å†…åµŒä¸€ä¸ªå†…è”æ±‡ç¼–äº†ï¼Œå°±å¾ˆä¸è®²é“ç†ï¼Œè‡ªå·±å®ç°ä¸€æ‰‹ï¼Œå…¶å®ç›´æ¥æŠŠidaä¸­åæ±‡ç¼–çš„æ±‡ç¼–ç›´æ¥æ‰’æ‹‰ä¸‹æ¥å°±å¥½äº†ï¼Œä¸è¿‡androidstudioè¿˜æ˜¯éœ€è¦è®¾ç½®ä¸€ä¸‹çš„ã€‚\n    .text\n    .global raw_syscall\n    .type raw_syscall,%function\n\nraw_syscall:\n        MOV             R12, SP\n        STMFD           SP!, &#123;R4-R7&#125;\n        MOV             R7, R0\n        MOV             R0, R1\n        MOV             R1, R2\n        MOV             R2, R3\n        LDMIA           R12, &#123;R3-R6&#125;\n        SVC             0\n        LDMFD           SP!, &#123;R4-R7&#125;\n        mov             pc, lr\n\n\n\nåœ¨cmakelistä¸­ä¹Ÿéœ€è¦ä¿®æ”¹ä¸‹ï¼Œå¼•å…¥è¿™ä¸ªæ±‡ç¼–æ–‡ä»¶\n\nç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°å°±è¡Œ\n\nå’Œä¹‹å‰æ˜¯ä¸€æ ·çš„ï¼Œæ²¡å•¥å¤§é—®é¢˜\nidaåç¼–è¯‘åï¼Œæ•ˆæœå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼Œè¿˜è¡Œ\n\nç»§ç»­è·Ÿä¸‹å»ï¼Œå‘ç°è¿™ä¸ªå‡½æ•°ï¼Œå’Œæˆ‘åœ¨libcä¸­åç¼–è¯‘å‡ºçš„syscallæ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡è¿™é‡Œæˆ‘å·²ç»ä¸éœ€è¦åŠ¨æ€é“¾æ¥è¿›å»äº†ï¼Œ\nç›´æ¥å°±æ˜¯æœ¬åœ°çš„ï¼Œhh\nå…¶ä»–å‚è€ƒå†…è”æ±‡ç¼–:https://blog.csdn.net/tidyjiang/article/details/52138598\n","slug":"SVCæŒ‡ä»¤è·å–è®¾å¤‡ä¿¡æ¯-å†…è”æ±‡ç¼–","date":"2021-06-28T07:05:01.000Z","categories_index":"AndroidReverse","tags_index":"reverse","author_index":"YenKoc"},{"id":"e711ae4763716495e69aa9bd1f61c2a8","title":"2021å¼ºç½‘æ¯wp","content":"å‰è¨€å°±çœ‹äº†ä¸¤é¢˜å®‰å“åŠ ä¸€ä¸ªtimeagoï¼Œå¤ªèœäº†å‘€ï¼Œå®å±è¦é€€å½¹çš„èŠ‚å¥äº†ï¼Œä¸€æ®µæ—¶é—´æ²¡è°ƒï¼Œæ„Ÿè§‰æ°´å¹³æ— é™ä¸‹æ»‘ï¼ˆã€‚\nezmathè¿™é¢˜ä¸äºˆè¯„ä»·äº†ï¼Œæ„Ÿè§‰æŒºå¥‡æ€ªçš„ï¼ŒæŒ‰é“ç†æ¥è¯´idapythonè¿˜æ˜¯inline hookéƒ½æ˜¯å¯ä»¥æ¯ä¸¤å­—èŠ‚çˆ†ç ´å‡ºæ¥çš„ï¼Œä½†æ˜¯ç²¾åº¦æŸå¤±çš„éå¸¸å‰å®³ï¼Œæ„Ÿè§‰æ˜¯å‡ºé¢˜äººæœºå™¨å’Œæˆ‘ä»¬çš„ä¸å¤ªä¸€æ ·çš„é—®é¢˜ï¼Œæ²¡å•¥æ„æ€æ„Ÿè§‰ã€‚\nTimetoAgoä¸€é“64ä½çš„exeï¼Œå…ˆå»èŠ±æŒ‡ä»¤çš„ï¼Œéƒ½æ˜¯ä¸€äº›ç®€å•çš„æ¨¡å¼ï¼Œdä¸€ä¸‹ï¼Œç„¶åè¯¥nopå°±nopå°±å¯ä»¥å®Œç¾çš„f5äº†ï¼Œ\n\nå› ä¸ºé¢˜ç›®ä¸€ç›´æç¤ºæ—¶é—´çš„ï¼Œé—®é¢˜ï¼Œæˆ‘å°±æƒ³å½“ç„¶çš„ç›´æ¥æŒ‰æ²¡åŠ å¯†çš„patchï¼Œåé¢å‘ç°flagä¸å¯¹ï¼Œåˆå¼€å§‹è€è€å®å®çš„æ¬ç –äº†ã€‚\nå…ˆç»è¿‡äº†å››ä¸ªæ¼«é•¿çš„å‡½æ•°ï¼Œå¤§æ¦‚å°±æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªç»“æ„ä½“ï¼Œä¸è¿‡ç»“æ„ä½“çš„å­—æ®µå€¼ï¼Œæ˜¯ç»è¿‡ä¸€ä¸ªå¥‡è‘©å‡½æ•°ç”Ÿæˆçš„ï¼ŒåŠ¨è°ƒäº†ä¸‹å‘ç°æ˜¯å¸¸æ•°ï¼Œä¸è¿‡è·‘çš„å¾ˆæ…¢ï¼Œè€å¿ƒä¸€ç‚¹ï¼Œå¤§æ¦‚5åˆ†é’Ÿå°±è·‘å®Œäº†ï¼Œå››ä¸ªå€¼ï¼Œ0xffd,0x1ffd,0x3ffd,0x7ffd\nåé¢çš„å°±æ˜¯æ…¢æ…¢ç£¨ï¼Œèƒ½å¾ˆæ˜æ˜¾çš„çœ‹åˆ°teaç®—æ³•åŠ å¯†çš„ç—•è¿¹ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°ä¸­å‡ºç°&lt;&lt;4 å’Œ&gt;&gt;5çš„å¼‚æˆ–ç›¸åŠ çš„ï¼Œåé¢å¯¹ç…§ç€æ€è·¯ï¼Œå‘ç°å°±æ˜¯å‰4ä¸ªæ˜¯xteaå˜ç§åŠ å¯†ï¼Œå4ä¸ªteaåŠ å¯†ï¼Œç„¶åå¯¹æ¯”çš„å¯†æ–‡ä¹Ÿå˜åŠ¨äº†ï¼Œä¸ç”¨ç®¡ç›´æ¥dumpä¸‹æ¥ï¼Œç›´æ¥æä¸ªè„šæœ¬è·‘å°±è¡Œã€‚\nStandonGiantå®‰å“é¢˜ï¼Œjavaå±‚æ²¡å•¥ä»£ç ï¼Œå°±æ˜¯ä¸€ä¸ªç‚¹å‡»äº‹ä»¶è€Œå·²ï¼Œç„¶åç›´æ¥åˆ°nativeå±‚ï¼Œåœ¨.init_arrayå‘ç°å¾ˆæ˜æ˜¾çš„opensslç—•è¿¹ï¼Œgithubä¸Šä¸€æœï¼Œå‘ç°å°±æ˜¯opensslçš„åˆå§‹åŒ–ï¼Œæ˜æ˜¾æ˜¯é™æ€ç¼–è¯‘è¿›æ¥äº†ï¼Œé¢˜ç›®ä¹Ÿå‘Šè¯‰æ˜¯å¤§æ•°ï¼Œæˆ‘è¿™é‡ŒçŠ¯äº†ä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼Œæ²¡æœ‰æ‹¿æºç å»å¯¹æ¯”ï¼Œå®é™…ä¸Šopensslçš„æºç ç½‘ä¸Šä¸€å †ï¼Œç„¶åä¸€ç›´åœ¨è°ƒè¯•åº“å‡½æ•°ï¼Œæ— ç©·æ— å°½ï¼Œå¤§æ¦‚å‰é¢å°±æ˜¯åšäº†ä¸€ä¸ªé€†åºï¼Œç„¶åç»è¿‡äº†ä¸€ä¸ªçº¯çš„rsaåŠ å¯†ï¼Œæ¨¡æ•°å°±æ˜¯é‚£ä¸ªå¼‚æˆ–åçš„æ•°ç»„ï¼Œç„¶åå†ç»è¿‡ä¸€ä¸ªbase64çš„æ¢è¡¨åŠ å¯†ï¼Œè¿™ä¸ªæ˜¯çœŸçš„å‘ï¼Œé‚£ä¸ªbase64çš„è¡¨ä¸­+-é‡å¤äº†ï¼Œä¹Ÿå°±ä¼šå¯¼è‡´æˆ‘ä»¬åæ¨å›åŸè¡¨çš„ä¸‹æ ‡ä¼šå¯¼è‡´ä¸æ­¢ä¸€ç§æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦çˆ†ç ´2^14æ¬¡ï¼ŒæŠŠæƒ…å†µéƒ½æ‰¾å‡ºæ¥ï¼Œåªæœ‰æ­£ç¡®çš„é‚£ä¸ªæ‰èƒ½è§£å¯†ï¼ˆã€‚\nfrom Crypto.Util.number import *\nimport base64\nn &#x3D; 0x1321D2FDDDE8BD9DFF379AFF030DE205B846EB5CECC40FA8AA9C2A85CE3E992193E873B2BC667DABE2AC3EE9DD23B3A9ED9EC0C3C7445663F5455469B727DD6FBC03B1BF95D03A13C0368645767630C7EABF5E7AB5FA27B94ADE7E1E23BCC65D2A7DED1C5B364B51\np &#x3D; 33372027594978156556226010605355114227940760344767554666784520987023841729210037080257448673296881877565718986258036932062711\nq &#x3D; 64135289477071580278790190170577389084825014742943447208116859632024532344630238623598752668347708737661925585694639798853367\ne &#x3D; 65537\n#æ™®é€šçš„base64çš„æ¢è¡¨\n&#39;&#39;&#39;\nstr1 &#x3D; &quot;x2dtJEOmyjacxDemx2eczT5cVS9fVUGvWTuZWjuexjRqy24rV29q&quot;\n\nstring1 &#x3D; &quot;ZYXABCDEFGHIJKLMNOPQRSTUVWzyxabcdefghijklmnopqrstuvw0123456789+&#x2F;&quot;\nstring2 &#x3D; &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#x2F;&quot;\nflag&#x3D;base64.b64decode(str1.translate(str.maketrans(string1,string2)))\n&#39;&#39;&#39;\n# è¡¨ä¸­å‡ºç°é‡å¤å‡ºç°çš„å­—ç¬¦æ—¶è¦æ€ä¹ˆåš\na &#x3D;&quot;bborOT+ohG*,U:;@&#x2F;gVIAZ-,t++LaZkOrk?UcSOKJ?p-J+vuSN?:e,Kc&#x2F;?h-oH?:tthoqYYSPp-ZC+Yw:*jrxPymGYO&#x2F;PvDOIivNYtvJ?Mi*GG+&#x2F;lmqEysrTdSD+eP+moP+l?+Np&#x2F;oK&quot;\n#a &#x3D; &quot;btF.d:IDCNIMHdD+PFExV+BBGYbxjqGK@IN?B+d:*;XZvSMiBJaY@ufB,CIDCI?;oR?SWWdNU?EXc*BfpakoNsRD:IQRffViAUmF+&#x2F;aJ*v*xvxYw?KXVaFsRzy&#x2F;N&#x2F;,XGGKHrpZ*Ooje&#x3D;&quot;\ntable1 &#x3D; &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ*+,-.&#x2F;:;?@+-&quot;\ntable2 &#x3D; &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#x2F;&quot;\nprint(len(a))\nall_mid_result&#x3D;[]\ndef findIndex(table,yk):\n    Indexs&#x3D;[]\n    for i in range(len(table)):\n        if yk&#x3D;&#x3D;table[i]:\n            Indexs.append(i);\n    return Indexs\n&#39;&#39;&#39;\nfor i in range(len(a)):\n    ykIndexs&#x3D;findIndex(a[i])\n    if len(ykIndexs)&#x3D;&#x3D;1:\n        flag+&#x3D;table2[ykIndexs[0]]\n    elif len(ykIndexs)&#x3D;&#x3D;2:\n&#39;&#39;&#39;\ntmp&#x3D;[]\ndef dfs(flag, yk, i):\n    if i&#x3D;&#x3D;139:\n        flag+&#x3D;&quot;&#x3D;&quot;\n        tmp.append(flag)\n        return\n    ykIndexs&#x3D;findIndex(yk,a[i])\n    #print(flag)\n    #print(ykIndexs)\n    if len(ykIndexs)&#x3D;&#x3D;2:\n        dfs(flag+table2[ykIndexs[0]],yk,i+1)\n        dfs(flag+table2[ykIndexs[1]],yk,i+1)\n    else:\n        dfs(flag+table2[ykIndexs[0]],yk,i+1)\ndfs(table2[table1.index(a[0])],table1,1)\nf&#x3D;open(&quot;data.txt&quot;,&quot;w&quot;)\nfor wx in range(len(tmp)):\n    mid_res&#x3D;base64.b64decode(tmp[wx])\n    c&#x3D;bytes_to_long(mid_res)\n    a&#x3D;pow(c,inverse(e,(p-1)*(q-1)),n)\n    flag&#x3D;long_to_bytes(a)\n    f.writelines(str(flag))\n\n\n\n\nåæ€è¿˜æœ‰ä¸€é¢˜allinoneæ˜¯é¢˜android vmå¥—å¨ƒï¼Œæœ‰äº›æ€è·¯ï¼Œä½†æ˜¯æœ€åæœ‰å‡½æ•°æˆ‘é€†ä¸å›å»ï¼Œåªèƒ½æ”¾å¼ƒï¼Œå¤ªèœäº†ï¼Œunicornæ²¡çœ‹ï¼Œæœ‰ç‚¹åƒkctfçš„ä¼ å®¶å®é‚£é¢˜äº†ï¼Œèœ—ç‰›å£³ï¼Œè¿è¡Œä¸€ç‚¹ï¼Œè§£å¯†ä¸€ç‚¹ï¼Œå¦ˆçš„ï¼Œå¾—å†™è„šæœ¬ä¸€ç›´æ‰£ä»£ç å§ï¼Œå¯æ€•ï¼Œä¸ä¼šï¼ŒæœŸå¾…ä¸‹wpï¼Œæ„Ÿè§‰çŠ¶æ€å¾ˆå·®ï¼Œéº»äº†\n","slug":"2021å¼ºç½‘æ¯wp","date":"2021-06-13T17:59:54.000Z","categories_index":"writeup","tags_index":"reverse","author_index":"YenKoc"},{"id":"05699e0b3c4e02c2136460838badc80b","title":"Android8.0 artä¸‹é¢çš„å‡ ä¸ªè„±å£³ç‚¹","content":"å‰è¨€æäº†ä¸€ä¸ª17å¹´decon ä¼šè®®çš„pptï¼Œé‡Œé¢å¯¹å¸‚é¢ä¸Šçš„ä¸€äº›apkåŠ å›ºæ–¹å¼æœ‰ä¸€äº›æ•´ä½“åˆ†æï¼Œå®é™…ä¸Šæ‰‹åŠ¨è„±å£³ï¼Œç°åœ¨è¶Šæ¥è¶Šéš¾äº†ï¼Œæ—¶é—´æˆæœ¬å¤ªå¤§äº†ï¼Œå„ç§è«åçš„åè°ƒè¯•å’Œæ··æ·†ï¼Œsoçš„è¯ï¼Œä¿ºä¹Ÿä¸å¤ªä¼šævmpï¼Œåœ¨å­¦äº†åœ¨å­¦äº†ï¼ˆæˆ‘å¤ªèœäº†ï¼Œjavaå±‚çš„è¯ï¼Œè¿˜æ˜¯æœ‰çªç ´å£çš„ï¼Œæ¯•ç«Ÿdexå†æ€ä¹ˆåŠ å›ºï¼Œæœ€ç»ˆè¿˜æ˜¯è¦ç»è¿‡classloaderï¼ŒåŠ è½½åˆ°å†…å­˜ä¸­çš„ï¼Œæ•´ä½“çš„dumpä¸‹æ¥ï¼Œä¸è¿‡ç›®å‰éƒ½æ˜¯æŠ½å–å£³ï¼Œå°±ç®—æ‰’æ‹‰ä¸‹æ¥ä¾æ—§æ˜¯éœ€è¦ä¿®å¤çš„ï¼ˆï¼Œè¿™æ˜¯fartè§£å†³çš„äº‹\nåˆ†ææºç å®‰å“8.0ä¼šæœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å˜åŠ¨ï¼Œå¤šäº†ä¸€ä¸ªinmemorydexclassloaderï¼Œè¿™ä¸ªclassloaderæ”¯æŒä¸è½åœ°åŠ è½½çš„ï¼Œæ‰€ä»¥æœ‰äº›å£³å¯èƒ½ä¼šé€‰æ‹©è¿™ä¸ªclassloaderå»åŠ è½½dexï¼Œè€Œä¸ä½¿ç”¨ä¼ ç»Ÿçš„dexclassloaderï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè·Ÿä¸€ä¸‹ä¸¤ç§dexclassloaderçš„æºç ï¼Œç„¶åä½œä¸€ä¸ªæ¯”è¾ƒï¼Œå¦‚æœæ‰¾åˆ°äº¤å‰ç‚¹çš„è¯ï¼Œç›´æ¥hookè¿™ä¸ªäº¤å‰ç‚¹ï¼Œä¸å°±å¯ä»¥å®ç°é€šæ€äº†ã€‚\nDexClassLoaderå‰é¢ä¸€å¤§å †è·Ÿçš„å°±ä¸æ”¾äº†ï¼Œå¤ªeasyäº†ï¼Œç›´æ¥è·Ÿåˆ°ä¸Šæ¬¡ç©çƒ­ä¿®å¤ï¼Œæ²¡ç»§ç»­è·Ÿä¸‹å»çš„åœ°æ–¹ã€‚\n\n\n\n\nè¿™é‡Œæœ‰ä¸ªå¾ˆæ˜æ˜¾çš„å°†dexè½¬æ¢ä¸ºoatæ ¼å¼çš„å‡½æ•°ï¼Œè¿™é‡Œå› ä¸ºartä¸­ä¼šå…ˆå°†dexè½¬æ¢oatæ ¼å¼ï¼ŒåŠ å¿«è¿è¡Œé€Ÿåº¦ï¼Œ\næˆ‘ä»¬ç»§ç»­è·Ÿè¿›å»ï¼Œæˆ‘ä»¬è·Ÿçš„ç›®çš„å°±æ˜¯æ‰¾åˆ°dexåŠ è½½åˆ°å†…å­˜ä¸­çš„é¦–åœ°å€å’Œsizeã€‚\n\n\nè¿™é‡Œæœ‰ç‚¹ç±»ä¼¼javaåå°„çš„æ“ä½œï¼Œåæ­£å°±æ˜¯è°ƒç”¨äº†dexè½¬æ¢ä¸ºoatæ ¼å¼çš„å‡½æ•°ï¼Œè¿™é‡Œæ¶‰åŠä¸€ä¸ªç‚¹å°±æ˜¯ç›®å‰çš„å£³ï¼Œä¸€èˆ¬éƒ½ä¼šé‡‡ç”¨ç¦ç”¨dexè½¬æ¢æˆoatçš„æ–¹å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯éœ€è¦åšä¸€ä¸ªè½¬æ¢ï¼Œèµ°å¦ä¸€ä¸ªåˆ†æ”¯\n\n\n\nç»ˆäºå‡ºç°äº†æˆ‘ä»¬æƒ³è¦çš„äº†ï¼Œç»§ç»­è·Ÿä¸‹å»ï¼Œå¤šæ‰¾å‡ ä¸ªç‚¹\n\nåŸºæœ¬æ‰¾åˆ°äº†ï¼Œæ¥ç€çœ‹å¦ä¸€ä¸ªclassloader\nInmemoryClassLoaderå’Œä¸Šæ–‡åŸºæœ¬ä¸€è‡´çš„åˆ†ææµç¨‹ï¼Œä¸è¿‡åˆ†æåˆ°åé¢å‘ç°å’Œä¸Šé¢çš„dexclassloaderæœ‰äº†äº¤å‰ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä»–ä»¬æœ€ç»ˆéƒ½ä¼šè°ƒç”¨çš„å‡½æ•°openCommonå’Œdexfileï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥hookè¿™ä¸¤ä¸ªå‡½æ•°ä¸å°±å®Œäº‹äº†\nhookæ‰¾åˆ°æºç ï¼Œå¼€å§‹hookï¼Œç„¶åç¼–è¯‘åˆ·æœº\n\n","slug":"Android8-0-artä¸‹é¢çš„å‡ ä¸ªè„±å£³ç‚¹","date":"2021-06-11T16:10:05.000Z","categories_index":"AndroidReverse","tags_index":"AndroidUnPacker","author_index":"YenKoc"},{"id":"08f55e9615384c7275f59ed241f8ccbd","title":"Android got hook","content":"åŸç† æ ¸å¿ƒåŸç†å°±æ˜¯æŸ¥æ‰¾ç¨‹åºå¤´è¡¨ä¸­çš„åŠ¨æ€segmentï¼Œç„¶åæŸ¥çœ‹è™šæ‹Ÿå†…å­˜æ˜ å°„åˆ°å“ªä¸ªä½ç½®ï¼Œä¹Ÿå°±æ˜¯rvaï¼Œå¯ä»¥ç›´æ¥å»idaä¸­æŸ¥çœ‹åç§»ï¼Œ å› ä¸ºæˆ‘å‘ç°idaå»è§£æsoæ–‡ä»¶çš„æ—¶å€™ï¼Œæ˜¯çœ‹segmentè¡¨å»è§£æçš„ï¼Œæ‰€ä»¥idaç›´æ¥å°±æ˜¯ä¸€ä¸ªèµ·å§‹åœ°å€ä¸º0çš„è™šæ‹Ÿå†…å­˜ï¼ˆï¼Œå…ˆå»010æŸ¥çœ‹è¿™ä¸ªæ®µåœ¨å“ªï¼Œç„¶åå‘ç°é‡Œé¢åŒ…å«äº†ä¸€äº›å¯¼å…¥çš„soåº“åç§°ï¼Œè¿˜æœ‰ä¸€ä¸ªç¬¦å·è¡¨ï¼Œå­—ç¬¦ä¸²è¡¨ï¼Œç„¶åè¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŠ¨æ€é‡å®šä½è¡¨ï¼Œé‡Œé¢æ˜¯åŒ…å«ä¸€ä¸ªinfoç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“å¯ä»¥å»æŸ¥è¯¢ç¬¦å·çš„å­—ç¬¦ä¸²è¡¨ä¸‹æ ‡ï¼Œä»¥åŠç±»å‹ï¼Œç„¶åè¿˜æœ‰ä¸€ä¸ªåœ°æ–¹ï¼Œå°±æ˜¯è¿™ä¸ªå¯¼å…¥ç¬¦å·å¯¹åº”gotè¡¨åç§»åœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥æŠŠè¿™ä¸ªåœ°å€ä¸­çš„åœ°å€æ›¿æ¢æˆæˆ‘ä»¬æƒ³è¦çš„ï¼Œä¸å°±å®Œäº‹äº†ï¼Œä¸æƒ³æ”¾å›¾äº†ï¼Œè¢«æŠ˜ç£¨çš„æœ‰ç‚¹æ€•äº†ï¼ˆï¼Œæˆ‘æ˜¯æ‡’ç‹—\nDemoä»£ç :#include &lt;jni.h&gt;\n#include &lt;string&gt;\n#include &quot;unistd.h&quot;\n#include &quot;stdio.h&quot;\n#include &quot;stdlib.h&quot;\n#include&lt;android&#x2F;log.h&gt;\n#include&lt;EGL&#x2F;egl.h&gt;\n#include&lt;GLES&#x2F;gl.h&gt;\n#include&lt;elf.h&gt;\n#include&lt;fcntl.h&gt;\n#include&lt;sys&#x2F;mman.h&gt;\n#include&lt;inttypes.h&gt;\n#include&lt;dlfcn.h&gt;\n#include &quot;native-lib.h&quot;\n\n\n#define LOG_TAG    &quot;NativeHook&quot;\n#define LOG_E(format, ...)  __android_log_print(ANDROID_LOG_ERROR, LOG_TAG, format, ##__VA_ARGS__)\n#define LOG_D(format, ...)  __android_log_print(ANDROID_LOG_INFO,  LOG_TAG, format, ##__VA_ARGS__)\n\n#define PAGE_START(address) ((address)&amp;PAGE_MASK)\n#define PAGE_END(address) (PAGE_START(address)+PAGE_SIZE)\n\nsize_t  (*old_fwrite)(const void *buf,size_t size,size_t count,FILE *fp);\n\nsize_t  new_fwrite(const void *buf,size_t size,size_t count,FILE *fp)\n&#123;\n    const char *text&#x3D;&quot;hello&quot;;\n    old_fwrite(text,strlen(text),1,fp);\n    return old_fwrite(buf,size,count,fp);\n&#125;\n\n&#x2F;&#x2F;ä»&#x2F;proc&#x2F;pi&#x2F;mapsæ–‡ä»¶ä¸­ï¼Œè·å–soæ¨¡å—çš„é¦–åœ°å€\nvoid * get_module_base(pid_t pid,const char *module_name)\n&#123;\n    FILE *fp;\n    long addr&#x3D;0;\n    char filename[32]&#x3D;&quot;\\n&quot;;\n    char line[1024]&#x3D;&quot;\\n&quot;;\n    if(pid&lt;0)\n    &#123;\n        snprintf(filename,sizeof(filename),&quot;&#x2F;proc&#x2F;self&#x2F;maps&quot;);\n    &#125; else&#123;\n        snprintf(filename,sizeof(filename),&quot;&#x2F;proc&#x2F;%d&#x2F;maps&quot;,pid);\n    &#125;\n\n    fp&#x3D;fopen(filename,&quot;r&quot;);\n    while(fgets(line,sizeof(line),fp))\n    &#123;\n        if(strstr(line,module_name)!&#x3D;NULL&amp;&amp;sscanf(line,&quot;%&quot; PRIxPTR&quot;-%*lx %*4s 00000000&quot;,&amp;addr)&#x3D;&#x3D;1)\n            break;\n    &#125;\n    fclose(fp);\n    return (void*) addr;\n&#125;\nint hook_fwrite(const char *soPath)\n&#123;\n    &#x2F;&#x2F;è·å–è¦hook soçš„æ¨¡å—åŸºåœ°å€\n    void* base_addr&#x3D;get_module_base(getpid(),soPath);\n    old_fwrite&#x3D;fwrite;\n    Elf32_Ehdr *header&#x3D;(Elf32_Ehdr*)base_addr;\n    Elf32_Phdr *phdr_table&#x3D;(Elf32_Phdr *)((int)base_addr+header-&gt;e_phoff);\n    if(phdr_table&#x3D;&#x3D;0)\n    &#123;\n        return 0;\n    &#125;\n    size_t phdr_count&#x3D;header-&gt;e_phnum;\n    unsigned long p_vaddr&#x3D;0;\n    unsigned int p_memsz&#x3D;0;\n    int j&#x3D;0;\n    for(j&#x3D;0;j&lt;phdr_count;j++)\n    &#123;\n        if(phdr_table[j].p_type&#x3D;&#x3D;PT_DYNAMIC) &#123;\n            p_vaddr &#x3D; phdr_table[j].p_vaddr + (int) base_addr;\n            p_memsz &#x3D; phdr_table[j].p_memsz;\n        &#125;;\n    &#125;\n    Elf32_Dyn *dynamic_table&#x3D;(Elf32_Dyn*)(p_vaddr);\n    unsigned long jmpRelOff&#x3D;0;\n    unsigned long strTabOff&#x3D;0;\n    unsigned long pltRelSz&#x3D;0;\n    unsigned long symTabOff&#x3D;0;\n    int dynCount&#x3D;p_memsz&#x2F;sizeof(Elf32_Dyn);\n    for(int i&#x3D;0;i&lt;dynCount;i++)\n    &#123;\n        int val&#x3D;dynamic_table[i].d_un.d_val;\n        switch (dynamic_table[i].d_tag) &#123;\n            case DT_JMPREL:\n                jmpRelOff&#x3D;val;\n                break;\n            case DT_STRTAB:\n                strTabOff&#x3D;val;\n                break;\n            case DT_PLTRELSZ:\n                pltRelSz&#x3D;val&#x2F;sizeof(Elf32_Rel);\n                break;\n            case DT_SYMTAB:\n                symTabOff&#x3D;val;\n                break;\n        &#125;\n    &#125;\n    Elf32_Rel *rel_table&#x3D;(Elf32_Rel*)(jmpRelOff+(int)base_addr);\n    for(int i&#x3D;0;i&lt;pltRelSz;i++)\n    &#123;\n        uint16_t ndx&#x3D;ELF32_R_SYM(rel_table[i].r_info);\n        Elf32_Sym *symTableIndex&#x3D;(Elf32_Sym*)(ndx*sizeof(Elf32_Sym)+symTabOff+(int)base_addr);\n        &#x2F;&#x2F;è·å–ç¬¦å·ç¬¦å·ç»“æ„ä½“\n        &#x2F;&#x2F;è·å–ç¬¦å·åå­—\n        char* funcName&#x3D;(char*)(symTableIndex-&gt;st_name+strTabOff+(int)base_addr);\n        if(memcmp(funcName,&quot;fwrite&quot;,strlen(&quot;fwrite&quot;))&#x3D;&#x3D;0)\n        &#123;\n            &#x2F;&#x2F;è·å–å½“å‰å†…å­˜åˆ†é¡µçš„å¤§å°\n            uint32_t page_size&#x3D;getpagesize();\n            &#x2F;&#x2F;è·å–å†…å­˜åˆ†é¡µçš„èµ·å§‹åœ°\n            uint32_t mem_page_start&#x3D;rel_table[i].r_offset+(int)base_addr;\n            mprotect(reinterpret_cast&lt;void *&gt;((uint32_t) PAGE_START(mem_page_start)), page_size, PROT_READ | PROT_WRITE | PROT_EXEC);\n            *(unsigned int*)(rel_table[i].r_offset+(int)base_addr)&#x3D;(int)new_fwrite;\n        &#125;\n\n    &#125;\n\n&#125;\n\n","slug":"Android-got-hook","date":"2021-06-09T06:24:12.000Z","categories_index":"AndroidReverse","tags_index":"gotè¡¨hook","author_index":"YenKoc"},{"id":"a90be964479d5a11087cdb9a691b6994","title":"Androidçƒ­ä¿®å¤ç±»åŠ è½½æ–¹æ¡ˆdemo","content":"å‰è¨€åœ¨é€†ä¸€äº›ä¸œè¥¿çš„æ—¶å€™ï¼Œæ€»ä¼šé‡åˆ°çƒ­ä¿®å¤çš„ä¸œè¥¿ï¼Œä½†æ˜¯ä¹‹å‰åªæ˜¯å¬è¯´å¹¶æ²¡æœ‰äº†è§£è¿‡è¿™ä¸ªçƒ­ä¿®å¤æ˜¯å•¥ï¼Œæ‰€ä»¥æ˜¨å¤©èŠ±äº†ä¸€ä¸‹åˆçš„æ—¶é—´å­¦ä¹ äº†ï¼Œæ„Ÿè§‰è¿˜å¯ä»¥ï¼Œä¸»è¦æ˜¯è·Ÿç³»ç»Ÿçš„æºç æœ‰å…³ç³»çš„ã€‚\nå…ˆäº†è§£ä¸€æ‰‹ç³»ç»Ÿclassloader\nclassloaderåœ¨çƒ­ä¿®å¤ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦å°±å…³å¿ƒä¸¤ç§ï¼Œpathclassloaderå’ŒdexClassloaderï¼Œç¬¬ä¸€ä¸ªæ˜¯æˆ‘ä»¬çš„ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œç¬¬äºŒä¸ªæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œå¯ä»¥ä»»æ„åŠ è½½zipï¼Œjarï¼Œapkä¸­çš„dexæ–‡ä»¶ï¼Œæˆ‘ä»¬ä»ç³»ç»Ÿæºç çš„è§’åº¦å‡ºå‘ï¼Œå»çœ‹çœ‹ä»–ä»¬åŠ è½½dexï¼Œä¸»è¦æ˜¯åšäº†å“ªäº›äº‹\n\nè¿™é‡Œæ˜¯é€‰æ‹©è·Ÿä¸€æ‰‹Android8.1çš„æºç ï¼Œæºç ç½‘ç«™å¯ä»¥é€‰æ‹©:http://aosp.opersys.com/xref/android-8.1.0_r81/\nä¸ªäººè®¤ä¸ºæ¯”é‚£ä¸ªå•¥androidxrefå¿«ä¸€äº›ï¼Œå…ˆçœ‹ä¸‹DexClassLoaderè¿™ä¸ªç±»\n\nå†ç‚¹è¿›å»ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°±æ˜¯ç›´æ¥è°ƒç”¨å®ƒçš„æ„é€ å‡½æ•°çš„ã€‚\n\nå‘ç°æœ‰å››ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è½½å…¥dexæ–‡ä»¶çš„è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å…¶ä»–ç±»ä¼¼zipå’Œjarï¼Œapkæ˜¯éœ€è¦è§£å‹çš„ï¼Œè§£å‹åçš„æ–‡ä»¶æ”¾å…¥çš„è·¯å¾„ï¼Œç¬¬ä¸‰ä¸ªçš„æ˜¯åŠ è½½dexéœ€è¦çš„åº“ï¼Œç¬¬å››ä¸ªæ˜¯ç»§æ‰¿çš„çˆ¶ç±»åŠ è½½å™¨ï¼Œç»§ç»­è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸ºç©ºäº†ï¼Œ8.0åçš„ç³»ç»Ÿï¼Œå·²ç»æŠŠç¬¬äºŒä¸ªå‚æ•°åºŸæ‰äº†ï¼ˆï¼Œå‘ç°æ˜¯ç»§ç»­baseclassloaderï¼Œå†è·Ÿä¸Šå»\n\nå‘ç°å¥½å®¶ä¼™ï¼Œè¿™é‡Œä¸»è¦æ˜¯å¹²äº†ä»€ä¹ˆå‘¢ï¼Œå…¶å®å°±æ˜¯ç»™pathListèµ‹å€¼ï¼Œè°ƒç”¨äº†DexPathListçš„æ„é€ æ–¹æ³•\nï¼Œæˆ‘ä»¬å†è·Ÿè¿›å»ã€‚\n\nå‘ç°ï¼Œå¥½å®¶ä¼™ï¼Œç–¯ç‹‚å¥—å¨ƒï¼Œç»™pathListè¿™ä¸ªå¯¹è±¡çš„å­—æ®µdexElementsèµ‹å€¼äº†ï¼Œç›´æ¥è·Ÿè¿›å»\n\nè¿™ä¸ªfiles.sizeæ–¹æ³•åŸºæœ¬åˆ¤æ–­è¯´ï¼Œå°±æ˜¯å½“æˆ‘ä»¬åŠ è½½çš„æ˜¯å¤šdexæƒ…å†µï¼Œæ¯ä¸ªelementséƒ½å¯¹åº”ä¸€ä¸ªdexï¼Œå¯ä»¥çœ‹è¿™é‡Œï¼Œéå†dexæ–‡ä»¶ï¼Œç„¶åæŠŠdexæ–‡ä»¶ææˆä¸€ä¸ªdexfileå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿè¿›\n\nç¬¬ä¸€ç§å°±æ˜¯ç›´æ¥dexæ–‡ä»¶çš„ï¼Œç¬¬äºŒç§å°±æ˜¯éœ€è¦è§£å‹çš„ï¼Œæ‡‚çš„éƒ½æ‡‚ï¼Œæˆ‘ä»¬ç›´æ¥è·Ÿç¬¬ä¸€ç§\n\nç»™dexfileä¸‰ä¸ªå­—æ®µè¿›è¡Œèµ‹å€¼ï¼Œå†è·Ÿä¸‹å»å°±åˆ°nativeå±‚å»äº†ï¼Œå°±ä¸è·Ÿäº†æˆ‘ä»¬çš„ç›®çš„ä¹Ÿè¾¾åˆ°äº†ï¼Œå‘ç°loaddexfileï¼Œå°±æ˜¯å°†ä¼ å…¥çš„dexæ–‡ä»¶ï¼Œæ‰“æˆäº†ä¸€ä¸ªdexfileå¯¹è±¡\n\nå‘ç°è¿™ä¸ªelementså­—æ®µæ ¸å¿ƒå°±æ˜¯ä¸ºäº†ç»™å®ƒçš„ä¸¤ä¸ªå­—æ®µèµ‹å€¼è€Œå·²ã€‚\n\n\nç³»ç»Ÿä¸­æ˜¯å¦‚ä½•å»æŸ¥æ‰¾ä¸€ä¸ªç±»çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç»§ç»­è·Ÿç€æºç ï¼Œå¹³å¸¸æˆ‘ä»¬çš„ä»£ç éƒ½æ˜¯å…ˆç”Ÿæˆä¸€ä¸ªclassloaderå¯¹è±¡ï¼Œç„¶åä½¿ç”¨å®ƒçš„ge tClass()æ–¹æ³•ï¼Œå»dexä¸­å»å¯»æ‰¾ç±»å¯¹è±¡ã€‚\n\nå‘ç°è°ƒç”¨äº†pathListçš„findClassæ–¹æ³•ï¼Œç»§ç»­è·Ÿ\n\n\næœ€åä¹Ÿæ˜¯è·Ÿç€nativeå±‚å»äº†ï¼Œç„¶åå‘ç°ä»€ä¹ˆé—®é¢˜ï¼Œå°±æ˜¯å…ˆéå†äº†è¿™ä¸ªdexelementsæ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ ä¸å°±ç›¸å½“äºä¸€ä¸ªdexfileå˜›ï¼Œå½“å‘ç°æœ‰åŒåçš„ç±»çš„æ—¶å€™ï¼Œå°±è¿”å›ç±»å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦çƒ­ä¿®å¤çš„è¯ï¼Œå¿…é¡»æ’åˆ°è¿™ä¸ªæ•°ç»„çš„å‰é¢æ‰è¡Œã€‚\nåˆ†äº«ä¸‹çƒ­ä¿®å¤çš„ä»£ç package com.example.hotfixtest;\n\nimport android.content.Context;\n\nimport java.io.File;\nimport java.lang.reflect.Array;\nimport java.lang.reflect.Field;\nimport java.nio.file.Path;\nimport java.util.HashSet;\n\nimport dalvik.system.DexClassLoader;\nimport dalvik.system.PathClassLoader;\n\npublic class FixDex &#123;\n    &#x2F;&#x2F;ä¿®å¤çš„æ–‡ä»¶åç¼€\n    private static final String DEX_SUFFIX&#x3D;&quot;.dex&quot;;\n    private static final String APK_SUFFIX&#x3D;&quot;.apk&quot;;\n    private static final String JAR_SUFFIX&#x3D;&quot;.jar&quot;;\n    private static final String ZIP_SUFFIX&#x3D;&quot;.zip&quot;;\n    public static final String DEX_DIR&#x3D;&quot;odex&quot;;\n    public static final String OPTIMIZE_DEX_DIR&#x3D;&quot;optimize_dex&quot;;\n    private static HashSet&lt;File&gt; loadedDex&#x3D;new HashSet&lt;File&gt;();\n\n    static &#123;\n        &#x2F;&#x2F;åˆå§‹åŒ–\n        loadedDex.clear();\n    &#125;\n    &#x2F;&#x2F;åå°„å·¥å…·åŒ…\n    &#x2F;&#x2F;ç»™å¯¹è±¡å­—æ®µèµ‹å€¼\n    public static void setObjectField(Object object,Class&lt;?&gt; objectClass,String fieldName,Object value) throws NoSuchFieldException, IllegalAccessException &#123;\n        Field field&#x3D;objectClass.getDeclaredField(fieldName);\n        field.setAccessible(true);\n        field.set(object,value);\n    &#125;\n    &#x2F;&#x2F;å–å‡ºå¯¹è±¡çš„å­—æ®µå€¼\n    public static Object getObjectField(Object object,Class&lt;?&gt; objectClass,String fieldName) throws NoSuchFieldException, IllegalAccessException &#123;\n        Field field&#x3D;objectClass.getDeclaredField(fieldName);\n        field.setAccessible(true);\n        return field.get(object);\n    &#125;\n    &#x2F;&#x2F;æ‹¿åˆ°pathListå¯¹è±¡\n    public static Object getPathList(Object baseDexClassLoader) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123;\n        return getObjectField(baseDexClassLoader,Class.forName(&quot;dalvik.system.BaseDexClassLoader&quot;),&quot;pathList&quot;);\n    &#125;\n    &#x2F;&#x2F;æ‹¿åˆ°pathListå¯¹è±¡ä¸­çš„dexElementså¯¹è±¡\n    public static Object getDexElement(Object PathList) throws NoSuchFieldException, IllegalAccessException &#123;\n        return getObjectField(PathList,PathList.getClass(),&quot;dexElements&quot;);\n    &#125;\n    &#x2F;&#x2F;æ•°ç»„åˆå¹¶\n    private static Object combineArray(Object arrayLhs,Object arrayRhs)\n    &#123;\n        Class&lt;?&gt; componentType&#x3D;arrayLhs.getClass().getComponentType(); &#x2F;&#x2F;dexElementså¯¹è±¡çš„é›·\n        int oLength&#x3D;Array.getLength(arrayLhs);\n        int nLength&#x3D;Array.getLength(arrayRhs);\n        int NewLength&#x3D;oLength+nLength;\n        &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªæ–°çš„dexElementså¯¹è±¡æ•°ç»„ï¼Œä¸è¿‡ç›®å‰æ˜¯ç©ºçš„\n        Object dexElements&#x3D;Array.newInstance(componentType,NewLength);\n        System.arraycopy(arrayLhs,0,dexElements,0,oLength);\n        System.arraycopy(arrayRhs,0,dexElements,oLength,nLength);\n        return dexElements;\n    &#125;\n    private static void deDexInject(Context appContext,HashSet&lt;File&gt; loadedDex)\n    &#123;\n        String optimizeDir&#x3D;appContext.getFilesDir().getAbsolutePath()+File.pathSeparator+OPTIMIZE_DEX_DIR;\n        File fopt&#x3D;new File(optimizeDir);\n        if(!fopt.exists())\n        &#123;\n            fopt.mkdirs();\n        &#125;\n        try&#123;\n            &#x2F;&#x2F;è®°è½½åº”ç”¨ç¨‹åºçš„dex\n            PathClassLoader pathClassLoader&#x3D; (PathClassLoader) appContext.getClassLoader();\n            for(File dex:loadedDex) &#123;\n                DexClassLoader dexClassLoader &#x3D; new DexClassLoader(dex.getAbsolutePath(), fopt.getAbsolutePath(), null, pathClassLoader);\n                &#x2F;&#x2F;3.åˆå¹¶\n                Object dexPathList&#x3D;getPathList(dexClassLoader);\n                Object pathPathList&#x3D;getPathList(pathClassLoader);\n                Object leftDexElements&#x3D;getDexElement(dexPathList);\n                Object rightDexElements&#x3D;getDexElement(pathPathList);\n                &#x2F;&#x2F;åˆå¹¶å®Œæˆ\n                Object newDexElements&#x3D;combineArray(leftDexElements,rightDexElements);\n                &#x2F;&#x2F; é‡å†™ç»™pathListä¸­çš„elementsæ•°ç»„èµ‹å€¼\n                Object pathPathList1&#x3D;getPathList(pathClassLoader);\n                setObjectField(pathPathList1,pathPathList1.getClass(),&quot;dexElements&quot;,newDexElements);\n\n            &#125;\n        &#125;catch (Exception e)\n        &#123;\n            e.printStackTrace();\n        &#125;\n    &#125;\n    public static void loadFixedDex(Context context,File patchFilsDir)\n    &#123;\n        if(context&#x3D;&#x3D;null) &#123;\n            return;\n        &#125;\n        File fileDir&#x3D;patchFilsDir!&#x3D;null? patchFilsDir: new File(context.getFilesDir().getAbsoluteFile(),DEX_DIR);\n        File[] f&#x3D;fileDir.listFiles();\n        for(File tmp:f)\n        &#123;\n            if(tmp.getName().startsWith(&quot;class&quot;)||tmp.getName().endsWith(DEX_SUFFIX)||tmp.getName().endsWith(APK_SUFFIX)||tmp.getName().endsWith(JAR_SUFFIX)|| tmp.getName().endsWith(ZIP_SUFFIX))\n            &#123;\n                loadedDex.add(tmp);\n            &#125;\n        &#125;\n        &#x2F;&#x2F;åˆå¹¶ä¹‹å‰çš„dex\n        deDexInject(context,loadedDex);\n    &#125;\n\n\n&#125;\n\nä¸»è¦é€šè¿‡åå°„è¿›è¡Œçš„æ“ä½œï¼Œæ‰€ä»¥å’Œç³»ç»Ÿç‰ˆæœ¬æœ‰å…³ç³»ï¼Œå®‰å“9å·²ç»æŠŠåå°„ç¦äº†ï¼Œå¾—éœ€è¦å¦ä¸€ç§æ–¹å¼çªç ´é™åˆ¶ï¼Œä¸å±•å¼€äº†\n","slug":"Androidçƒ­ä¿®å¤ç±»åŠ è½½æ–¹æ¡ˆdemo","date":"2021-06-04T05:54:30.000Z","categories_index":"å®‰å“å¼€å‘","tags_index":"çƒ­ä¿®å¤","author_index":"YenKoc"},{"id":"ab71dbe1e9c18adee445c559bc9eb61a","title":"å“ˆå·¥å¤§ç¼–è¯‘åŸç†ç¬¬äºŒèŠ‚ç¬”è®°","content":"å‰è¨€æœ¬æ¥æ‰“ç®—æ—©ä¸Šèµ·æ¥å­¦çš„ï¼Œæ²¡æƒ³åˆ°å¤±çœ äº†ï¼Œç›´æ¥èµ·åºŠå­¦ï¼ˆï¼Œè¢«åŠ¨å­¦ä¹ åŠ ä¸€\n2-1 è¯æ³•è¯­æ³•åˆ†æåŸºæœ¬æ¦‚å¿µ\nè¿™é‡Œè®²äº†ä¸€ä¸ªé›†åˆä¹˜ç§¯çš„æ¦‚å¿µï¼Œå­—æ¯è¡¨çš„næ¬¡æ–¹ï¼Œå°±æ˜¯å‡ ä¸ªå­—æ¯è¡¨çš„ä¹˜ç§¯ï¼Œè¿™é‡Œçš„ä¹˜ç§¯å’Œæˆ‘ä»¬è¯´çš„ä¹˜æ³•ä¸åŒï¼Œè¿™é‡Œçš„ä¹˜ç§¯ï¼Œå…¶å®æ›´å¤šçš„æ¦‚å¿µå«è¿æ¥ï¼Œå‡ æ¬¡æ–¹ï¼Œç›¸å½“äºæ˜¯è¿æ¥åå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç±»ä¼¼äºæ¯ä½ä»å­—ç¬¦è¡¨ä¸­å–å‡ºä¸€ä¸ªå­—ç¬¦ï¼Œè¿›è¡Œè¿æ¥ã€‚\n\n\nå…‹æ—é—­åŒ…ï¼Œå·²ç»åŒ…æ‹¬äº†è¿™ä¸ªå­—ç¬¦è¡¨ä¸­å­—ç¬¦çš„æ‰€æœ‰ç»„åˆäº†ï¼Œä¸²å°±æ˜¯å…‹æ—é—­åŒ…ä¸­çš„ä»»æ„å…ƒç´ ã€‚\n\n\n2-2 æ–‡æ³•çš„å®šä¹‰æ–‡æ³•ä¸»è¦æ˜¯æè¿°å¥å­ç»„æˆè§„åˆ™çš„ï¼Œä¸è¿‡è€å¸ˆä¹Ÿæäº†ä¸€ä¸‹ï¼Œæ ¹æ®æè¿°çš„å¯¹è±¡çš„ä¸åŒï¼Œæˆ‘ä»¬çš„åŸºæœ¬ç¬¦å·ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬æè¿°çš„æ˜¯å•è¯çš„è§„åˆ™ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„åŸºæœ¬ç¬¦å·å¯¹è±¡å°±å˜æˆäº†å­—æ¯ã€‚\n\nç»ˆç»“ç¬¦ï¼Œå°±æ˜¯æ–‡æ³•æ‰€å®šä¹‰çš„è¯­è¨€çš„åŸºæœ¬ç¬¦å·ï¼Œæœ‰æ—¶å€™ä¹Ÿå«tokenã€‚ æ ¹æ®ä¸¾ä¾‹ï¼ŒåŸºæœ¬ç¬¦å·å·²ç»æ˜¯å…·ä½“çš„xxä¸œè¥¿äº†ã€‚\n\néç»ˆç»“ç¬¦æ˜¯ç”¨æ¥è¡¨ç¤ºè¯­æ³•æˆåˆ†çš„ç¬¦å·ï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸º è¯­æ³•å˜é‡\n\n\n\n\n\n\n2-3 è¯­è¨€çš„å®šä¹‰\nç¼–è¯‘å™¨å¦‚ä½•çŸ¥é“è¿™ä¸ªå¥å­æ˜¯ä¸æ˜¯ç¬¦å·æ–‡æ³•è§„åˆ™ï¼Œå…¶ä¸­ä¸€ç§å°±æ˜¯ä½¿ç”¨è¿™ç§è‡ªé¡¶å‘ä¸‹çš„æ¨å¯¼ï¼Œå¦ä¸€ç§å°±æ˜¯å½’çº¦ï¼Œè‡ªä¸‹å‘ä¸Šå½’çº¦ï¼Œæ¨å¯¼å’Œå½’çº¦æ˜¯ä¸ªäº’é€†çš„è¿‡ç¨‹\n\nè¯­è¨€çš„å½¢å¼åŒ–å®šä¹‰\n\n2-4 æ–‡æ³•çš„åˆ†ç±»\n\n\né€çº§åŒ…å«çš„å…³ç³»ï¼Œè¿˜æŒº6çš„\n","slug":"å“ˆå·¥å¤§ç¼–è¯‘åŸç†ç¬¬äºŒèŠ‚ç¬”è®°","date":"2021-06-02T17:36:06.000Z","categories_index":"ç¼–è¯‘åŸç†","tags_index":"è®¡ç®—æœºåŸºç¡€","author_index":"YenKoc"},{"id":"645125775bc5f25537c3c04c5e9cbef1","title":"å…³äºpixel4 rootæˆç –ï¼Œåˆå¤æ´»çš„æ•…äº‹","content":"å‰è¨€æˆ‘è‡ªå·±çš„pixel1å¿˜è®°å¸¦æ¥äº†ï¼Œä»å¯¼å¸ˆé‚£å¼„äº†ä¸€å°pixel4ï¼Œå¥½åƒæ²¡rootï¼Œæ‰€ä»¥æ‰“ç®—å¼€å§‹å…ˆrootï¼Œç„¶åè£…ä¸ªæµ‹è¯•ç¯å¢ƒ\nåˆ·å…¥é¢å…·magiskè¿™é‡Œå’Œå¸¸è§„çš„é‚£ç§pixelï¼Œåˆ·å…¥ç¬¬ä¸‰æ–¹twï¼Œç„¶åå¡åˆ·zipåŒ…è¿˜æ˜¯å¾ˆå¤§ä¸åŒï¼Œæˆ‘å°è¯•äº†ä¸€éï¼Œå‘ç°æ ¹æœ¬æ²¡ç”¨ï¼Œä»ç½‘ä¸Šæœäº†ä¸€ç§æ–¹æ³•è¿˜è¡Œï¼Œæ‰“å¼€è°ƒè¯•æ¨¡å¼ä»€ä¹ˆçš„ï¼Œå°±ä¸å¤šbbäº†ï¼Œé¦–å…ˆå»githubä¸Šä¸‹ä¸€ä¸ªmagiskmanager:https://github.com/topjohnwu/Magisk/releases?after=v20.2ï¼Œå®‰è£…å¥½ä¹‹åï¼Œå¼€å§‹å®‰è£…magiskï¼Œç‚¹å‡»\n\nç‚¹å‡»å®‰è£…åï¼Œè¦æ³¨æ„å®ƒä¼šè®©ä½ é€‰æ‹©ä»€ä¹ˆæ ·çš„å®‰è£…æ–¹å¼ï¼Œè¿™é‡Œæ˜¯é€‰æ‹©ä¿®å¤boot.imgï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œéœ€è¦åŒä¸€ä¸ªç³»ç»Ÿç‰ˆæœ¬çš„boot\u0001.imgï¼Œå»ç½‘ç«™ä¸Šä¸‹ä¸ªé•œåƒï¼Œæå–å‡ºboot.img,ç„¶åpushåˆ°æ‰‹æœºä¸­ï¼Œåˆ°æ—¶å€™å®‰è£…æ—¶ï¼Œç›´æ¥é€‰æ‹©å°±å¥½äº†\n\nç„¶åä¿®è¡¥å¥½åï¼Œä¼šç”Ÿæˆä¸€ä¸ªpatched.imgæ–‡ä»¶ï¼ŒæŠŠå®ƒå†pullåˆ°æœ¬åœ°ä¸Š\n\nå…ˆè¿›å…¥bootloaderæ¨¡å¼\nadb shell bootloader\n\nå†ä½¿ç”¨\nfastboot flash boot ä¸Šé¢çš„é‚£ä¸ªpatched.imgæ–‡ä»¶\n\næœ€å\nfastboot reboot\n\né‡å¯åï¼Œå‘ç°é¢å…·å·²ç»åˆ·å¥½äº†ï¼Œå¹¶ä¸”å¯ä»¥suäº†\nå‘ç‚¹fastbootè€ä¼šå‡ºç°command failedï¼Œç½‘ä¸Šæœåˆ°äº†ä¸€ç§è§£å†³æ–¹å¼ï¼Œè¿˜ä¸é”™\nfastboot snapshot-update cancel\n\nè¾“å…¥ä¸Šé¢è¿™æ®µå°±å¯ä»¥å®Œç¾è§£å†³äº†\nå‚è€ƒé“¾æ¥\nhttps://sspai.com/post/57923\nhttps://blog.csdn.net/weixin_45472158/article/details/113461883\nhttps://www.reddit.com/r/CalyxOS/comments/jlx95g/pixel_4a_installation_issues_boot_slot/\nitfanr.cc/2018/10/16/google-pixel-unlock-bl-and-root/\n\n","slug":"å…³äºpixel4-rootæˆç –ï¼Œåˆå¤æ´»çš„æ•…äº‹","date":"2021-06-02T08:04:54.000Z","categories_index":"åˆ·æœº","tags_index":"åˆ·æœº","author_index":"YenKoc"},{"id":"77bc24379b69ae18331fff6632b0555b","title":"å“ˆå·¥å¤§ç¼–è¯‘åŸç†ç¬¬ä¸€èŠ‚ç¬”è®°","content":"å‰è¨€åœ¨çœ‹å“ˆå·¥å¤§çš„ç¼–è¯‘åŸç†è§†é¢‘ingï¼Œé¡ºä¾¿åšåšç¬”è®°ï¼ˆï¼Œè¦è€ƒè¯•äº†ï¼Œå¤ªæƒ¨äº†\nç¬”è®°1-1 ä»€ä¹ˆæ˜¯ç¼–è¯‘æºç¨‹åºè¿›è¡Œç¼–è¯‘å™¨ï¼Œç¼–è¯‘æˆæ±‡ç¼–ï¼Œç„¶åæ±‡ç¼–ç”Ÿæˆå¯é‡å®šä½çš„æœºå™¨ä»£ç ï¼Œå†ç»è¿‡é“¾æ¥ï¼Œç”Ÿæˆç›®æ ‡æœºå™¨ä»£ç ï¼Œå¤§ä½“æµç¨‹æ˜¯è¿™æ ·çš„ï¼Œå…·ä½“çš„æµç¨‹ï¼Œæˆ‘åˆå»ç¿»äº†ä¸€éç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»çš„ç¬¬äºŒç« ã€‚\n\nå…ˆç»è¿‡é¢„å¤„ç†æ“ä½œ\nè¿™é‡Œçš„è¿‡ç¨‹ä¸»è¦æ˜¯å¤„ç†é‚£äº›æºæ–‡ä»¶ä¸­ä»¥â€#â€å¼€å§‹çš„é¢„ç¼–è¯‘æŒ‡ä»¤ã€‚æ¯”å¦‚#include,#defineç­‰ï¼Œä¸»è¦å¤„ç†è§„åˆ™:\n\nå°†æ‰€æœ‰çš„â€œ#defineâ€æŒ‡ä»¤åˆ é™¤ï¼Œå¹¶ä¸”å±•å¼€æ‰€æœ‰çš„å®å®šä¹‰\nå¤„ç†æ‰€æœ‰æ¡ä»¶é¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œæ¯”å¦‚â€#ifâ€œï¼Œâ€#idefâ€œï¼Œ#elifâ€ï¼Œâ€œ#elseâ€\nå¤„ç†#includeé¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œå°†è¢«åŒ…å«çš„æ–‡ä»¶æ’å…¥åˆ°è¯¥é¢„ç¼–æŒ‡ä»¤çš„ä½ç½®ï¼Œä¸æ–­åŒ…å«ï¼Œå› ä¸ºå¤´æ–‡ä»¶ä¹ŸåŒ…å«å…¶ä»–å¤´æ–‡ä»¶\nåˆ é™¤æ‰€æœ‰çš„æ³¨é‡Š\næ·»åŠ è¡Œå·å’Œæ–‡ä»¶åæ ‡è¯†\nä¿ç•™æ‰€æœ‰çš„#pramaç¼–è¯‘å™¨æŒ‡ä»¤\n\nç»è¿‡é¢„ç¼–è¯‘åçš„.iæ–‡ä»¶ä¸åŒ…å«ä»»ä½•å®å®šä¹‰ï¼Œå› ä¸ºæ‰€æœ‰çš„å®å®šä¹‰éƒ½å·²ç»å±•å¼€äº†ï¼ŒåŒ…å«çš„æ–‡ä»¶ä¹Ÿå·²ç»æ’å…¥åˆ°æ–‡ä»¶å½“ä¸­äº†ã€‚\n\nç¼–è¯‘\nç¼–è¯‘è¿‡ç¨‹å°±æ˜¯æŠŠé¢„å¤„ç†å®Œçš„æ–‡ä»¶è¿›è¡Œä¸€ç³»åˆ—è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æä»¥åŠä¼˜åŒ–åç”Ÿäº§ç›¸åº”çš„æ±‡ç¼–ä»£ç æ–‡ä»¶ã€‚\n\næ±‡ç¼–\næ±‡ç¼–å™¨æ˜¯å°†æ±‡ç¼–ä»£ç è½¬å˜æˆæœºå™¨å¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œå…¶å®æ±‡ç¼–å°±æ˜¯æœºå™¨ç çš„ç¿»è¯‘ï¼Œå¯ä»¥å¯¹åº”èµ·æ¥çš„ï¼Œæ‰€ä»¥æ±‡ç¼–ä¹Ÿæ˜¯å’Œcpuæ¶æ„å¯¹åº”èµ·æ¥çš„ã€‚\n\né“¾æ¥\nä¸»è¦æ˜¯å°†å„ç§æ¨¡å—ç»è¿‡æ±‡ç¼–åçš„é‡å®šä½ç›®æ ‡æ¨¡å—ï¼Œç»„è£…åœ¨ä¸€èµ·ï¼Œä¸‹é¢è¿™å›¾æˆ‘è§‰å¾—æŒºè´´åˆ‡çš„\n\n\n\n1-2 ç¼–è¯‘ç³»ç»Ÿçš„ç»“æ„è€å¸ˆè¿™è¾¹ä¸¾äº†ä¸€ä¸ªè‹±æ–‡ç¿»è¯‘æˆæ±‰è¯­çš„ä¾‹å­ï¼Œæˆ‘è§‰å¾—æŒºä¸é”™çš„ï¼Œé¦–å…ˆæˆ‘ä»¬è‚¯å®šå¾—çŸ¥é“è¿™ä¸ªå¥å­æ˜¯ä»€ä¹ˆæ„æ€å˜›ï¼Œæ‰€ä»¥éœ€è¦è¯­ä¹‰åˆ†æï¼Œç„¶åè¯­ä¹‰åˆ†ææ˜¯éœ€è¦åˆ†æå¥å­çš„ç»“æ„ï¼Œåˆ’åˆ†å¥å­çš„ï¼Œå¥å­ç»“æ„æ˜¯åˆ†æä»–ä»¬çš„åˆ†åˆ«æ˜¯ä»€ä¹ˆçŠ¶è¯­çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„é—®é¢˜åˆè½¬åˆ°åˆ†æçŠ¶è¯­çš„è¿‡ç¨‹ï¼Œæ˜¯è¯­æ³•åˆ†æï¼Œè¯†åˆ«çŸ­è¯­ï¼ŒåŒæ—¶è¦è¯†åˆ«çŸ­è¯­ï¼Œæ˜¯éœ€è¦ç¡®å®šè¯æ€§çš„ï¼Œæ˜¯éœ€è¦è¯æ³•åˆ†æçš„ï¼ŒçœŸä¸é”™çš„ï¼Œå®é™…ç¼–è¯‘å™¨ä¸Šæ˜¯å€’ç€æ¥çš„\n\n1-3 è¯æ³•åˆ†æ\nåŒç§ç±»å‹å°±æ˜¯é å±æ€§å€¼æ¥è¿›è¡ŒåŒºåˆ†çš„ï¼Œæ¥ä¸ªä¾‹å­ï¼Œå…¶å®å°±æ˜¯æœç´¢ï¼Œç„¶åå†æ‹†åˆ†\n\n1-4 è¯­æ³•åˆ†ææ¦‚è¿°\n\n\nå¤§æ¦‚æœ‰ç‚¹ç†è§£äº†ï¼Œæ‰€ä»¥è¯´ï¼Œåœ¨æ­£å¸¸ç¿»è¯‘è¿‡ç¨‹ä¸­çš„xè¯­ï¼Œåœ¨ç¼–è¯‘åŸç†ä¸­ï¼Œå…¶å®ä¸Šæ˜¯ç”±æ–‡æ³•æ¥åˆ¶å®šçš„ï¼Œä»€ä¹ˆè¯åŠ ä¸Šä»€ä¹ˆè¯ï¼Œæ„æˆä»€ä¹ˆè¯­æ³•ç»“æ„ï¼Œæ˜¯ç”±æ–‡æ³•æ¥å†³å®šçš„ï¼Œè¿™æ­¥æ˜¯è¯­æ³•åˆ†æåšçš„äº‹ã€‚\n1-5 è¯­ä¹‰åˆ†ææ¦‚è¿°\n\n\n1-6 ä¸­é—´ä»£ç ç”Ÿæˆå’Œç¼–è¯‘å™¨åç«¯\n\nå”¯ä¸€ç¡®å®šäº†è¿ç®—å®Œæˆçš„é¡ºåº\n\nç›®æ ‡ä»£ç ç”Ÿæˆä»¥æºç¨‹åºçš„ä¸­é—´è¡¨ç¤ºå½¢å¼ä½œä¸ºè¾“å…¥ï¼Œå¹¶æŠŠå®ƒæ˜ å°„åˆ°ç›®æ ‡è¯­è¨€ï¼Œæœ€é‡è¦çš„æ˜¯å˜é‡çš„å¯„å­˜å™¨åˆ†é…\nä»£ç ä¼˜åŒ–ä¸ºæ”¹è¿›ä»£ç è¿›è¡Œçš„ç­‰ä»·ç¨‹åºå˜åŒ–ï¼Œä½¿å…¶è¿è¡Œå¾—æ›´å¿«ï¼Œæ‰€å ç”¨ç©ºé—´æ›´å°‘\næ€»ç»“ä¸‹: æœ‰ä¸ªä¸€ä¸ªå¤§ä½“çš„æ¦‚å¿µï¼Œè€å¸ˆè®²çš„æŒºèµçš„\n","slug":"å“ˆå·¥å¤§ç¼–è¯‘åŸç†ç¬¬ä¸€èŠ‚ç¬”è®°","date":"2021-06-01T11:15:47.000Z","categories_index":"ç¼–è¯‘åŸç†","tags_index":"è®¡ç®—æœºåŸºç¡€","author_index":"YenKoc"},{"id":"29c90278776b9ceb230f70e3bee57549","title":"windowsä¸Šåè°ƒè¯•çš„ä¸€äº›æ€»ç»“","content":"å‰è¨€åè°ƒè¯•ï¼Œåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯é™æ€åè°ƒè¯•ï¼Œå¦ä¸€ç§æ˜¯åŠ¨æ€åè°ƒè¯•ï¼Œè¿™ä¸¤è€…ä¸»è¦çš„ç›®çš„ä¹Ÿä¸åŒï¼Œç¬¬ä¸€ç§çš„æ ¸å¿ƒç›®çš„æ˜¯æ£€æµ‹è°ƒè¯•å™¨ï¼Œè€Œç¬¬äºŒç§çš„æ ¸å¿ƒç›®çš„å…¶å®å°±æ˜¯ä¸ºäº†éšè—ä»£ç å’Œæ•°æ®çš„ï¼Œç¬¬ä¸€ç§çš„ç±»ä¼¼xxdebugpresentï¼Œç¬¬äºŒç§ç±»ä¼¼åŒè¿›ç¨‹ä¿æŠ¤ï¼Œå¼‚å¸¸å¤„ç†ç­‰åè°ƒè¯•æ‰‹æ®µï¼Œç¬¬ä¸€ç§çš„è¯å®é™…ä¸Šä¸€æ¬¡ç ´è§£ç»“æŸåï¼Œåè°ƒè¯•å°±è¢«ç»•è¿‡äº†ï¼Œç¨‹åºå°±å¯ä»¥æ­£å¸¸è°ƒè¯•äº†ï¼Œä½†æ˜¯ç¬¬äºŒç§æ˜¯è¦ä¸æ–­çš„è°ƒè¯•ï¼Œæ‰èƒ½çœ‹åˆ°ä»£ç å’Œæ•°æ®çš„ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«çš„ã€‚\né™æ€åè°ƒè¯•0x01 PEBåè°ƒè¯•pebçš„æ„æ€æ˜¯è¿›ç¨‹ç¯å¢ƒä¿¡æ¯å—ï¼Œåˆ©ç”¨pebç»“æ„ä½“ä¿¡æ¯å¯ä»¥åˆ¤æ–­å½“å‰è¿›ç¨‹æ˜¯å¦å¤„äºè¢«è°ƒè¯•çš„çŠ¶æ€çš„ã€‚\ntypedef struct _PEB &#123;\n  BYTE                          Reserved1[2];\n  BYTE                          BeingDebugged; &#x2F;&#x2F;è¢«è°ƒè¯•çŠ¶æ€\n  BYTE                          Reserved2[1];\n  PVOID                         Reserved3[2];\n  PPEB_LDR_DATA                 Ldr;\n  PRTL_USER_PROCESS_PARAMETERS  ProcessParameters;\n  BYTE                          Reserved4[104];\n  PVOID                         Reserved5[52];\n  PPS_POST_PROCESS_INIT_ROUTINE PostProcessInitRoutine;\n  BYTE                          Reserved6[128];\n  PVOID                         Reserved7[1];\n  ULONG                         SessionId;\n&#125; PEB, *PPEB;\n\nä»¥ä¸Šæ˜¯pebç»“æ„ä½“çš„æˆå‘˜ä¿¡æ¯ï¼Œä¸å®Œå…¨ï¼Œä½†æ˜¯è¿™é‡Œå°±ä¸æˆªå›¾äº†ï¼Œå…·ä½“å®Œæ•´çš„pebå¯ä»¥è§é“¾æ¥:https://msdn.microsoft.com/en-us/library/windows/desktop/aa813706(v=vs.85).aspx\nè¿™é‡Œä¸»è¦å…³æ³¨å››ä¸ªæˆå‘˜\n0x002 BeingDebugged  UChar\n0x00c Ldr \t\t\t\t\tPtr32_PEB_LDR_DATA\n0x018 ProcessHeap.  Ptr32_Void\n0x068 NtGlobalFlag. Uint48\n\n0x02 è·å–pebåœ°å€è¿™é‡Œè·å–pebç»“æ„ä½“æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸è¿‡éƒ½æ˜¯é€šè¿‡å€ŸåŠ©fsæ®µå¯„å­˜å™¨åšçš„\n\nç›´æ¥è·å–pebçš„åœ°å€\nMOV EAX,DWORD PTR FS:[0x30]\n\nå…ˆè·å–tebåœ°å€ï¼Œå†é€šè¿‡ProcessEnvironmentBlockæˆå‘˜ï¼ˆåç§»åŠ 0x30ï¼‰æ¥è·å–pebåœ°å€\nMOV EAX,DWORD PTR FS:[0x18]\nMOV EAX,DWORD PTR DS:[EAX+0x30]\n\n\n0x03 ç»†åˆ†peb\nBeingDebugged(+0x2)\nè¿›ç¨‹å¤„äºè°ƒè¯•çŠ¶æ€çš„æ—¶å€™ï¼Œè¿™ä¸ªæˆå‘˜ä¼šè¢«è®¾ç½®æˆ1ï¼Œä¸åœ¨è°ƒè¯•çŠ¶æ€ä¸‹ï¼Œå®ƒçš„å€¼æ˜¯ä¼šè¢«è®¾ç½®æˆ0ï¼Œ\nè¿™ä¸å¾—ä¸ æåˆ°IsDebuggerPresent()è¿™ä¸ªapiå®é™…ä¸Šå°±æ˜¯æ£€æµ‹pebè¿™ä¸ªæˆå‘˜çš„å€¼çš„ã€‚\n\nNtGlobalFlag(+0x68)\nè°ƒè¯•è¿›ç¨‹çš„æ—¶å€™ï¼ŒPEB.NtGlobalFlagæˆå‘˜(+0x68)çš„å€¼ä¼šè¢«è®¾ç½®æˆ0x70æ‰€ä»¥å¯ä»¥å»æ£€æµ‹\nè¿™ä¸ªå€¼ï¼Œç„¶åå»åˆ¤æ–­è¿›ç¨‹æ˜¯å¦å¤„äºè¢«è°ƒè¯•çŠ¶æ€ã€‚\nä½†æ˜¯ç›´æ¥attachä¸Šè°ƒè¯•å™¨çš„æ—¶å€™ï¼Œè¿™ä¸ªæˆå‘˜å€¼æ˜¯ä¸ä¼šå˜çš„\n\n\n0x04 è¿‡åè°ƒè¯•åŠæ³•pebæ¯•ç«Ÿè¿˜æ˜¯ç»“æ„ä½“ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆè¿˜æ˜¯åœ¨å†…å­˜ä¸­ä½“ç°çš„ï¼Œé‚£ä¹ˆ\næˆ‘ä»¬å¯ä»¥ç›´æ¥å–åˆ°pebåœ°å€ï¼Œç„¶åæŠŠæˆå‘˜çš„å€¼æ”¹å›æ¥å°±è¡Œäº†\næˆ–è€…å¯ä»¥åˆ©ç”¨æˆ‘ä¹‹å‰ä½¿ç”¨çš„åœ¨æ±‡ç¼–å±‚é¢ä¸ŠæŠŠè¿”å›å€¼ä¿®æ”¹æ‰ï¼Œä¸è¿‡\næ²¡æœ‰ç›´æ¥æ”¹ç»“æ„ä½“ï¼Œæ¥çš„æ–¹ä¾¿\n0x01 NtQueryInformationProcess()åˆ©ç”¨è¿™ä¸ªapiæ¢æµ‹è°ƒè¯•å™¨ï¼Œè¿™ä¸ªapiå¯ä»¥è·å–å„ç§ä¸è¿›ç¨‹è°ƒè¯•ç›¸å…³çš„ä¿¡æ¯\nï¼Œè¯¥å‡½æ•°å®šä¹‰\nNTSTATUS WINAPI NtQueryInformationProcess\n(\n\t__in HANDLE ProcessHandle\n\t__in PROCESSINFOCLASS ProcessInforationClass\n\t__out PVOID ProcessInformation,\n\t__in ULONG ProcessInformationLength,\n\t__out_opt PULONG ReturnLength\n);\n\næ ¹æ®ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°çš„ä¸åŒï¼Œè¿”å›å€¼ä¼šä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°\nè¿™ä¸ªPROCESSINFOCLASSæ˜¯æšä¸¾ç±»å‹ï¼Œæˆ‘ä»¬æˆ‘ä»¬ä¸»è¦å»å…³å¿ƒè¿™ä¸ªä¸è°ƒè¯•å™¨æœ‰å…³çš„æˆå‘˜æœ‰\nProcessDebugPort(0x7)ã€ProcessDebugObject-Handle(0x1E)ã€ProcessDebugFlags(0x1F)\n0x02 ProcessDebugPort(0x7)å½“ä¼ å…¥çš„å‚æ•°ä¸º0x7çš„æ—¶å€™ï¼Œè°ƒç”¨è¿™ä¸ªNtQueryInformationProcess()å‡½æ•°\nï¼Œè¿›ç¨‹å¤„äºéè°ƒè¯•çŠ¶æ€æ—¶ï¼Œæ˜¯ä¸º0ï¼Œå¤„äºè°ƒè¯•çŠ¶æ€å€¼ä¸º0xFFFFFFFF\n\nNtqxxxx()\n0x03 ProcessDebugObjectHandle(0x1e)è°ƒè¯•è¿›ç¨‹ä¼šç”Ÿæˆè°ƒè¯•å¯¹è±¡ï¼Œå½“ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ä¸º0x1eæ—¶ï¼Œ\nç¬¬ä¸‰ä¸ªå‚æ•°å°±å¯ä»¥è·å–è°ƒè¯•å¯¹è±¡å¥æŸ„ï¼Œä½†æ˜¯è¿™ä¸ªå¥æŸ„è¦åœ¨è¿›ç¨‹å¤„äºè°ƒè¯•çŠ¶æ€çš„æ—¶å€™ï¼Œæ‰å¯ä»¥ï¼Œå¦‚æœè¿›ç¨‹å¤„äºéè°ƒè¯•çŠ¶æ€\nï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä¸ºç©ºçš„ã€‚\n0x04 ProcessDebugFlags(0x1F)å’Œä¸Šé¢çš„æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡ç¬¬äºŒä¸ªå‚æ•°ç°åœ¨è¦ä¼ å…¥0x11fçš„ï¼Œ\nè‹¥è¿›ç¨‹å¤„äºè¢«è°ƒè¯•çŠ¶æ€ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å€¼ä¸º0ï¼Œå¦‚æœä¸º1çš„è¯ï¼Œåˆ™è¿›ç¨‹å¤„äºéè°ƒè¯•çŠ¶æ€çš„\n0x05 åè°ƒè¯•æ–¹æ³•å¦‚æœåè°ƒè¯•apiè°ƒç”¨å°‘ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å»æ”¹é‚£ä¸ªå†…å­˜ä¸­çš„å€¼ï¼Œæ¯•ç«Ÿæ¯æ¬¡ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°çš„æ—¶å€™ï¼Œä¼šæŠŠè¿”å›å€¼å­˜åœ¨ç¬¬ä¸‰ä¸ªå‚æ•°é‡ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°çš„å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥æ“ä½œçš„ï¼Œå¦‚æœapiå¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ç”¨inlinehookï¼Œç›´æ¥å»ä¿®æ”¹è¿”å›å€¼ï¼Œå®ç°è‡ªåŠ¨åŒ–ã€‚\n0x01 ZwSetInformationThread()å¼ºåˆ¶åˆ†ç¦»è°ƒè¯•å™¨å’Œè¢«è°ƒè¯•è¿›ç¨‹çš„æŠ€æœ¯\nè¿™ä¸ªapiçš„ç»“æ„\nNTSTATUS ZwSetInformationThread(\n\t--in HANDLE ThreadHandle\n\t--in THREADINFOCLASS ThreadInformationClass\n\t__in PVOID ThreadInformation,\n\t__in ULONG ThreadInformationLength\n)\n\nç”±ç¬¬äºŒä¸ªå‚æ•°æ¥å†³å®šè¿™ä¸ªapiçš„åŠŸèƒ½ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º0x11æ—¶ï¼Œæ˜¯éšè—è°ƒè¯•è¿›ç¨‹ï¼Œä½¿å…¶æ— æ³•è°ƒè¯•çš„ï¼Œ\n0x02 åè°ƒè¯•æ–¹æ³•å¯ä»¥ä¿®æ”¹ç¬¬äºŒä¸ªå‚æ•°çš„å€¼ä¸º0ï¼Œè¿™æ ·å°±å¯ä»¥ä¸æ‰§è¡Œåˆ†ç¦»è¿›ç¨‹çš„åŠŸèƒ½äº†\nå…¶ä»–æ–¹å¼ä¾‹å¦‚æ£€æµ‹è™šæ‹Ÿæœºç¯å¢ƒï¼Œæ£€æµ‹odçª—å£ï¼Œæ£€æµ‹è¿›ç¨‹ä¸­æ˜¯å¦æœ‰è°ƒè¯•å™¨çš„è¿›ç¨‹ï¼Œæ£€æµ‹è®¡ç®—æœºçš„åå­—\nä¸»è¦é€šè¿‡ç³»ç»Ÿçš„apiå»åšçš„æ£€æµ‹\n","slug":"windowsä¸Šåè°ƒè¯•çš„ä¸€äº›æ€»ç»“","date":"2021-05-27T17:25:12.000Z","categories_index":"é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†","tags_index":"åè°ƒè¯•","author_index":"YenKoc"},{"id":"99d6abf837e88eebd0687f5f9fc4ecea","title":"mrctfçš„æ¸¸æˆé€†å‘","content":"å‰è¨€ä¹‹å‰ctfä¸­çš„æ¸¸æˆé€†å‘éƒ½æ˜¯æ¯”è¾ƒç›´æ¥ï¼Œéƒ½æ˜¯dnspyç„¶åæœç´¢å…³é”®å­—ï¼Œç„¶åå¼€å§‹é€†å‘çš„ï¼Œæ¯”è¾ƒç®€å•äº›ï¼Œè¿™é¢˜çš„è¯å’Œå…¶ä»–çš„æ¸¸æˆé¢˜è¿˜æ˜¯æœ‰å¾ˆå¤§çš„ä¸åŒçš„ï¼Œæ˜‚å“¥å‡ºçš„é¢˜ç¡®å®æœ‰è´¨é‡ï¼Œåç»­çš„å®˜æ–¹wpä¸­ä¹Ÿæœ‰æ˜‚å“¥ç”¨dllæ³¨å…¥ï¼Œç›´æ¥ç ´æ‰çš„æ“ä½œï¼Œå…ˆçœ‹å‡ é¢˜ï¼Œå¸¸è§„çš„é¢˜ï¼Œä¹‹åå†ä¸è¿™é¢˜è¿›è¡Œä¸€ä¸ªå¯¹æ¯”ã€‚\nBJD hamburger competitionè¿™é¢˜æŒºæœ‰èŠ‚ç›®æ•ˆæœçš„ï¼Œè€å…«å¥¥åŠ›ç»™\n\nä¼°è®¡å°±æ˜¯æˆ‘ä»¬é€‰æ‹©æ­£ç¡®çš„é£Ÿç‰©ç»„åˆï¼Œç„¶åæ‰èƒ½getflagï¼Œä¸€çœ‹å°±æ˜¯unity3dçš„æ¸¸æˆï¼Œè¿˜æœ‰monoçš„è¿è¡Œåº“ï¼Œå¾ˆæ˜æ˜¾äº†\n\nå› ä¸ºc#éƒ½ç¼–è¯‘åˆ°Assembly-CSharp.dllä¸­å»äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å…¥æ‰‹ç‚¹åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œdnspyå®‰æ’ä¸Š\n\nå…ˆé€šè¿‡æœç´¢å­—ç¬¦ä¸²ï¼Œå®šä½ä¸€ä¸‹æ ¸å¿ƒé€»è¾‘\n\nç›´æ¥æœåˆ°äº†æ ¸å¿ƒé€»è¾‘äº†ï¼Œæˆ‘ä»¬çœ‹ä¸‹é€»è¾‘ï¼Œçœ‹çœ‹è¦æ€ä¹ˆé€†\n\nå‘ç°é€»è¾‘å…¶å®å¾ˆç®€å•ï¼Œå’Œä¹‹å‰çŒœæƒ³çš„ä¸€æ ·ï¼Œå°±æ˜¯ä¸åŒé£Ÿæçš„ç»„åˆï¼Œä¸åŒé£Ÿæå¯¹åº”çš„ä¸åŒåˆ†æ•°ï¼Œæ°å¥½ç»„åˆæ‰å¯ä»¥getflagï¼Œå‘ç°æ˜¯é™¤äº†æ±‰å ¡é¡¶å’Œåº•ï¼Œ7ç§é£Ÿç‰©è¦é€‰4ç§ï¼Œç›´æ¥çˆ†ç ´æ‰€æœ‰æƒ…å†µï¼Œä¸è¿‡ä¹Ÿæœ‰éé¢„æœŸè§£ï¼Œå°±æ˜¯ç›´æ¥sha1è§£å¼€\nimport hashlib\ndef enc(a):\n    tmp&#x3D;997\n    for i in a:\n        if i&#x3D;&#x3D;1:\n            tmp-&#x3D;127\n        elif i&#x3D;&#x3D;2:\n            tmp*&#x3D;3\n        elif i&#x3D;&#x3D;3:\n            tmp^&#x3D;18\n        elif i&#x3D;&#x3D;4:\n            tmp+&#x3D;29\n        elif i&#x3D;&#x3D;5:\n            tmp-&#x3D;47\n        elif i&#x3D;&#x3D;6:\n            tmp*&#x3D;5\n        elif i&#x3D;&#x3D;7:\n            tmp^&#x3D;87\n    tmp^&#x3D;127\n    return str(tmp)\nindex&#x3D;[1,2,3,4,5,6,7]\nres&#x3D;[]\nfor yk1 in index:\n    for yk2 in index:\n        for yk3 in index:\n            for yk4 in index:\n                res.append(yk1)\n                res.append(yk2)\n                res.append(yk3)\n                res.append(yk4)\n                t&#x3D;enc(res).encode(&quot;utf-8&quot;)\n                if (hashlib.sha1(t).hexdigest().upper()&#x3D;&#x3D;&quot;DD01903921EA24941C26A48F2CEC24E0BB0E8CC7&quot;):\n                    print t\n                res&#x3D;[]\n\n\nMRCTF EZ_GAMEè¿™é¢˜æœ‰ä¸¤ç§åšæ³•ï¼Œä¸€ç§æ˜¯éªšæ“ä½œï¼Œä¸€ç§å°±æ˜¯æ­£å¸¸çš„æ€è·¯ï¼Œdllæ³¨å…¥\nå…ˆé‡æ¸©ä¸‹éªšæ“ä½œï¼Œä¸å¾—ä¸è¯´ï¼Œç°åœ¨çš„éªšæ“ä½œç¡®å®çŒ›ä¸”éªšï¼Œå“ˆå“ˆå“ˆ\nç¬¬ä¸€æ­¥å…ˆæ‰“å¼€æ–‡ä»¶å¤¹ï¼Œçœ‹ä¸‹è¿™ä¸ªç¨‹åºçš„æ¶æ„ï¼Œä¸€çœ‹å°±æ˜¯unityï¼Œä½†æ˜¯ç°åœ¨unityè¿˜æœ‰icppï¼Œä¸ºäº†æé«˜è¿è¡Œé€Ÿåº¦ï¼Œæ‰€ä»¥éœ€è¦å»è¯†åˆ«çš„ä¸‹ï¼Œ\nå‘ç°å°±æ˜¯I2cppçš„\n\nç„¶åå‡ºé¢˜äººæœ‰ç‚¹ç‹ ï¼Œç›´æ¥åŠ çš„æ˜¯themidaçš„å£³ï¼Œä¸è®²æ­¦å¾·ï¼ï¼Œè¿™ç§é¢˜i2cppè¿˜æ˜¯æœ‰ç°æˆçš„å·¥å…·å»æŸ¥çœ‹ä¸€äº›ç±»ä¿¡æ¯çš„ï¼Œä¸è¿‡é€šè¿‡ç±»ä¿¡æ¯å»å®šä½æ ¸å¿ƒé€»è¾‘ï¼Œä¼°è®¡æ˜¯å‡‰äº†ï¼Œæ¯•ç«ŸåŠ äº†å¼ºå£³ï¼Œä¸è¿‡è¿˜æ˜¯å¯ä»¥å¯¹æˆ‘ä»¬çš„åˆ†æèµ·åˆ°å¾ˆå…³é”®çš„åœ°æ–¹çš„ï¼Œè¿™ä¸ªå·¥å…·å«II2CppDumperï¼Œæ”¾ä¸‹githubé“¾æ¥. https://github.com/Perfare/Il2CppDumperï¼Œè®°å¾—ç›´æ¥ä¸‹ç¼–è¯‘å¥½çš„\nç”¨æ³•å¦‚ä¸‹:\n\nç„¶ååœ¨ç”Ÿæˆçš„Dumpdllæ–‡ä»¶å¤¹ä¸‹é¢æ‰¾åˆ°Assemableæ–‡ä»¶ï¼Œæ‹–å…¥dnspyï¼Œå¯ä»¥æŸ¥çœ‹ä¸€äº›ç±»ä¿¡æ¯å’Œå®šä¹‰\n\nå¯ä»¥å‘ç°è¿™é¢˜æ— æ³•ç”¨ceæå‡ºæ¥ï¼Œå› ä¸ºå‘ç°ä¸ä»…ä»…æ˜¯æ•°é‡ä¿®æ”¹äº†ï¼Œå°±å®Œäº‹äº†ï¼Œå› ä¸ºè¿™ä¸ªkeyçš„updateæ˜¯è¦æ ¹æ®åƒçš„æ˜Ÿæ˜Ÿï¼Œæ¯åƒä¸€ä¸ªï¼Œè®¡ç®—ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»åƒæ»¡105ä¸ªæ˜Ÿæ˜Ÿï¼Œupdateäº†105æ¬¡ï¼Œæ‰æ˜¯æ­£ç¡®çš„keyï¼Œè¿™ç‚¹æˆ‘ä»¬å¯ä»¥ç”¨ceåšä¸€ä¸ªéªŒè¯,å“¦å¯¹ï¼Œæœ¬æ¥è¿™äº›ä¿¡æ¯çš„rvaï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªåç§»ï¼Œç›´æ¥æ‰“å¼€idaå»çœ‹çš„ï¼Œç„¶è€ŒåŠ äº†å£³ï¼Œä½ æ‡‚çš„ï¼Œéš¾é¡¶ã€‚\nceçš„æ“ä½œå…ˆæ‰“å¼€ceï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯é£å¶äººçš„åŠ å¼ºç‰ˆï¼Œç¡®å®ğŸ‚ï¼Œå¯¹ç»“æ„ä½“ä»¥åŠç±»è¿™å—æœ‰åŠ å¼ºï¼ŒæŒºé¦™çš„ï¼Œæˆ‘ä»¬å…ˆåƒå‡ ä¸ªæ˜Ÿæ˜Ÿï¼Œç„¶åå¼€å§‹å†…å­˜æœç´¢ï¼Œçœ‹çœ‹æ˜¯å“ªé‡Œåœ¨ä¿®æ”¹\n\nå‘ç°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Œåé¢çš„å…«ä¸ªå­—èŠ‚ä¸€ç›´åœ¨å˜åŠ¨ï¼Œç„¶åæˆ‘æ ‡æ³¨çš„åœ°æ–¹å°±æ˜¯ä¹‹å‰æˆ‘ä»¬æ­»äº¡çš„æ¬¡æ•°ï¼Œè¿™ä¸ªç»“æ„æ˜¯å¯ä»¥å®Œå…¨å¯¹åº”ä¸Šä¹‹å‰æˆ‘ä»¬ç”¨å·¥å…·æå‡ºæ¥çš„ç±»å®šä¹‰çš„ä¿¡æ¯çš„ï¼Œ\n\nokçš„ï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„çŒœæƒ³æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•å»æ‰¾åˆ°è¿™ä¸ªupdatekeyçš„åœ°æ–¹å‘¢ï¼Œceæœ‰è¿™ä¸ªåŠŸèƒ½å»è·Ÿè¸ªæ˜¯å“ªé‡Œæ”¹å†™äº†è¿™ä¸ªåœ°å€ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ›´å¿«çš„æ‰¾åˆ°æ ¸å¿ƒé€»è¾‘ï¼Œè¿™ä¸ªå¼ºå£³ï¼Œæœ‰äº›åè°ƒè¯•ï¼Œæ‰€ä»¥éœ€è¦å»è®¾ç½®ä¸‹ce\n\n\nä¼šå¼¹å‡ºæ—è¾¹çš„é‚£ä¸ªçª—ï¼Œä¸ç®¡å®ƒï¼Œå†å»åƒé’»çŸ³ï¼Œå»è§¦å‘è¿™ä¸ªå†…å­˜æ–­ç‚¹ï¼ˆæˆ‘ä¼°è®¡å°±æ˜¯ä¸‹äº†ä¸€ä¸ªå†…å­˜è®¿é—®çš„æ–­ç‚¹ï¼‰,å‘ç°æˆåŠŸè§¦å‘äº†\n\nè¿™é‡Œå¯ä»¥é€‰æ‹©ç›´æ¥æ’¸æ±‡ç¼–ï¼Œä¸è¿‡å¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯é€‰æ‹©ä»å†…å­˜ä¸­dumpä¸‹æ¥ï¼Œç„¶åidaæ‰“å¼€ï¼Œé˜…è¯»ä¼ªä»£ç å¥½ä¸€äº›\n\nç›´æ¥ç«ç»’å‰‘å®‰æ’ä¸Šï¼ŒæŠŠå†…å­˜å…ˆdumpä¸‹æ¥\n\nç”¨idaæ‰“å¼€ä¹‹åï¼Œæœ‰äº›ç»“æ„è¢«æ‰“ä¹±äº†ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»æ‰¾å‡½æ•°å¤´\n\n\næŠŠåˆå§‹çš„å€¼æ‹¿å‡ºæ¥ï¼Œç„¶åæœ¬åœ°å¤ç°åŠ å¯†ç®—æ³•ï¼Œå†å¡«å……å›ceå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°flagäº†ï¼Œå†²\n#include &lt;cstdio&gt;\n#include &quot;defs.h&quot;\nvoid calc(__int64* key)\n&#123;\n    for (int i &#x3D; 0; i &lt; 4; i++)\n    &#123;\n        __int64 k &#x3D; 1, l &#x3D; 0;\n        for (__int64 j &#x3D; 0; j &lt; 64; j++)\n        &#123;      \n            l ^&#x3D; (unsigned __int64)(k &amp; *key) &gt;&gt; (j &amp; 0x3F);\n            k &#x3D; __ROL8__(k, 1);\n        &#125;\n        *key &#x3D; l | (2 * *key);\n    &#125;\n&#125;\n\nint main()\n&#123;\n    __int64 key &#x3D; 0xDEADBEEFAA114514;\n    for (int i &#x3D; 0; i &lt; 105; i++)\n        calc(&amp;key);\n    printf(&quot;0x%llX&quot;, key);\n    return 0;\n&#125;\n\næ‹¿åˆ°æœ€ç»ˆçš„keyï¼Œç„¶åå°±æ˜¯é‡æ–°å¯åŠ¨æ¸¸æˆï¼Œç›´æ¥å¡«å……æ•°æ®ï¼Œ0xEA8451453BD5B7DD, æŠŠå¯¹åº”åç§»çš„å†…å­˜åœ°å€çš„å€¼éƒ½å¡«ä¸Šï¼Œå°±èƒ½æ‹¿åˆ°flagäº†\n\n\nDLLæ³¨å…¥åˆ©ç”¨i2cppå¯¼å‡ºçš„å‡½æ•°ï¼Œç„¶åå¯ä»¥åˆ©ç”¨è¿™äº›å¯¼å‡ºå‡½æ•°ç±»ä¼¼åå°„çš„åŠŸèƒ½ï¼Œåˆå› ä¸ºæˆ‘ä»¬æŠŠdllæ³¨å…¥è¿›å»äº†ï¼Œä¹Ÿæ˜¯åŒä¸€ä¸ªè¿›ç¨‹äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å»ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ˜¯å…¨å±€çš„ï¼Œç»å¯¹æœ‰å½±å“çš„\n\nä»¥ä¸Šå°±æ˜¯å¤§è‡´çš„å¯¼å‡ºå‡½æ•°ï¼Œç„¶ååˆ©ç”¨ GetProcAddress(dll_name,api_name)ï¼Œè·å–æ¯ä¸ªå¯¼å‡ºå‡½æ•°çš„åœ°å€ï¼Œç„¶åæŠŠæ¯ä¸ªapiçš„åœ°å€éƒ½å­˜æ”¾åˆ°ä¸€ä¸ªæ•°æ®ç»“æ„é‡Œé¢çš„ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯è¿™æ ·çš„\nvoid getclass(PTR clazz,void *data)\n&#123;\n    char *str&#x3D;(char*)il2cpp_class_get_name(clazz);\n    if(!strcmp(str,&quot;GetFlag&quot;))\n    &#123;\n        \n        void *iter&#x3D;0;\n        PTR method&#x3D;NULL;\n        do \n        &#123;\n            method&#x3D;il2cpp_class_get_methods(clazz,&amp;iter);\n            char *name&#x3D;il2cpp_method_get_name(method);\n            \n            if(!strcmp(name,&quot;EatTokenUpdateKey&quot;))\n            &#123;\n                MessageBoxA(NULL,name,name,NULL);\n                PTR eatCookie&#x3D;il2cpp_class_get_field_from_name(clazz,&quot;eatCookie&quot;);\n                PTR goHome&#x3D;il2cpp_class_get_field_from_name(clazz,&quot;goHome&quot;);\n                PTR findAlien&#x3D;il2cpp_class_get_field_from_name(clazz,&quot;findAlien&quot;);\n                bool b&#x3D;true;\n                PTR b_ptr&#x3D;(PTR)&amp;b;\n                il2cpp_field_static_set_value(eatCookie,b_ptr);\n                il2cpp_field_static_set_value(goHome,b_ptr);\n                il2cpp_field_static_set_value(findAlien,b_ptr);\n                PTR o&#x3D;NULL;\n                PTR objs[1]&#x3D;&#123;NULL&#125;;\n                for(int i&#x3D;0;i&lt;105;i++)\n                    il2cpp_runtime_invoke(method,(PTR)&amp;o,objs);\n                return;\n            &#125;\n        &#125;while(method!&#x3D;NULL);\n        \n    &#125;\n    \n    \n&#125;\n\nç„¶åè‡³äºä¸ºä»€ä¹ˆdllæ³¨å…¥ä¹‹åï¼Œå°±ä¼šå¯åŠ¨æŸä¸ªå‡½æ•°çš„å‘¢ï¼Œè¿™ä¸ªæˆ‘ä¹Ÿæ˜¯æŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œå‘ç°æ¯ä¸ªDLLéƒ½æœ‰ä¸€ä¸ªå…¥å£ç‚¹å‡½æ•°ï¼Œç³»ç»Ÿä¼šåœ¨ä¸åŒæ—¶åˆ»è¿›è¡Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚è¿™é‡Œ,å°±æ˜¯æ³¨å…¥çš„dllçš„å‡½æ•°å…¥å£ç‚¹ï¼Œ\nBOOL APIENTRY DllMain(HMODULE hModule,DWORD  ul_reason_for_call,LPVOID lpReserved)\n&#123;\n    \n    switch (ul_reason_for_call)\n    &#123;\n        case DLL_PROCESS_ATTACH:\n            FillFunctionTable();\n            il2cpp_class_for_each(getclass,NULL); &#x2F;&#x2F;éå†æ¯ä¸ªç±»ï¼ŒæŸ¥çœ‹æ˜¯å¦æ˜¯æˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ªç±»\n            if(enable_hijack)\n            &#123;\n                main_dll&#x3D;LoadLibraryA(&quot;UnityPlayer_Original.dll&quot;);\n                if(main_dll&#x3D;&#x3D;NULL)\n                &#123;\n                    MessageBoxA(NULL,&quot;Error&quot;,&quot;Error&quot;,MB_OK);\n                    TerminateProcess(GetCurrentProcess(),0);\n                    return FALSE;\n                &#125;\n                else\n                    UnityMainCall&#x3D;(PTR (*)())GetProcAddress(main_dll,&quot;UnityMain&quot;);\n            &#125;\n            &#x2F;&#x2F;Sleep(10000);\n           \n            &#x2F;&#x2F;il2cpp_alloc(64);\n            break;\n        case DLL_PROCESS_DETACH:\n            if(enable_hijack)\n                FreeLibrary(main_dll);\n            break;\n    &#125;\n    return TRUE;\n&#125;\n\n\nè‡³äºä»€ä¹ˆæ—¶åˆ»ï¼Œæ€ä¹ˆè¾¨åˆ«ï¼Œå°±æ˜¯é ä¼ å…¥çš„ä¿¡å·å€¼ï¼Œä¸åŒæ¥è¾¨åˆ«ï¼Œæ¯”å¦‚DLL_PROCESS_ATTACHï¼Œå°±æ˜¯å½“dllè½½å…¥å†…å­˜ç©ºé—´æ—¶ï¼Œè¿›è¡Œè°ƒç”¨ï¼Œå…¶ä»–çš„è°ƒç”¨æ–¹å¼ï¼Œçœ‹ä¸‹å›¾(copyå¾—åˆ°):\n2.æ¯ä¸ªDLLéƒ½å¯ä»¥æœ‰ä¸€ä¸ªå…¥å£ç‚¹å‡½æ•°DllMain,ç³»ç»Ÿä¼šåœ¨ä¸åŒçš„æ—¶åˆ»è°ƒç”¨æ­¤å‡½æ•°ã€‚ä»¥ä¸‹æ˜¯DllMainçš„ä¸€èˆ¬å½¢å¼ï¼š\n\nBOOL WINAPI DllMain(\n    HINSTANCE hinstDLL,  &#x2F;&#x2F; handle to DLL module\n    DWORD fdwReason,     &#x2F;&#x2F; reason for calling function\n    LPVOID lpReserved )  &#x2F;&#x2F; reserved\n&#123;\n    &#x2F;&#x2F; Perform actions based on the reason for calling.\n    switch( fdwReason ) \n    &#123; \n        case DLL_PROCESS_ATTACH:\n         &#x2F;&#x2F; Initialize once for each new process.\n         &#x2F;&#x2F; Return FALSE to fail DLL load.\n            break;\n\n        case DLL_THREAD_ATTACH:\n         &#x2F;&#x2F; Do thread-specific initialization.\n            break;\n\n        case DLL_THREAD_DETACH:\n         &#x2F;&#x2F; Do thread-specific cleanup.\n            break;\n\n        case DLL_PROCESS_DETACH:\n         &#x2F;&#x2F; Perform any necessary cleanup.\n            break;\n    &#125;\n    return TRUE;  &#x2F;&#x2F; Successful DLL_PROCESS_ATTACH.\n&#125;\nå…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ä¼ é€’è¿›æ¥çš„å‚æ•°ï¼š\n1ã€ HINSTANCE hinstDLL\nè¿™ä¸ªå‚æ•°æ˜¯è¯¥DLLå®ä¾‹çš„å¥æŸ„ï¼Œä¹Ÿå°±æ˜¯æ­¤DLLæ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´åï¼Œåœ¨è¯¥è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„ä½ç½®ã€‚\n2ã€ DWORD fdwReason\næ­¤å‚æ•°æ ‡ç¤ºäº†è°ƒç”¨DllMainå‡½æ•°çš„åŸå› ã€‚æœ‰å››ç§å€¼ï¼Œå°±æ˜¯å‡½æ•°ä¸­caseåçš„å–å€¼ã€‚å„ä¸ªå–å€¼çš„å«ä¹‰ï¼Œç¨åè®ºè¿°ã€‚\n3ã€ LPVOID lpReserved \nä¿ç•™ã€‚\n\nç°åœ¨æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹fdwReasonçš„å››ç§å–å€¼ï¼Œè¿™äº›å–å€¼ï¼Œä¹Ÿç›´æ¥åæ˜ äº†æ“ä½œç³»ç»Ÿä¼šåœ¨ä½•ç§æƒ…å†µä¸‹è°ƒç”¨DllMainã€‚\n1ã€DLL_PROCESS_ATTACH\nå½“ç³»ç»Ÿç¬¬ä¸€æ¬¡å°†ä¸€ä¸ªDLLæ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ä¸­æ—¶ï¼Œä¼šè°ƒç”¨DllMainï¼Œå¹¶ä¸ºfdwReasonä¼ å…¥DLL_PROCESS_ATTACHã€‚\næ³¨æ„ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡æ˜ å°„çš„æ—¶å€™ï¼Œæ‰ä¼šè¿™æ ·ã€‚å¦‚ä¹‹åï¼Œå¦ä¸€çº¿ç¨‹å†æ¬¡æ˜¾å¼åŠ è½½æ­¤DLLï¼Œåˆ™æ“ä½œç³»ç»Ÿåªæ˜¯å¢åŠ è¯¥DLLçš„ä½¿ç”¨è®¡æ•°ï¼Œè€Œä¸ä¼šå†æ¬¡ä½¿ç”¨DLL_PROCESS_ATTACHæ¥è°ƒç”¨DllMainã€‚\nå¯¹DLL_PROCESS_ATTACHçš„å¤„ç†ï¼Œä»£è¡¨äº†DLLçš„åˆå§‹åŒ–ã€‚\nDllMainçš„è¿”å›å€¼ï¼Œä¹Ÿæ˜¯é’ˆå¯¹DLL_PROCESS_ATTACHæ¶ˆæ¯çš„ã€‚å¯¹äºå…¶ä½™çš„ä¸‰ç§å–å€¼ï¼Œä¸èµ·ä½œç”¨ã€‚\nå¯¹äºéšå¼åŠ è½½ï¼Œå¦‚DllMainè¿”å›FALSEï¼Œåˆ™ç¨‹åºä¼šå¯åŠ¨å¤±è´¥ã€‚å¯¹äºæ˜¾å¼åŠ è½½ï¼Œåˆ™ä¼šä½¿LoadLibraryè¿”å›NULLã€‚\n2ã€DLL_PROCESS_DETACH\nå½“ç³»ç»Ÿå°†ä¸€ä¸ªDLLä»è¿›ç¨‹åœ°å€ç©ºé—´ä¸­æ’¤é”€æ˜ å°„æ—¶ï¼Œåˆ™ä¼šå‘DllMainä¼ å…¥DLL_PROCESS_DETACHã€‚æˆ‘ä»¬åº”å½“åœ¨æ­¤å¤„æ”¾ç½®ä¸€äº›æ¸…ç†ä»£ç ã€‚\nå½“ä½¿ç”¨FreeLibraryæ—¶ï¼Œå¦‚è¯¥çº¿ç¨‹çš„ä½¿ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šä½¿ç”¨DLL_PROCESS_DETACHæ¥è°ƒç”¨DllMainã€‚å¦‚ä½¿ç”¨è®¡æ•°å¤§äº0ï¼Œåˆ™åªæ˜¯å•çº¯çš„å‡å°‘è¯¥DLLçš„è®¡æ•°ã€‚\n3ã€DLL_THREAD_ATTACH\nå½“è¿›ç¨‹åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ™ç³»ç»Ÿä¼šæ£€æŸ¥å½“å‰å·²æ˜ å°„åˆ°è¯¥è¿›ç¨‹ç©ºé—´ä¸­çš„æ‰€æœ‰DLLæ˜ åƒï¼Œå¹¶ç”¨DLL_THREAD_ATTACHæ¥è°ƒç”¨æ¯ä¸ªDLLçš„DllMainã€‚\nåªæœ‰å½“æ‰€æœ‰DLLéƒ½å®Œæˆäº†å¯¹DLL_THREAD_ATTACHçš„å¤„ç†åï¼Œæ–°çº¿ç¨‹æ‰ä¼šæ‰§è¡Œå®ƒçš„çº¿ç¨‹å‡½æ•°ã€‚\nå¦å¤–ï¼Œä¸»çº¿ç¨‹ä¸å¯èƒ½ç”¨DLL_THREAD_ATTACHæ¥è°ƒç”¨DllMainï¼Œå› ä¸ºä¸»çº¿ç¨‹å¿…ç„¶æ˜¯åœ¨è¿›ç¨‹åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç”¨DLL_PROCESS_ATTACHè°ƒç”¨DllMainçš„ã€‚\n4ã€DLL_THREAD_DETACH\nçº¿ç¨‹è‹¥è¦ç»ˆæ­¢ï¼Œä¼šè°ƒç”¨ExitThreadï¼Œä½†æ˜¯æ­¤å‡½æ•°ä¸ä¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹ï¼Œè€Œæ˜¯ä¼šåˆ©ç”¨DLL_THREAD_DETACHæ¥è°ƒç”¨å½“å‰è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„æ‰€æœ‰DLLé•œåƒçš„DllMain.\nå½“æ¯ä¸ªDLLçš„DllMainéƒ½å¤„ç†å®Œåï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£çš„ç»“æŸçº¿ç¨‹ã€‚\n\n","slug":"mrctfçš„æ¸¸æˆé€†å‘","date":"2021-05-24T05:57:54.000Z","categories_index":"gameReverse","tags_index":"reverse","author_index":"YenKoc"},{"id":"884cdb3da3fbfd31ea764ff186f03018","title":"pintool in CTF","content":"å‰è¨€çªç„¶å‘ç°pintoolså¯¹ä¸€äº›å•å­—èŠ‚éªŒè¯çš„é¢˜ç›®è¿˜æŒºå¥½ä½¿çš„ï¼Œæ‰€ä»¥å°±æ‰“ç®—æ•´æ•´å­¦å­¦ï¼Œå”‰ï¼Œå°±æ˜¯ç©ï¼Œ2333\nå®‰è£…(ubuntu16.04)ä¸è¦é—®æˆ‘ï¼Œkaliæ€ä¹ˆè£…ï¼Œåº”è¯¥æ˜¯ä¸€æ ·çš„ï¼‰,æ— è„‘è¾“å…¥ä¸‹é¢çš„shellå‘½ä»¤å°±å®Œäº‹äº†\nwget -c https:&#x2F;&#x2F;software.intel.com&#x2F;sites&#x2F;landingpage&#x2F;pintool&#x2F;downloads&#x2F;pin-3.13-98189-g60a6ef199-gcc-linux.tar.gz\ntar -xvf pin-3.13-98189-g60a6ef199-gcc-linux.tar.gz\nmv pin-3.13-98189-g60a6ef199-gcc-linux pin\ncd pin&#x2F;source&#x2F;tools&#x2F;ManualExamples&#x2F;\nmake all TAEGET&#x3D;intel64\nmake all TAEGET&#x3D;ia32\n\nä¹‹åå°±ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæœ¬æ¥æ˜¯å«pin-xxxxxï¼Œå°±å¾ˆå¤šï¼Œåå­—æ”¹çš„ç®€æ´äº›ï¼Œæ”¹æˆpinäº†ï¼Œæ•ˆæœå¦‚ä¸‹\n\nä½¿ç”¨ä½¿ç”¨çš„æ–¹æ³•åŸºæœ¬å°±æ˜¯å‘½ä»¤è®°ä½å°±è¡Œï¼Œä»¥ä¸‹å‘½ä»¤åœ¨pinç›®å½•è·¯å¾„ä¸‹æ‰§è¡Œï¼Œä¸»è¦æ˜¯ä¸ºäº†æ‰¾åˆ°pinè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„åº”è¯¥æ˜ç™½çš„å§ï¼Œå…„å¼Ÿä»¬ã€‚\n.&#x2F;pin -t &#x2F;home&#x2F;giantbranch&#x2F;pin&#x2F;source&#x2F;tools&#x2F;ManualExamples&#x2F;obj-intel64&#x2F;inscount0.so -- .&#x2F;æ–‡ä»¶å\n\nåŸç†å‰–æinscount0.soè¿™ä¸ªç©æ„ä¸»è¦å°±æ˜¯è®°å½•æ‰§è¡Œçš„æŒ‡ä»¤æ•°ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬éå¸¸å¸¸ç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæŒ‡ä»¤æ•°çš„å·®å¼‚è¿›è¡Œçˆ†ç ´ï¼Œæˆ‘æ€»ç»“äº†ä¸‹ï¼Œä¸»è¦æ˜¯é€‚ç”¨äºå•å­—èŠ‚æ¯”è¾ƒï¼Œæ¯”å¦‚è¾“å…¥çš„ä¸€ä¸ªå­—èŠ‚ï¼Œç»è¿‡ä¸€ä¸ªåŠ å¯†ç­‰æ“ä½œåï¼Œå’Œå¯†æ–‡è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœé”™è¯¯ï¼Œç¨‹åºé€€å‡ºï¼Œå¦‚æœæ­£ç¡®çš„è¯ï¼Œæ˜¯ä¸æ˜¯å°±è¿›è¡Œä¸‹ä¸€ä¸ªå­—èŠ‚çš„åˆ¤æ–­ï¼Œç”±æ­¤é€ æˆäº†æŒ‡ä»¤æ•°çš„å·®å¼‚ï¼Œå¦‚æœæ­£ç¡®çš„è¯ï¼ŒæŒ‡ä»¤æ•°å¯èƒ½ä¼šæš´å¢ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸ä¸€å®šçš„ï¼Œqctfæœ‰é¢˜ollvmï¼ŒæŒ‡ä»¤æ•°å°±æ˜¯è¾“å…¥æ­£ç¡®çš„ï¼Œåè€ŒæŒ‡ä»¤æ•°æ›´å°‘äº†ï¼Œè¿˜æ˜¯éœ€è¦å»æ ¹æ®è§„å¾‹å»ä½¿ç”¨ã€‚\næ ¹æ®ctfå®ä¾‹ï¼Œè¿›è¡Œåˆ†æ1. å¼ºç½‘æ¯çš„ä¸€é¢˜xx_warm_obfè¿™é¢˜å€’æ˜¯æœ‰ç‚¹æ„æ€ï¼Œåœ¨mainå‡½æ•°ä¸­æ³¨å†Œäº†ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ã€‚\n\nè‡³äºæ€ä¹ˆå‘ç°å‘¢ï¼Œå°±æ˜¯åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå‘ç°äº†è®¸å¤šçš„int3çš„æŒ‡ä»¤ï¼Œè¿™ç©æ„ä¼šå¼•èµ·è½¯ä¸­æ–­çš„ï¼Œå¹¶å‘é€ä¸€ä¸ªä¿¡å·ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬ä½¿ç”¨è°ƒè¯•å™¨è°ƒè¯•ï¼Œæ‰€ä»¥ä¼šå…ˆå°†ä¿¡å·å‘é€åˆ°è°ƒè¯•å™¨æ¥å¤„ç†ï¼Œç”±äºç¨‹åºæ˜¯éœ€è¦int3å»å‘é€ä¿¡å·ï¼Œå¹¶å¤„ç†ä¿¡å·çš„ï¼Œæˆ‘ä»¬å°±ä¸è¦å»æ‰“ä¹±è¿™ä¸ªé€»è¾‘ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç¨å¾®ä¿®æ”¹ä¸€æ‰‹ä¿¡å·æ“ä½œã€‚\n\n\n okï¼Œå·²ç»ä¸ä¼šè€å¼¹çª—äº†ï¼Œä¸è¿‡è¿˜æœ‰ä¸€ä¸ªä¿¡å·è¦å¤„ç†ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªåè°ƒè¯•ï¼Œå°±æ˜¯å…³äºç¨‹åºè¶…æ—¶çš„æƒ…å†µï¼Œæ‰€ä»¥ä¸€å¼¹å‡ºï¼Œæˆ‘ä»¬ç›´æ¥ä¸¢å¼ƒè¿™ä¸ªå¼‚å¸¸å°±å®Œäº‹äº†ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æˆ‘ä»¬ä¸æ–­çš„å»è°ƒè¯•ï¼Œå‘ç°å®ƒæœ‰å¾ˆå¤šå›ºå®šçš„è·³è½¬æ¨¡å¼ï¼Œå…¶å®å°±æ˜¯åƒåœ¾æŒ‡ä»¤ï¼Œæœ¬æ¥ç¨‹åºæ‰§è¡Œçš„è¯ï¼Œå®ƒçš„æŒ‡ä»¤æµç¨‹æ˜¯å›ºå®šçš„å˜›ï¼Œè¿™é‡Œä¸è°ˆè¾“å…¥çš„å½±å“ï¼Œä½†æ˜¯åŠ å…¥ä¸€äº›åƒåœ¾æŒ‡ä»¤åï¼Œå¢åŠ äº†æˆ‘ä»¬é™æ€åˆ†æçš„éš¾åº¦ï¼Œä½†æ˜¯è¿™ç©æ„å’Œollvmï¼Œæ°¸è¿œåªæ˜¯è¡¨é¢ä¸Šæ‰“ä¹±äº†ç¨‹åºæµç¨‹ï¼Œä½†æ˜¯å®é™…çš„traceæ—¥å¿—ä¸Šä½“ç°çš„ï¼Œè¿˜æ˜¯ä»ä¸Šåˆ°ä¸‹çš„æ‰§è¡Œæµç¨‹ï¼ŒæŠŠåƒåœ¾çš„æŒ‡ä»¤åˆ†è¾¨å‡ºæ¥å°±å¯ä»¥ï¼Œå¾ˆå¿«åˆ°çœŸå®æ‰§è¡Œçš„åœ°æ–¹äº†ï¼Œå‘ç°è¿™ç©æ„å°±æ˜¯ä¸€ä¸ªæ–¹ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨z3å»è§£ï¼Œä½†æ˜¯æœ‰pintoolsï¼Œè¿™é¢˜åˆæ˜¯å•å­—èŠ‚æ•´æ´»ï¼Œç›´æ¥å®‰æ’ä¸Šã€‚\n\n\næ”¾ä¸‹pintool expï¼ˆpythonï¼‰ï¼Œå®é™…ä¸Šèƒ½æ“ä½œshelléƒ½è¡Œ\nimport os\nimport sys\nimport subprocess\n\nclass Shell(object):\n    def runCmd(self, cmd):\n        res &#x3D; subprocess.Popen(cmd, shell&#x3D;True, stdin&#x3D;subprocess.PIPE,\n                               stdout&#x3D;subprocess.PIPE, stderr&#x3D;subprocess.STDOUT)\n        sout, serr &#x3D; res.communicate()\n        return res.returncode, sout, serr, res.pid\n\n    def initPin(self, cmd):\n        res &#x3D; subprocess.Popen(cmd, shell&#x3D;True, stdin&#x3D;subprocess.PIPE,\n                               stdout&#x3D;subprocess.PIPE, stderr&#x3D;subprocess.STDOUT)\n        self.res &#x3D; res\n\n    def pinWrite(self, input):\n        self.res.stdin.write(input)\n\n    def pinRun(self):\n        sout, serr &#x3D; self.res.communicate()\n        return sout, serr\n\ncmd &#x3D; &#39;.&#x2F;pin -t .&#x2F;home&#x2F;giantbranch&#x2F;pin&#x2F;source&#x2F;tools&#x2F;ManualExamples&#x2F;obj-intel64&#x2F;inscount0.so -- .&#x2F;xx_warmup_obf&#39;\n\nshell &#x3D; Shell()\n\ns &#x3D; &quot;f&quot;\nimport string\nchs&#x3D;string.printable\nchs &#x3D; string.digits+string.ascii_letters+&#39;&#123;&#125;_&#39;\nfor i in range(27):\n    min_num &#x3D; 2**32\n    min_ch &#x3D; &quot;&quot;\n    for ch in chs:\n        tmp &#x3D; s + ch +(28-len(s)-1)*&#39;a&#39;+&#39;\\n&#39;\n        shell.initPin(cmd)\n        shell.pinWrite(tmp)\n        sout,serr &#x3D; shell.pinRun()\n        with open(&#39;inscount.out&#39;) as f:\n            count &#x3D; f.readline().split(&#39; &#39;)[1]\n        count &#x3D; int(count)\n        print(count,tmp,sout)\n        if(count&lt;min_num):\n            min_num &#x3D; count\n            min_ch &#x3D; ch\n    s+&#x3D;min_ch\n    print(min_num,min_ch)\n    print(&#39;flag:&#39;+s)\n\n2. QCTF ollvmè¿™é¢˜ä¹Ÿæ˜¯å¾ˆç»å…¸çš„ä¸€é¢˜ollvmç±»å‹é¢˜ç›®äº†ï¼Œå¯ä»¥ç”¨birdçˆ·çš„å»å¹³å¦åŒ–çš„è„šæœ¬ï¼Œå¯ä»¥å»æ‰çš„ï¼Œä¹Ÿå¯ä»¥æœ‰éªšæ“ä½œï¼Œæ¯”å¦‚pintoolï¼Œåœ¨å°è¯•è¾“å…¥çš„è¿‡ç¨‹ä¸­å‘¢ï¼Œå‘ç°qï¼Œè¾“å…¥ä¹‹åï¼ŒæŒ‡ä»¤æ•°æ˜¯åœ¨é€’å¢çš„ï¼Œcä¹Ÿæ˜¯ï¼Œè¯´æ˜æ˜¯å¯ä»¥ä½¿ç”¨pintoolçš„ï¼Œæ”¾ä¸‹expå°±å®Œäº‹äº†\nimport subprocess\nimport os\nimport logging\nimport json\nimport string\nimport time\nlogging.basicConfig(level&#x3D;logging.INFO)\nlogger &#x3D; logging.getLogger(__name__)\nclass shell(object):\n    def runCmd(self, cmd):\n        res &#x3D; subprocess.Popen(cmd, shell&#x3D;True, stdin&#x3D;subprocess.PIPE,\n                               stdout&#x3D;subprocess.PIPE, stderr&#x3D;subprocess.STDOUT)\n        sout, serr &#x3D; res.communicate()\n        return res.returncode, sout, serr, res.pid\n\n    def initPin(self, cmd):\n        res &#x3D; subprocess.Popen(cmd, shell&#x3D;True, stdin&#x3D;subprocess.PIPE,\n                               stdout&#x3D;subprocess.PIPE, stderr&#x3D;subprocess.STDOUT)\n        self.res &#x3D; res\n\n    def pinWrite(self, input):\n        self.res.stdin.write(input)\n\n    def pinRun(self):\n        sout, serr &#x3D; self.res.communicate()\n        return sout, serr\nfilename &#x3D; &quot;.&#x2F;ollvm&quot;\ncmd &#x3D; &quot;.&#x2F;pin -t &quot; + \\\n    &quot;&#x2F;home&#x2F;giantbranch&#x2F;pin&#x2F;source&#x2F;tools&#x2F;ManualExamples&#x2F;obj-intel64&#x2F;inscount0.so&quot; + &quot; -- &quot; + filename\nprint cmd\nsubprocess.Popen(cmd,shell&#x3D;True,stdin&#x3D;subprocess.PIPE,stdout&#x3D;subprocess.PIPE,stderr&#x3D;subprocess.STDOUT)\n#### brup args ascii\nstart_time &#x3D; time.time()\ndic &#x3D; string.letters+&#39;_&#123;&#125;&#39;+string.digits\ncur&#x3D;&#39;&#39;\nshell &#x3D; shell()\ncout_old&#x3D;0\nstart_time &#x3D; time.time()\nfor i in range(38):\n    for s in dic:\n        pwd &#x3D; cur+s+&#39;?&#39;*(37-len(cur))\n        print len(pwd)\n        rcmd &#x3D; cmd+&#39; &#39;+pwd\n        shell.initPin(rcmd)\n        sout,serr &#x3D; shell.pinRun()\n\twith open(&#39;inscount.out&#39;) as f:\n\t\tcount&#x3D;f.readline().split(&#39; &#39;)[1]\n\tcout&#x3D;count\n        cout_sub&#x3D; int(cout) - cout_old\n        cout_old &#x3D; int(cout)\n        if cout_sub &gt; 1000000 and cout_sub &lt; 1500000 :\n            cur&#x3D;cur+s\n        print (&quot;current flag &quot;, pwd,&quot;current count:&quot;,cout,&quot;sub_count &quot;,cout_sub)\nend_time&#x3D;time.time()\ntimes&#x3D; end_time-start_time\nprint &quot;need times :&quot;,times,&#39;s&#39;\n\n\n\n","slug":"pintool-in-CTF","date":"2021-05-22T12:28:18.000Z","categories_index":"pintool","tags_index":"reverse","author_index":"YenKoc"},{"id":"f39a6fe1a2cc6526ddedf18113d11661","title":"rctf 2018 Simple vm","content":"ç»™äº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯vmï¼Œä¸€ä¸ªæ˜¯opcodeæ–‡ä»¶ï¼Œidaæ‰“å¼€å\n\næ‰“å¼€äº†binæ–‡ä»¶ï¼Œç„¶åå°†æ–‡ä»¶å†…å®¹è¯»å–å‡ºæ¥ï¼Œç»§ç»­è¿›å…¥ä¸‹ä¸€ä¸ªå‡½æ•°é‡Œé¢åˆ†æ\n\næ˜¯ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„while switch caseçš„è§£é‡Šå™¨ï¼Œptrå­˜ç€å°±æ˜¯ä¸Šé¢è¯»å–çš„opcodeæ–‡ä»¶å†…å­˜ï¼Œè¿™å°±æ˜¯å±äºæ˜¯é‚£ç§å·²ç»ç»™å®šäº†opcodeï¼Œæˆ‘ä»¬éœ€è¦é€†å‘è§£é‡Šå™¨ï¼Œç»“åˆopcodeæ–‡ä»¶ï¼Œæ¨å‡ºflagï¼Œè¿™é‡Œæˆ‘å°±ä¸æ‰“ç®—æŠŠæ˜ å°„æå‡ºæ¥äº†ï¼Œæˆ‘è¿™é‡Œçš„æ‰‹æ³•å°±æ˜¯å»è·Ÿè¸ªæ•°æ®æµï¼Œä¹Ÿå°±æ˜¯æˆ‘çš„è¾“å…¥ç©¶ç«Ÿç»è¿‡äº†ä»€ä¹ˆæ ·çš„å¤„ç†ï¼Ÿ éœ€è¦å»ææ˜ç™½ï¼Œä¸ºäº†åŠ å¿«æˆ‘çš„è°ƒè¯•é€Ÿåº¦ï¼Œæˆ‘å…ˆæŠŠä¼ªä»£ç æŠ ä¸‹æ¥ï¼Œç„¶åæŠŠä¼ªä»£ç çš„æ‰§è¡Œæµç¨‹è¿›è¡Œäº†æ‰“å°\n#include&lt;iostream&gt;\n#include&lt;cstring&gt;\n#include&lt;map&gt;\n#include &quot;defs.h&quot;\nusing namespace std;\nconst int maxm&#x3D;2e3+5;\n\nint main()&#123;\n    __int64 v0; &#x2F;&#x2F; rax\n    _BYTE *v1; &#x2F;&#x2F; rbp\n    int v2; &#x2F;&#x2F; ebx\n    __int64 v4; &#x2F;&#x2F; rdx\n    __int64 v5; &#x2F;&#x2F; rax\n    __int64 v6; &#x2F;&#x2F; rax\n    __int64 v7; &#x2F;&#x2F; rax\n    __int64 v8; &#x2F;&#x2F; rax\n    __int64 v9; &#x2F;&#x2F; rax\n    int v10; &#x2F;&#x2F; eax\n    __int64 v11; &#x2F;&#x2F; rax\n    char v12; &#x2F;&#x2F; dl\n    int v13; &#x2F;&#x2F; eax\n    int v14; &#x2F;&#x2F; eax\n    _BYTE *v15; &#x2F;&#x2F; rax\n    __int64 v16; &#x2F;&#x2F; rax\n    __int64 v17; &#x2F;&#x2F; rax\n    __int64 v18; &#x2F;&#x2F; rax\n    unsigned char ptr[396] &#x3D; &#123;\n            0x01, 0x30, 0x00, 0x00, 0x00, 0x10, 0x18, 0x43, 0x14, 0x15, 0x47, 0x40, 0x17, 0x10, 0x1D, 0x4B,\n            0x12, 0x1F, 0x49, 0x48, 0x18, 0x53, 0x54, 0x01, 0x57, 0x51, 0x53, 0x05, 0x56, 0x5A, 0x08, 0x58,\n            0x5F, 0x0A, 0x0C, 0x58, 0x09, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x00, 0x00, 0x00, 0x00,\n            0x15, 0x00, 0x01, 0x00, 0x00, 0x0E, 0x12, 0x0B, 0x0C, 0x00, 0x01, 0x00, 0x00, 0x35, 0x00, 0x00,\n            0x00, 0x66, 0x15, 0x10, 0x01, 0x00, 0x00, 0x0E, 0x0A, 0x66, 0x16, 0x0C, 0x10, 0x01, 0x00, 0x00,\n            0x47, 0x00, 0x00, 0x00, 0x66, 0x03, 0x40, 0x01, 0x00, 0x00, 0x10, 0x11, 0xF1, 0x00, 0x00, 0x00,\n            0x13, 0x04, 0x43, 0x01, 0x00, 0x00, 0x08, 0x04, 0x41, 0x01, 0x00, 0x00, 0x10, 0x03, 0x40, 0x01,\n            0x00, 0x00, 0x08, 0x04, 0x42, 0x01, 0x00, 0x00, 0x03, 0x41, 0x01, 0x00, 0x00, 0x03, 0x43, 0x01,\n            0x00, 0x00, 0x08, 0x10, 0x03, 0x42, 0x01, 0x00, 0x00, 0x08, 0x04, 0x44, 0x01, 0x00, 0x00, 0x66,\n            0x03, 0x40, 0x01, 0x00, 0x00, 0x11, 0xF1, 0x00, 0x00, 0x00, 0x10, 0x03, 0x44, 0x01, 0x00, 0x00,\n            0x16, 0x05, 0x40, 0x01, 0x00, 0x00, 0x0E, 0x06, 0x40, 0x01, 0x00, 0x00, 0x0C, 0x45, 0x01, 0x00,\n            0x00, 0x55, 0x00, 0x00, 0x00, 0x66, 0x03, 0x46, 0x01, 0x00, 0x00, 0x11, 0x05, 0x00, 0x00, 0x00,\n            0x13, 0x10, 0x03, 0x46, 0x01, 0x00, 0x00, 0x11, 0x11, 0x01, 0x00, 0x00, 0x13, 0x17, 0x18, 0x60,\n            0x01, 0x00, 0x00, 0x0C, 0x46, 0x01, 0x00, 0x00, 0xB6, 0x00, 0x00, 0x00, 0x01, 0x76, 0x01, 0x00,\n            0x00, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n            0x0A, 0x49, 0x6E, 0x70, 0x75, 0x74, 0x20, 0x46, 0x6C, 0x61, 0x67, 0x3A, 0x00, 0x00, 0x00, 0x0F,\n            0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n            0x20, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n            0x05, 0x57, 0x72, 0x6F, 0x6E, 0x67, 0x0A, 0x52, 0x69, 0x67, 0x68, 0x74, 0x0A, 0x00, 0x00, 0x00,\n            0x15, 0x50, 0x01, 0x00, 0x00, 0x0E, 0x12, 0x0B, 0x0C, 0x50, 0x01, 0x00, 0x00, 0x65, 0x01, 0x00,\n            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x15, 0x56, 0x01, 0x00, 0x00, 0x0E, 0x12, 0x0B, 0x0C, 0x50,\n            0x01, 0x00, 0x00, 0x7B, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00\n    &#125;;\n    unsigned int test&#x3D;~(0xffffffdf&amp;0x31);\n    printf(&quot;%d\\n&quot;,test);\n    v0 &#x3D; 0LL;\n    v1 &#x3D; ptr;\n    int dword_6010A4&#x3D;0;\n    int dword_601090&#x3D;0x18c;\n    int c;\n    while ( 1 )\n    &#123;\n        v2 &#x3D; v0 + 1;\n        switch ( v1[v0] )\n        &#123;\n            case 0:\n                return *(unsigned int *)&amp;v1[v2];\n                printf(&quot;over!&quot;);\n            case 1:\n                goto LABEL_35;\n            case 2:\n                v4 &#x3D; v2;\n                v2 &#x3D; v0 + 9;\n                v1[*(int *)&amp;v1[v4]] &#x3D; *(_DWORD *)&amp;v1[(int)v0 + 5];\n                printf(&quot;v4 &#x3D; v2;\\n&quot;\n                       &quot; v2 &#x3D; v0 + 9;\\n&quot;\n                       &quot;v1[*(int *)&amp;v1[v4]] &#x3D; *(_DWORD *)&amp;v1[(int)v0 + 5];\\n&quot;);\n                break;\n            case 3:\n                v5 &#x3D; v2;\n                v2 +&#x3D; 4;\n                v6 &#x3D; *(int *)&amp;v1[v5];\n                printf(&quot; v5 &#x3D; v2;\\n&quot;\n                       &quot; v2 +&#x3D; 4;\\n&quot;\n                       &quot;v6 &#x3D; *(int *)&amp;v1[v5];\\n&quot;);\n                goto LABEL_27;\n            case 4:\n                v7 &#x3D; v2;\n                v2 +&#x3D; 4;\n                v8 &#x3D; *(int *)&amp;v1[v7];\n                printf(&quot;v7 &#x3D; v2;\\n&quot;\n                       &quot;v2 +&#x3D; 4;\\n&quot;\n                       &quot;v8 &#x3D; *(int *)&amp;v1[v7];\\n&quot;);\n                goto LABEL_31;\n            case 5:\n                v9 &#x3D; v2;\n                v2 +&#x3D; 4;\n                v10 &#x3D; (char)v1[*(int *)&amp;v1[v9]];\n                printf(&quot; v9 &#x3D; v2;\\n&quot;\n                       &quot; v2 +&#x3D; 4;\\n&quot;\n                       &quot; v10 &#x3D; (char)v1[*(int *)&amp;v1[v9]];\\n&quot;);\n                goto LABEL_21;\n            case 6:\n                v11 &#x3D; v2;\n                v12 &#x3D; dword_6010A4;\n                v2 +&#x3D; 4;\n                v8 &#x3D; *(int *)&amp;v1[v11];\n                printf(&quot; v11 &#x3D; v2;\\n&quot;\n                       &quot; v12 &#x3D; dword_6010A4;\\n&quot;\n                       &quot; v2 +&#x3D; 4;\\n&quot;\n                       &quot; v8 &#x3D; *(int *)&amp;v1[v11];\\n&quot;);\n                goto LABEL_9;\n            case 7:\n                v13 &#x3D; dword_6010A4;\n                printf(&quot;v13 &#x3D; dword_6010A4;\\n&quot;);\n                goto LABEL_23;\n            case 8:\n                v14 &#x3D; ~(dword_6010A4 &amp; c);\n                printf(&quot;v14 &#x3D; ~(dword_6010A4 &amp; c);\\n&quot;);\n                goto LABEL_12;\n            case 0xA:\n                v14 &#x3D; getchar();\n                printf(&quot;v14 &#x3D; getchar();\\n&quot;);\n                goto LABEL_12;\n            case 0xB:\n                putchar(c);\n                printf(&quot;\\n&quot;);\n                printf(&quot;putchar(c);\\n&quot;);\n                break;\n            case 0xC:\n                v15 &#x3D; &amp;v1[*(int *)&amp;v1[v2]];\n                if ( *v15 )\n                &#123;\n                    v2 &#x3D; *(_DWORD *)&amp;v1[v2 + 4];\n                    --*v15;\n                &#125;\n                else\n                &#123;\n                    v2 +&#x3D; 8;\n                &#125;\n                printf(&quot;v15 &#x3D; &amp;v1[*(int *)&amp;v1[v2]];\\n&quot;\n                       &quot;                if ( *v15 )\\n&quot;\n                       &quot;                &#123;\\n&quot;\n                       &quot;                    v2 &#x3D; *(_DWORD *)&amp;v1[v2 + 4];\\n&quot;\n                       &quot;                    --*v15;\\n&quot;\n                       &quot;                &#125;\\n&quot;\n                       &quot;                else\\n&quot;\n                       &quot;                &#123;\\n&quot;\n                       &quot;                    v2 +&#x3D; 8;\\n&quot;\n                       &quot;                &#125;\\n&quot;);\n                break;\n            case 0xD:\n                ++c;\n                printf(&quot;++c\\n&quot;);\n                break;\n            case 0xE:\n                ++dword_6010A4;\n                printf(&quot;++dword_6010A4;\\n&quot;);\n                break;\n            case 0xF:\n                v14 &#x3D; dword_6010A4;\n                printf(&quot;v14 &#x3D; dword_6010A4;\\n&quot;);\n                goto LABEL_12;\n            case 0x10:\n                v10 &#x3D; c;\n                printf(&quot;v10&#x3D;c\\n&quot;);\n                goto LABEL_21;\n            case 0x11:\n                v16 &#x3D; v2;\n                v2 +&#x3D; 4;\n                v13 &#x3D; *(_DWORD *)&amp;v1[v16];\n                printf(&quot; v16 &#x3D; v2;\\n&quot;\n                       &quot;                v2 +&#x3D; 4;\\n&quot;\n                       &quot;                v13 &#x3D; *(_DWORD *)&amp;v1[v16];\\n&quot;);\n            LABEL_23:\n                c +&#x3D; v13;\n                printf(&quot;c+&#x3D;v13\\n&quot;);\n                break;\n            case 0x12:\n                printf(&quot; v6 &#x3D; dword_6010A4;\\n&quot;\n                       &quot; goto LABEL_27;\\n&quot;);\n                v6 &#x3D; dword_6010A4;\n                goto LABEL_27;\n\n            case 0x13:\n                v6 &#x3D; c;\n                printf(&quot;v6&#x3D;c\\n&quot;);\n            LABEL_27:\n                v14 &#x3D; (char)v1[v6];\n                printf(&quot;v14 &#x3D; (char)v1[v6];\\n&quot;\n                       &quot;goto LABEL_12;\\n&quot;);\n                goto LABEL_12;\n\n            case 0x14:\n                v17 &#x3D; v2;\n                v2 +&#x3D; 4;\n                v14 &#x3D; *(_DWORD *)&amp;v1[v17];\n                printf(&quot;v17 &#x3D; v2;\\n&quot;\n                       &quot;v2 +&#x3D; 4;\\n&quot;\n                       &quot;v14 &#x3D; *(_DWORD *)&amp;v1[v17];\\n&quot;\n                       &quot;goto LABEL_12;\\n&quot;);\n                goto LABEL_12;\n\n            case 0x15:\n                v18 &#x3D; v2;\n                v2 +&#x3D; 4;\n                v10 &#x3D; *(_DWORD *)&amp;v1[v18];\n                printf(&quot;v18 &#x3D; v2;\\n&quot;\n                       &quot;v2 +&#x3D; 4;\\n&quot;\n                       &quot;v10 &#x3D; *(_DWORD *)&amp;v1[v18];\\n&quot;);\n            LABEL_21:\n                dword_6010A4 &#x3D; v10;\n                printf(&quot;dword_6010A4 &#x3D; v10;\\n&quot;);\n                break;\n            case 0x16:\n                v8 &#x3D; dword_6010A4;\n                printf(&quot;v8 &#x3D; dword_6010A4;\\n&quot;);\n            LABEL_31:\n                v12 &#x3D; c;\n                printf(&quot;v12&#x3D;c\\n&quot;);\n            LABEL_9:\n                v1[v8] &#x3D; v12;\n                printf(&quot;v1[v8]&#x3D;v12\\n&quot;);\n                break;\n            case 0x17:\n                v14 &#x3D; c - dword_6010A4;\n                printf(&quot;v14 &#x3D; c - dword_6010A4;\\n&quot;);\n            LABEL_12:\n                c &#x3D; v14;\n                printf(&quot;c&#x3D;v14\\n&quot;);\n                break;\n            case 0x18:\n                if ( c )\n                    LABEL_35:\n                    v2 &#x3D; *(_DWORD *)&amp;v1[v2];\n                else\n                    v2 &#x3D; v0 + 5;\n                printf(&quot; if ( c )\\n&quot;\n                       &quot;                    LABEL_35:\\n&quot;\n                       &quot;                    v2 &#x3D; *(_DWORD *)&amp;v1[v2];\\n&quot;\n                       &quot;                else\\n&quot;\n                       &quot;                    v2 &#x3D; v0 + 5;\\n&quot;);\n                break;\n            default:\n                break;\n        &#125;\n        if ( v2 &gt;&#x3D; dword_601090 )\n            return 0LL;\n        v0 &#x3D; v2\n        printf(&quot;v0&#x3D;v2\\n&quot;);\n    &#125;\n&#125;\n\n\nåœ¨getchar()æ–¹æ³•ä¸Šï¼Œå¼€å§‹ä¸‹æ–­ç‚¹ï¼Œç„¶åæ ¹æ®æ•°æ®æµï¼Œå‘ç°å°†è¾“å…¥å­˜åœ¨æŸæ®µå†…å­˜ç©ºé—´ä¸­,åœ¨è¿™æ®µå†…å­˜ç©ºé—´ï¼Œä¸‹ä¸€ä¸ªå†…å­˜è®¿é—®æ–­ç‚¹\nå‘ç°åœ¨è¿™æ–­ä¸‹æ¥äº†ï¼Œ\n\nv14çš„å€¼å°±æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå†…å­˜ç©ºé—´çš„å€¼ï¼Œç»§ç»­å¾€ä¸‹è·Ÿè¸ª\nc&#x3D;v14\nv12&#x3D;c\nv1[v8]&#x3D;v12\n\nå¥½å®¶ä¼™ï¼Œåˆå¤åˆ¶åˆ°åˆ«çš„åœ°æ–¹å»äº†ï¼Œä¼°è®¡æ˜¯æ€•ç›´æ¥åœ¨åŸå†…å­˜ä¸­è¿›è¡Œæ“ä½œçš„è¯ï¼Œå®¹æ˜“ç›´æ¥è¢«å†…å­˜æ–­ç‚¹æ‰“ç ´2333ï¼Œæˆ‘ä»¬æŠŠå†…å­˜è®¿é—®æ–­ç‚¹å†ä¸€æ¬¡çš„è®¾å®šåœ¨è¿™ï¼Œ2333\nâ€‹    \nè·Ÿä¸€ä¸‹è¿™ä¸ªv14\nc&#x3D;v14\nv12&#x3D;c\nv1[v8]&#x3D;v12 &#x2F;&#x2F;å­˜æ”¾åˆ°åˆ«çš„åœ°æ–¹å»\n\nv14&#x3D;~(dword_10A4&amp; c) &#x2F;&#x2F;0x20&amp;str[0]\nc&#x3D;v14\nv12&#x3D;c\nv1[v8]&#x3D;v12 &#x2F;&#x2F;v8&#x3D;0x141\n\næŠŠæ•°æ®æ”¾åˆ°è¿™æ®µå†…å­˜é‡Œäº†g\nt1=~(0x20+i&amp;str[i]);\nt2=~((0x20+i)&amp;t1);\nv14&#x3D;~(dword_6010a4&amp;c)\nc&#x3D;v14\nv12&#x3D;c\nv1[v8]&#x3D;v12 &#x2F;&#x2F;v8&#x3D;142 t2å­˜è¿›å»\n\nv14&#x3D;v1[v6] &#x2F;&#x2F;v6&#x3D;141 ä¹Ÿå°±æ˜¯t1å–å‡º\nc&#x3D;v14\nv14&#x3D;v1[v6] &#x2F;&#x2F;v6&#x3D;140 æŠŠè¾“å…¥å–å‡º\nc&#x3D;v14\nv14&#x3D;~(dword_6010a4&amp;c)  t1&amp;str[i]\nc&#x3D;v14\nv10&#x3D;c\ndword_6010a4&#x3D;v10\nv14&#x3D;v1[v6] &#x2F;&#x2F;v6&#x3D;0x142 æŠŠt2å–å‡º\nc&#x3D;v14\nv14&#x3D;~(dword_6010A4&amp;c); t3&amp;t2\nc&#x3D;v14\nv12&#x3D;c\nv1[v8]&#x3D;v14 v8&#x3D;0x144\n\n\n\nè¯´æ˜æ˜¯ä¸€æ³¢å•å­—èŠ‚æ“ä½œï¼Œå°†0x144çš„æœ€ååŠ å¯†éƒ¨åˆ†å­˜æ”¾åˆ°0x112ä¸­äº† ,æ¯ä¸€æ¬¡è°ƒè¯•çš„è¿‡ç¨‹ä¸­çŸ¥é“äº†dwordåœ¨é‚£ä¸ªç­‰å¼ä¸­å°±æ˜¯0x20+i\n\n\nè¿™é‡Œå°±æ˜¯åšåˆ¤æ–­çš„åœ°æ–¹ï¼Œå¥½å®¶ä¼™ï¼Œè¿˜æ˜¯å€’ç€æ¥åˆ¤æ–­çš„ï¼‰ï¼Œä¸è¿‡ä¹‹å‰æˆ‘ä»¬å·²ç»æŠŠç®—æ³•åˆ†æå‡ºæ¥äº†ï¼Œç›´æ¥çˆ†ç ´å°±å®Œäº‹äº†ï¼Œåæ­£æ˜¯å•å­—èŠ‚çš„\n#include&lt;iostream&gt;\n#include&lt;cstring&gt;\n#include&lt;map&gt;\n#include &quot;defs.h&quot;\nusing namespace std;\nconst int maxm&#x3D;2e3+5;\n\nint main()&#123;\n\n    int res[] &#x3D; &#123;0x10,0x18,0x43,0x14,0x15,0x47,0x40,0x17,0x10,0x1d,0x4b,0x12,0x1f,0x49,0x48,0x18,0x53,0x54,0x1,0x57,0x51,0x53,0x5,0x56,0x5a,0x8,0x58,0x5f,0xa,0xc,0x58,0x9&#125;;\n\n    for(int i&#x3D;0;i&lt;32;i++)\n    &#123;\n        for(int j&#x3D;0;j&lt;256;j++)\n        &#123;\n        int t1&#x3D;~((0x20+i)&amp;j);\n        int t2&#x3D;~((0x20+i)&amp;t1);\n        int t3&#x3D;~(t1&amp;j);\n        int t4&#x3D;~(t3&amp;t2);\n        if(t4&#x3D;&#x3D;res[i])\n        &#123;\n            printf(&quot;%c&quot;,j);\n            break;\n        &#125;\n        &#125;\n    &#125;\n&#125;\n\n\nå†ä»‹ç»ä¸€ç§z3çš„ä½¿ç”¨\nfrom z3 import *\ndef tt(inp,i):\n    t1&#x3D;~((0x20+i)&amp;inp)\n    t2&#x3D;~((0x20+i)&amp;t1)\n    t3&#x3D;~(t1&amp;inp)\n    t4&#x3D;~(t3&amp;t2)\n    return t4\nres&#x3D; [0x10,0x18,0x43,0x14,0x15,0x47,0x40,0x17,0x10,0x1d,0x4b,0x12,0x1f,0x49,0x48,0x18,0x53,0x54,0x1,0x57,0x51,0x53,0x5,0x56,0x5a,0x8,0x58,0x5f,0xa,0xc,0x58,0x9]\n\ns&#x3D;Solver()\ninputs&#x3D;[BitVec((&#39;w%d&#39;%i),8) for i in range(32)]\nfor yk in range(32):\n    s.add(tt(inputs[yk],yk)&#x3D;&#x3D;res[yk])\nif s.check()&#x3D;&#x3D;sat:\n    model&#x3D;s.model()\n    str&#x3D;[chr(model[inputs[j]].as_long().real) for j in range(32)]\n    print &quot;&quot;.join(str)\n\n\n","slug":"rctf-2018-Simple-vm","date":"2021-05-21T02:23:22.000Z","categories_index":"writeup","tags_index":"reverse","author_index":"YenKoc"},{"id":"43f61f74963677e07981d8eac779d6cf","title":"çœ‹é›ªctf ç¬¬äºŒé¢˜ å—å†¥ç¥åŠŸ","content":"","slug":"çœ‹é›ªctf-ç¬¬äºŒé¢˜-å—å†¥ç¥åŠŸ","date":"2021-05-12T02:44:04.000Z","categories_index":"","tags_index":"","author_index":"YenKoc"},{"id":"5f3262e9c2aa5e7df63089bc650eb7bf","title":"æ´¥é—¨æ¯2021 wp","content":"mobileåŠ äº†360çš„å£³å­ï¼Œfrida-dexdumpï¼Œè„±ä¸‹æ¥å°±å®Œäº‹äº†ï¼Œå‘ç°æ²¡nativeå±‚, å¥½å®¶ä¼™ï¼Œçº¯javaå‘—ï¼‰ï¼Œæ‰¾åˆ°å…³é”®çš„dexå¼€å§‹å®¡è®¡\nï¼Œæ‰¾åˆ°äº†ä¸¤æ®µé€»è¾‘ï¼Œä¸€æ®µæ˜¯åŠ å¯†çš„ï¼Œä¸€æ®µæ˜¯è§£å¯†çš„ï¼Œå¤§æ¦‚é€†äº†ä¸€ä¸‹ï¼Œå‘ç°è¿™é¢˜æœ‰ä¸¤ç§åšæ³•ï¼Œä¸€ç§æ˜¯ç™½å«–è§£å¯†æ¥å£ï¼ŒæŠŠç»™å‡ºçš„æ•°æ®ï¼Œé€šè¿‡æ›¿æ¢xmlï¼Œtxtï¼Œdbæ–‡ä»¶ï¼Œå†hookè¾“å…¥å°±å¯ä»¥ç›´æ¥å®ç°å‚»ç“œå¼è§£å¯†ï¼Œå¦ä¸€ç§å°±æ˜¯æœ¬åœ°å¤ç°åŠ å¯†æ¥å£ï¼Œç„¶åç›´æ¥é€†å‘è§£å¯†ã€‚\n1.æ­£å‘çš„æ“ä½œå…ˆçœ‹ä¸‹ä»£ç \npublic void i() throws NoSuchPaddingException, InvalidKeyException, NoSuchAlgorithmException, IllegalBlockSizeException, BadPaddingException, InvalidAlgorithmParameterException, InvalidKeySpecException, CertificateException, UnrecoverableEntryException, KeyStoreException, NoSuchProviderException, IOException &#123;\n      String v0 &#x3D; this.f0.getText().toString(); &#x2F;&#x2F;å–å‡ºdata\n      String v1 &#x3D; this.e0.getText().toString(); &#x2F;&#x2F;å–å‡ºkey\n      this.d0 &#x3D; v1;\n      int v2 &#x3D; 0;\n      if((v1.equals(&quot;&quot;) | v0.equals(&quot;&quot;)) !&#x3D; 0) &#123;  &#x2F;&#x2F;ä¸ä¸ºç©º\n          Toast.makeText(StubApp.getOrigApplicationContext(this.getApplicationContext()), &quot;The user password or data is null, please check!&quot;, 0).show();\n          return;\n      &#125;\n\n      new a(this);\n      String v1_1 &#x3D; this.d0;\n      if(a.b &#x3D;&#x3D; 0) &#123;\n          a.a &#x3D; new SecureRandom().generateSeed(8);  &#x2F;&#x2F;è¿™é‡Œç”Ÿæˆäº†ä¸€ä¸ªéšæœºæ•°ç§å­\n          a.b &#x3D; 10;\n      &#125;\n\n      BigInteger v3 &#x3D; new BigInteger(a.a); &#x2F;&#x2F;ç”Ÿæˆäº†ä¸€ä¸ªå¤§æ•´æ•°\n      Key v1_2 &#x3D; a.a(v1_1); &#x2F;&#x2F;ä»¥å‰é¢ç”Ÿæˆçš„ç§å­ï¼Œç”Ÿæˆä¸€ä¸ªkey\n      Cipher v4 &#x3D; Cipher.getInstance(&quot;PBEWITHSHA256AND128BITAES-CBC-BC&quot;);\n      v4.init(1, v1_2);\n      String v1_3 &#x3D; new String(Base64.encode(v4.doFinal(v0.getBytes()), 1)); &#x2F;&#x2F;å…ˆaesåŠ å¯†ï¼Œç„¶åbase64\n      --a.b;\n      this.k0 &#x3D; v3 + &quot;_&quot; + v1_3;  &#x2F;&#x2F;flagåŠ å¯†æˆ éšæœºæ•°ç§å­å¤§æ•´æ•°+ä¸‹åˆ’çº¿+aesåŠ base64åŠ å¯†åçš„æ•°æ®\n      TextView v0_1 &#x3D; this.g0;\n      StringBuilder v1_4 &#x3D; c.a.a.a.a.a(&quot;The flag is encrypted!\\n&quot;);\n      v1_4.append(this.k0);\n      v1_4.append(&quot;\\n&quot;);\n      v0_1.setText(v1_4.toString());\n      Log.i(&quot;KeyDistribution:&quot;, &quot;encString:&quot; + this.k0);\n      if(this.k0 &#x3D;&#x3D; null) &#123;\n          Toast.makeText(StubApp.getOrigApplicationContext(this.getApplicationContext()), &quot;Encryption failedï¼ï¼&quot;, 0).show();\n      &#125;\n      else &#123;\n          Toast.makeText(StubApp.getOrigApplicationContext(this.getApplicationContext()), &quot;Encrypted successfullyï¼\\n&quot;, 0).show();\n      &#125;\n\n      b v0_2 &#x3D; new b(this); &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„sqlliteæ•°æ®åº“\n      this.h0.setLength(0);\n      this.i0.setLength(0);\n      this.j0 &#x3D; null;\n      v0_2.Q &#x3D; this.d0; &#x2F;&#x2F;ä¸€å¼€å§‹è¾“å…¥çš„key\n      SecureRandom v6 &#x3D; new SecureRandom();\n      BigInteger[] v8 &#x3D; new BigInteger[3]; &#x2F;&#x2F;åˆ›å»ºäº†ä¸€ä¸ªå¤§æ•°çš„æ•°ç»„\n      int v9;\n      for(v9 &#x3D; 0; v9 &lt; 3; ++v9) &#123;\n          v8[v9] &#x3D; new BigInteger(0x20, v6);  ç”Ÿæˆäº†ä¸‰ä¸ªéšæœºå¤§æ•´æ•°\n          Log.i(&quot;upDateR:&quot;, v8[v9].toString());\n      &#125;\n\n      v0_2.P &#x3D; v8;\n      SecureRandom v6_1 &#x3D; new SecureRandom();\n      ArrayList v8_1 &#x3D; new ArrayList();\n      while(v8_1.size() &lt; 7) &#123;\n          BigInteger v9_1 &#x3D; new BigInteger(16, v6_1); ç”Ÿæˆäº†7ä¸ªéšæœºå¤§æ•´æ•°\n          if(!v8_1.contains(v9_1)) &#123;\n              v8_1.add(v9_1);\n          &#125;\n\n          Log.i(&quot;upDateX:&quot;, v8_1.toString());\n      &#125;\n\n      v0_2.R &#x3D; v8_1;\n      this.g0.append(&quot;Random numbers R and X have been successfully generatedï¼\\n&quot;);\n      BigInteger v8_2 &#x3D; new BigInteger(v0_2.Q.getBytes()); &#x2F;&#x2F;keyè½¬æ¢æˆå¤§æ•´æ•°\n      BigInteger[] v6_2 &#x3D; new BigInteger[7];\n      int v9_2;\n      for(v9_2 &#x3D; 0; v9_2 &lt; 7; ++v9_2) &#123;\n          v6_2[v9_2] &#x3D; v8_2.add(v0_2.P[0].multiply(((BigInteger)v0_2.R.get(v9_2))).add(v0_2.P[1].multiply(((BigInteger)v0_2.R.get(v9_2)).pow(2))).add(v0_2.P[2].multiply(((BigInteger)v0_2.R.get(v9_2)).pow(3)))); &#x2F;&#x2F;è¿™é‡Œæœ‰ä¸ªè®¡ç®—ï¼Œç„¶åæŠŠå€¼ç®—å‡ºæ¥ï¼Œå…¶å®å°±æ˜¯ç»™å‡ºæ–‡ä»¶çš„ä¸‹åˆ’çº¿çš„ååŠæ®µ\n      &#125;\n\n      List v8_3 &#x3D; v0_2.R;\n      String[] v9_3 &#x3D; new String[7];\n      int v12;\n      for(v12 &#x3D; 0; v12 &lt; 7; ++v12) &#123;\n          v9_3[v12] &#x3D; ((BigInteger)v8_3.get(v12)).toString() + &quot;_&quot; + v6_2[v12].toString(); &#x2F;&#x2F;å­˜æ”¾å„ä¸ªæ–‡ä»¶ä¸­çš„å€¼ï¼Œå‰åŠæ®µå°±æ˜¯v8_3çš„å€¼ï¼Œ\n          StringBuilder v13 &#x3D; c.a.a.a.a.a(&quot;formatShareKey:&quot;);\n          v13.append(v9_3[v12]);\n          Log.i(&quot;KeyDistribution:&quot;, v13.toString());\n      &#125;\n\t&#x2F;&#x2F;ä¸‹é¢å°±æ˜¯æ•°æ®å­˜æ”¾åˆ°æ–‡ä»¶é‡Œå°±è¡Œ\n      v0_2.S &#x3D; v9_3;\n      SharedPreferences.Editor v3_1 &#x3D; v0_2.T.getSharedPreferences(&quot;shareKeys&quot;, 0).edit();\n      v3_1.putString(&quot;key1&quot;, v0_2.S[0]);\n      v3_1.putString(&quot;key2&quot;, v0_2.S[1]);\n      v3_1.putString(&quot;key3&quot;, v0_2.S[2]);\n      v3_1.apply();\n      Log.i(&quot;KeyDistribution:&quot;, &quot;SharedPreferences store 3keys success! &quot;);\n      FileOutputStream v3_2 &#x3D; v0_2.T.openFileOutput(&quot;shareKeys.txt&quot;, 0);\n      v3_2.write(v0_2.S[3].getBytes());\n      v3_2.write(&quot;\\n&quot;.getBytes());\n      v3_2.write(v0_2.S[4].getBytes());\n      v3_2.close();\n      Log.i(&quot;KeyDistribution:&quot;, &quot;file store 2keys success! &quot;);\n      SQLiteDatabase v3_3 &#x3D; new b(v0_2.T).getWritableDatabase();\n      v0_2.onCreate(v3_3);\n      v3_3.execSQL(&quot;insert into shareKey(keyStr) values(\\&quot;&quot; + v0_2.S[5] + &quot;\\&quot;)&quot;);\n      v3_3.execSQL(&quot;insert into shareKey(keyStr) values(\\&quot;&quot; + v0_2.S[6] + &quot;\\&quot;)&quot;);\n      Log.i(&quot;KeyDistribution:&quot;, &quot;database store 2keys success! &quot;);\n      while(v2 &lt; 7) &#123;\n          StringBuilder v0_3 &#x3D; this.h0;\n          v0_3.append(&quot;output&quot;);\n          int v1_5 &#x3D; v2 + 1;\n          v0_3.append(v1_5);\n          v0_3.append(&quot;: &quot;);\n          v0_3.append(v9_3[v2]);\n          v0_3.append(&quot;\\n&quot;);\n          v2 &#x3D; v1_5;\n      &#125;\n  &#125;\n\nä»”ç»†å‘ç°ï¼Œè¿™ç©æ„æ ¸å¿ƒè¿˜æ˜¯åœ¨äºæ‰¾å‡ºkeyå¯¹å§ï¼Œæ¯•ç«Ÿaes å¯¹ç§°åŠ å¯†ï¼Œæ‹¿åˆ°keyå°±å¯ä»¥è§£å¯†ï¼Œåœ¨åé¢çš„è§£å¯†å‡½æ•°ä¹Ÿæœ‰ä½“ç°ï¼Œè¿™ä¸€å¤§å †æ•°æ®ï¼Œåœ¨ç»è¿‡shitçš„è®¡ç®—ï¼Œå‘ç°æœ€ç»ˆæŠŠkeyè¿˜åŸå‡ºæ¥çš„ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåé¢ç™½å«–æ¥å£æ˜¯æ²¡æ¯›ç—…çš„ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬åªéœ€è¦å»è§£æ–¹ç¨‹ï¼Œ7ä¸ªæ–¹ç¨‹ï¼Œè§£4ä¸ªæœªçŸ¥æ•°ï¼Œç»°ç»°æœ‰ä½™ï¼Œè§£æ–¹ç¨‹ï¼Œz3å¿…é¡»å¾—å®‰æ’ä¸€æ‰‹ï¼Œæˆ‘å‘ç°z3è¿™ä¸œè¥¿æ˜¯çœŸå¥½ç”¨ï¼Œå°¤å…¶æ˜¯é‚£ç§ä¸å¯é€†çš„ï¼Œç”¨æ–¹ç¨‹çº¦æŸè§£ï¼Œæ˜¯çœŸçš„é¦™ã€‚è´´ä¸‹exp\nfrom z3 import *\nfrom Crypto.Util.number import long_to_bytes\n&#39;&#39;&#39;encString:-7821488970927517137_qaoNj5jP05riAKvxmIju6o3tg90BdCcAlBkGtP&#x2F;x4rlJGUtVwBJY+5LlhPO3YRjP\n\noutput1:8885_37582432166857160353847123081\noutput2:9640_37582432426358548450758074236\noutput3:24762_37582451494960253781775215346\noutput4:51615_37582614757994549493283390711\noutput5:31533_37582473078165981182199222865\noutput6:63809_37582777982366357470099779581\noutput7:3560_37582431290919704469684029756&#39;&#39;&#39;\nt&#x3D;[8885,9640,24762,51615,31533,63809,3560]\ncmp_data&#x3D;[37582432166857160353847123081,37582432426358548450758074236,37582451494960253781775215346,37582614757994549493283390711,37582473078165981182199222865,37582777982366357470099779581,37582431290919704469684029756]\ns&#x3D;Solver()\nkey&#x3D;Int(&#39;key&#39;)\nv8_3&#x3D;[Int(&#39;v%d&#39;% i) for i in range(3)]\nfor i in range(7):\n    s.add(key+v8_3[0]*t[i]+v8_3[1]*t[i]**2+v8_3[2]*t[i]**3&#x3D;&#x3D;cmp_data[i])\nif s.check()&#x3D;&#x3D;sat:\n    print(s.model())\n    key &#x3D; s.model()[key].as_long()\n    print long_to_bytes(key)\n\n\n\n\npackage com.example.jm;\n\nimport androidx.appcompat.app.AppCompatActivity;\n\nimport android.content.Context;\nimport android.os.Bundle;\nimport android.util.Base64;\nimport android.widget.TextView;\n\nimport java.math.BigInteger;\nimport java.security.InvalidKeyException;\nimport java.security.Key;\nimport java.security.NoSuchAlgorithmException;\nimport java.security.SecureRandom;\nimport java.security.Security;\nimport java.security.spec.InvalidKeySpecException;\n\nimport javax.crypto.BadPaddingException;\nimport javax.crypto.Cipher;\nimport javax.crypto.IllegalBlockSizeException;\nimport javax.crypto.NoSuchPaddingException;\nimport javax.crypto.SecretKeyFactory;\nimport javax.crypto.spec.PBEKeySpec;\n\npublic class MainActivity extends AppCompatActivity &#123;\n\n    TextView textView;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) &#123;\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        textView&#x3D;findViewById(R.id.text1);\n        try &#123;\n            textView.setText(check());\n        &#125; catch (BadPaddingException e) &#123;\n            e.printStackTrace();\n        &#125; catch (IllegalBlockSizeException e) &#123;\n            e.printStackTrace();\n        &#125; catch (NoSuchPaddingException e) &#123;\n            e.printStackTrace();\n        &#125; catch (NoSuchAlgorithmException e) &#123;\n            e.printStackTrace();\n        &#125; catch (InvalidKeySpecException e) &#123;\n            e.printStackTrace();\n        &#125;\n    &#125;\n    public String check() throws BadPaddingException, IllegalBlockSizeException, NoSuchPaddingException, NoSuchAlgorithmException, InvalidKeySpecException &#123;\n        a.a &#x3D; new BigInteger(&quot;-7821488970927517137&quot;).toByteArray();\n        String v3_5&#x3D;&quot;qaoNj5jP05riAKvxmIju6o3tg90BdCcAlBkGtP&#x2F;x4rlJGUtVwBJY+5LlhPO3YRjP&quot;;\n        byte[] v1_1 &#x3D; Base64.decode(v3_5, 2);\n        Key v2_6 &#x3D; a.a(&quot;you_are_good&quot;);\n        Cipher v3_6 &#x3D; Cipher.getInstance(&quot;PBEWITHSHA256AND128BITAES-CBC-BC&quot;);\n        try &#123;\n            v3_6.init(2, v2_6);\n        &#125; catch (InvalidKeyException e) &#123;\n            e.printStackTrace();\n        &#125;\n        return new String(v3_6.doFinal(v1_1));\n    &#125;\n\n&#125;\n&#x2F;* class a &#123;\n    public static byte[] a &#x3D; null;\n    public static int b &#x3D; 10;\n\n    public a(Context arg2) &#123;\n        this.a &#x3D; new SecureRandom().generateSeed(8);\n    &#125;\n\n    public static Key a(String arg4) throws NoSuchAlgorithmException, InvalidKeySpecException &#123;\n        PBEKeySpec v0 &#x3D; new PBEKeySpec(arg4.toCharArray(), a, 10000, 0x80);\n        return SecretKeyFactory.getInstance(&quot;PBEWITHSHA256AND128BITAES-CBC-BC&quot;).generateSecret(v0);\n    &#125;\n&#125;\n*&#x2F;\n\npackage com.example.jm;\n\nimport android.content.Context;\n\nimport java.security.Key;\nimport java.security.NoSuchAlgorithmException;\nimport java.security.SecureRandom;\nimport java.security.spec.InvalidKeySpecException;\n\nimport javax.crypto.SecretKeyFactory;\nimport javax.crypto.spec.PBEKeySpec;\n\npublic class a &#123;\n\n    public static byte[] a &#x3D; null;\n    public static int b &#x3D; 10;\n\n    public a(Context arg2) &#123;\n        this.a &#x3D; new SecureRandom().generateSeed(8);\n    &#125;\n\n    public static Key a(String arg4) throws NoSuchAlgorithmException, InvalidKeySpecException &#123;\n        PBEKeySpec v0 &#x3D; new PBEKeySpec(arg4.toCharArray(), a, 10000, 0x80);\n        return SecretKeyFactory.getInstance(&quot;PBEWITHSHA256AND128BITAES-CBC-BC&quot;).generateSecret(v0);\n    &#125;\n&#125;\n\n\n\n\nre1. easyreå°±ä¸æ”¾å›¾äº†ï¼Œå‡ºé¢˜äººæ•…æ„ä¿®æ”¹äº†elfæ–‡ä»¶çš„å­—æ®µå€¼ï¼Œå¯¼è‡´æ— æ³•è¿è¡Œï¼Œå°è¯•ä¿®æ”¹oepï¼Œå‘ç°è¿˜æœ‰æ®µé”™è¯¯ï¼Œæ‰€ä»¥å°±æ”¾å¼ƒäº†ï¼Œç¾¤é‡Œå¤§å“¥èŠåˆ°å’Œsctfçš„ä¸€é¢˜ç®—æ³•ä¸€æ ·ï¼Œæ‰¾åˆ°äº†é“¾æ¥ï¼Œç„¶åå‘ç°è¿™é“é¢˜æ ¹æœ¬å°±æ˜¯sctf orzçš„ç¼©å°ç‰ˆï¼ŒæŠŠdesåŠ å¯†çš„éƒ¨åˆ†å»æ‰äº†ï¼Œæ‰€ä»¥è¿expéƒ½æ˜¯å¯ä»¥ç™½å«–çš„ï¼Œä¸è¿‡è¿˜æœ‰ä¸€ä¸ªluaç¨‹åºï¼Œå‘ç°æ˜¯å…ˆè§£å¯†ï¼Œç„¶ååœ¨åé¢ç¨‹åºä¸­è°ƒç”¨äº†è¿™ä¸ªç®—æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„expè¿˜éœ€è¦å¾®è°ƒä¸€ä¸‹ï¼Œç›´æ¥ä»æŒ‡çº¹çˆ·é‚£é‡Œå«–ä¸€æ‰‹expï¼Œé­”æ”¹ä¸€ä¸‹ï¼Œç„¶åè®°å¾—çº¦æŸè¿˜è¦ç¡®ä¿æ˜¯asciiç ï¼Œå¦åˆ™è·‘å‡ºæ¥å°±æ˜¯ä¹±ç ,z3ç»å¯¹æ˜¯ä¸€ä¸ªçˆ†ç ´å¥½æ‰‹ï¼Œæœ€ç»ˆè½¬åŒ–æˆç­‰å¼å°±å¯ä»¥å¼€å§‹ä¹±æ€ï¼‰\nfrom z3 import *\n\ndest_enc&#x3D;[0x005B3600, 0x000000CB, 0x005B3422, 0x0000025D, 0x005B38EA, 0x00000F5B, 0x005B34F0, 0x00000057, 0x005B372A, 0x00000504, 0x005B3429, 0x00001365, 0x005B2542, 0x00000293, 0x005B35EA, 0x00000D6E, 0x005B3B2B, 0x00000697, 0x005B4282, 0x00000941, 0x005B33F9, 0x0000772B, 0x005B2839, 0x00000D8A, 0x005B3CFE, 0x00000861, 0x005B28BC, 0x00007710, 0x005B1224, 0x0000326E, 0x005B26AC, 0x00001DE8]\nfrom Crypto.Cipher import DES\nimport struct\nimport time\n\n\ndef Z3(xor_data, cmp_data):\n    s&#x3D;Solver()\n\n    flag &#x3D; [BitVec((&#39;x%d&#39; % i), 8) for i in range(32)]\n    xor_result &#x3D; [0 for i in range(64)]\n    for i in range(32):\n        for j in range(33):\n            a &#x3D; flag[i] ^ xor_data[j]\n            xor_result[i + j] +&#x3D; a\n            xor_result[i+j]&#x3D;(xor_result[i+j]^5977654)\n\n    for i in range(0, 32):\n        s.add(flag[i]&lt;&#x3D;127)\n        s.add(flag[i]&gt;&#x3D;32)\n        s.add(xor_result[i] &#x3D;&#x3D; cmp_data[i])\n\n    if s.check() &#x3D;&#x3D; sat:\n        model &#x3D; s.model()\n        str &#x3D; [chr(model[flag[i]].as_long().real) for i in range(32)]\n        print(&quot;&quot;.join(str))\n        time.sleep(5)\n        exit()\n    else:\n        print(&quot;unsat&quot;)\n\ndef myrandint( start,end,seed):\n    a&#x3D;32310901\n    b&#x3D;1729\n    rOld&#x3D;seed\n    m&#x3D;end-start\n    while True:\n        rNew&#x3D;int((a*rOld+b)%m)\n        yield rNew\n        rOld &#x3D; rNew\nif __name__ &#x3D;&#x3D; &quot;__main__&quot;:\n\n    for seed in range(0xfff):\n        xor_data &#x3D; []\n        # r &#x3D; myrandint(1, 255, 99)\n        r &#x3D; myrandint(1, 255, seed)\n        for i in range(33):\n            xor_data.append(next(r))\n        # r &#x3D; myrandint(1, 255, 99)\n\n        Z3(xor_data, dest_enc)\n\n2.  GOODREè¿™é¢˜ç®—æ¯”è¾ƒeasyä¸€ç‚¹çš„ï¼Œé‡ç‚¹åœ¨äºè¦åŠ¨è°ƒï¼Œå¤šé€†ï¼Œé™æ€åˆ†ææœ‰æ—¶å€™å¤´æ™•çš„è¯ï¼ŒåŠ¨è°ƒçœ‹æ±‡ç¼–ï¼Œå¾ˆå¿«ä¼šèµ°å‡ºå»å›°å±€ï¼Œç›´æ¥çœ‹æ³¨é‡Šå§\n\n\nå¾ˆæ˜æ˜¾çš„teaåŠ å¯†ï¼Œå°±ä¸å¤šbbäº†ï¼Œä¸€ä¸ªæ˜¯teaå¸¸æ•°ï¼Œç‰¹åˆ«æ³¨æ„å°±æ˜¯å¯†é’¥æ˜¯ç¡¬ç¼–ç çš„ï¼Œè¦è‡ªå·±æ ¹æ®ç®—æ³•æµç¨‹å»æ‰¾å°±è¡Œäº†ï¼Œå…¶ä»–æ²¡ä»€ä¹ˆå¥½è¯´çš„\n","slug":"æ´¥é—¨æ¯2021-wp","date":"2021-05-10T02:48:37.000Z","categories_index":"writeup","tags_index":"reverse","author_index":"YenKoc"},{"id":"65a729b015fbeb895e9e3c25a8f4953e","title":"è®°å½•ä¸‹ä¿®æ”¹smailçš„éªšæ“ä½œä»¥åŠå¦‚ä½•é‡æ‰“åŒ…","content":"å‰è¨€åœ¨è¢«å„ç§çš„é‡æ‰“åŒ…å·¥å…·æŠ˜ç£¨ä¹‹åï¼Œç¾¤é‡Œå¤§ä½¬æ¨èæˆ‘çœ‹çœ‹çæƒœå“¥çš„è§†é¢‘å­¦å­¦ï¼Œè¿™è‚¯å®šå¾—å†²äº†å‘€ï¼Œçœ‹äº†ä¸€å°æ—¶ï¼Œçœ‹å®Œäº†ï¼Œæ„Ÿè§‰å­¦åˆ°ä¸€ç‚¹éªšæ“ä½œï¼ŒæŒºå¥½ç©çš„ï¼Œå°±è®°å½•ä¸‹\nsmailçš„ä¿®æ”¹åœ¨patch javaå±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯å»åç¼–è¯‘apkï¼Œç„¶åå»ä¿®æ”¹smailï¼Œä¹‹åå†é‡æ–°ç¼–è¯‘æ‰“åŒ…ç­¾åï¼Œå¾—æŠŠå‡ ä¸ªè¿‡ç¨‹åˆ†å¼€æ¥çœ‹\nåç¼–è¯‘è¿™é‡Œæˆ‘ä¹‹å‰å°±ç”¨androidkillerå’Œapkæ”¹ä¹‹ç†ï¼Œæ¥å‘ç¼–è¯‘ï¼Œä½†æ˜¯æœ€è¿‘å‘ç°åç¼–è¯‘æ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯å¥½å®¶ä¼™ï¼Œæ‰“åŒ…çš„æ—¶å€™ä¼šæŠ¥é”™ï¼ŒæŸ¥é˜…äº†ä¸‹èµ„æ–™ï¼ŒåŸæ¥æ˜¯jdk14ä»¥ä¸Šï¼Œé»˜è®¤ç­¾åæ˜¯ä½¿ç”¨jdkå»ç­¾åçš„äº†ï¼Œä¸ä½¿ç”¨apktoolsäº†ï¼Œæ‰€ä»¥æˆ‘å¦å¤–ä¸‹äº†ä¸€ä¸ªjdk8ï¼Œå•ç‹¬è®¾ç½®äº†è·¯å¾„ï¼Œè¿™ä¸ªé—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯æœ‰äº›apkï¼Œé‡æ‰“åŒ…è¿˜æ˜¯ä¼šå‡ºç°é—®é¢˜ï¼‰ï¼Œè¿™é‡Œè¯´åäº†ï¼‰ï¼Œè¯´å›æ¥ï¼Œçæƒœå¸ˆå‚…æ¨èæ˜¯androidé€†å‘åŠ©æ‰‹ï¼Œæˆ‘ä¸‹äº†ä¸€ä¸ªï¼Œç•Œé¢æ¯”è¾ƒç®€æ´\n\nè¿™é‡Œæˆ‘ä¸»è¦æ˜¯ç”¨æ¥åç¼–è¯‘dexçš„ã€‚è‡³äºä¸ºä»€ä¹ˆä¸æ˜¯æ•´ä¸ªapkï¼Œä¸‹é¢ä¼šè¯´\nä¿®æ”¹smailå…ˆå†™ä¸ªdemo\npackage com.example.smailtest;\n\nimport androidx.appcompat.app.AppCompatActivity;\n\nimport android.os.Bundle;\nimport android.widget.TextView;\n\npublic class MainActivity extends AppCompatActivity &#123;\n\n    TextView tv;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) &#123;\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        tv&#x3D;findViewById(R.id.tvt);\n        tv.setText(Test.getXx());\n    &#125;\n&#125;\n\npackage com.example.smailtest;\n\npublic class Test &#123;\n    public static int xx&#x3D;2;\n    public static int getXx()\n    &#123;\n        return xx;\n    &#125;\n\n&#125;\n\nå°†ç”Ÿæˆçš„apkï¼Œå¼„å‡ºæ¥ï¼Œåç¼–è¯‘\n\næ‰“å¼€Test.smailæ–‡ä»¶ï¼Œè®°äº‹æœ¬æ°¸è¿œçš„ç¥\n\nè¯­æ³•éå¸¸ç®€å•ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘æƒ³è¦ä¿®æ”¹getXx()æ–¹æ³•çš„è¿”å›å€¼çš„ï¼Œæˆ–è€…æ€ä¹ˆä¿®æ”¹ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯è¦æŒ‰ç…§æ‰‹å†Œä¸€è¡Œä¸€è¡Œå†™çš„å‘¢ï¼Œè‚¯å®šä¸æ˜¯çš„ï¼Œçæƒœè¡¨å“¥ï¼Œæäº†ä¸€ä¸ªéªšæ“ä½œï¼Œå°±æ˜¯æŠŠjebåç¼–è¯‘å¥½çš„ï¼Œä»£ç ç›´æ¥æŠ„ä¸€ä»½åˆ°androidstudioä¸­ï¼Œç„¶åæˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨æ”¹å¥½é€»è¾‘åï¼Œåˆ©ç”¨java2smailè½¬æ¢æˆsmailæ–‡ä»¶ï¼Œä¸å°±ç›´æ¥æ¥è¿‘äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœäº†å—ï¼Œ2333ï¼Œåˆ°æ—¶å€™å¯„å­˜å™¨æœ‰ç‚¹å˜åŒ–ï¼Œä¸ç”¨ç®¡ï¼Œæ‰‹åŠ¨è°ƒæ•´è¿‡æ¥å°±å¥½äº†\npackage com.example.smailtest;\n\npublic class Test &#123;\n    public static int xx&#x3D;2;\n    public static int getXx()\n    &#123;\n        return 100000;\n    &#125;\n\n&#125;\n\n\n\n\næŠ„ä¸‹æ¥ï¼Œæ˜¯è¿™æ ·çš„ï¼Œç„¶åä¿®æ”¹äº†ä¸€æ‰‹ï¼Œä¹‹åå¤§æ¦‚æ˜¯æˆ‘æƒ³è¦çš„æ•ˆæœã€‚ç„¶åè½¬æ¢æˆsmail\n\nç›´æ¥copyåˆ°æˆ‘ä»¬çš„smailæ–‡ä»¶ä¸­ï¼Œåˆ©ç”¨é€†å‘åŠ©æ‰‹ï¼Œé‡æ–°ç¼–è¯‘æˆdex\né‡æ‰“åŒ…æ‰“åŒ…ä¸ä¸€å®šéè¦ä½¿ç”¨ä¹‹å‰é‚£ç§androidkillerå’Œæ”¹ä¹‹ç†æ•´ä½“apkç¼–è¯‘é‡æ‰“åŒ…çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠapkçœ‹æˆzipï¼Œç„¶åæŠŠæˆ‘ä»¬ä¿®æ”¹ç¼–è¯‘åçš„dexï¼Œæ›¿æ¢åŸæ¥çš„dexï¼Œç„¶åä¿®æ”¹åç¼€ä¸ºapkï¼Œè¿™æ—¶å€™æˆ‘ä»¬åªéœ€è¦ç­¾åå°±å®Œäº‹äº†\n\né‡æ–°ç­¾åï¼Œè¿™é‡Œé€‰æ‹©mtç®¡ç†å™¨çš„é‡æ‰“åŒ…ç­¾åï¼Œéå¸¸çš„ç¨³ï¼Œç‰›é€¼ï¼Œè¿™é‡Œç›´æ¥æ‰‹æœºä¸Šæ“ä½œå°±å®Œäº‹äº†ï¼Œå“¦å¯¹ï¼Œæ”¯æŒæ­£ç‰ˆå“¦ï¼Œ\nç­¾ååï¼Œæ­£å¸¸è¿è¡Œï¼Œæå®šï¼Œå˜¿å˜¿\n","slug":"è®°å½•ä¸‹ä¿®æ”¹smailçš„éªšæ“ä½œä»¥åŠå¦‚ä½•é‡æ‰“åŒ…","date":"2021-05-06T09:20:45.000Z","categories_index":"å®‰å“å°æŠ€å·§","tags_index":"reverse","author_index":"YenKoc"},{"id":"b380b394179f19e6fa4ccc3b184ec926","title":"ISCCæŸå®‰å“é¢˜","content":"å£è¿°ä¸‹:ctfçš„å®‰å“é¢˜ï¼Œä¸èƒ½ä»¥å®æˆ˜çš„è§’åº¦å»é€†äº†ï¼Œæ¯•ç«Ÿä»ctfè§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯æœ€çŸ­æ—¶é—´æ‹¿åˆ°flagï¼Œè€Œä¸æ˜¯æŠŠæ•´ä½“appä»£ç å…¨éƒ¨åˆ†æå‡ºæ¥ï¼Œæ˜¨æ™šç¡å‰ï¼Œå¤§æ¦‚çœ‹äº†ä¸‹æ–‡ä»¶å°±ç¡äº†ï¼Œæ—©ä¸ŠæŠŠé€»è¾‘ç†äº†ä¸‹ï¼Œå°±å¼€å§‹äº†ï¼Œé¦–å…ˆæ˜¯java2cï¼Œè¿™ä¸ªé—®é¢˜ï¼Œå…¶å®å°±æ˜¯å’Œjavaå±‚çš„ä»£ç ä¸€æ ·ï¼Œä¸è¿‡æ˜¯å†™åœ¨ndkä¸­çš„ï¼Œæ ·å­æ¯”è¾ƒä¸‘ï¼Œå’Œåå°„é•¿çš„å·®ä¸å¤šï¼Œå¯ä»¥å»hook artï¼Œä¹Ÿå¯ä»¥ç›´æ¥çœ‹é€»è¾‘ï¼Œæˆ‘ç”¨äº†ä¸‹æ¨ç¥çš„è½®å­ï¼Œå¤§æ¦‚æ‰“å°äº†ä¸‹ï¼Œå‘ç°æµç¨‹æ˜¯æ­£å¸¸ï¼Œä¸è¿‡è¿™æ ·å…¶å®ä¹Ÿåäº†ï¼Œå°±ç®—å‰æœŸæŠŠä¸€äº›æ•°å‰§æ”¹äº†ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œåæ­£åæœŸæˆ‘ä»¬ç”¨çš„æ˜¯æ”¹å®Œä¹‹åçš„æ•°æ®å»è·å¾—flagçš„ï¼Œæ‰€ä»¥æ ¹æœ¬ä¸éœ€è¦åœ¨æ„ä»–æ€ä¹ˆæ”¹ï¼Œå«–å°±å®Œäº‹äº†ï¼Œç›´æ¥å®šä½åˆ°ç‚¹å‡»äº‹ä»¶ï¼Œonclickæ–¹æ³•ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œç›´æ¥è·Ÿè¿›å»ï¼Œå‘ç°è¿™é‡Œå°±æ˜¯æ ¸å¿ƒé€»è¾‘ï¼Œä¸è¿‡å…ˆè°ƒç”¨äº†ä¸€ä¸ªcheck1æ–¹æ³•ï¼Œè·Ÿè¿›å»ï¼Œå‘ç°æ˜¯ollvm è™šå‡æ§åˆ¶æµï¼Œçœ‹äº†ä¸‹æ··æ·†æ¯”è¾ƒè½»ï¼Œç›´æ¥æ‰‹è°ƒï¼Œå‘ç°å°±æ˜¯ä¸€ä¸ªéªŒè¯codeé•¿åº¦æ˜¯ä¸æ˜¯ä¸º6ï¼Œç»„æˆæ˜¯ä¸æ˜¯åªæœ‰å°å†™çš„å­—æ¯ï¼Œç„¶åç»§ç»­ä¸‹ä¸€æ­¥ï¼Œå°±æ˜¯æ­£å¼è°ƒè¯•ï¼Œå‘ç°å…ˆç»è¿‡ä¸€ä¸ªmd5åŠ å¯†ï¼Œç„¶åæ¯ä¸ªå­—èŠ‚æ¯4ä½å¼€å§‹è½¬æ¢æˆå­—ç¬¦ï¼Œå…¶å®å°±æ˜¯md5æˆ32ä½çš„å­—ç¬¦ä¸²ï¼Œç„¶åç»è¿‡ä¸€ä¸ªç­‰å¼ï¼Œæ¥åˆ¤æ–­codeæ˜¯å¦æ­£ç¡®ï¼Œçœ‹äº†ä¸‹ä¸å¯é€†ï¼Œä¸è¿‡æ˜¯å¯ä»¥ç›´æ¥çˆ†ç ´çš„ï¼Œå†™expå¼€å§‹è·‘\nimport hashlib\n\ntt&#x3D;&quot;&quot;\nflag&#x3D;&quot;abcdefghijklmnopqrstuvwxyz&quot;\nv35&#x3D;0\nfor a in range(26):\n    for b in range(26):\n        for c in range(26):\n            for d in range(26):\n                for e in range(26):\n                    for f in range(26):\n                        #tt+&#x3D;\n                        m &#x3D; hashlib.md5()\n                        tt&#x3D;flag[a]+flag[b]+flag[c]+flag[d]+flag[e]+flag[f]\n                        m.update(bytes(tt, encoding&#x3D;&quot;utf8&quot;))\n                        res&#x3D;m.hexdigest()\n                        v33&#x3D;0\n                        v34&#x3D;0\n\n                        for yk in range(len(res)):\n                            if ord(res[yk])&#x3D;&#x3D;48:\n                                v35&#x3D;yk\n                            else:\n                                v35&#x3D;0\n                            if ord(res[yk])&#x3D;&#x3D;48:\n                                v33+&#x3D;1\n                            v34+&#x3D;v35\n                        if v34+10*v33&#x3D;&#x3D;403:\n                            print(&quot;right!:&quot;+tt)\n                            exit(0)\n                        else:\n                            print(&quot;wrong answer:&quot;+tt)\n                        tt&#x3D;&quot;&quot;\n\nè¿™é‡Œæ³¨æ„hashlib.md5()è¿™ä¸ªæ–¹æ³•ï¼Œæ¯æ¬¡åªè°ƒç”¨ä¸€æ¬¡ï¼Œå¦åˆ™ä¼šä¸€ç›´å˜åŠ¨ï¼Œä¹‹å‰è·‘äº†ä¸€æ¬¡ï¼Œä½†æ˜¯æ²¡è·‘å‡ºæ¥ï¼Œè°ƒè¯•äº†ä¸‹æºç¨‹åºï¼Œå‘ç°äº†è¿™ä¸ªé—®é¢˜ï¼Œæ”¹è¿‡æ¥åï¼Œç›´æ¥å°±å¯ä»¥è·‘å‡ºæ¥äº†ï¼Œå¤§æ¦‚3ä¸ªå°æ—¶ï¼Œ\n\nç„¶åæ¥ä¸‹æ¥å°±æ˜¯ç”¨codeä¸­çš„ä¸€äº›å­—ç¬¦ä½œä¸ºä¼ªéšæœºçš„ç§å­ï¼Œä¹‹å‰ä»¥ä¸ºæ˜¯å‰4ä½ï¼Œè°ƒè¯•åï¼Œå‘ç°ä¸æ˜¯ï¼Œä¸è¿‡å’Œæˆ‘ä»¬è¾“å…¥çš„flagæ²¡å…³ç³»ï¼Œé‚£ä¹ˆè¯´æ˜æ˜¯è·Ÿç€codeå˜åŒ–ï¼Œcodeçš„æ­£ç¡®ï¼Œå€¼ä¹Ÿå¿…ç„¶å¯¹ï¼Œç›´æ¥dumpä¸‹æ¥ï¼Œå°±å®Œäº‹äº†ï¼Œå†™ä¸ªexpï¼Œæå®š\nimport java.util.Random;\n\npublic class getFlag &#123;\n    public static void main(String[] args) &#123;\n        String test&#x3D;&quot;ozulmt&quot;;\n        char[] tt&#x3D;new char[]&#123;&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;&#125;;\n        int v49&#x3D;test.charAt(0);\n        int v50&#x3D;test.charAt(1);\n        int v51&#x3D;test.charAt(2);\n        int v52&#x3D;test.charAt(3);\n        System.out.println(v49);\n        Random rd&#x3D;new Random(0xcc18);\n        StringBuilder sb&#x3D;new StringBuilder();\n        for(int w&#x3D;0;w&lt;32;w++)\n        &#123;\n           sb.append(tt[rd.nextInt(16)]);\n        &#125;\n        System.out.println(sb.toString());\n\n    &#125;\n&#125;\n\n6ab457d7223583baa46d8b2cb1c3c406\ncodeå’Œflagæ­£ç¡®è¾“å…¥ï¼Œå‘ç°å¼¹å‡ºISCC{6ab457d7223583baa46d8b2cb1c3c406}ï¼Œç»“æŸï¼Œæ€»ä½“å‡ºçš„è¿˜è¡Œ\n","slug":"ISCCæŸå®‰å“é¢˜","date":"2021-05-02T11:56:33.000Z","categories_index":"writeup","tags_index":"reverse","author_index":"YenKoc"},{"id":"ab7fd6f31dafc73ffe830b8abfe31bb7","title":"è‚‰ä¸çš„ä»»åŠ¡ç½¢äº†","content":"ç¬¬ä¸€é“é¢˜\né€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯è¾“å…¥ä¸€ä¸ªusernameï¼Œç„¶åç»è¿‡ä¸€ä¸ªnativeå‡½æ•°ï¼Œå’Œå­—ç¬¦ä¸²åšå¯¹æ¯”\n\nè°ƒç”¨äº†ä¸€ä¸ªbase64ï¼Œ\n\nç¬¬äºŒé¢˜å’Œç¬¬ä¸€é¢˜javaå±‚é€»è¾‘å·®ä¸å¤šï¼Œç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œå¤§æ¦‚å°±æ˜¯æ•°å­—å…ˆmd5åŠ å¯†ï¼Œç„¶ååŸæ•°å­—ç»è¿‡ä¸€ä¸ªaes-cbcåŠ å¯†ï¼Œå’Œmd5åŠ å¯†åçš„è¿›è¡Œæ‹¼æ¥ï¼Œè¿›è¡Œä¸€æ³¢å¯¹æ¯”ã€‚cbcçš„åŠ å¯†é€»è¾‘çœ‹äº†æŒºä¹…ï¼Œæˆ‘ä»¥ä¸ºæœ‰é­”æ”¹ï¼Œçœ‹äº†ä¸‹é€»è¾‘å¹¶æ²¡æœ‰ï¼Œç›´æ¥hookä¸‹å‡½æ•°ï¼ŒæŠŠkeyå’Œiv dumpä¸‹æ¥ï¼Œè§£å¯†å°±å®Œäº‹äº†\n\nfunction aa()&#123;\n    var moudle&#x3D;Process.findModuleByName(&quot;libroysue.so&quot;);\n    var hoofunc&#x3D;ptr(moudle.base).add(0x341e8);\n    Interceptor.attach(hoofunc,&#123;\n        onEnter:function(args)&#123;\n            console.log(&quot;key:&quot;,Memory.readPointer(ptr(args[3]),16));\n            console.log(&quot;content:&quot;,Memory.readCString(args[3]),16);\n            console.log(&quot;iv:&quot;,Memory.readCString(args[4]));\n\n        &#125;,onLeave:function(retval)\n        &#123;\n\n\n        &#125;\n    &#125;)\n&#125;\nsetImmediate(aa);\n\n\nç¬¬ä¸‰é¢˜å’Œç¬¬äºŒé¢˜ä¸€æ ·çš„é€»è¾‘ï¼Œåªæ˜¯åŠ äº†ä¸€äº›åè°ƒè¯•ï¼Œä¸è¿‡ç¡®å®å¤ªé¸¡è‚‹äº†ï¼Œè¿™æ³¢æˆ‘é™æ€å°±èƒ½æäº†ï¼Œç”šè‡³ä¸‰ä¸ªå‡½æ•°å…¨nopé‡æ‰“åŒ…ï¼Œä¸€ä¸ªæ˜¯æ£€æµ‹è°ƒè¯•å»çš„ï¼Œçœ‹traceidï¼Œä¸€ä¸ªæ˜¯çœ‹æ‰‹æœºå‹å·ï¼Œä¸€ä¸ªæ˜¯æ£€æµ‹aospï¼Œhhï¼Œfridaä¸€æŠŠæ¢­ä¹Ÿå¯ä»¥ã€‚\n\nå…¶ä»–ç¡®å®æ²¡å•¥å¥½è¯´çš„ï¼Œå¼ºåº¦ä¸å¤Ÿé«˜ï¼Œç®—æ³•ä¸å¤Ÿå¤æ‚\n","slug":"è‚‰ä¸çš„ä»»åŠ¡ç½¢äº†","date":"2021-04-25T14:03:22.000Z","categories_index":"writeup","tags_index":"reverse","author_index":"YenKoc"},{"id":"92105b8d45b62e5c37b36b7d4a309a89","title":"2021HWçš„ä¸ªäººæ€»ç»“","content":"1.hwç»™æˆ‘å¸¦æ¥ä»€ä¹ˆï¼Ÿâ€‹     é¦–å…ˆï¼Œæˆ‘ä»Šå¹´èƒ½æ¥æŠ¤ç½‘çœŸçš„ç®—æ˜¯æˆ‘çš„è¿æ°”äº†ï¼Œè‡³äºä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Œå› ä¸ºåœ¨é¢è¯•è¿™ä¸ªéƒ¨é—¨çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®é‡åˆ°äº†ä¸€äº›æ’æ›²ï¼Œåœ¨ä¸€é¢çš„æ—¶å€™ï¼Œå›ç­”çš„è¿˜ç®—å®Œç¾ï¼Œä¹‹å‰è·Ÿç€æ¨±èŠ±å¸ˆå‚…å†™çš„oså’Œcsapp labè¿˜æ˜¯æœ‰å°è±¡çš„ï¼Œåœ¨äºŒé¢çš„æ—¶å€™ï¼Œå°±å¼€å§‹å´©äº†ï¼Œé—®äº†å¾ˆå¤šå®‰å“å¼€å‘çš„é—®é¢˜ï¼Œç„¶è€Œæˆ‘è¿™é‡Œå¾ˆä¹…æ²¡æœ‰å»ç†Ÿæ‚‰å¼€å‘çš„çŸ¥è¯†ï¼Œå¯¼è‡´å¾ˆå¤šé—®é¢˜æ²¡æœ‰å›ç­”ä¸Šï¼Œæˆ‘å¯¹è‡ªå·±éƒ½å¾ˆä¸æ»¡æ„ï¼Œäºæ˜¯åœ¨å¯’å‡çš„æ—¶å€™åˆé‡æ¸©äº†å®‰å“å¼€å‘ï¼‰ï¼Œè¿™ä¸ªæ˜¯åè¯äº†ï¼Œä¼°è®¡æ˜¯äºŒé¢æœ‰ç‚¹ç‚¸ï¼Œæ‰€ä»¥å®‰æ’äº†ä¸€ä¸ªæ€»ç›‘é¢ï¼Œå’Œå•è€å¤§åŠ ä¸Šäº†å¾®ä¿¡ï¼Œæˆ‘ä»¬ç›´æ¥å¼€å§‹äº†é¢è¯•ï¼Œæˆ‘å¤§è‡´ä»‹ç»äº†æˆ‘çš„æƒ…å†µï¼Œç„¶åèŠäº†ä¸€äº›æŠ€æœ¯æ–¹é¢çš„é—®é¢˜ï¼Œåé¢åˆèŠäº†ä¸‹æˆ‘æ˜¯ä¸ºä»€ä¹ˆåœ¨å­¦æ ¡æ²¡äººå­¦å®‰å…¨çš„æƒ…å†µä¸‹ä¾æ—§æƒ³ä»äº‹å®‰å…¨çš„ï¼Œä»¥åŠç»„å»ºå®‰å…¨å®éªŒå®¤çš„äº‹ï¼Œæˆ‘å°±å¦‚å®å›ç­”çš„äº†ï¼Œå…¶å®è‡ªå·±ä¹Ÿæ²¡æƒ³é‚£ä¹ˆå¤šï¼Œæˆ‘åªè§‰å¾—å®‰å…¨å¾ˆæœ‰æ„æ€ï¼Œå®ƒä¸ºæˆ‘æ‰“å¼€äº†ä¸€ä¸ªæ–°ä¸–ç•Œï¼ŒåŒæ—¶èƒ½æœ‰æˆå°±æ„Ÿå§ï¼Œå¯èƒ½æ˜¯æˆ‘æ¯å¤©çš„æ—¥æŠ¥å’Œæˆ‘çš„çœŸè¯šï¼Œæ‰“åŠ¨äº†å•è€å¤§ï¼Œé¢å®Œä¹‹åï¼Œluluè¯´è€å¤§å¾ˆæ¬£èµæˆ‘å¯¹æŠ€æœ¯çš„çƒ­æƒ…ï¼Œæˆ‘ä¹Ÿæ„Ÿè§‰åˆ°å¾ˆæƒŠå–œï¼Œåé¢ä¹Ÿå’Œæˆ‘é¢„æƒ³çš„ä¸€æ ·ï¼Œæˆ‘é¢è¯•é€šè¿‡äº†ï¼Œä½†æ˜¯æˆ‘ä¸æ•¢æ¾æ‡ˆï¼Œæˆ‘è§‰å¾—æŠ€æœ¯ä¸èƒ½åªé çƒ­æƒ…ï¼Œè¿˜æ˜¯éœ€è¦å®åŠ›è¯´è¯ï¼Œæ‰€ä»¥å°±å¼€å§‹è®¤çœŸæèµ·äº†å®æˆ˜ï¼Œä»å¼€å§‹å®ä¹ åˆ°ç°åœ¨ï¼Œæ”¶è·ä¸å°‘ï¼ŒåŒäº‹ä»¬ä¹Ÿéå¸¸niceï¼ŒæŠ€æœ¯ä¹Ÿæå‡äº†ä¸å°‘ï¼Œå¥½åƒå†™åäº†ï¼‰ï¼Œç»§ç»­å›å½’ï¼Œæ€»ä½“æ¥è¯´è¿™æ¬¡hwï¼Œè‡ªå·±åœ¨ç§»åŠ¨ç«¯æ²¡æœ‰ç»™å›¢é˜Ÿç»™æ¥ä»€ä¹ˆæ”¶ç›Šåˆ†ï¼Œè™½ç„¶å°å¼ºå“¥ä¹Ÿç»™æˆ‘ä»¬å‡ ä¸ªappåˆ†æï¼Œå¯æ˜¯é€†å®Œï¼Œå‘ç°ä¼¤å®³æ€§ä¸å¤§ï¼Œmmpï¼Œç”šè‡³å¯ä»¥ä¼ªé€ ä»¤ç‰Œç™»å½•ï¼Œæ²¡å•¥å¤§ç”¨ï¼Œä½†æ˜¯å‘ç°ç§‘æ©é‚£è¾¹æœ‰ç”¨è¿™ä¸ªappçš„é€»è¾‘æ´æ‰“è¿›é‚®ç®±çš„ï¼Œå¿ƒç†å°±æœ‰ç‚¹éš¾å—ï¼Œå› ä¸ºé‚£ä¸ªé€»è¾‘æ´æ˜¯éœ€è¦ç”¨æˆ·idçš„ï¼Œæˆ‘ä»¬æ„è¯†åˆ°äº†ï¼Œä½†æ˜¯æ²¡å·å•Šï¼Œè¿™éœ€è¦æ•°æ®åº“çš„è´¦å·æ‰èƒ½åšåˆ°ï¼Œæ‰€ä»¥è¯´webçˆ·çˆ·æ²¡è¿›å±•çš„è¯ï¼Œæˆ‘ä»¬å‡ ä¹å°±æ²¡å•¥è¾“å‡ºï¼Œåé¢å°±æ˜¯å¯¹ç€å‡ ä¸ªappçš„æ¥å£ï¼Œå„ç§å°è¯•ï¼Œç„¶è€ŒæœåŠ¡å™¨é‚£è¾¹æƒé™ä¸€ç›´å…³é—­ï¼Œæˆ‘ä»¬æ™®é€šç”¨æˆ·æƒé™ä¸€ç‚¹æœºä¼šéƒ½æ²¡æœ‰ï¼‰ï¼Œæ‰€ä»¥å°±å¾ˆå°´å°¬ï¼Œåé¢å°±è®¤æ¸…è‡ªå·±çš„å®šä½äº†ï¼Œå“ªé‡Œéœ€è¦æˆ‘ï¼Œæˆ‘å°±å»å“ªï¼Œæ‰“è¾…åŠ©è¿™ä¸ªæˆ‘åœ¨è¡Œï¼Œå°±ä¸€ç›´å¸®å°å¼ºå“¥ç¿»æ•°æ®ï¼Œæåˆ°äº†å¾ˆä¸é”™çš„æ•°æ®ï¼Œå˜¿å˜¿ï¼Œç®—æ˜¯æ¬£æ…°äº†ï¼Œæœ€åä¸€æ®µæ—¶é—´ï¼Œå°±æ˜¯å¸®ç€æ˜†å“¥ææŠ¥å‘Šäº†ï¼Œåœ¨ææŠ¥å‘Šçš„è¿‡ç¨‹ä¸­ï¼Œçœ‹åˆ°äº†webçˆ·çˆ·ä»¬çš„æŠ¥å‘Šï¼Œæ„Ÿè§‰åˆ°å¾ˆå‰å®³ï¼Œè‡ªå·±ä¹Ÿå­¦åˆ°ä¸€äº›æ¸—é€çš„æ€è·¯ï¼Œè™½ç„¶æˆ‘è¿™æ–¹é¢å¼±çš„ä¸€ï¼Œhhï¼Œä½†æ˜¯æˆ‘è§‰å¾—æŠ€æœ¯ä¸èƒ½å—é™åˆ¶ï¼Œè¦å¤šå»å­¦ä¹ å’Œæ¥å—ï¼Œè¿™æ ·æ‰èƒ½èµ°çš„æ›´è¿œï¼ä¸Šé¢é‚£ä¹ˆå¤šåºŸè¯ï¼Œæ ¸å¿ƒå°±æ˜¯æ‰“å¼€äº†è‡ªå·±çš„æ€è·¯ï¼Œæ¶¨äº†è§è¯†ï¼Œçœ‹åˆ°äº†å¤§å‚çš„å›¢é˜Ÿåä½œæ¨¡å¼ï¼Œè¿™äº›éƒ½æ˜¯å®è´µçš„äººç”Ÿç»å†ï¼Œæ„Ÿè°¢å•è€å¤§ï¼Œæ„Ÿè°¢æ˜å“¥ï¼Œä¹Ÿæ„Ÿè°¢é‚£ä¸ªä¸è‚¯æ”¾å¼ƒçš„è‡ªå·±ã€‚\n2. æ„å¤–ä¹‹å–œè¿™å‡ å¤©æˆ‘è§åˆ°äº†è‡ªå·±çš„å¶åƒï¼Œå¤œå½±å¤§å“¥ï¼Œä»–å¯¹æˆ‘çš„æ•´ä¸ªctfç”Ÿæ¶¯å½±å“å¾ˆå¤§ï¼Œå¯ä»¥è¯´å°±æ˜¯çœ‹å¤œå½±å¤§å“¥çš„åšå®¢å…¥é—¨çš„ï¼Œä»¥åŠåé¢åœ¨è¿·èŒ«ä¸­ï¼Œå¤œå½±å¤§å“¥ä¹Ÿç»™äº†æˆ‘å¾ˆå¤šæ„è§ï¼Œæˆ‘çœŸçš„éå¸¸æ„Ÿè°¢ä»–ï¼Œè¿™æ¬¡hwï¼Œæˆ‘æ²¡æƒ³åˆ°ä»–ä¹Ÿåœ¨ï¼Œhwå‰å‡ å¤©æˆ‘è¿˜ä¸è®¤è¯†å·è€æ¿ï¼ŒçŸ¥é“2stæŠŠç…§ç‰‡å‘ç»™æˆ‘çœ‹ï¼Œæˆ‘æ‰çŸ¥é“æ˜¯å·è€æ¿ï¼Œè¿›è€Œåˆ¤æ–­äº†ä¸‹å¤œå½±è¯´ä¸å®šä¹Ÿåœ¨ï¼Œè¯•æ¢æ€§çš„é—®äº†ä¸‹ï¼Œå±…ç„¶çœŸçš„åœ¨ï¼Œåé¢å°±çœŸçš„é¢åŸºäº†ï¼Œæ„Ÿè§‰æŒºä¸å¯æ€è®®çš„ï¼Œæ„Ÿè§‰å¤§ä½¬ä»¬éƒ½å¾ˆæœ‰äº²å’ŒåŠ›ï¼Œäººéƒ½å¾ˆä¸é”™ï¼Œå“ˆå“ˆã€‚\nä»Šæ™šç›´æ¥ç–¯äº†ï¼Œè§åˆ°äº†tkæ•™ä¸»ï¼Œè¿˜æ¡æ‰‹å¹¶åˆå½±äº†ï¼Œæ¿€åŠ¨ç‚¸äº†ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼\n3. æˆ‘æ¥ä¸‹æ¥è¦åšäº›ä»€ä¹ˆå‘¢ï¼Ÿç»§ç»­æŠŠåŸºç¡€ææ‰å®ï¼Œç„¶åæŠŠpcç¼ºçš„é‚£éƒ¨åˆ†è¡¥ä¸Šï¼Œpcçš„æ€æƒ³å¯¹å®‰å“çš„è¿›é˜¶å­¦ä¹ æ˜¯æœ‰å¾ˆå¤§å¥½å¤„çš„ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯æœ‰å¾ˆå¤šç›¸é€šçš„ç‚¹ï¼Œç„¶åå°±æ˜¯å¤šå®æˆ˜ï¼Œå¤šæŠŠè‡ªå·±å¹³å¸¸çš„æƒ³æ³•æŠ•å…¥å®è·µï¼Œå¤šé€†ï¼Œå¤šé—®ï¼ŒåŠ æ²¹ï¼ï¼\n","slug":"2021HWçš„ä¸ªäººæ€»ç»“","date":"2021-04-22T17:50:06.000Z","categories_index":"æ€»ç»“","tags_index":"æ€»ç»“","author_index":"YenKoc"},{"id":"17e7f940452dda42feb97fd742be4e95","title":"DDCTF é»‘ç›’ç ´è§£","content":"å‰è¨€æœ€è¿‘åœ¨å‡ºæ ¡èµ›çš„é¢˜ï¼Œå’Œcsuè”åˆå‡ºé¢˜ï¼Œå‹åŠ›è¿˜æ˜¯æœ‰çš„ï¼Œé¢˜ç›®ä¸å¯èƒ½å‡ºçš„å¤ªæ°´çš„ï¼Œæ‰€ä»¥æˆ‘æœ€è¿‘çš„æƒ³æ³•ï¼Œæç‚¹æœ‰æ„æ€çš„é¢˜ï¼Œçœ‹çœ‹vmçš„å‡ ç§å®ç°ï¼Œç„¶åè‡ªå·±å†™å†™ï¼Œæ„Ÿå—ä¸‹ï¼Œç„¶åå¼€å§‹ææå¼€å‘äº†ï¼Œå˜¿å˜¿ï¼Œvmåšä¸ªå¼€èƒƒèœï¼Œä¹‹åç©ç‚¹ä¸Šæ¬¡githubä¸Šçœ‹åˆ°çš„ä¸œè¥¿ã€‚\nå¼€å§‹åˆ†æï¼Œidaä¸Šå·è¿™é¢˜vmæ˜¯å±äºéœ€è¦è‡ªå·±æ„é€ bytecodeçš„ï¼Œç„¶åæ„é€ å¾—å‡ºflagï¼Œå¦ä¸€ç§æ˜¯ç»™å‡ºbytecodeï¼Œç„¶åæ ¹æ®bytecodeçš„åŠ å¯†æµç¨‹ï¼ŒæŠŠflagé€†å‘å‡ºæ¥ï¼Œç¬¬äºŒç§æˆ‘è§‰å¾—æ¯”ç¬¬ä¸€ç§ç®€å•ï¼Œæ¯•ç«Ÿç¨‹åºæµç¨‹æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å®ç°ä¸€ä¸ªè§£é‡Šå™¨ï¼Œç„¶åé€šè¿‡bytecodeï¼Œå’Œé€†å‘å‡ºçš„è™šæ‹Ÿæœºdispatcherï¼Œå¼„å‡ºä¼ªä»£ç ï¼Œç„¶åå°±å¯ä»¥æ„‰å¿«çš„é€†å‘äº†ï¼Œç¬¬ä¸€ç§ï¼Œå°±emmmï¼Œå±äºå¾—è‡ªå·±å»çŒœå’Œæƒ³ï¼Œè¿™ä¸ªç¨‹åºæµç¨‹è¦æ€ä¹ˆèµ°ï¼Œéš¾åº¦æ›´å¤§ï¼Œè¿™é¢˜æ°å¥½æ˜¯ç¬¬ä¸€ç§ï¼Œåªèƒ½è€å¿ƒæ¨å¯¼äº†ã€‚\n\nsub401E90å‡½æ•°å’Œsub4016BDå‡½æ•°æ˜¯ç”¨æ¥åˆå§‹åŒ–vmç¯å¢ƒçš„ï¼Œ\n\nåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå¤§å‹ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“å¤ªå¤§ï¼Œæœ¬æ¥æƒ³ç”¨idaæ„é€ ä¸ªå‡ºæ¥çš„ï¼Œåé¢å‘ç°å­—æ®µå¤ªå¤šäº†ï¼Œç©ä¸åŠ¨ï¼Œè¿™é‡Œä¸­é—´å’Œä¸­åˆçœ‹vmæ„é€ ï¼Œå·®ä¸å¤š\n\nåŒæ ·ç”¨ä¸€ä¸ªç»“æ„ä½“å­˜å‚¨è¿™ä¸€ä¸ªopcodeï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªhandlerï¼Œå…¶ä»–å°±æ˜¯è¡¨çš„å„ç§æ“ä½œï¼Œç›´æ¥ä¸çœ‹ï¼Œåæ­£å’Œè¾“å…¥æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè¡¨ä¸­çš„æ•°æ®ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¿…ç„¶æ˜¯æ­£ç¡®çš„ï¼Œdumpå°±å®Œäº‹äº†ï¼Œæ¥ç€å¾€ä¸‹èµ°\n\nå‘ç°æˆ‘ä»¬çš„è¾“å…¥ï¼Œä½œä¸ºä¸Šæ–‡åˆå§‹åŒ–è¡¨çš„ä¸‹æ ‡ï¼Œå’Œä¹‹å‰å®šä¹‰çš„opcodeå¼€å§‹ä½œå¯¹æ¯”ï¼Œä¸æ¯«ä¸æ…Œï¼Œæˆ‘ä»¬çŸ¥é“äº†opcodeï¼Œç›´æ¥é€†æ¨ä¸‹æ ‡ï¼Œå°±çŸ¥é“æˆ‘ä»¬çš„è¾“å…¥èŒƒå›´æ˜¯ä»€ä¹ˆï¼Œpycharmå¯åŠ¨\n\nbyte_603900&#x3D;[\n  0x02, 0x00, 0x00, 0x0E, 0x16, 0x54, 0x20, 0x18, 0x11, 0x45,\n  0x50, 0x59, 0x58, 0x53, 0x00, 0x08, 0x44, 0x2D, 0x46, 0x39,\n  0x00, 0x54, 0x42, 0x01, 0x3C, 0x0F, 0x00, 0x07, 0x17, 0x00,\n  0x56, 0x21, 0x00, 0x37, 0x6D, 0x2B, 0x2A, 0x6E, 0x59, 0x5D,\n  0x47, 0x3A, 0x4A, 0x34, 0x44, 0x48, 0x43, 0x6C, 0x3F, 0x59,\n  0x25, 0x33, 0x55, 0x2F, 0x31, 0x68, 0x27, 0x34, 0x7C, 0x28,\n  0x67, 0x59, 0x00, 0x52, 0x00, 0x26, 0x00, 0x3E, 0x56, 0x4E,\n  0x33, 0x21, 0x45, 0x6D, 0x60, 0x39, 0x46, 0x72, 0x6D, 0x4D,\n  0x54, 0x40, 0x00, 0x74, 0x57, 0x73, 0x72, 0x7A, 0x47, 0x45,\n  0x00, 0x71, 0x00, 0x4A, 0x35, 0x70, 0x3B, 0x36, 0x2E, 0x26,\n  0x2C, 0x6C, 0x4A, 0x00, 0x7C, 0x63, 0x35, 0x57, 0x4D, 0x41,\n  0x43, 0x62, 0x00, 0x68, 0x37, 0x00, 0x5A, 0x6A, 0x6B, 0x7C,\n  0x29, 0x69, 0x4C, 0x70, 0x50, 0x71, 0x26, 0x36, 0x3C, 0x06,\n  0x1B, 0x00, 0x3C, 0x30, 0x00, 0x00, 0x00, 0x4C, 0x0B, 0x4B,\n  0x48, 0x08, 0x54, 0x47, 0x12, 0x09, 0x24, 0x00, 0x00, 0x24,\n  0x40, 0x0D, 0x39, 0x06, 0x5C, 0x2C, 0x1A, 0x2D, 0x0A, 0x38,\n  0x35, 0x37, 0x16, 0x3B, 0x00, 0x24, 0x48, 0x00, 0x49, 0x00,\n  0x37, 0x08, 0x1F, 0x24, 0x45, 0x1D, 0x11, 0x40, 0x2F, 0x4A,\n  0x08, 0x15, 0x00, 0x11, 0x00, 0x1A, 0x22, 0x41, 0x52, 0x5B,\n  0x0B, 0x45, 0x31, 0x19, 0x43, 0x19, 0x1E, 0x0A, 0x21, 0x05,\n  0x4D, 0x59, 0x38, 0x34, 0x09, 0x36, 0x2F, 0x43, 0x02, 0x53,\n  0x12, 0x2F, 0x4C, 0x21, 0x0D, 0x3C, 0x31, 0x2E, 0x37, 0x08,\n  0x30, 0x29, 0x32, 0x2F, 0x00, 0x1A, 0x14, 0x41, 0x53, 0x15,\n  0x21, 0x00, 0x08, 0x13, 0x38, 0x5C, 0x36, 0x3B, 0x50, 0x00,\n  0x2F, 0x1E, 0x57, 0x00, 0x30, 0x2E, 0x0C, 0x2E, 0x37, 0x52,\n  0x1C, 0x33, 0x34, 0x11, 0x38, 0x00\n]\nopcode&#x3D;[0x2A,0x27,0x3e,0x5A,0x3F,0x4E,0x6A,0x2B,0x28]\ninputD&#x3D;[]\nfor j in range(len(opcode)):\n    inputD.append(chr(byte_603900.index(opcode[j])&amp;0xff))\nprint(inputD)\n\n\nè¿™é‡Œæœ‰ç‚¹å‘çš„å°±æ˜¯è¡¨è¢«æ”¹äº†ï¼Œå…·ä½“è¿½æº¯æœ‰ç‚¹éº»çƒ¦ï¼Œç›´æ¥åœ¨å¯¹æ¯”çš„åœ°æ–¹ï¼Œä¸‹æ–­ç‚¹æŠŠæ­£ç¡®çš„opcode dumpä¸‹æ¥å°±ç®—æˆåŠŸäº†ã€‚\n\nåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šæˆ‘ä»¬çš„è¾“å…¥çš„èŒƒå›´ï¼Œå°±åœ¨è¿™ä¸ªä¹ä¸ªå­—æ¯é€‰æ‹©ï¼Œä¸åŒçš„å­—æ¯å¯¹åº”ä¸åŒçš„handlerï¼Œè¿™é‡Œå¸¸è§„æ­¥éª¤æ˜¯é€†å‘handlerï¼Œå°†handleræå–å‡ºæ¥ï¼Œç„¶åå°è¯•è¿˜åŸæˆä¼ªä»£ç ï¼Œæˆ‘ä»¬è·Ÿè¿›ä¸åŒçš„å‡½æ•°èµ°ç€çœ‹ï¼Œç„¶åæŠŠå…³é”®æ­¥éª¤ï¼Œéƒ½æå–å‡ºæ¥ï¼Œæ¯”è¾ƒç›´è§‚\n#  *(_BYTE *)(a1 + 665) &#x3D; *(_BYTE *)(*(_QWORD *)(a1 + 8) + *(int *)(a1 + 288));\n\n# *(_BYTE *)(*(int *)(a1 + 288) + *(_QWORD *)(a1 + 8)) &#x3D; *(_BYTE *)(a1 + 665);\n\n#  *(_BYTE *)(a1 + 665) &#x3D; *(_BYTE *)(a1 + 665) + *(_BYTE *)(a1 + 664) - 33;\n\n#  *(_BYTE *)(a1 + 665) &#x3D; *(_BYTE *)(a1 + 665) - *(_BYTE *)(a1 + 664) + 33;  ++*(_BYTE *)(a1 + 665);\n\n# ++*(_DWORD *)(a1 + 288);\n\n#  --*(_DWORD *)(a1 + 288);\n\n# ++*(_DWORD *)(a1 + 288);   *(_BYTE *)(*(_QWORD *)(a1 + 280) + *(int *)(a1 + 288) + *(_QWORD *)a1) &#x3D; *(_BYTE *)(a1+ 16+ *(int *)(a1 + 288)+ (__int64)*(char *)(a1 + 664)- 48)- 49;\n\n# for ( i &#x3D; 0; *(char *)(a1 + 664) &gt; i; ++i )\n#     ++*(_DWORD *)(a1 + 288);\n# *(_BYTE *)(*(_QWORD *)(a1 + 280) + *(int *)(a1 + 288) + *(_QWORD *)a1) &#x3D; *(_BYTE *)(a1 + 16+ *(int *)(a1 + 288) + (__int64)*(char *)(a1 + 664) - 48)- 49;\n\n#  *(_DWORD *)(a1 + 288) +&#x3D; *(char *)(a1 + 664);\n\n #*(_BYTE *)(a1 + 665) *&#x3D; *(_BYTE *)(a1 + 664);\n#*(_BYTE *)(*(_QWORD *)(a1 + 280) + * (int *)(a1 + 288) +*(_QWORD *)a1) &#x3D; *(_BYTE *)(a1+ * (int *)(a1 + 288)+ (__int64) * (char *)(a1 + 664))- 17;\n\n# *(char *)(a1 + 665) &#x2F;&#x3D; *(char *)(a1 + 664);\n\n#*(_BYTE *)((int)++*(_DWORD *)(a1 + 288) + *(_QWORD *)(a1 + 8)) &#x3D; *(_BYTE *)(a1 + 664);\n#*(_BYTE *)(*(_QWORD *)(a1 + 280) + * (int *)(a1 + 288) +*(_QWORD *)a1) &#x3D; *(_BYTE *)(a1+ 16+ * (int *)(a1 + 288) + (__int64) * (char *)(a1 + 664) - 80)- 81;\n\n# *(_BYTE *)(a1 + 664) &#x3D; *(_BYTE *)(*(_QWORD *)(a1 + 8) + (int)(*(_DWORD *)(a1 + 288))--);\n# *(_BYTE *)(*(_QWORD *)(a1 + 280) + *(int *)(a1 + 288) + *(_QWORD *)a1) &#x3D; *(_BYTE *)(a1+ 16+ *(int *)(a1 + 288) + (__int64)*(char *)(a1 + 664)- 32)- 33\n\nè¿™æ ·çœ‹ï¼Œå¤ªä¸‘äº†ï¼Œæˆ‘ä»¬ç”¨æˆ‘ä»¬çš„ç†è§£çš„ä¼ªä»£ç å¼„å‡ºæ¥ã€‚\n&#39;$&#39;: tmp&#x3D;data[index]\n&#39;8&#39;: data[index]&#x3D;tmp\n&#39;C&#39;: tmp&#x3D;tmp+input[i]-33\n&#39;t&#39;: tmp&#x3D;tmp-input[i]+33; --tmp\n&#39;0&#39;: index++\n&#39;E&#39;: check\n&#39;u&#39;: index--\n&#39;#&#39;: data[index]&#x3D;input[index+input[i]-48]-49\n&#39;;&#39;: \nfor(int j&#x3D;0;j&lt;input[i];j++)\n\t++index\ndata[index]&#x3D;input[index+input[i]-48]-49\n\ncheckå‡½æ•°ï¼Œä¸»è¦å°±æ˜¯åˆ¤æ–­PaF0!&amp;Prv}H{ojDQ#7v=æ˜¯å¦è½¬å˜æˆBinggo\næ¥ä¸‹æ¥å°±å¼€å§‹æ„é€ ï¼ŒP-&gt;B è¿™é‡Œè‚¯å®šæ˜¯å…ˆå–æ•°æ®ï¼Œç„¶åå¤„ç†ï¼Œç„¶åå†å¡å›å»ï¼Œè¿™é‡Œæ•°å­—ç”±å¤§å˜å°ï¼Œè‚¯å®šæ˜¯é€‰tæ¥å¤„ç†çš„ã€‚\nåŸºæœ¬ä¸Šå°±æ˜¯$t/80ï¼Œä»¥æ­¤ç±»æ¨å°±å®Œäº‹äº†ã€‚\nè¿™é‡Œæ¯”è¾ƒç»•çš„ç‚¹ï¼Œåœ¨äºåé¢é‚£ä¸ªå°†dataåœ¨ç¬¬7ä¸ªå­—ç¬¦åé¢æˆªæ–­çš„æ—¶ï¼Œéœ€è¦å¡«å…¥çš„\\0ï¼Œè¿™é‡Œéœ€è¦ç‰¹åˆ«æ„é€ \nè¿™é‡Œæ„é€ æ–¹å¼å¾ˆå¤šï¼Œå°±ä¸å¤šé€¼é€¼äº†ï¼Œè¿™é¢˜çœŸæœ‰æ„æ€ï¼Œè‰ï¼Œè°ƒä¸€å¤©äº†ï¼Œèˆ’æœäº†ã€‚\n  $t/80$C11111)80$CI80$CX80$Cg80$Cj80#1uuuuuuEs\n","slug":"DDCTF-é»‘ç›’ç ´è§£","date":"2021-04-22T06:07:05.000Z","categories_index":"writeup","tags_index":"reverse","author_index":"YenKoc"},{"id":"a285eb2e1ce3d42c5752f972d9befc34","title":"è§£å†³åŸºäºå¤šçº¿ç¨‹æ ˆå›æº¯ä¸å¤Ÿæ·±åº¦ï¼Œæ— æ³•å®šä½åˆ°å…·ä½“ä»£ç ","content":"å‰è¨€ç°åœ¨çš„å‘åŒ…æ¡†æ¶éƒ½æ˜¯æ–°èµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åæŠŠä¸€äº›å‘åŒ…é€»è¾‘å¡åˆ°é‡Œé¢å»ï¼Œä¹‹å‰å­¦ä¹ åˆ°å»hookä¸€äº›javaå±‚çš„apiï¼Œå¯ä»¥å»æ ˆå›æº¯ï¼Œä½†æ˜¯åœ¨å®æˆ˜ä¸­å‘ç°ï¼Œå°±æ˜¯æˆ‘ä»¬çš„æ ˆå›æº¯æœ€é«˜å±‚ï¼Œåªèƒ½å›æº¯åˆ°java.lang.Threadç±»ï¼Œä½†æ˜¯è¿™ä¸ªæ— æ³•è®©æˆ‘ä»¬å¿«é€Ÿæ‰¾åˆ°å…³é”®ä»£ç ï¼Œè€Œä¸”ä¸ºä»€ä¹ˆåªèƒ½å›æº¯åˆ°java.lang.Threadç±»å‘¢ï¼Œå°±åªèƒ½ä»æºç ä¸­å»æ‰¾ç­”æ¡ˆ.\næºç åˆ†æå…ˆå†™ä¸ªå®‰å“é‡Œé¢æ–°å»ºçº¿ç¨‹çš„demo\nnew Thread(new Runnable() &#123;\n            @Override\n            public void run() &#123;\n                System.out.println(&quot;helll&quot;);\n            &#125;\n        &#125;).start();\n\nå‘ç°æ˜¯åˆ›å»ºäº†ä¸€ä¸ªthreadå¯¹è±¡ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œä¼ å…¥äº†ä¸€ä¸ªrunnableå¯¹è±¡ï¼Œå…¨æ˜¯åŒ¿åçš„ï¼Œæˆ‘ä»¬å»è·Ÿä¸‹è¿™ä¸ªThreadç±»\nï¼Œçœ‹çœ‹æ˜¯å¦‚ä½•æ–°å»ºçº¿ç¨‹çš„ï¼Œ\n\n\n\nåˆ°ç›®å‰ä¸ºæ­¢ï¼Œåªæ˜¯newäº†threadå¯¹è±¡ï¼Œè¿˜æ²¡å¼€å§‹æ–°å»ºçº¿ç¨‹ï¼Œåªæ˜¯æŠŠçº¿ç¨‹çš„åˆå§‹åŒ–ç¯å¢ƒé…å¥½ã€‚å†è·Ÿä¸‹startæ–¹æ³•\n\nè·Ÿè¿›nativeCreateæ–¹æ³•\n\nå¥½å®¶ä¼™ï¼Œæ˜¯jniå‡½æ•°ï¼Œè¿™é‡Œæœ‰ä¸ªæŠ€å·§ï¼Œå°±æ˜¯jniå‡½æ•°æ‰¾æºç ï¼Œç±»ååŠ ä¸‹åˆ’çº¿åŠ jniå‡½æ•°ï¼Œå°±èƒ½æ‰¾åˆ°ã€‚\n\n\n\nå‘ç°æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨libcä¸­çš„pthreadcreateæ–¹æ³•ï¼Œå»æ–°å»ºè¿›ç¨‹ï¼Œç»§ç»­è·Ÿä¸‹è¿™ä¸ªçº¿ç¨‹ä¼šæ‰§è¡Œä»€ä¹ˆï¼Œè¿™æ—¶å€™å·²ç»åˆ°æ–°å»ºçº¿ç¨‹é‡Œäº†ï¼Œ\n\nå‘ç°äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬æ ˆå›æº¯ï¼Œä¸€ç›´æœ€é«˜å±‚æ˜¯java.lang.Threadï¼Œå› ä¸ºæˆ‘ä»¬æ–°çº¿ç¨‹æœ€å…ˆæ‰§è¡Œæ˜¯java.lang.Thread.runæ–¹æ³•ã€‚\næ‰€ä»¥æˆ‘ä»¬çš„æ ¸å¿ƒé—®é¢˜æ˜¯æ‰¾åˆ°ä¸»çº¿ç¨‹æ˜¯åœ¨å“ªé‡Œæ–°å»ºçº¿ç¨‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬hookçš„å¯¹è±¡åº”è¯¥æ˜¯åœ¨ä¸»è¿›ç¨‹è¿‡ç¨‹ä¸­çš„æ‰§è¡Œæµç¨‹ï¼Œç„¶åæ‰“å°\nè¿™é‡Œå¯é€‰çš„ç‚¹è¿˜æ˜¯è›®å¤šçš„ï¼Œè¿™é‡Œé€‰init2ï¼Œç„¶åè¿˜å¯ä»¥æŠŠtargetå¯¹è±¡çš„classnameæ‰“å°å‡ºæ¥çš„ï¼Œæ”¾ä¸‹frida è„šæœ¬\n&#x2F;&#x2F;package:com.example.hookso\nfunction LogPrint(log) &#123;\n    var theDate &#x3D; new Date();\n    var hour &#x3D; theDate.getHours();\n    var minute &#x3D; theDate.getMinutes();\n    var second &#x3D; theDate.getSeconds();\n    var mSecond &#x3D; theDate.getMilliseconds();\n\n    hour &lt; 10 ? hour &#x3D; &quot;0&quot; + hour : hour;\n    minute &lt; 10 ? minute &#x3D; &quot;0&quot; + minute : minute;\n    second &lt; 10 ? second &#x3D; &quot;0&quot; + second : second;\n    mSecond &lt; 10 ? mSecond &#x3D; &quot;00&quot; + mSecond : mSecond &lt; 100 ? mSecond &#x3D; &quot;0&quot; + mSecond : mSecond;\n    var time &#x3D; hour + &quot;:&quot; + minute + &quot;:&quot; + second + &quot;:&quot; + mSecond;\n    var threadid &#x3D; Process.getCurrentThreadId();\n    console.log(&quot;[&quot; + time + &quot;]&quot; + &quot;-&gt;threadid:&quot; + threadid + &quot;--&quot; + log);\n\n&#125;\n\nfunction printJavaStack(name) &#123;\n    Java.perform(function () &#123;\n        var Exception &#x3D; Java.use(&quot;java.lang.Exception&quot;);\n        var ins &#x3D; Exception.$new(&quot;Exception&quot;);\n        var straces &#x3D; ins.getStackTrace();\n        if (straces !&#x3D; undefined &amp;&amp; straces !&#x3D; null) &#123;\n            var strace &#x3D; straces.toString();\n            var replaceStr &#x3D; strace.replace(&#x2F;,&#x2F;g, &quot; \\n &quot;);\n            LogPrint(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot; + name + &quot; Stack start&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);\n            LogPrint(replaceStr);\n            LogPrint(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot; + name + &quot; Stack end&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; \\n &quot;);\n            Exception.$dispose();\n        &#125;\n    &#125;);\n&#125;\nfunction hookThread()\n&#123;\n    Java.perform(function()&#123;\n         var YThreadClass&#x3D;Java.use(&quot;java.lang.Thread&quot;);\n         YThreadClass.init2.implementation&#x3D;function(arg0)\n         &#123;\n             var target&#x3D;this.target.value;\n             if(target!&#x3D;null)\n             &#123;\n                LogPrint(&quot;go into Thread.init2 -&gt;Runnable class:&quot;+target.$className);\n                printJavaStack(&quot;java.lang.Thread.init2&quot;);\n             &#125;else&#123;\n                 LogPrint(&quot;go into Thread.init2-&gt;Thread.class:&quot;,this.$className);\n                 printJavaStack(&quot;java.lang.Thread.init2&quot;);\n                 var threadclassname&#x3D;this.$className;\n                 var ChindThreadClass.run.implementation&#x3D;function()&#123;\n                     LogPrint(&quot;go into&quot;+threadclassname+&quot;.run&quot;);\n                     printJavaStack(threadclassname+&quot;.run&quot;);\n                     var result&#x3D;this.run();\n                     return result;\n                 &#125;\n             &#125;\n         \n         var res&#x3D;this.init2(arg0);\n         return res;\n        &#125;\n        YThreadClass.run.implementation&#x3D;function()\n        &#123;\n            var target &#x3D; this.target.value;\n            if (target !&#x3D; null) &#123;\n                LogPrint(&quot;go into Thread.run-&gt;Runnable class:&quot; + target.$className);\n                printJavaStack(&quot;java.lang.Thread.run&quot;)\n            &#125;\n\n            var reuslt &#x3D; this.run();\n            return reuslt;\n        &#125;\n\n    &#125;)\n\n    \n&#125;\nfunction main()\n&#123;\n    hookThread();\n&#125;\nsetImmediate(main)    \n\n\n\n\næ•ˆæœçœŸä¸é”™\n","slug":"è§£å†³åŸºäºå¤šçº¿ç¨‹æ ˆå›æº¯ä¸å¤Ÿæ·±åº¦ï¼Œæ— æ³•å®šä½åˆ°å…·ä½“ä»£ç ","date":"2021-04-21T02:05:56.000Z","categories_index":"appæŠ“åŒ…","tags_index":"æŠ“åŒ…","author_index":"YenKoc"},{"id":"3c82e2c97f4021478c0aae078b24ed3b","title":"ZUCå¯†ç ","content":"å‰è¨€å¤ç°mrctfé¢˜ä¸­ï¼Œå‘ç°æœ‰é¢˜æ¶‰åŠåˆ°zucå¯†ç ï¼Œè¿™ä¸ªä¹‹å‰å¥½åƒæœ‰å¬è¯´è¿‡ï¼Œä½†æ˜¯æ²¡å»ç»†è‡´çœ‹è¿‡ï¼Œæ‰€ä»¥å°±çœ‹äº†å‡ ç¯‡åšå®¢ï¼Œè·Ÿäº†ä¸‹æµç¨‹ï¼ŒæŠŠç®—æ³•æŠ„äº†ä¸€éï¼ŒåŠ æ·±ä¸‹å½±å“ï¼Œå»å…·ä½“èƒŒåŠ å¯†æµç¨‹ï¼Œæˆ‘è¿™è„‘å­ä¹Ÿè®°ä¸ä¸‹ï¼Œåªèƒ½æ˜¯ç†Ÿæ‚‰æµç¨‹å’Œç‰¹å¾ï¼Œå¯¹åº”çš„çœ‹äº†233\næºä»£ç #include &lt;iostream&gt;\n\n#include&lt;cstdio&gt;\n#include&lt;iostream&gt;\n#include&lt;cstring&gt;\n&#x2F;*the state register of LFSR*&#x2F;\ntypedef unsigned char u8;\ntypedef unsigned int u32;\nu32 LFSR_S[16]&#x3D;&#123;0&#125;;\n\n&#x2F;*the register of F*&#x2F;\nu32 F_R1&#x3D;0;\nu32 F_R2&#x3D;0;\n\n&#x2F;*the outputs of BitReorganization*&#x2F;\nu32 BRC_X[4]&#x3D;&#123;0&#125;;\n\n\nu8 S0[256] &#x3D; &#123;\n        0x3e, 0x72, 0x5b, 0x47, 0xca, 0xe0, 0x00, 0x33, 0x04, 0xd1, 0x54, 0x98, 0x09, 0xb9, 0x6d, 0xcb,\n        0x7b, 0x1b, 0xf9, 0x32, 0xaf, 0x9d, 0x6a, 0xa5, 0xb8, 0x2d, 0xfc, 0x1d, 0x08, 0x53, 0x03, 0x90,\n        0x4d, 0x4e, 0x84, 0x99, 0xe4, 0xce, 0xd9, 0x91, 0xdd, 0xb6, 0x85, 0x48, 0x8b, 0x29, 0x6e, 0xac,\n        0xcd, 0xc1, 0xf8, 0x1e, 0x73, 0x43, 0x69, 0xc6, 0xb5, 0xbd, 0xfd, 0x39, 0x63, 0x20, 0xd4, 0x38,\n        0x76, 0x7d, 0xb2, 0xa7, 0xcf, 0xed, 0x57, 0xc5, 0xf3, 0x2c, 0xbb, 0x14, 0x21, 0x06, 0x55, 0x9b,\n        0xe3, 0xef, 0x5e, 0x31, 0x4f, 0x7f, 0x5a, 0xa4, 0x0d, 0x82, 0x51, 0x49, 0x5f, 0xba, 0x58, 0x1c,\n        0x4a, 0x16, 0xd5, 0x17, 0xa8, 0x92, 0x24, 0x1f, 0x8c, 0xff, 0xd8, 0xae, 0x2e, 0x01, 0xd3, 0xad,\n        0x3b, 0x4b, 0xda, 0x46, 0xeb, 0xc9, 0xde, 0x9a, 0x8f, 0x87, 0xd7, 0x3a, 0x80, 0x6f, 0x2f, 0xc8,\n        0xb1, 0xb4, 0x37, 0xf7, 0x0a, 0x22, 0x13, 0x28, 0x7c, 0xcc, 0x3c, 0x89, 0xc7, 0xc3, 0x96, 0x56,\n        0x07, 0xbf, 0x7e, 0xf0, 0x0b, 0x2b, 0x97, 0x52, 0x35, 0x41, 0x79, 0x61, 0xa6, 0x4c, 0x10, 0xfe,\n        0xbc, 0x26, 0x95, 0x88, 0x8a, 0xb0, 0xa3, 0xfb, 0xc0, 0x18, 0x94, 0xf2, 0xe1, 0xe5, 0xe9, 0x5d,\n        0xd0, 0xdc, 0x11, 0x66, 0x64, 0x5c, 0xec, 0x59, 0x42, 0x75, 0x12, 0xf5, 0x74, 0x9c, 0xaa, 0x23,\n        0x0e, 0x86, 0xab, 0xbe, 0x2a, 0x02, 0xe7, 0x67, 0xe6, 0x44, 0xa2, 0x6c, 0xc2, 0x93, 0x9f, 0xf1,\n        0xf6, 0xfa, 0x36, 0xd2, 0x50, 0x68, 0x9e, 0x62, 0x71, 0x15, 0x3d, 0xd6, 0x40, 0xc4, 0xe2, 0x0f,\n        0x8e, 0x83, 0x77, 0x6b, 0x25, 0x05, 0x3f, 0x0c, 0x30, 0xea, 0x70, 0xb7, 0xa1, 0xe8, 0xa9, 0x65,\n        0x8d, 0x27, 0x1a, 0xdb, 0x81, 0xb3, 0xa0, 0xf4, 0x45, 0x7a, 0x19, 0xdf, 0xee, 0x78, 0x34, 0x60&#125;;\n\nu8 S1[256] &#x3D; &#123;\n        0x55, 0xc2, 0x63, 0x71, 0x3b, 0xc8, 0x47, 0x86, 0x9f, 0x3c, 0xda, 0x5b, 0x29, 0xaa, 0xfd, 0x77,\n        0x8c, 0xc5, 0x94, 0x0c, 0xa6, 0x1a, 0x13, 0x00, 0xe3, 0xa8, 0x16, 0x72, 0x40, 0xf9, 0xf8, 0x42,\n        0x44, 0x26, 0x68, 0x96, 0x81, 0xd9, 0x45, 0x3e, 0x10, 0x76, 0xc6, 0xa7, 0x8b, 0x39, 0x43, 0xe1,\n        0x3a, 0xb5, 0x56, 0x2a, 0xc0, 0x6d, 0xb3, 0x05, 0x22, 0x66, 0xbf, 0xdc, 0x0b, 0xfa, 0x62, 0x48,\n        0xdd, 0x20, 0x11, 0x06, 0x36, 0xc9, 0xc1, 0xcf, 0xf6, 0x27, 0x52, 0xbb, 0x69, 0xf5, 0xd4, 0x87,\n        0x7f, 0x84, 0x4c, 0xd2, 0x9c, 0x57, 0xa4, 0xbc, 0x4f, 0x9a, 0xdf, 0xfe, 0xd6, 0x8d, 0x7a, 0xeb,\n        0x2b, 0x53, 0xd8, 0x5c, 0xa1, 0x14, 0x17, 0xfb, 0x23, 0xd5, 0x7d, 0x30, 0x67, 0x73, 0x08, 0x09,\n        0xee, 0xb7, 0x70, 0x3f, 0x61, 0xb2, 0x19, 0x8e, 0x4e, 0xe5, 0x4b, 0x93, 0x8f, 0x5d, 0xdb, 0xa9,\n        0xad, 0xf1, 0xae, 0x2e, 0xcb, 0x0d, 0xfc, 0xf4, 0x2d, 0x46, 0x6e, 0x1d, 0x97, 0xe8, 0xd1, 0xe9,\n        0x4d, 0x37, 0xa5, 0x75, 0x5e, 0x83, 0x9e, 0xab, 0x82, 0x9d, 0xb9, 0x1c, 0xe0, 0xcd, 0x49, 0x89,\n        0x01, 0xb6, 0xbd, 0x58, 0x24, 0xa2, 0x5f, 0x38, 0x78, 0x99, 0x15, 0x90, 0x50, 0xb8, 0x95, 0xe4,\n        0xd0, 0x91, 0xc7, 0xce, 0xed, 0x0f, 0xb4, 0x6f, 0xa0, 0xcc, 0xf0, 0x02, 0x4a, 0x79, 0xc3, 0xde,\n        0xa3, 0xef, 0xea, 0x51, 0xe6, 0x6b, 0x18, 0xec, 0x1b, 0x2c, 0x80, 0xf7, 0x74, 0xe7, 0xff, 0x21,\n        0x5a, 0x6a, 0x54, 0x1e, 0x41, 0x31, 0x92, 0x35, 0xc4, 0x33, 0x07, 0x0a, 0xba, 0x7e, 0x0e, 0x34,\n        0x88, 0xb1, 0x98, 0x7c, 0xf3, 0x3d, 0x60, 0x6c, 0x7b, 0xca, 0xd3, 0x1f, 0x32, 0x65, 0x04, 0x28,\n        0x64, 0xbe, 0x85, 0x9b, 0x2f, 0x59, 0x8a, 0xd7, 0xb0, 0x25, 0xac, 0xaf, 0x12, 0x03, 0xe2, 0xf2&#125;;\n\nu32 EK_d[16] &#x3D; &#123;\n        0x44d7, 0x26bc, 0x626b, 0x135e, 0x5789, 0x35e2, 0x7135, 0x09af,\n        0x4d78, 0x2f13, 0x6bc4, 0x1af1, 0x5e26, 0x3c4d, 0x789a, 0x47ac&#125;;\n#define MAKEU31(a,b,c) (((u32)((u32)(0)|(u8)(a))&lt;&lt;23)|(u32)((u32)(0)|(u8)(c)))\n&#x2F;*Bit Reorganization*&#x2F;\nvoid BitReorganization()\n&#123;\n    BRC_X[0]&#x3D;((LFSR_S[15]&amp;0x7FFF8000)&lt;&lt;1)|(LFSR_S[14]&amp;0xFFFF);\n    BRC_X[1]&#x3D;((LFSR_S[11]&amp;0xFFFF)&lt;&lt;16)|(LFSR_S[9]&gt;&gt;15);\n    BRC_X[2]&#x3D;((LFSR_S[7]&amp;0xFFFF)&lt;&lt;16)|(LFSR_S[5]&gt;&gt;15);\n    BRC_X[3]&#x3D;((LFSR_S[2]&amp;0xFFFF)&lt;&lt;16)|(LFSR_S[0]&gt;&gt;15);\n&#125;\n#define MAKEU32(a,b,c,d) (((u32)(a)&lt;&lt;24)|((u32)(b)&lt;&lt;16)|((u32)(c)&lt;&lt;8)|((u32)(d)))\n#define ROT(a,k) (((a)&lt;&lt;k)|((a)&gt;&gt;(32-k)))\n&#x2F;*L1*&#x2F;\nu32 L1(u32 X)\n&#123;\n    return (X^ROT(X,2)^ROT(X,10)^ROT(X,18)^ROT(X,24));\n&#125;\n&#x2F;*L2*&#x2F;\nu32 L2(u32 X)\n&#123;\n    return (X^ROT(X,8)^ROT(X,14)^ROT(X,22)^ROT(X,30));\n&#125;\n\n&#x2F;*F*&#x2F;\nu32 F()&#123;\n    u32 W,W1,W2,u,v;\n    W&#x3D;(BRC_X[0]^F_R1)+F_R2;\n    W1&#x3D;F_R1+BRC_X[1];\n    W2&#x3D;F_R2+BRC_X[2];\n    u&#x3D;L1((W1&lt;&lt;16)|W2&gt;&gt;16);\n    v&#x3D;L2((W2&lt;&lt;16|W1&gt;&gt;16));\n    F_R1&#x3D; MAKEU32(S0[u&gt;&gt;24],S1[(u&gt;&gt;16)&amp;0xFF],S0[(u&gt;&gt;8)&amp;0xFF],S1[u&amp;0xFF]);\n    F_R2&#x3D;MAKEU32(S0[v&gt;&gt;24],S1[(v&gt;&gt;16)&amp;0xFF],S0[(v&gt;&gt;8)&amp;0xFF],S1[v&amp;0xFF]);\n    return W;\n&#125;\nu32 AddM(u32 a,u32 b)\n&#123;\n    u32 c&#x3D;a+b;\n    return (c&amp;0x7FFFFFFF)+(c&gt;&gt;31);\n&#125;\n#define MulByPow2(x,k) ((((x) &lt;&lt; k) | ((x) &gt;&gt; (31 - k))) &amp; 0x7FFFFFFF)\n&#x2F;* LFSR with work mode *&#x2F;\nvoid LFSRWithWorkMode()\n&#123;\n    u32 f,v;\n    u32 i;\n    f&#x3D;LFSR_S[0];\n    v&#x3D;MulByPow2(LFSR_S[0],8);\n    f&#x3D;AddM(f,v);\n\n    v&#x3D;MulByPow2(LFSR_S[4],20);\n    f&#x3D;AddM(f,v);\n\n    v&#x3D;MulByPow2(LFSR_S[10],21);\n    f&#x3D;AddM(f,v);\n\n    v&#x3D;MulByPow2(LFSR_S[13],17);\n    f&#x3D;AddM(f,v);\n\n    v&#x3D;MulByPow2(LFSR_S[15],15);\n    f&#x3D;AddM(f,v);\n    &#x2F;*update the state*&#x2F;\n    for(i&#x3D;0;i&lt;15;i++)&#123;\n        LFSR_S[i]&#x3D;LFSR_S[i+1];\n    &#125;\n    LFSR_S[15]&#x3D;f;\n&#125;\nvoid LFSRWithInitializationMode(u32 u)\n&#123;\n    u32 f,v;\n    u32 i;\n    f&#x3D;LFSR_S[0];\n    v&#x3D;MulByPow2(LFSR_S[0],8);\n    f&#x3D;AddM(f,v);\n\n    v&#x3D;MulByPow2(LFSR_S[4],20);\n    f&#x3D;AddM(f,v);\n\n    v&#x3D;MulByPow2(LFSR_S[10],21);\n    f&#x3D;AddM(f,v);\n\n    v&#x3D;MulByPow2(LFSR_S[13],17);\n    f&#x3D;AddM(f,v);\n\n    v&#x3D;MulByPow2(LFSR_S[15],15);\n    f&#x3D;AddM(f,v);\n    f&#x3D; AddM(f,u);\n    &#x2F;*update the state*&#x2F;\n    for(i&#x3D;0;i&lt;15;i++)&#123;\n        LFSR_S[i]&#x3D;LFSR_S[i+1];\n    &#125;\n    LFSR_S[15]&#x3D;f;\n&#125;\n&#x2F;*initialize*&#x2F;\nvoid Initiallization(u8 *k,u8 *iv)\n&#123;\n    u32 w,nCount;\n    u32 i;\n\n    &#x2F;*expand key*&#x2F;\n    for(i&#x3D;0;i&lt;16;i++)\n    &#123;\n        LFSR_S[i]&#x3D;MAKEU31(k[i],EK_d[i],iv[i]);\n    &#125;\n\n    &#x2F;*set F_R1 and F_R2 to zero*&#x2F;\n    F_R1&#x3D;0;\n    F_R2&#x3D;0;\n    nCount&#x3D;32;\n    while(nCount&gt;0)\n    &#123;\n        BitReorganization();\n        w&#x3D;F();\n        LFSRWithInitializationMode(w&gt;&gt;1);\n        nCount--;\n    &#125;\n    &#x2F;*First generation abandoned*&#x2F;\n    BitReorganization();\n    F();\n    LFSRWithWorkMode();\n\n&#125;\nvoid GenerateKeyStream(u32* pKeyStream,u32 KeyStreamLen)\n&#123;\n    u32 i;\n    for(i&#x3D;0;i&lt;KeyStreamLen;i++)\n    &#123;\n        BitReorganization();\n        pKeyStream[i]&#x3D;F()^BRC_X[3];\n        LFSRWithWorkMode();\n    &#125;\n&#125;\nint main() &#123;\n    u8 key[16]&#x3D;&#123;0x3d,0x4c,0x4b,0xe9,0x6a,0x82,0xfd, 0xae, 0xb5, 0x8f, 0x64, 0x1d, 0xb1, 0x7b, 0x45, 0x5b&#125;;\n    u8 iv[16]&#x3D;&#123;0x84,0x31,0x9a,0xa8,0xde,0x69,0x15,0xca,0x1f,0x6b,0xda,0xd8,0xc7,0x66&#125;;\n    u32 pKeyStream[4]&#x3D;&#123;0&#125;;\n    u32 KeyStreamLen&#x3D;sizeof(pKeyStream)&#x2F;sizeof(pKeyStream[0]);\n    Initiallization(key,iv);\n    GenerateKeyStream(pKeyStream,KeyStreamLen);\n    for(int i&#x3D;0;i&lt;KeyStreamLen;i++)\n    &#123;\n        printf(&quot;z%d:\\t0x%08x\\n&quot;,i,pKeyStream[i]);\n    &#125;\n\n&#125;\n\næ¯”è¾ƒæ˜æ˜¾çš„å°±æ˜¯å››ä¸ªxå¯„å­˜å™¨ï¼Œç„¶åé‚£ä¸¤å¼ sè¡¨ï¼Œä»¥åŠæœ€åçš„x3å¯„å­˜å™¨çš„å¼‚æˆ–ï¼Œéƒ½å¯ä»¥ä½œä¸ºåˆ¤æ–­çš„æ ‡å‡†ï¼Œè‡ªå·±ç”¨c++æå®Œï¼Œç¼–è¯‘åï¼Œstripå»å®Œç¬¦å·ï¼Œç”¨idaæ‰“å¼€ï¼Œçœ‹äº†çœ‹\n\n\n\nç»“å°¾ç ”ç©¶äº†ä¸‹ubuntuçš„c/c++ç¼–è¯‘ç¯å¢ƒï¼Œé…ç½®äº†ä¸‹ï¼Œæ„Ÿè§‰è¿˜ä¸é”™ï¼Œåæ­£æ¯”æˆ‘winè™šæ‹Ÿæœºå¼ºmmpï¼Œlinuxç”¨èµ·æ¥è¿˜æ˜¯èˆ’æœï¼Œå»ç¬¦å·æ‰¾äº†å¾ˆä¹…\nå‚è€ƒé“¾æ¥:\nhttps://blog.csdn.net/qq_38737992/article/details/90288994\nhttps://blog.csdn.net/qq_43094622/article/details/105823724\nhttps://blog.csdn.net/listener51/article/details/53836213\n","slug":"ZUCå¯†ç ","date":"2021-04-19T12:05:24.000Z","categories_index":"å¯†ç å­¦","tags_index":"å¯†ç å­¦","author_index":"YenKoc"},{"id":"62c420e89414aa7b4113290b58fef1bf","title":"2021MRCTF Re wp","content":"My Registerè¿™é¢˜æˆ‘è§‰å¾—å‡ºçš„éå¸¸å¥½ï¼ŒçœŸä¸é”™ï¼Œæˆ‘éƒ½å­¦åˆ°äº†å¾ˆå¤šï¼Œå°¤å…¶æ˜¯è¿™ç§åŒè¿›ç¨‹ä¿æŠ¤ï¼Œä¹‹å‰å…¶å®æŒºæ‡µé€¼çš„ï¼Œæœ€è¿‘å¯èƒ½æ˜¯è‡ªå·±åŸºç¡€æ›´æ‰å®äº†ï¼Œå¾ˆå¤šæ¦‚å¿µä¸€ç‚¹å°±èƒ½é€šï¼Œæ€»ä½“å°±æ˜¯çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹ï¼Œæ ¹æ®æ ‡è®°ï¼Œä¼šèµ°å‘ä¸åŒåˆ†æ”¯ï¼Œè¿™æ ·è¿˜ä¸å¤Ÿåˆºæ¿€ï¼Œè¿˜æ²¡è¾¾åˆ°åè°ƒè¯•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å­è¿›ç¨‹çš„ä»£ç ä¸­å¼ºè¡ŒåŠ å…¥ä¸€äº›å¼‚å¸¸å¤„ç†ï¼Œè¿™æ ·å½“æ‰§è¡Œåˆ°å¼‚å¸¸å¤„ç†æ—¶ï¼Œæœ‰è°ƒè¯•å™¨æ—¶ï¼ˆè¿™æ—¶å€™çˆ¶è¿›ç¨‹å°±æ˜¯è°ƒè¯•å™¨ï¼‰ä¼šå°†æ‰§è¡Œæƒè½¬ç§»åˆ°çˆ¶è¿›ç¨‹ï¼Œå‘é€ä¸€ä¸ªä¿¡å·ç»™çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹ä»£ç ä¸­è®¾ç½®äº†whileï¼ˆtrueï¼‰ï¼Œä¸æ–­çš„ç­‰å¾…ï¼Œå½“ä¿¡å·è¿‡æ¥æ—¶ï¼Œæ ¹æ®å¼‚å¸¸çš„ç±»å‹ï¼Œèµ°å‘ä¸åŒçš„åˆ†æ”¯ï¼Œè¿™æ—¶å€™çˆ¶è¿›ç¨‹ä½œä¸ºè°ƒè¯•å™¨æ˜¯å¯ä»¥æ“ä½œå­è¿›ç¨‹çš„å¯„å­˜å™¨ä»¥åŠå†…å­˜çš„ï¼Œä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬å¯ä»¥å°†å­è¿›ç¨‹æŸä¸ªæ®µæˆ–è€…å‡½æ•°è¿›è¡ŒåŠ å¯†ï¼Œå½“å¼‚å¸¸å¤„ç†æ—¶ï¼Œçˆ¶è¿›ç¨‹å†è¿›è¡Œè§£å¯†ï¼Œleaveçˆ·çœŸæœ‰ä½ çš„å“¦\n\n\nè¿™é‡Œæ˜¯æœ€éªšçš„ï¼Œå¦‚æœä½ å»åŠ¨è°ƒï¼Œç›´æ¥å®ŒçŠŠå­ï¼Œè¿™ä¸ªisDeggerpresentæœ¬æ¥æ£€æµ‹æ˜¯çˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹ï¼Œä¸€èˆ¬æ˜¯å­è¿›ç¨‹æ‰èƒ½èµ°è¿™ä¸ªåˆ†æ”¯ï¼Œä½†æ˜¯å½“æˆ‘ä»¬ç”¨idaå»åŠ¨è°ƒæ—¶ï¼Œçˆ¶è¿›ç¨‹å› ä¸ºæœ‰äº†è°ƒè¯•å™¨ï¼Œä¹Ÿå°±æ„å‘³ç€ï¼Œè¿™ä¸ªçˆ¶è¿›ç¨‹è¿›å»äº†ï¼Œmmmpï¼Œåé¢æˆ‘åˆ†æå°±å¾ˆä¹±ï¼Œå¾ˆæ‡µé€¼ã€‚ã€‚è¿™é‡Œè®¾è®¡æ˜¯å·§å¦™çš„ã€‚\n\nè¿™é‡Œæ˜¯ä¸Šé¢æˆ‘è¯´çš„ï¼Œæ˜¯è´Ÿè´£è§£å¯†å­è¿›ç¨‹çš„åœ°æ–¹ï¼Œè¿˜æœ‰ä¿®æ”¹ripçš„åœ°æ–¹ï¼Œä¹‹å‰è°ƒè¯•çˆ¶è¿›ç¨‹ä¸€ç›´æœ‰å¼‚å¸¸ï¼Œé—®é¢˜å°±åœ¨è¿™é‡Œè·³è¿‡çš„ï¼Œè·Ÿè¿›å­è¿›ç¨‹\n\nå·®ä¸å¤šå°±æ˜¯ä¸¤ä¸ªè¾“å…¥ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œå†ç»§ç»­è·Ÿ\n\nå°±åŠ å¯†æ–¹å¼ï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œåªæ˜¯æ³¨æ„ä¸€ç‚¹å°±æ˜¯emailæ˜¯ä¸å½±å“æœ€åç»“æœï¼Œæ”¾ä¸‹exp\n#include&lt;cstdio&gt;\n#include&lt;cstring&gt;\n#include&quot;defs.h&quot;\nint main()\n&#123;\n   int dword_4xx[376]&#x3D;&#123;0x0000001D, 0x0000006E, 0x0000004E, 0x0000003F, 0x00000039, 0x0000003A, 0x00000028, 0x00000029, 0x00000017, 0x00000014, 0x00000037, 0x00000046, 0x00000043, 0x00000030, 0x00000011, 0x00000012, 0x0000002D, 0x0000002E, 0x00000002, 0x0000000C, 0x00000030, 0x00000031, 0x00000032, 0x0000003E, 0x00000025, 0x00000026, 0x00000005, 0x00000076, 0x0000005E, 0x0000002D, 0x0000000F, 0x0000000C, 0x0000001D, 0x0000001E, 0x0000003F, 0x0000004C, 0x00000066, 0x00000015, 0x00000038, 0x0000003B, 0x00000015, 0x00000016, 0x00000006, 0x00000075, 0x0000006F, 0x0000001C, 0x00000003, 0x00000000, 0x0000000D, 0x0000007C, 0x0000007F, 0x00000003, 0x00000010, 0x0000006C, 0x0000007A, 0x0000000B, 0x00000005, 0x00000006, 0x0000002A, 0x0000002B, 0x00000021, 0x00000052, 0x0000007D, 0x0000000E, 0x00000050, 0x00000053, 0x0000007F, 0x0000007C, 0x0000005B, 0x0000005A, 0x00000056, 0x00000058, 0x0000006C, 0x00000010, 0x00000006, 0x00000077, 0x00000071, 0x00000072, 0x00000050, 0x00000051, 0x0000007D, 0x0000000E, 0x00000011, 0x00000062, 0x00000078, 0x0000007B, 0x0000006B, 0x00000068, 0x00000076, 0x00000078, 0x0000007E, 0x00000070, 0x00000071, 0x00000070, 0x00000043, 0x00000040, 0x0000005D, 0x00000051, 0x00000046, 0x0000003A, 0x00000005, 0x00000079, 0x00000042, 0x0000004C, 0x00000079, 0x0000007A, 0x00000057, 0x00000026, 0x00000023, 0x0000005F, 0x0000004A, 0x00000044, 0x0000006D, 0x0000006C, 0x0000006C, 0x0000006F, 0x00000049, 0x0000004A, 0x00000066, 0x00000067, 0x00000054, 0x0000005A, 0x0000005E, 0x00000050, 0x00000063, 0x00000062, 0x00000052, 0x00000051, 0x000000BD, 0x000000BE, 0x0000009D, 0x0000009C, 0x000000A9, 0x000000A8, 0x00000097, 0x00000099, 0x000000AD, 0x000000D1, 0x000000C6, 0x000000B7, 0x000000B1, 0x000000B2, 0x00000090, 0x000000E3, 0x000000DC, 0x000000A0, 0x000000B7, 0x000000B9, 0x0000008B, 0x0000008A, 0x000000BB, 0x000000B8, 0x000000A5, 0x000000A6, 0x000000B7, 0x000000B6, 0x00000082, 0x000000F1, 0x000000DD, 0x000000AE, 0x000000BE, 0x000000B0, 0x00000086, 0x0000008A, 0x00000099, 0x000000E8, 0x000000E5, 0x00000096, 0x000000B8, 0x000000B9, 0x000000B4, 0x000000C7, 0x000000E1, 0x00000092, 0x00000080, 0x00000083, 0x0000008D, 0x0000008E, 0x000000A2, 0x000000A3, 0x000000A5, 0x000000A4, 0x000000AB, 0x000000D8, 0x000000F7, 0x00000084, 0x00000094, 0x000000E7, 0x000000F1, 0x00000080, 0x00000083, 0x00000080, 0x000000D0, 0x000000A3, 0x00000081, 0x000000F2, 0x000000E9, 0x000000E8, 0x000000D9, 0x000000D8, 0x000000E6, 0x000000E7, 0x000000D5, 0x000000D6, 0x000000F1, 0x000000F2, 0x000000D1, 0x000000A2, 0x00000093, 0x00000092, 0x00000090, 0x000000E3, 0x000000C4, 0x000000C5, 0x000000C9, 0x000000C8, 0x000000C7, 0x000000C4, 0x000000E7, 0x000000E4, 0x000000C1, 0x000000C0, 0x000000F0, 0x000000F1, 0x000000F0, 0x000000F1, 0x000000FC, 0x0000008F, 0x000000A6, 0x000000D5, 0x000000F8, 0x000000FB, 0x000000D5, 0x000000D6, 0x000000C7, 0x000000B4, 0x0000008D, 0x0000008C, 0x000000A3, 0x000000D0, 0x000000DE, 0x000000DF, 0x000000EC, 0x000000ED, 0x000000E9, 0x000000EA, 0x000000CB, 0x000000BA, 0x000000BA, 0x000000C9, 0x000000E7, 0x00000094, 0x000000B0, 0x000000CC, 0x000000DB, 0x000000D5, 0x0000002E, 0x0000002F, 0x0000002C, 0x0000002F, 0x00000039, 0x0000003A, 0x00000016, 0x00000017, 0x00000017, 0x00000016, 0x00000017, 0x00000019, 0x00000029, 0x00000055, 0x00000041, 0x00000040, 0x00000052, 0x0000002E, 0x00000037, 0x0000003B, 0x00000029, 0x0000002A, 0x00000006, 0x00000075, 0x00000054, 0x00000028, 0x0000003F, 0x00000031, 0x00000030, 0x0000003E, 0x0000003A, 0x00000034, 0x0000000D, 0x0000007E, 0x0000006E, 0x0000001F, 0x00000019, 0x0000001A, 0x00000039, 0x0000004A, 0x00000049, 0x00000048, 0x00000065, 0x00000016, 0x0000003C, 0x0000003D, 0x00000002, 0x0000000C, 0x00000015, 0x00000069, 0x0000007E, 0x0000000F, 0x00000009, 0x0000000A, 0x0000002B, 0x00000058, 0x00000074, 0x00000007, 0x00000016, 0x00000018, 0x00000019, 0x00000017, 0x0000002F, 0x0000002E, 0x0000006D, 0x0000001E, 0x00000000, 0x00000071, 0x00000079, 0x0000007A, 0x0000006A, 0x00000019, 0x00000004, 0x00000077, 0x00000064, 0x00000017, 0x0000000F, 0x00000073, 0x0000006A, 0x00000064, 0x0000004D, 0x0000004C, 0x00000042, 0x00000041, 0x00000069, 0x00000018, 0x0000001B, 0x0000001A, 0x0000001B, 0x0000001A, 0x00000016, 0x00000065, 0x00000042, 0x0000004C, 0x0000007A, 0x00000006, 0x0000002D, 0x0000002C, 0x0000002E, 0x0000005F, 0x00000059, 0x0000005A, 0x00000076, 0x00000077, 0x00000075, 0x0000007B, 0x0000004E, 0x00000040, 0x00000073, 0x00000000, 0x00000021, 0x00000052, 0x00000060, 0x0000006E, 0x00000056, 0x0000002A, 0x00000036, 0x00000047, 0x0000004B, 0x00000078&#125;;\n\n    for(int i&#x3D;374;i&gt;&#x3D;0;i--)\n    &#123;\n        dword_4xx[i]&#x3D;(char)dword_4xx[i]^(char)dword_4xx[i+1]^i;\n    &#125;\n    unsigned __int8 v20;\n    unsigned __int8 v19;\n    unsigned __int8 v18;\n    dword_4xx[375]&#x3D;0x78;\n    char v10[96];\n    char res1[500]&#x3D;&#123;0&#125;;\n    strcpy(v10,&quot;ABCDEFGH&quot;);\n    strcpy(&amp;v10[9],&quot;12345678&quot;);\n    strcpy(&amp;v10[18],&quot;0IJKLMNO&quot;);\n    strcpy(&amp;v10[27],&quot;+OPQRStu&quot;);\n    strcpy(&amp;v10[36],&quot;\\\\vwxyzTU&quot;);\n    strcpy(&amp;v10[45],&quot;abcdefgh&quot;);\n    strcpy(&amp;v10[54],&quot;VWXYZijk&quot;);\n    strcpy(&amp;v10[63],&quot;lmnopqrs&quot;);\n    int ccc&#x3D;0;\n    for(int i&#x3D;0;i&lt;&#x3D;374;i+&#x3D;2)\n    &#123;\n        for(int j&#x3D;0;j&lt;255;j++)\n        &#123;\n            v20&#x3D;(j&gt;&gt;6)&amp;1;\n            v19&#x3D;(j&gt;&gt;3)&amp;7;\n            v18&#x3D;j&amp;7;\n            if(v10[9*v20+v19]&#x3D;&#x3D;dword_4xx[i]&amp;&amp;v10[9*v19+v18]&#x3D;&#x3D;dword_4xx[i+1])\n            &#123;\n              res1[i&#x2F;2]&#x3D;j;\n              ccc+&#x3D;1;\n              break;\n            &#125;\n        &#125;\n    &#125;\n    \n    printf(&quot;%s&quot;,res1);\n    printf(&quot;%d&quot;,ccc);\n&#125;\n\n\n\nc &#x3D; &quot;4d#52#e2#188#2b0#4b3#7a6#c8d#14a1#218d#36a7#5864#8f80#e843#17827#2609d#3d926#63a38#a13c5#104e5c#1a6252#2ab122#4513b3#6fc534#b4d955#1249eb9#1d9786d#2fe179d#4d7906b#7d5a841#cad38cd#1482e18b#&quot;\ntt&#x3D;c.split(&quot;#&quot;)\ntt&#x3D;tt[:-1]\nprint(int(&quot;0x&quot;+tt[0],16))\nflag&#x3D;chr(0x4d)+chr(0x52)\nprint(tt)\nfor i in range(2,len(tt)):\n    tempSum&#x3D;int(&quot;0x&quot;+tt[i-1],16)+int(&quot;0x&quot;+tt[i-2],16)\n    tempSxm&#x3D;int(&quot;0x&quot;+tt[i],16)\n    flag+&#x3D;chr(tempSxm-tempSum)\nprint(flag)\n\n\n\n\n\ndynnamic_debugæ„æ€æ˜¯åŠ¨æ€è°ƒè¯•ï¼Œé‚£å°±åŠ¨è°ƒå‘—ï¼ŒæŒ‰ä¹‹å‰çš„ç»éªŒå°±æ˜¯f7å°±å®Œäº‹äº†ï¼Œåˆ°ä¸€äº›å…³é”®åœ°æ–¹ï¼ŒåŸºæœ¬å°±è§£å¯†å®Œæˆäº†ï¼Œè¿™é¢˜ä¹Ÿä¸€æ ·\nç„¶åå°±æ˜¯teaåŠ å¯†ï¼Œå¾ˆå¸¸è§„ï¼Œkeyæ‹¿åˆ°ä¹‹åï¼Œè§£å¯†å°±å®Œäº‹äº†\n#include &lt;cstdio&gt;\n#include &lt;cstring&gt;\n#include &quot;defs.h&quot;\n#include&lt;iostream&gt;\n  \n&#x2F;&#x2F;åŠ å¯†å‡½æ•°  \nvoid encrypt (uint32_t* v, uint32_t* k) &#123;  \n    uint32_t v0&#x3D;v[0], v1&#x3D;v[1], sum&#x3D;0, i;           &#x2F;* set up *&#x2F;  \n    uint32_t delta&#x3D;0x9e3779b9;                     &#x2F;* a key schedule constant *&#x2F;  \n    uint32_t k0&#x3D;k[0], k1&#x3D;k[1], k2&#x3D;k[2], k3&#x3D;k[3];   &#x2F;* cache key *&#x2F;  \n    for (i&#x3D;0; i &lt; 32; i++) &#123;                       &#x2F;* basic cycle start *&#x2F;  \n        sum +&#x3D; delta;  \n        v0 +&#x3D; ((v1&lt;&lt;4) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;5) + k1);  \n        v1 +&#x3D; ((v0&lt;&lt;4) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;5) + k3);  \n    &#125;                                              &#x2F;* end cycle *&#x2F;  \n    v[0]&#x3D;v0; v[1]&#x3D;v1;  \n&#125;  \n&#x2F;&#x2F;è§£å¯†å‡½æ•°  \nvoid decrypt (uint32_t* v, uint32_t* k) &#123;  \n    uint32_t v0&#x3D;v[0], v1&#x3D;v[1], sum&#x3D;0xC6EF3720, i;  &#x2F;* set up *&#x2F;  \n    uint32_t delta&#x3D;0x9e3779b9;                     &#x2F;* a key schedule constant *&#x2F;  \n    uint32_t k0&#x3D;k[0], k1&#x3D;k[1], k2&#x3D;k[2], k3&#x3D;k[3];   &#x2F;* cache key *&#x2F;  \n    for (i&#x3D;0; i&lt;32; i++) &#123;                         &#x2F;* basic cycle start *&#x2F;  \n        v1 -&#x3D; ((v0&lt;&lt;4) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;5) + k3);  \n        v0 -&#x3D; ((v1&lt;&lt;4) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;5) + k1);  \n        sum -&#x3D; delta;  \n    &#125;                                              &#x2F;* end cycle *&#x2F;  \n    v[0]&#x3D;v0; v[1]&#x3D;v1;  \n&#125;  \n  \nint main()  \n&#123;  \n    uint32_t v[] &#x3D;\n&#123;\n  0x5585A199, 0x7E825D68,0x944D0039, 0x71726943, 0x6A514306, 0x4B14AD00, 0x64D20D3F, 0x9F37DB15&#125;;\n    uint32_t k[4]&#x3D;&#123;0x6B696C69,0x79645F65,0x696D616E,0x67626463&#125;;  \n    &#x2F;&#x2F; vä¸ºè¦åŠ å¯†çš„æ•°æ®æ˜¯ä¸¤ä¸ª32ä½æ— ç¬¦å·æ•´æ•°  \n    &#x2F;&#x2F; kä¸ºåŠ å¯†è§£å¯†å¯†é’¥ï¼Œä¸º4ä¸ª32ä½æ— ç¬¦å·æ•´æ•°ï¼Œå³å¯†é’¥é•¿åº¦ä¸º128ä½   \n    for(int i&#x3D;0;i&lt;8;i+&#x3D;2)\n    &#123;\n        decrypt(v+i, k);  \n    &#125; \n    \n    printf(&quot;%s&quot;,v); \n    return 0;  \n&#125;  \n\n\n","slug":"2021MRCTF-Re-wp","date":"2021-04-17T03:54:09.000Z","categories_index":"writeup","tags_index":"reverse","author_index":"YenKoc"},{"id":"e5bc877fa4a0c33bb045786c11ac5c34","title":"pikachué¶åœº-RCE","content":"æ¦‚è¿°\nå…¶å®å°±æ˜¯æ²¡å¯¹è¾“å…¥åšé™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ è¾“å…¥ï¼Œç„¶åç›´æ¥åœ¨å¯¹æ–¹çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼ŒèŠœæ¹–\nexec ping\nç”¨ç®¡é“ç¬¦éš”å¼€ï¼Œå¯ä»¥æ‰§è¡Œä¸¤æ®µå‘½ä»¤ï¼Œè®°ä½å°±è¡Œ\nexec eval\næ‰§è¡Œä¸äº†å°±ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç›´æ¥è¾“å…¥phpinfo();ï¼Œç†è®ºä¸Šphpä¸Šçš„ä»»æ„å¯æ‰§è¡Œçš„å‘½ä»¤éƒ½å¯ä»¥çš„\n\n","slug":"pikachué¶åœº-RCE","date":"2021-04-16T08:13:55.000Z","categories_index":"æ¸—é€æµ‹è¯•","tags_index":"æ¸—é€æµ‹è¯•","author_index":"YenKoc"},{"id":"f73a8e23e6f6f669cf99c7dba8fa0722","title":"","content":"æ¦‚è¿°\næœ‰ä¸€è¯´ä¸€ï¼Œè¿™é‡Œæ¦‚è¿°è®²çš„éå¸¸æ¸…æ™°äº†ï¼Œå°¤å…¶æ˜¯xsså’Œcsrfçš„åŒºåˆ«ï¼Œcsrfå…¶å®å°±æ˜¯å€Ÿç”¨ä»–äººçš„æ‰‹å»å¹²åäº‹ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬å»æ‹¿åˆ°ä»–çš„cookieå»å¹²åäº‹çš„ï¼Œè¿™é‡ŒåŒºåˆ«è¿˜æ˜¯æœ‰çš„ï¼Œæ ¸å¿ƒè¡¨ç°å°±æ˜¯æä¸ªè™šå‡é“¾æ¥ï¼Œäº‹å…ˆæŠŠè¦æ¥å£å’Œå‚æ•°å†™å¥½ï¼Œä¸€ç‚¹å‡»å°±ç«‹é©¬å‘é€è¯·æ±‚ï¼Œæµ‹è¯•äº†ä¸‹æ˜¯ä¼šè‡ªåŠ¨åŠ cookieçš„ï¼Œæ‰€ä»¥tokenå°±å¾ˆé‡è¦äº†ï¼Œå¦‚æœæ²¡æœ‰ç±»ä¼¼tokenè¿™ç§æ ¡éªŒï¼Œé‚£ä¹ˆå°±æ— æ³•åˆ¤æ–­è¿™ä¸ªç©æ„æ˜¯ä¸æ˜¯ä»–æœ¬æ„å‘é€çš„ã€‚ã€‚æ¯•ç«Ÿcookieçš„æ—¶æ•ˆä¼šæŒç»­ä¸€æ®µæ—¶é—´çš„ï¼Œ\ncsrf(get)\nç™»å½•åï¼Œå‘ç°ä¸€ä¸ªè¡¨å•æ˜¯ä¿®æ”¹ä¿¡æ¯çš„ï¼Œbpä¸ŠæŠ“åŒ…ï¼Œå‘ç°æ˜¯getè¯·æ±‚ï¼Œå¥½å®¶ä¼™\n\né‚£ä¹ˆæˆ‘åªè¦æœ‰cookieï¼ŒæŠŠå‚æ•°ä¸€æ”¹ï¼Œæˆ‘å°±å¯ä»¥æŠŠä¸ªäººä¿¡æ¯æ”¹äº†ï¼Œé‚£ä¹ˆåªéœ€è¦ç”Ÿæˆä¸€ä¸ªé“¾æ¥ï¼Œç‚¹å‡»å®Œäº‹äº†ï¼Œbpä¸Š\næœ‰ç”Ÿæˆcsrfçš„æŒ‰é’®ï¼ŒæŒ‰å®Œå°±å¯ä»¥æ“ä½œäº†2333\n\næµ‹è¯•äº†ä¸€æ³¢ï¼Œå‘ç°æ²¡å•¥å¤§æ¯›ç—…ï¼Œç‚¹å‡»åï¼Œå‘ç°ä¼°è®¡æ˜¯åŸŸåè¯†åˆ«è¿˜æ˜¯ï¼Œä¼šè‡ªåŠ¨åŠ ä¸ŠåŸŸåçš„ï¼Œç¨³\ncsrfï¼ˆpostï¼‰å’Œä¸Šé¢å·®ä¸å¤šï¼Œemmï¼Œä¸è¿‡getæ–¹æ³•ï¼Œæ˜¯å¯ä»¥ç›´æ¥åœ¨urlä¸ŠåŠ å‚æ•°ï¼Œé‚£ä¹ˆç›´æ¥ç‚¹å‡»å°±å¤„ç½šï¼Œpostæ˜¯åªèƒ½ç”¨è¡¨å•äº†\ncsrfï¼ˆToken)\nå’Œä¸Šæ–‡çš„æš´åŠ›ç ´è§£å·®ä¸å¤šçš„ï¼Œæ¯æ¬¡è¯·æ±‚ï¼ŒæœåŠ¡å™¨éƒ½ä¼šè¿”å›ä¸€ä¸ªä¸åŒçš„tokenï¼Œä¸è¿‡åº”è¯¥æ˜¯æœ‰æ—¶æ•ˆçš„ï¼Œè€Œä¸”æ—¶æ•ˆè¿˜ä¸\nçŸ­ï¼Œé—®é¢˜åŠ äº†tokenï¼Œè¿™ä¸ªé“¾æ¥å¦‚æœé•¿æ—¶é—´æ²¡å»ç‚¹å‡»å°±å®ŒçŠŠå­äº†ï¼Œè€Œä¸”tokenå»å“ªè·å¾—2333ï¼Œæ‰€ä»¥è¿™é¢˜æ ¹æœ¬æ²¡è§£\n","slug":"pikachué¶åœº-CSRF","date":"2021-04-16T07:24:58.532Z","categories_index":"","tags_index":"","author_index":"YenKoc"},{"id":"4b815d1a9fd6704c9aee8cee1d9828dc","title":"pikachué¶åœº-XSS","content":"xssï¼ˆè·¨ç«™è„šæœ¬ï¼‰æ¦‚è¿°ä¸€èˆ¬xsså¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ç§å¸¸è§çš„ç±»å‹ï¼š\n\nåå°„æ€§xss\nå­˜å‚¨å‹xss\nDomå‹xss\n\nåå°„å‹xss(get)\nä¸€ä¸ªè¾“å…¥æ¡†ï¼Œç„¶åè¾“å…¥çš„æ—¶å€™ï¼Œå‘ç°ä¼šå‡ºç°ï¼Œæˆ‘è¾“å…¥ä»€ä¹ˆï¼Œä¸‹é¢ä¼šç›´æ¥æ˜¾ç¤ºå‡ºä¸€å¥è¯åŠ ä¸Šæˆ‘è¾“å…¥çš„åœ°æ–¹ï¼Œè¿™é‡Œå°±å®¹æ˜“å‡ºç°xssæ¼æ´ï¼Œå…ˆå¼¹çª—ï¼Œå¼¹ä¸‹\n\nå¹¶æ²¡æœ‰ä»€ä¹ˆè¿‡æ»¤ï¼Œå’Œè½¬ä¹‰ï¼Œç›´æ¥å¼¹çª—æˆåŠŸï¼Œhhh\nåå°„æ€§xssï¼ˆpostï¼‰\nç›´æ¥admin/123åï¼Œæ ¹æ®æç¤ºï¼Œæ˜¯è·å–cookieï¼Œæœäº†ä¸‹è·å–cookieçš„xssæ‰‹æ³•ï¼Œç›´æ¥æ‰“ï¼Œç„¶åå‘ç°è¿˜æœ‰ä¸€ç§å¯ä»¥å°†cookieä¼ è¾“åˆ°å…¶ä»–æœåŠ¡å™¨çš„ï¼Œnb\nå­˜å‚¨å‹xss\nå‘ç°ä¸€ä¸ªç•™è¨€æ¿ï¼Œè¾“å…¥çš„ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œè€Œä¸”æ˜¯æŒä¹…åŒ–çš„ï¼Œå­˜å‚¨åœ¨æ•°æ®åº“é‡Œï¼Œå¤§æ¦‚é€»è¾‘å°±æ˜¯æˆ‘ä»¬è¾“å…¥ï¼Œç„¶åå‘è¯·æ±‚ï¼Œåœ¨æ•°æ®åº“ä¸­ï¼Œæ’å…¥ä¸€æ¡è®°å½•ï¼Œå¹¶è¿”å›å“åº”ï¼Œåˆ·æ–°é¡µé¢ï¼Œå°†æ–°çš„è®°å½•æ˜¾ç¤ºå‡ºæ¥ï¼Œï¼Œé‚£ä¹ˆå¦‚æœè¿™é‡Œæœ‰xssï¼Œæ¯æ¬¡åˆ·æ–°ä¹Ÿæ„å‘³ç€éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡\n\ndomå‹xssä¸»è¦æ˜¯æ„é€ domæ ‘çš„è¯­æ³•ï¼Œå„ç§htmlæ ‡ç­¾ï¼Œå¯¹æˆ‘è¿™ç§åƒåœ¾å…¨æ ˆè¿˜æš‚æ—¶ä¸æ˜¯é—®é¢˜\n\nå‘ç°æˆ‘ä»¬è¾“å…¥çš„å†…å®¹åœ¨domé‡Œé¢ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥æ„é€ è¾“å…¥å†…å®¹ï¼Œé—­åˆaæ ‡ç­¾ï¼Œç„¶åæ·»åŠ ä¸Šæˆ‘ä»¬çš„payloadï¼Œæ³¨æ„é‚£ä¸ªå‡½æ•°ï¼Œé‡Œé¢çš„å•å¼•å·ï¼Œè¿™é‡Œå¾—æ³¨æ„ï¼Œ\npayloadï¼šâ€™&gt;\ndom xss-a\nxss ç›²æ‰“\nç›²æ‰“çš„æ„æ€æ˜¯å‰ç«¯æ˜¯æ²¡æŠŠå†…å®¹è¿”å›å‡ºæ¥çš„ï¼Œä½†æ˜¯åå°ç®¡ç†å‘˜åœ¨æŸ¥çœ‹åå°æ¶ˆæ¯æ—¶ï¼Œå¦‚æœæ²¡å¯¹xssè¿›è¡Œè¿‡æ»¤æˆ–è€…è½¬ä¹‰ï¼Œé‚£ä¹ˆç®¡ç†å‘˜ä¼šçœ‹åˆ°xssçš„æ•ˆæœï¼Œä¸Šå›¾æ˜¯æˆ‘æäº¤åï¼Œç™»å½•åå°çœ‹åˆ°çš„\nxssè¿‡æ»¤è§‚å¯Ÿä¸‹æºç \n\nå‘ç°æ˜¯è¿‡æ»¤äº†&lt;å¼€å¤´ï¼Œä¸­é—´åŒ…å«scriptè¿™å‡ ä¸ªå­—ç¬¦çš„ï¼Œå…¨éƒ¨æ›¿æ¢æˆç©ºäº†ï¼Œemmï¼Œé‚£ä¹ˆå…¨å¤§å†™ä¸å°±è¿‡äº†ï¼Œï¼Œæˆ–è€…ä½¿ç”¨imgæ ‡ç­¾ï¼Œä¸ä¹Ÿèƒ½è¿‡\nxss htmlcharè¿™ç©æ„ä¼šå°†æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œ\n\nä½†æ˜¯å¹¶æ²¡æœ‰å¯¹æˆ‘ä»¬çš„å•å¼•å·è¿›è¡Œè½¬ä¹‰ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥æ„é€ xss\nâ€˜onclick=â€™alert(1). è¿™é‡Œç¬¬ä¸€ä¸ªå•å¼•å·æ˜¯ä¸ºäº†é—­åˆhrefçš„åŒå¼•å·ï¼Œç¬¬äºŒä¸ªå•å¼•å·ï¼Œæ˜¯ä¸ºäº†åä¸€ä¸ªå•å¼•å·\n\nxss hrefè¾“å‡ºæ‰‹åŠ¨fuzzäº†ä¸‹ï¼Œå‘ç°å•å¼•å·ä»€ä¹ˆçš„ï¼Œæ²¡ç”¨äº†ï¼Œä¼°è®¡è¢«è¿‡æ»¤äº†ï¼Œè¿™é‡Œhrefè¿˜å¯ä»¥å°è¯•ä¼ªåè®®è¿›è¡Œç»•è¿‡\n\nxss çš„jsè¾“å‡ºåœ¨å“åº”åŒ…å‘ç°æˆ‘ä»¬çš„è¾“å…¥ï¼Œèµ‹å€¼ç»™äº†ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ å‡ºè‡ªå·±çš„jsä»£ç ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ‰§è¡Œå°±åƒè¿™æ ·\n\n","slug":"pikachué¶åœº-XSS","date":"2021-04-16T01:34:32.000Z","categories_index":"æ¸—é€æµ‹è¯•","tags_index":"æ¸—é€æµ‹è¯•","author_index":"YenKoc"},{"id":"40d02940207fb31febc4e2293b7db511","title":"pikachué¶åœº-æš´åŠ›ç ´è§£","content":"1. åŸºäºè¡¨å•çš„æš´åŠ›ç ´è§£\nè¿™ç©æ„å°±æ˜¯è€ƒbpçš„çˆ†ç ´æ¨¡å—çš„ä½¿ç”¨ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ¡†éœ€è¦çˆ†ç ´ï¼Œé‚£ä¹ˆbpçš„çˆ†ç ´æ¨¡å—çš„æ¨¡å¼é€‰æ‹©ä¹Ÿå¾—å‘ç”Ÿå˜åŒ–\n\nå°†æˆ‘ä»¬éœ€è¦æ‰€è¦çˆ†ç ´çš„åœ°æ–¹ï¼ŒåŠ $ç¬¦å·ï¼Œç„¶åæ”»å‡»ç±»å‹é€‰æ‹©clusterbombï¼Œè¿™ä¸ªæ˜¯é€‚ç”¨äºå¤šä¸ªå‚æ•°è¿›è¡Œçˆ†ç ´çš„ï¼Œæ¨¡å¼æ˜¯ç¬›å¡å°”ç§¯\nç›´æ¥è·‘å°±å®Œäº‹äº†\n2. éªŒè¯ç ç»•è¿‡on serverè¿™é‡ŒåŠ å…¥äº†éªŒè¯ç ï¼Œä¸è¿‡ä¸ç”¨æ…Œï¼Œé€šè¿‡æ‰‹åŠ¨æµ‹ï¼Œå‘ç°æ¯æ¬¡è¾“å…¥ç›¸åŒçš„éªŒè¯ç ï¼Œåªä¼šæç¤ºæˆ‘ä»¬ç”¨æˆ·åæˆ–è€…å¯†ç é—®é¢˜ï¼Œé‚£ä¹ˆè¯´æ˜éªŒè¯ç æ˜¯å…·æœ‰ä¸€å®šæœ‰æ•ˆæ€§çš„ï¼Œå¤§æ¦‚ç‡æ˜¯æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªéªŒè¯ç åï¼Œç”¨åˆ—è¡¨ä»€ä¹ˆçš„å­˜å‚¨èµ·æ¥äº†ï¼Œç„¶åæäº¤ä»æ± ä¸­å¯¹æ¯”\n3. éªŒè¯ç ç»•è¿‡on clientå‘ç°æ˜¯å®¢æˆ·ç«¯jsç”ŸæˆéªŒè¯ç ï¼ŒåŒæ—¶å¯¹æ¯”ï¼Œå¦‚æœé”™è¯¯å°±æ— æ³•å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆæ ¹æœ¬å°±ä¸ç”¨é¸Ÿè¿™ä¸ªå‰ç«¯æ ¡éªŒï¼Œç›´æ¥å‘é€ä¸€ä¸ªéªŒè¯ç æ­£ç¡®çš„è¯·æ±‚ï¼Œbpä¸Šçˆ†ç ´ï¼Œä¸èµ°jsçš„åˆ¤æ–­ä¸å°±å®Œäº‹äº†\n4. tokené˜²çˆ†ç ´è¿™ä¸ªæ¯”è¾ƒå¸¸è§çš„ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡æˆ‘ä»¬å‘è¯·æ±‚çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šäº‹å…ˆå°†æœåŠ¡ç«¯ç”Ÿæˆçš„tokenï¼Œé€šè¿‡å“åº”ï¼Œè¿”å›åˆ°æˆ‘ä»¬æµè§ˆå™¨çš„æœ¬åœ°ä¸Šï¼Œå¯èƒ½æ˜¯cookieï¼Œæˆ–è€…æ˜¯formè¡¨å•çš„ï¼Œéšè—åŸŸï¼Œè¿™é¢˜å±äºåè€…ï¼Œå› ä¸ºæˆ‘é€šè¿‡æœç´¢htmlçš„æºç ï¼Œå‘ç°äº†å®ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æ€è·¯å¯ä»¥æ˜¯æ¯æ¬¡åœ¨å‘é€ç©ç©é”™è¯¯è¯·æ±‚åï¼Œå°†è¿”å›çš„htmlï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼Œå–å‡ºtokenï¼Œä½œä¸ºä¸‹ä¸€æ¬¡è¯·æ±‚çš„å‚æ•°ï¼Œç›´æ¥çˆ¬è™«\nimport requests\nimport re\nurl&#x3D;&quot;http:&#x2F;&#x2F;192.168.8.125&#x2F;pikachu&#x2F;vul&#x2F;burteforce&#x2F;bf_token.php&quot;\ndatas&#x3D;&#123;\n    &quot;username&quot;:&quot;admin&quot;,\n    &quot;password&quot;:&quot;123&quot;,\n    &quot;token&quot;:1234124,\n    &quot;submit&quot;:&quot;Login&quot;\n&#125;\npattern&#x3D;re.compile(&quot;token\\&quot; value&#x3D;\\&quot;\\d*&quot;)\nresponse&#x3D;requests.post(url&#x3D;url,data&#x3D;datas)\nprint(pattern.findall(response.text)[0].split(&quot;&#x3D;\\&quot;&quot;)[1])\n#print(response.text)\n\n\n\n\n","slug":"pikachué¶åœº-æš´åŠ›ç ´è§£","date":"2021-04-15T13:31:57.000Z","categories_index":"æ¸—é€æµ‹è¯•","tags_index":"æ¸—é€æµ‹è¯•","author_index":"YenKoc"},{"id":"950945665e1fae17418166fca4d96e19","title":"pixelåˆ·å…¥å®˜æ–¹é•œåƒä»¥åŠmagisk","content":"å‰è¨€åæ§½ä¸‹ï¼Œæœ¬æ¥æ˜¯æ‰“ç®—è½¬edxposedï¼Œå¥½å®¶ä¼™ï¼Œtwå¡åˆ·ï¼Œæˆ‘è¿™ä¸€ç›´éƒ½æ˜¯è‹±æ–‡ï¼Œæ ¹æœ¬å®‰è£…ä¸äº†ï¼Œmmpï¼Œåˆ·ç€åˆ·ç€æˆç –å¤´äº†ã€‚ã€‚æ‰€ä»¥å°±ä»å®˜æ–¹é•œåƒç«™é‡Œä¸‹è½½äº†å®˜æ–¹é•œåƒ8.1ï¼Œå¼€å§‹åˆ·ç³»ç»Ÿï¼Œå¹¶è£…å…¥ä¹‹å‰çš„magiskï¼Œå› ä¸ºç°åœ¨magiskæ®çæƒœè¡¨å“¥è¯´å¯¹exposedå…¼å®¹å¾ˆå·®ï¼Œæˆ‘äº²æµ‹ä¹Ÿç¡®å®æ˜¯è¿™æ ·çš„ï¼Œå†™è¿™ç¯‡æ–‡ç« è®°å½•ä¸‹è¿‡ç¨‹\nåˆ·å…¥å®˜æ–¹é•œåƒ\nå…ˆå»å®˜æ–¹çš„é•œåƒç«™ä¸‹è½½\né“¾æ¥: https://developers.google.cn/android/images#sailfish\n\nä¸‹è½½å®Œæ˜¯ä¸€ä¸ªzipåŒ…ï¼Œè§£å‹åï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„ã€‚\n\n\nè¿™æ—¶å€™æ‰‹æœºå¼€å§‹äº†ï¼Œå› ä¸ºæ‰‹æœºå˜ç –å¤´äº†ï¼Œæ‰€ä»¥ä»€ä¹ˆå‘½ä»¤è¡Œè¿›å…¥fastbootå°±æ˜¯ç‹—å±ï¼Œå…³æœºé”®åŠ éŸ³é‡ä¸‹é”®æŒç»­å‡ ç§’ï¼Œå°±è¿›å…¥fastbootæ¨¡å¼ï¼Œfastbootä¹Ÿå«åšçº¿åˆ·æ¨¡å¼ï¼Œrecoveryæ˜¯å¡åˆ·ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å–œæ¬¢æŠŠå®‰è£…çš„ä¸œè¥¿pushåˆ°sdå¡ä¸‹ï¼Œç„¶ååˆ·å…¥ç¬¬ä¸‰æ–¹recoryçš„åŸå› ï¼Œæ‰¯è¿œäº†233\n\nç”µè„‘æ‰“å¼€ç»ˆç«¯ï¼Œè¿›å…¥è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œç›´æ¥è¿è¡Œshåç¼€çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç­‰å¾…è¿è¡Œç»“æŸå°±åˆ·å®Œäº†ï¼Œè¿˜æ˜¯æŒºç®€å•çš„\n\n\n\n\nã€€# åˆ·å…¥magisk\n\nä¹‹å‰åˆ·å…¥ç³»ç»Ÿäº†ï¼Œå·²ç»å¯ä»¥æ­£å¸¸å¼€æœºäº†ï¼Œå…ˆæŠŠusbè°ƒè¯•æ‰“å¼€ï¼Œç„¶åæŠŠmagiskçš„zipåŒ…ä»¥åŠtwçš„zipåŒ…pushåˆ°sdcardä¸‹æˆ–è€…/data/local/tmpä¸‹ï¼Œæˆ‘è¿™é‡Œpushåˆ°sdcardä¸‹å°±ä¹±ç ï¼Œæ‰€ä»¥é€‰æ‹©å¦ä¸€ä¸ªäº†ï¼Œéƒ½å·®ä¸å¤šçš„\n\n\nä¸‹è½½ä¸ªä¸´æ—¶çš„twçš„imgæ–‡ä»¶ï¼Œä¹‹ååˆ·å…¥ç¬¬ä¸‰æ–¹çš„recoveryï¼Œé“¾æ¥æ”¾ä¸‹:https://dl.twrp.me/marlin/twrp-3.1.1-1-fastboot-marlin.img\nadb reboot bootloader      fastboot boot xxx/twrp-3.1.1-1-fastboot-marlin.img\n\nè¿›å…¥ç¬¬ä¸‰æ–¹recoveryæ¨¡å¼ï¼Œå°±ä¸ç”¨å¤šè¯´äº†ï¼Œè¿›å…¥æˆ‘ä»¬æ”¾zipåŒ…çš„ç›®å½•ä¸‹ï¼Œç‚¹å‡»å®‰è£…ï¼Œé‡æ–°å¯åŠ¨å°±å®Œäº‹äº†\n\n\nå‚è€ƒé“¾æ¥\nhttps://www.cnblogs.com/YenKoc/p/14236792.html\nhttps://sspai.com/post/43338\nhttps://blog.csdn.net/a940659387/article/details/109116460\nhttps://www.xzymoe.com/pixel-xl-unlockbl-root/\n\n","slug":"pixelåˆ·å…¥å®˜æ–¹é•œåƒä»¥åŠmagisk","date":"2021-04-13T17:32:59.000Z","categories_index":"åˆ·æœº","tags_index":"åˆ·æœº","author_index":"YenKoc"},{"id":"94996d3e08d5b007f0ef9d436bcc2ac8","title":"ARMæ±‡ç¼–ï¼ˆè½¬è½½,ä¸»è¦ç”¨æ¥æŸ¥è¯¢çš„)","content":"å‰è¨€æœ¬æ¥æƒ³è‡ªå·±å†™å†™ï¼Œå‘ç°ç½‘ä¸Šå¸ˆå‚…ä»¬å†™çš„æ–‡ç« å·²ç»è¶³å¤Ÿè¯¦ç»†å’Œä¼˜ç§€ï¼Œå°±æ‰“ç®—ç›´æ¥ç™½å«–äº†ï¼Œæˆ‘æ˜¯æ‡’ç‹—ï¼‰ï¼Œæ¯•ç«Ÿæ±‡ç¼–è¿™ä¸œè¥¿è¿˜æ˜¯å¾—å¤šçœ‹ï¼Œç„¶åå¹³å¸¸å°±å¤šæŸ¥æŸ¥ï¼Œä¸ç„¶å°±åƒæˆ‘ä¹‹å‰è¿å‡½æ•°è°ƒç”¨è¿”å›ç»“æœå­˜å‚¨åˆ°r0ï¼Œéƒ½å›ç­”é”™äº†ï¼Œmmpï¼Œr0-r4ä¼˜å…ˆå­˜æ”¾å‡½æ•°å‚æ•°çš„ï¼Œr11å…¶å®å°±æ˜¯x86ä¸­çš„ebpå’Œx64çš„rbpï¼Œr13å°±æ˜¯rspå’Œespï¼Œr14å­˜æ”¾è¿”å›åœ°å€ï¼Œå‡½æ•°è°ƒç”¨è¿‡ç¨‹å’Œx64å¤§ä½“å·®ä¸å¤šï¼Œå‰©ä¸‹å°±æ˜¯å¤šæŸ¥æŸ¥2333\næŸ¥è¯¢é“¾æ¥\nhttps://www.anquanke.com/post/id/86383\nhttps://github.com/bin4re/Learn-and-Think-More/blob/master/Android%20Security/Arm%E6%B1%87%E7%BC%96/arm%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89.md\n\n","slug":"ARMæ±‡ç¼–ï¼ˆè½¬è½½-ä¸»è¦ç”¨æ¥æŸ¥è¯¢çš„","date":"2021-04-13T15:40:54.000Z","categories_index":"ARMæ±‡ç¼–","tags_index":"","author_index":"YenKoc"},{"id":"490dee142b27f79f3072c0e4373d70d3","title":"å…³äºæŸapicloudåŠ å¯†çš„appçš„é€†å‘åˆ†æä»¥åŠè§£å¯†","content":"å‰è¨€åŒäº‹å‘ç°äº†ä¸€ä¸ªhtmlå’Œjsä½œä¸ºä¸»è¦é€»è¾‘å®ç°çš„appï¼Œå¥½å®¶ä¼™ï¼Œå¹¶ä¸”èµ„æºæ–‡ä»¶éƒ½è¢«åŠ å¯†ï¼Œæ‰“å¼€å°±ä¹±ç ï¼Œè¿™æ³¢æˆ‘ä¹Ÿæ²¡è§è¿‡ï¼Œä¸è¿‡çœ‹æˆ‘åŒäº‹åœ¨é€†ï¼Œæˆ‘å› ä¸ºå¥½å¥‡ä¹Ÿå»é€†äº†ä¸‹ï¼Œå¥½å®¶ä¼™ï¼Œæ‰‹æœºæœç„¶å‡ºé—®é¢˜äº†ï¼Œfrida hookä¸åˆ°å…³é”®å‡½æ•°ï¼Œå¯¼è‡´å¡äº†å¾ˆä¹…ï¼ŒæŠŠæˆ‘æ–¹å‘éƒ½æä¹±äº†ï¼Œæœ€ç»ˆåœ¨æˆ‘åŒäº‹å’Œæˆ‘åšäº†å¯¹æ¯”å˜é‡ï¼Œåæ’é™¤äº†ä»£ç é—®é¢˜ï¼Œé”å®šæ˜¯æ‰‹æœºé—®é¢˜ï¼Œåˆ·æœºä¹‹åï¼Œæ¢å¤æ­£å¸¸ï¼‰ï¼Œæ²¡æœ‰ä»€ä¹ˆé—®é¢˜æ˜¯åˆ·æœºè§£å†³ä¸äº†çš„ã€‚\nåˆ†æè¿‡ç¨‹å®é™…ä¸Šç›´æ¥é¢å¯¹è¿™ç§ï¼Œå®é™…ä¸Šå¾ˆæ‡µçš„ï¼Œé€†å‘å¦‚æœåŸºäºå¼€å‘çš„è§’åº¦å»é€†å‘ï¼Œä¼šåŠ å¿«é€†å‘çš„é€Ÿåº¦çš„ï¼Œå¹¶æ›´å®¹æ˜“å»å®šä½åˆ°å…³é”®é€»è¾‘ï¼Œè¿™jsåœ¨æœ¬åœ°åŠ å¯†ï¼Œé‚£ä¹ˆæœ‰ä¸€ç§å¯èƒ½æ˜¯å‘é€è¯·æ±‚ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šè§£å¯†åï¼Œä¼ å›æ­£å¸¸jsç„¶åè§£å¯†ï¼Œæˆ–è€…ç›´æ¥åœ¨æœ¬åœ°å°±è§£å¯†äº†ï¼Œæœäº†ä¸‹ï¼Œå‘ç°è¿™ä¸ªæ¡†æ¶å«apicloudï¼Œçœ‹äº†ä¸‹å¼€å‘æµç¨‹ï¼Œæ„Ÿè§‰æ²¡æ¶‰åŠåˆ°åŠ è§£å¯†ï¼Œåº”è¯¥æ˜¯apicloudè‡ªå·±çš„sdkï¼Œè‡ªå·±å¸®ç”¨æˆ·å·²ç»å°è£…å¥½äº†ï¼Œæ—¢ç„¶å·²ç»çŸ¥é“äº†è¿™ä¸ªä¸œè¥¿æ˜¯ä»€ä¹ˆï¼Œé‚£ä¹ˆç«™åœ¨å·¨äººçš„è§’åº¦ä¸Šï¼Œä¼šä¸ä¼šæ›´å¥½ï¼Œç›´æ¥æœï¼Œå‘ç°çœ‹é›ªä¹‹å‰æœ‰å¤§ä½¬å·²ç»å‘äº†ä¸€ç¯‡apicloudé€†å‘è§£å¯†çš„æ–‡ç« ï¼Œå¥½å¥‡ï¼Œç›´æ¥ç‚¹è¿›å»\n\nå‘ç°äº†è¿™å¥è¯ï¼Œè¯´æ˜è¿™ä¸ªæ–¹æ³•æ˜¯æˆ‘ä»¬è¦æ‰¾çš„é‡ç‚¹ï¼Œç›´æ¥jebæœç´¢\n\nå…¶ä»–çš„å‡ ä¸ªæ–¹æ³•éƒ½è·Ÿäº†ä¸‹ï¼Œæœ€ç»ˆè¿˜æ˜¯å›è°ƒè¿™ä¸ªæ–¹æ³•ï¼Œå†å’Œä¹‹å‰é‚£ç¯‡æ–‡ç« å¯¹æ¯”ä¸‹ï¼Œå‘ç°æ²¡å•¥å·®åˆ«çš„\nè·Ÿä¸€ä¸‹b.d()æ–¹æ³•\n\næœ€ç»ˆæ˜¯è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œå…¶å®å°±æ˜¯è¿”å›æ–‡ä»¶åç¼€çš„ï¼Œåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œæ„ˆå‘å‘ç°ï¼Œå¾ˆå¤šæ—¶å€™è¦å…ˆä»å¤§é€»è¾‘å¼€å§‹é€†ï¼Œç„¶åå†æ·±å…¥è¿™ä¸ªå¤§é€»è¾‘å»é€†å‘ç»†èŠ‚ï¼Œä¹Ÿå¯èƒ½å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¹ æƒ¯f8ï¼Œå†f7ï¼Œæ‰¾åˆ°ä»€ä¹ˆé‡è¦ï¼Œä»€ä¹ˆæ ¹æœ¬å°±æ²¡å¿…è¦è·Ÿã€‚\nä¸‹ä¸€æ­¥è·Ÿthis.b()æ–¹æ³•\n\né‡ç‚¹æ˜¯f.a()æ–¹æ³•ï¼Œåœ¨æˆ‘ä½¿ç”¨fridaå»hookæ—¶å€™ï¼Œå‘ç°è¿”å›å€¼å°±æ˜¯è§£å¯†åçš„å­—èŠ‚æµï¼Œå¥½å®¶ä¼™ï¼Œé‚£ä¹ˆè¿™ç©æ„åŠ å¯†çš„æ„ä¹‰å°±ä¸å¤§äº†ï¼Œ\nä»£ç æ²¡æ··æ·†ï¼Œé‚£ä¹ˆæˆ‘åªè¦hookè¿™ä¸ªæ–¹æ³•ï¼ŒæŠŠå­—èŠ‚æµdumpä¸‹æ¥ï¼Œä¸å°±å®Œäº‹äº†ï¼Œä¸è¿‡è¿™æ ·æœ‰ä¸ªé—®é¢˜å°±æ˜¯é‚£æ²¡åŠ è½½çš„æ–‡ä»¶æ— æ³•è§£å¯†ï¼Œæ‰€ä»¥æ‰¾åˆ°æ ¸å¿ƒçš„åŠ å¯†é€»è¾‘æ‰è¡Œï¼Œç»§ç»­è·Ÿè¿›å»\n\næ ¸å¿ƒåŠ å¯†è·Ÿè¿›\n\n\nå†ç»§ç»­\n\nnext\n\nå‘ç°è·Ÿè¿›äº†nativeå‡½æ•°é‡Œé¢ï¼Œidaæ‹¿å‡ºæ¥ï¼Œå¹²å®ƒï¼Œå‘ç°æ˜¯åŠ¨æ€æ³¨å†Œï¼Œæ‰¾åˆ°ç»“æ„ä½“\n\né€šè¿‡åŠ¨æ€è°ƒè¯•ï¼Œå‘ç°æ ¸å¿ƒåŠ å¯†å‡½æ•°\n\n\nå°±ä¸è·Ÿè¿›å»äº†ï¼Œé‡ç‚¹æ˜¯åˆ†ææ€è·¯ï¼Œé™æ€åˆ†æï¼Œå¾ˆæ˜æ˜¾çš„rc4åŠ å¯†ï¼ŒæŠŠkeydumpä¸‹æ¥å°±å¯ä»¥æ­£å¸¸è§£å¯†æ–‡ä»¶äº†ï¼Œæˆ‘åŒäº‹ä¹Ÿå†™äº†ä¸€ä¸ªè§£å¯†æœ¬åœ°æ–‡ä»¶çš„cppè„šæœ¬ï¼Œæˆ‘å°±ä¸é‡å¤é€ è½®å­äº†ï¼Œå°±åˆ†äº«ä¸‹\n","slug":"å…³äºæŸapicloudåŠ å¯†çš„appçš„é€†å‘åˆ†æä»¥åŠè§£å¯†","date":"2021-04-11T16:00:43.000Z","categories_index":"appå®æˆ˜","tags_index":"a-iCloud","author_index":"YenKoc"},{"id":"7cc37a0c897d960438332a3e8c6a890d","title":"JNI helperæ’ä»¶ä½¿ç”¨","content":"1. å‰è¨€çœ‹ç›´æ’­çš„æ—¶å€™ï¼Œè‚‰ä¸è¡¨å“¥è®²äº†r2çš„jni æ’ä»¶ï¼Œè®²åˆ°äº†jni helperï¼Œeviå¤§ä½¬å†™çš„ä¸€æ¬¾ï¼Œè‡ªåŠ¨è¯†åˆ«jniç±»å‹çš„æ’ä»¶ï¼Œå…¼å®¹äº†å¥½å‡ æ¬¾å¸¸è§çš„åç¼–è¯‘å·¥å…·ï¼Œä¹‹å‰ä¹Ÿç»™äº†githubæ˜Ÿæ˜Ÿçš„ï¼Œä½†æ˜¯å…·ä½“æ€ä¹ˆä½¿ç”¨æ²¡å»çœ‹ï¼Œè¿™é‡Œåˆšå¥½è®²åˆ°äº†ï¼Œæˆ‘ä¹Ÿäº†è§£äº†ä¸‹ï¼Œæœ€ç»ˆæ•ˆæœè¿˜ä¸é”™ï¼Œè†œ\n2. ä½¿ç”¨è¿‡ç¨‹\nå…ˆä»githubä¸Šclone ä¸€ä»½é¡¹ç›®ä¸‹æ¥\n\n\nç„¶åè¿™é‡Œè¿›å…¥JadxFindJNIç›®å½•ä¸‹ï¼Œmake jniï¼Œæˆ–è€…ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„jaråŒ…ï¼Œå› ä¸ºéœ€è¦è¿™ä¸ªjaråŒ…åˆ†æapk\n\n\nç„¶ååœ¨å‘½ä»¤è¡Œä¸‹ä½¿ç”¨jaråŒ…å»åˆ†æapkåŒ…ï¼Œå¾—åˆ°ä¸€ä»½jsonæ–‡ä»¶\n\n\nokä¹‹åï¼Œå°†jnihelper3.py(å› ä¸ºæˆ‘è¿™é‡Œä½¿ç”¨çš„ida7.5æ‰€ä»¥ï¼Œæ˜¯3)ï¼Œ7.4ä»¥ä¸‹ä½¿ç”¨æ™®é€š.pyÂ ,å¤åˆ¶è¿›pluginç›®å½•ä¸‹å°±å¥½äº†ï¼Œç„¶åæ‰“å¼€idaï¼Œæ‰“å¼€pluginï¼Œé€‰æ‹©ä¹‹å‰ç”Ÿæˆçš„jsonæ–‡ä»¶ï¼Œç­‰å¾…å‡ ç§’ï¼Œåˆ†æå®Œæˆ\n\n\næ•ˆæœå±•ç¤º\n\n","slug":"JNI-helperæ’ä»¶ä½¿ç”¨","date":"2021-04-07T17:15:59.000Z","categories_index":"idaæ’ä»¶","tags_index":"idaæ’ä»¶","author_index":"YenKoc"},{"id":"b0f886f319692d13d933a2573c7d3ea9","title":"2021è™ç¬¦ctf","content":"1.  codeé€šè¿‡å»è§‚å¯Ÿä»£ç é€»è¾‘ï¼Œå‘ç°æ˜¯å…ˆåˆå§‹åŒ–å‡ºä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œç„¶åå¼€å§‹å–å­—ç¬¦ï¼Œä¸è¿‡æ¯è¡Œä¸­çš„åˆ—æ•°ä¸ºå­—ç¬¦çš„asciiç å€¼æ—¶ï¼Œè€Œå–å‡ºæ¥ä¸ºä¸‹ä¸€è¡Œçš„è¡Œæ•°ï¼Œå†å¡«å……å›å»ï¼Œè€Œv7é‚£ä¸ªå¾ªç¯ï¼Œè¦æƒ³æˆåŠŸçš„æ¡ä»¶ï¼Œå°±æ˜¯å¿…é¡»æ¯æ¬¡éƒ½æ‰¾åˆ°ä¸‹ä¸€è¡Œçš„è¡Œæ•°ï¼Œé‚£ä¹ˆå…¶å®flagå°±æ˜¯è¾“å…¥çš„å‰14ä½å­—ç¬¦ï¼Œç›´æ¥æäº¤\n2.  goå‘ç°æ²¡å»æ‰ç¬¦å·è¡¨ï¼Œç›´æ¥å»çœ‹main_mainå‡½æ•°ï¼Œç„¶åå‘ç°æœ‰å‡ ä¸ªå‡½æ•°å¾ˆå¯ç–‘ï¼Œé€šè¿‡åŠ¨è°ƒè°ƒè¯•å‘ç°å…ˆç»è¿‡ä¸€ä¸ªæ ¼å¼çš„æ£€æŸ¥ï¼Œè¦æ»¡è¶³å‰é¢5ä½flag{ï¼Œåé¢3ç±»4ä¸ª0-9a-fï¼Œæœ€åæ˜¯12ä¸ªå­—ç¬¦çš„0-9a-fï¼Œå†åé¢å°±æ˜¯ä½¿ç”¨äº†ä¸¤æ¬¡çš„xteaåŠ å¯†ï¼Œä¸è¿‡æ˜¯é­”æ”¹çš„ï¼ŒæŠŠå¸¸æ•°æ›¿æ¢ä¹‹åå°±å¥½ï¼Œç›´æ¥ä»ç½‘ä¸Šcopyä¸€ä»½xteaçš„è§£å¯†è„šæœ¬ï¼Œé­”æ”¹ä¸‹ï¼Œè§£å°±å®Œäº‹äº†\n\n#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n\nvoid encipher(unsigned int num_rounds, uint32_t v[2], uint32_t const key[4]) &#123;\nunsigned int i;\nuint32_t v0&#x3D;v[0], v1&#x3D;v[1], sum&#x3D;0, delta&#x3D;0x12345678;\nfor (i&#x3D;0; i &lt; num_rounds; i++) &#123;\nv0 +&#x3D; (((v1 &lt;&lt; 4) ^ (v1 &gt;&gt; 5)) + v1) ^ (sum + key[sum &amp; 3]);\nsum +&#x3D; delta;\nv1 +&#x3D; (((v0 &lt;&lt; 4) ^ (v0 &gt;&gt; 5)) + v0) ^ (sum + key[(sum&gt;&gt;11) &amp; 3]);\n&#125;\nv[0]&#x3D;v0; v[1]&#x3D;v1;\n&#125;\n\nvoid decipher(unsigned int num_rounds, uint32_t v[2], uint32_t const key[4]) &#123;\nunsigned int i;\nuint32_t v0&#x3D;v[0], v1&#x3D;v[1], delta&#x3D;0x12345678, sum&#x3D;delta*num_rounds;\nfor (i&#x3D;0; i &lt; num_rounds; i++) &#123;\nv1 -&#x3D; (((v0 &lt;&lt; 4) ^ (v0 &gt;&gt; 5)) + v0) ^ (sum + key[(sum&gt;&gt;11) &amp; 3]);\nsum -&#x3D; delta;\nv0 -&#x3D; (((v1 &lt;&lt; 4) ^ (v1 &gt;&gt; 5)) + v1) ^ (sum + key[sum &amp; 3]);\n&#125;\nv[0]&#x3D;v0; v[1]&#x3D;v1;\n&#125;\nint main()\n&#123;\nuint32_t v[2]&#x3D;&#123;0x0ec311f0,0x45c79af3&#125;;\n&#x2F;&#x2F;uint32_t v[2]&#x3D;&#123;0xedf5d910,0x542702cb&#125;;\nuint32_t const k[4]&#x3D;&#123;0x010203,0x04050607,0x08090a0b,0x0c0d0e0f&#125;;\nunsigned int r&#x3D;32;&#x2F;&#x2F;num_roundsé”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·å–å€¼ä¸º32\ndecipher(r, v, k);\nprintf(&quot;%x %x\\n&quot;,v[0],v[1]);\nreturn 0;\n&#125;\n\n3.  CrackMeå‘ç°ä¸¤ä¸ªè¾“å…¥ï¼Œç¬¬ä¸€ä¸ªè¾“å…¥æ˜¯å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªæ˜¯æ•°å­—ï¼Œç„¶åå‘ç°æœ‰ä¸€ä¸ªifï¼Œåªå’Œæ•°å­—æœ‰å…³ç³»ï¼Œç„¶åæ˜¯intï¼Œè€ƒè™‘åˆ©ç”¨idapythonè¿›è¡Œçˆ†ç ´ï¼Œæˆ–è€…å’Œ2stå¤§å“¥ä¸€æ ·ä½¿ç”¨inline hookè¿›è¡Œçˆ†ç ´ï¼Œååçš„,ï¼Œæ”¾ä¸‹å„’å“¥çš„çˆ†ç ´è„šæœ¬ï¼Œæˆ‘å†™çš„ä¸ªida6çš„äº§ç‰©ï¼Œmmpï¼Œå…¶å®è¿™ç§idapythonå°±æ˜¯å¯¹inline hookç”¨idapythonçš„å½¢å¼è¿›è¡Œå¤è¿°äº†ä¸€éï¼Œä¸»è¦æ˜¯æ§åˆ¶ripå¯„å­˜å™¨æ¥æ”¹å˜ç¨‹åºæµç¨‹ï¼ŒåŒæ—¶è¿™ç§æ˜¯åŠ¨æ€æ‰§è¡Œçš„ï¼Œä¹‹å‰ä¸€ç›´æƒ³çš„æ˜¯ç±»ä¼¼unicorné‚£ç§æ¨¡æ‹Ÿæ‰§è¡Œçš„ï¼Œemmï¼Œæƒ³æ­ªäº†\nimport ida_dbg\nimport idc\n\n\nclass MyDbgHook(ida_dbg.DBG_Hooks):\n  def __init__(self):\n    ida_dbg.DBG_Hooks.__init__(self)  # important\n    self.guess &#x3D; 0\n    self.cin1_addr &#x3D; 0x140001658\n    self.cin2_addr &#x3D; 0x140001762\n    self.before_cin2 &#x3D; 0x14000175B\n    self.after_cin2 &#x3D; 0x140001768\n    self.chk_addr &#x3D; 0x14000184E\n\n  def log(self, msg):\n    print(&quot;&gt;&gt;&gt; %s&quot; % msg)\n\n  def dbg_bpt(self, tid, ea):\n    if ea &#x3D;&#x3D; self.cin1_addr:\n      self.reset()\n    elif ea &#x3D;&#x3D; self.cin2_addr:\n      ida_dbg.set_reg_val(&#39;rip&#39;, self.after_cin2)\n      rsp &#x3D; ida_dbg.get_reg_val(&#39;rsp&#39;)\n      idc.patch_qword(rsp+0x40, self.guess)\n      self.continue_process()\n    elif ea &#x3D;&#x3D; self.chk_addr:\n      ebx &#x3D; ida_dbg.get_reg_val(&#39;ebx&#39;)\n      eax &#x3D; ida_dbg.get_reg_val(&#39;eax&#39;)\n      if ebx !&#x3D; 80643:\n        self.guess +&#x3D; 12379\n        self.reset()\n      elif eax !&#x3D; 1442:\n        self.guess +&#x3D; 1\n        self.reset()\n      else:\n        self.log(str(self.guess))\n        self.continue_process()\n    return 0\n\n  def continue_process(self):\n    pass\n\n  def reset(self):\n    ida_dbg.set_reg_val(&#39;rip&#39;, self.before_cin2)\n    self.continue_process()\n\n  def dbg_process_exit(self, *args):\n    self.unhook()\n    self.log(&quot;unhooked&quot;)\n\n\n# Install the debug hook\ndebughook &#x3D; MyDbgHook()\ndebughook.hook()\nida_dbg.request_start_process()\nida_dbg.run_requests()\n\n\nè·‘å‡ºæ¥ä¸€ä¸ªæ•°å­—99308ï¼Œç„¶åå°±æ˜¯ä¸€ä¸ªå¸¸è§„çš„rc4ï¼Œç›´æ¥è§£å¼€å°±å®Œäº‹äº†\n","slug":"2021è™ç¬¦ctf","date":"2021-04-07T14:43:37.000Z","categories_index":"writeup","tags_index":"reverse","author_index":"YenKoc"},{"id":"509e3543271104a33a26b59536e47f22","title":"çœ‹é›ªæŸæ•°å­—å£³æµ‹è¯•é¢˜","content":"è„±å£³å‘ç°åŠ äº†æ•°å­—å£³ï¼Œç›´æ¥ç”¨frida-çš„dexdumpæˆ–è€…å¯’å†°å¤§ä½¬çš„fartè„±ï¼Œå°±å®Œäº‹äº†ï¼Œæˆ‘è¿™é‡Œè¿˜æ˜¯æ¯”è¾ƒå–œæ¬¢objectionæ­é…frida-dexdumpæ’ä»¶çš„æ–¹å¼ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œå¯¹è¿™ç§æ²¡æŠ½å–çš„å£³ï¼Œä¹Ÿå®Œå…¨è¶³å¤Ÿäº†ï¼Œç›´æ¥æ“ä½œ\n\nä»å†…å­˜ä¸­dumpä¸‹äº†ï¼Œä¸‰ä¸ªdexï¼Œå‘½ä»¤è¡Œè¾“å…¥grep -ril â€œMainActivityâ€ * ï¼ŒæŠŠä¸»æ´»åŠ¨æ‰¾åˆ°ï¼Œå‘ç°æ˜¯d0å¼€å¤´çš„dex\n\nä»£ç åˆ†æå°†è„±ä¸‹æ¥çš„dexï¼Œæ‹–å…¥jadxä¸­ï¼Œå‘ç°æ•ˆæœå¹¶ä¸å¥½ï¼Œå¾ˆå¤šåœ°æ–¹æ‰¾ä¸åˆ°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¯’å†°å–œæ¬¢ç”¨gdaæ¥åç¼–è¯‘å§ï¼Œå›½äº§ç‰›é€¼ï¼\n\n\nä¸è¿‡å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ‰€æœ‰çš„æ–¹æ³•ï¼Œéƒ½å˜æˆnativeå‡½æ•°äº†ï¼Œè¿™ä¸å°±æ˜¯dex2cå—ï¼Œå¥½å®¶ä¼™ï¼Œç›´æ¥idaå®‰æ’ä¸Šï¼Œå»æ‰¾è¿™ä¸ªonclickæ–¹æ³•\n\nå‘ç°è¿™ä¸ªonclickæ–¹æ³•ä¸­å­—ç¬¦ä¸²å…¨è¢«åŠ å¯†äº†ï¼ŒåŒæ—¶åŠ å¯†çš„å‡½æ•°å°±åœ¨.initæ®µï¼Œå¯ä»¥çœ‹åˆ°ä¸€æ®µçš„ä»£ç è¿›è¡Œå¼‚æˆ–\n\nå¥½å®¶ä¼™ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œè¦ä¹ˆé™æ€çš„å»å†™idaè„šæœ¬ï¼Œè¦ä¹ˆå°±æ˜¯åŠ¨æ€ç›´æ¥attachä¸Šå»ï¼Œæ¯•ç«Ÿè¿™ä¸ªæ®µæ˜¯åœ¨soè½½å…¥å†…å­˜ä¸­å°±ä¼šæ‰§è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦attachä¸Šå»çš„è¯ï¼Œå­—ç¬¦ä¸²å°±æ˜¯è§£å¯†åçš„\nè¿™é‡Œæˆ‘æ²¡æˆªå›¾äº†ï¼Œæ˜¨æ™šå†™çš„äº†ï¼Œç¨å¾®æè¿°ä¸‹è¿‡ç¨‹ï¼Œå¼€å¯androidserverï¼Œç«¯å£è½¬å‘åï¼Œç›´æ¥å¼€å§‹attachï¼Œattachä¸Šå»åï¼Œä¸éœ€è¦æ“ä½œäº†ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ²¡åœ¨å“ªä¸ªsoä¸­ä¸‹æ–­ç‚¹ï¼Œæˆ‘ä»¬åªè¦åœ¨å†…å­˜ä¸­æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„å‡½æ•°ï¼Œæ ¹æ®soçš„åŸºåœ°å€åŠ ä¸Šå‡½æ•°åç§»ï¼Œæ‰€ä»¥æ ¹æœ¬åˆ«æ…Œï¼Œè¿™é‡Œæœ‰ä¸ªå‘ç‚¹å°±æ˜¯æœå‡ºæ¥æœ‰ä¸¤ä¸ªsoæ–‡ä»¶ï¼Œå…·ä½“é€‰å“ªä¸ªï¼Œå¾—çœ‹ï¼Œæˆ‘ä»¬åŠ ä¸Šåç§»åæ˜¯å¦è·³è½¬åˆ°æ­£ç¡®åœ°å€ä¸Šã€‚\næ‰¾åˆ°æ­£ç¡®å‡½æ•°äº†ï¼Œf5ï¼Œç„¶åæ”¹jnienvä¹‹åï¼Œå‘ç°å°±æ˜¯å…¸å‹çš„dex2cï¼Œåœ¨jniå±‚è°ƒç”¨javaå±‚çš„å‡½æ•°ï¼Œæ²‰æ€ï¼Œæˆ‘å°±åœ¨æƒ³é‚£ä¹ˆç›´æ¥hookï¼Œæ‰€æœ‰çš„getxxxxidï¼Œsetxxxidä¸å°±å®Œäº‹ï¼Œæ‰¾äº†æ¨ç¥ä¹‹å‰çš„è„šæœ¬ï¼Œç›´æ¥hookå‘ç°ï¼Œå¥”æºƒäº†ã€‚ã€‚ä¼°è®¡æœ‰åfridaã€‚ã€‚è¿™é‡Œæœ‰ä¸ªæ€æƒ³æˆ‘è§‰å¾—å¾ˆå¥½ï¼Œå°±æ˜¯ä»åº•å±‚è€ƒè™‘èµ·æ¥ï¼Œæœ‰æ—¶å€™ç›´æ¥å»æ‰¾å“ªé‡Œåè°ƒè¯•ï¼Œå‹åŠ›å¾ˆå¤§ï¼Œé€†å‘çš„å»æƒ³ï¼Œæ—¢ç„¶åè°ƒè¯•å¥”æºƒäº†ï¼Œé‚£å¿…ç„¶è°ƒç”¨äº†ä¸€ä¸ªå¥”æºƒå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡æ‰¾åˆ°å¥”æºƒå‡½æ•°çš„å¼•ç”¨ï¼Œä¸€æ­¥ä¸€æ­¥çš„åè·Ÿä¸Šå»å‘¢ã€‚\n\nåœ¨ä¸¤ä¸ªsoä¸­ï¼Œéƒ½æœäº†ä¸‹ï¼Œå‘ç°åœ¨libnative-lib.soä¸‹è¿˜çœŸæœ‰ï¼Œæ‰¾åˆ°äº†åè°ƒè¯•çš„åœ°æ–¹\n\né‚£ä¹ˆæˆ‘ä»¬ç¬¬ä¸€æ­¥å°±éœ€è¦æŠŠåè°ƒè¯•ç»™ç»•è¿‡äº†ï¼Œè¿™é‡Œæ˜¯é€‰æ‹©hook killå‡½æ•°ï¼Œæ¯•ç«Ÿkillæ˜¯é€€å‡ºï¼Œå¦‚æœhookä¸ºç©ºï¼Œç¨‹åºä¸å°±æ­£å¸¸äº†ã€‚\nå…¶å®è¿˜æœ‰å¾ˆå¤šæ“ä½œï¼Œæ¯”å¦‚hook strstrï¼Œgetpidï¼ˆï¼‰éƒ½æ˜¯å¯ä»¥çš„\nç›´æ¥ä¸Šè„šæœ¬\n\n\n&#x2F;*\nGetFieldID is at  0xe39b87c5 _ZN3art3JNI10GetFieldIDEP7_JNIEnvP7_jclassPKcS6_\nGetMethodID is at  0xe39a1a19 _ZN3art3JNI11GetMethodIDEP7_JNIEnvP7_jclassPKcS6_\nNewStringUTF is at  0xe39cff25 _ZN3art3JNI12NewStringUTFEP7_JNIEnvPKc\nRegisterNatives is at  0xe39e08fd _ZN3art3JNI15RegisterNativesEP7_JNIEnvP7_jclassPK15JNINativeMethodi\nGetStaticFieldID is at  0xe39c9635 _ZN3art3JNI16GetStaticFieldIDEP7_JNIEnvP7_jclassPKcS6_\nGetStaticMethodID is at  0xe39be0ed _ZN3art3JNI17GetStaticMethodIDEP7_JNIEnvP7_jclassPKcS6_\nGetStringUTFChars is at  0xe39d06e5 _ZN3art3JNI17GetStringUTFCharsEP7_JNIEnvP8_jstringPh\nFindClass is at  0xe399ae5d _ZN3art3JNI9FindClassEP7_JNIEnvPKc\n*&#x2F;  \nfunction hookkill()\n&#123;\n        var module&#x3D;Process.findModuleByName(&quot;libc.so&quot;);\n        var killAddr&#x3D;module.findExportByName(&quot;kill&quot;);\n        Interceptor.replace(killAddr,new NativeCallback(function(args0,args1)&#123;\n            console.log(&quot;Interceptor.attach myfirstjniJNI args:&quot;,args0,args1);\n            \n            return 11;\n    \n        &#125;,&quot;int&quot;,[&quot;pointer&quot;,&quot;int&quot;]));\n       \n&#125;\nfunction hook_libart() &#123;\n    var symbols &#x3D; Module.enumerateSymbolsSync(&quot;libart.so&quot;);\n    var addrGetStringUTFChars &#x3D; null;\n    var addrNewStringUTF &#x3D; null;\n    var addrFindClass &#x3D; null;\n    var addrGetMethodID &#x3D; null;\n    var addrGetStaticMethodID &#x3D; null;\n    var addrGetFieldID &#x3D; null;\n    var addrGetStaticFieldID &#x3D; null;\n    var addrRegisterNatives &#x3D; null;\n    for (var i &#x3D; 0; i &lt; symbols.length; i++) &#123;\n        var symbol &#x3D; symbols[i];\n        if (symbol.name.indexOf(&quot;art&quot;) &gt;&#x3D; 0 &amp;&amp;\n            symbol.name.indexOf(&quot;JNI&quot;) &gt;&#x3D; 0 &amp;&amp;\n            symbol.name.indexOf(&quot;CheckJNI&quot;) &lt; 0\n        ) &#123;\n            if (symbol.name.indexOf(&quot;GetStringUTFChars&quot;) &gt;&#x3D; 0) &#123;\n                addrGetStringUTFChars &#x3D; symbol.address;\n                console.log(&quot;GetStringUTFChars is at &quot;, symbol.address, symbol.name);\n            &#125; else if (symbol.name.indexOf(&quot;NewStringUTF&quot;) &gt;&#x3D; 0) &#123;\n                addrNewStringUTF &#x3D; symbol.address;\n                console.log(&quot;NewStringUTF is at &quot;, symbol.address, symbol.name);\n            &#125; else if (symbol.name.indexOf(&quot;FindClass&quot;) &gt;&#x3D; 0) &#123;\n                addrFindClass &#x3D; symbol.address;\n                console.log(&quot;FindClass is at &quot;, symbol.address, symbol.name);\n            &#125; else if (symbol.name.indexOf(&quot;GetMethodID&quot;) &gt;&#x3D; 0) &#123;\n                addrGetMethodID &#x3D; symbol.address;\n                console.log(&quot;GetMethodID is at &quot;, symbol.address, symbol.name);\n            &#125; else if (symbol.name.indexOf(&quot;GetStaticMethodID&quot;) &gt;&#x3D; 0) &#123;\n                addrGetStaticMethodID &#x3D; symbol.address;\n                console.log(&quot;GetStaticMethodID is at &quot;, symbol.address, symbol.name);\n            &#125; else if (symbol.name.indexOf(&quot;GetFieldID&quot;) &gt;&#x3D; 0) &#123;\n                addrGetFieldID &#x3D; symbol.address;\n                console.log(&quot;GetFieldID is at &quot;, symbol.address, symbol.name);\n            &#125; else if (symbol.name.indexOf(&quot;GetStaticFieldID&quot;) &gt;&#x3D; 0) &#123;\n                addrGetStaticFieldID &#x3D; symbol.address;\n                console.log(&quot;GetStaticFieldID is at &quot;, symbol.address, symbol.name);\n            &#125; else if (symbol.name.indexOf(&quot;RegisterNatives&quot;) &gt;&#x3D; 0) &#123;\n                addrRegisterNatives &#x3D; symbol.address;\n                console.log(&quot;RegisterNatives is at &quot;, symbol.address, symbol.name);\n            &#125;\n        &#125;\n    &#125;\n\n    if (addrGetStringUTFChars !&#x3D; null) &#123;\n        Interceptor.attach(addrGetStringUTFChars, &#123;\n            onEnter: function (args) &#123;&#125;,\n            onLeave: function (retval) &#123;\n                if (retval !&#x3D; null) &#123;\n                    var bytes &#x3D; Memory.readCString(retval);\n                    console.log(&quot;[GetStringUTFChars] result:&quot; + bytes);\n                &#125;\n            &#125;\n        &#125;);\n    &#125;\n    if (addrNewStringUTF !&#x3D; null) &#123;\n        Interceptor.attach(addrNewStringUTF, &#123;\n            onEnter: function (args) &#123;\n                if (args[1] !&#x3D; null) &#123;\n                    var string &#x3D; Memory.readCString(args[1]);\n                    console.log(&quot;[NewStringUTF] bytes:&quot; + string);\n                &#125;\n            &#125;,\n            onLeave: function (retval) &#123;&#125;\n        &#125;);\n    &#125;\n    if (addrFindClass !&#x3D; null) &#123;\n        Interceptor.attach(addrFindClass, &#123;\n            onEnter: function (args) &#123;\n                if (args[1] !&#x3D; null) &#123;\n                    var name &#x3D; Memory.readCString(args[1]);\n                    console.log(&quot;[FindClass] name:&quot; + name);\n                &#125;\n            &#125;,\n            onLeave: function (retval) &#123;&#125;\n        &#125;);\n    &#125;\n    if (addrGetMethodID !&#x3D; null) &#123;\n        Interceptor.attach(addrGetMethodID, &#123;\n            onEnter: function (args) &#123;\n                if (args[2] !&#x3D; null) &#123;\n                    var name &#x3D; Memory.readCString(args[2]);\n                    if (args[3] !&#x3D; null) &#123;\n                        var sig &#x3D; Memory.readCString(args[3]);\n                        console.log(&quot;[GetMethodID] name:&quot; + name + &quot;, sig:&quot; + sig);\n                    &#125; else &#123;\n                        console.log(&quot;[GetMethodID] name:&quot; + name);\n                    &#125;\n\n                &#125;\n            &#125;,\n            onLeave: function (retval) &#123;&#125;\n        &#125;);\n    &#125;\n    if (addrGetStaticMethodID !&#x3D; null) &#123;\n        Interceptor.attach(addrGetStaticMethodID, &#123;\n            onEnter: function (args) &#123;\n                if (args[2] !&#x3D; null) &#123;\n                    var name &#x3D; Memory.readCString(args[2]);\n                    if (args[3] !&#x3D; null) &#123;\n                        var sig &#x3D; Memory.readCString(args[3]);\n                        console.log(&quot;[GetStaticMethodID] name:&quot; + name + &quot;, sig:&quot; + sig);\n                    &#125; else &#123;\n                        console.log(&quot;[GetStaticMethodID] name:&quot; + name);\n                    &#125;\n\n                &#125;\n            &#125;,\n            onLeave: function (retval) &#123;&#125;\n        &#125;);\n    &#125;\n    if (addrGetFieldID !&#x3D; null) &#123;\n        Interceptor.attach(addrGetFieldID, &#123;\n            onEnter: function (args) &#123;\n                if (args[2] !&#x3D; null) &#123;\n                    var name &#x3D; Memory.readCString(args[2]);\n                    if (args[3] !&#x3D; null) &#123;\n                        var sig &#x3D; Memory.readCString(args[3]);\n                        console.log(&quot;[GetFieldID] name:&quot; + name + &quot;, sig:&quot; + sig);\n                    &#125; else &#123;\n                        console.log(&quot;[GetFieldID] name:&quot; + name);\n                    &#125;\n\n                &#125;\n            &#125;,\n            onLeave: function (retval) &#123;&#125;\n        &#125;);\n    &#125;\n    if (addrGetStaticFieldID !&#x3D; null) &#123;\n        Interceptor.attach(addrGetStaticFieldID, &#123;\n            onEnter: function (args) &#123;\n                if (args[2] !&#x3D; null) &#123;\n                    var name &#x3D; Memory.readCString(args[2]);\n                    if (args[3] !&#x3D; null) &#123;\n                        var sig &#x3D; Memory.readCString(args[3]);\n                        console.log(&quot;[GetStaticFieldID] name:&quot; + name + &quot;, sig:&quot; + sig);\n                    &#125; else &#123;\n                        console.log(&quot;[GetStaticFieldID] name:&quot; + name);\n                    &#125;\n\n                &#125;\n            &#125;,\n            onLeave: function (retval) &#123;&#125;\n        &#125;);\n    &#125;\n\n    if (addrRegisterNatives !&#x3D; null) &#123;\n        Interceptor.attach(addrRegisterNatives, &#123;\n            onEnter: function (args) &#123;\n                console.log(&quot;[RegisterNatives] method_count:&quot;, args[3]);\n                var env &#x3D; args[0];\n                var java_class &#x3D; args[1];\n                var class_name &#x3D; Java.vm.tryGetEnv().getClassName(java_class);\n\n                var methods_ptr &#x3D; ptr(args[2]);\n\n                var method_count &#x3D; parseInt(args[3]);\n                for (var i &#x3D; 0; i &lt; method_count; i++) &#123;\n                    var name_ptr &#x3D; Memory.readPointer(methods_ptr.add(i * Process.pointerSize * 3));\n                    var sig_ptr &#x3D; Memory.readPointer(methods_ptr.add(i * Process.pointerSize * 3 + Process.pointerSize));\n                    var fnPtr_ptr &#x3D; Memory.readPointer(methods_ptr.add(i * Process.pointerSize * 3 + Process.pointerSize * 2));\n\n                    var name &#x3D; Memory.readCString(name_ptr);\n                    var sig &#x3D; Memory.readCString(sig_ptr);\n                    var find_module &#x3D; Process.findModuleByAddress(fnPtr_ptr);\n                    console.log(&quot;[RegisterNatives] java_class:&quot;, class_name, &quot;name:&quot;, name, &quot;sig:&quot;, sig, &quot;fnPtr:&quot;, fnPtr_ptr, &quot;module_name:&quot;, find_module.name, &quot;module_base:&quot;, find_module.base, &quot;offset:&quot;, ptr(fnPtr_ptr).sub(find_module.base));\n\n                &#125;\n            &#125;,\n            onLeave: function (retval) &#123;&#125;\n        &#125;);\n    &#125;\n&#125;\nfunction main()\n&#123;\n    hookkill();\n    hook_libart();\n&#125;\nsetImmediate(main);\n\n\n\nhookæ•ˆæœï¼Œå“¦å¯¹ï¼Œæœ€å¥½ç”¨attachæ–¹å¼ï¼Œæ¯•ç«Ÿhookæ˜¯libcçš„å‡½æ•°ï¼Œè‚¯å®šè¿˜æœ‰å…¶ä»–åœ°æ–¹ä¼šhookåˆ°ï¼Œä¸ºäº†é¿å…å¤ªå¤šæ— ç”¨ä¿¡æ¯ï¼Œæ‰€ä»¥é€‰æ‹©attach\nfrida -UF com.kanxue.test -l hook_art.js --no-pause\n\n\n\n\né€»è¾‘å°±å¾ˆæ¸…æ™°äº†ï¼Œéå¸¸niceã€‚\n","slug":"çœ‹é›ªæŸæ•°å­—å£³æµ‹è¯•é¢˜","date":"2021-04-07T01:48:58.000Z","categories_index":"appå®æˆ˜","tags_index":"d2c","author_index":"YenKoc"},{"id":"da27febfe9a3ffe7e8fc2063f78d23df","title":"idaæ’ä»¶_traceNativeså‰–æ","content":"å‰è¨€å‰å‡ å¤©åœ¨è‚‰ä¸æœ‹å‹åœˆçœ‹åˆ°äº†é¾™å“¥çš„æ–°ä½œï¼Œä¸€ä¸ªåå«trace_nativeçš„idaæ’ä»¶é¡¹ç›®ï¼Œæˆ‘å‡ºäºå¥½å¥‡å°±æƒ³çœ‹çœ‹æºç ï¼Œå‘ç°å¥½æƒ³åŸç†ä¹Ÿä¸éš¾ï¼Œä¸è¿‡æå‡äº†æ•ˆç‡ï¼Œè¿˜æ˜¯å¾ˆä¸é”™çš„\næºç å‰–æimport os\nfrom idaapi import plugin_t\nfrom idaapi import PLUGIN_PROC\nfrom idaapi import PLGIN_OK\nimport ida_nalt\nimport idaapi\nimport idautils\nimport idc\nimport time\n\n# è·å–soæ–‡ä»¶åå’Œè·¯å¾„\ndef getSoPathAndName()\n&#123;\n  fullpath=ida_nalt.get_input_file_path()\n  #ä»å®Œæ•´è·¯å¾„ä¸­å–å‡ºï¼Œæ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶å\n  filepath,filename=os.path.split(fullpath)\n  return filepath,filename\n&#125;\n# è·å–ä»£ç æ®µçš„èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€\ndef getSegAddr()\n&#123;\n  finalStart=0xffffffff\n  finalEnd=0\n  for seg in idautils.Segments():\n  \tif (idc.get_segm_name(seg).lower())=='.text' or (idc.get_segm_name(seg).lower())=='text':\n  \t\ttempStart=idc.get_segm_start(seg)\n  \t\ttempEnd=idc.get_segm_end(seg)\n  \t\tif finalStart>tempStart:\n  \t\t\t\tfinalStart=tempStart\n  \t\tif finalEnd&lt;tempEnd:\n  \t\t\t\tfinalEnd=tempEnd\n\treturn finalStart,textEnd\n&#125;\nclass traceNatives(plugin_t):\n  flags=PLUGIN_PROC\n  comment=\"traceNatives\"\n  help=\"\"\n  wanted_name=\"traceNatives\"\n  wanted_hotkey=\"\"\n  \n  def init(self):\n    print(\"traceNatives(v0.1) plugin has been loaded\")\n    return PLUGIN_OK\n  def run(self,arg):\n    ea,ed=getSegAddr()\n    search_result=[]\n    for func in idautils.Functions(ea,ed):\n      try:\n        functionName=str(idaapi.ida_funcs.get_func_name(func))\n        if len(list(idautils.FuncItems(func)))>10:\n          #å¦‚æœæ˜¯thumbæ¨¡å¼ï¼Œåœ°å€+1\n          arm_or_thumb=idc.get_sreg(func,\"T\")\n          if arm_or_thumb:\n            func+=1\n          search_result.append(hex(func))\n      except:\n        pass\n    \n    so_path,so_name=getSoPathAndName()\n    search_result=[f\"-a '&#123;so_name&#125;!&#123;offset&#125;'\" for offset in search_result]\n    search_result=\" \".join(search_result)\n    \n    script_name=so_name.split(\".\")[0]+\"_\"+str(int(time.time()))+\".txt\"\n    save_path=os.path.join(so_path,script_name)\n    with open(save_path,\"w\",encoding=\"utf-8\") as f:\n      f.write(search_result)\n    print(\"ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:\")\n    print(f\"frida-trace -UF -O &#123;save_path&#125;\")\n  def term(self):\n    pass\n \t\ndef PLUGIN_ENTRY():\n  return traceNatives()\n     \n         \n\nå®é™…ä¸Šï¼Œå°±æ˜¯é€šè¿‡idapythonæä¾›çš„apiï¼Œå…ˆæ‰¾å‡ºä»£ç æ®µçš„èµ·å§‹åœ°å€å’Œç»“å°¾åœ°å€ï¼Œç„¶åå¯¹ä»£ç æ®µä¸­çš„å‡½æ•°è¿›è¡Œéå†ï¼Œåˆ¤æ–­æ˜¯thumbæ¨¡å¼è¿˜æ˜¯armæ¨¡å¼ï¼Œç„¶åæ ¹æ®ä»€ä¹ˆæ¨¡å¼ï¼Œå¯¹åœ°å€è¿›è¡Œå¤„ç†ï¼Œæå®Œä¹‹åï¼Œå°†åœ°å€å­˜å…¥ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œä¹‹åå°±è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¸ºåç»­ä½¿ç”¨frida-traceæ‰¹é‡hookï¼Œä½œå‡†å¤‡ï¼Œæˆ‘æ”¹äº†ä¸€ä¸ªåœ°æ–¹ï¼Œæ„Ÿè§‰é‚£ä¸ªåœ°æ–¹å†™çš„æœ‰ç‚¹æµªè´¹å†…å­˜ã€‚\næ•ˆæœæ¼”ç¤º\n\n","slug":"idaæ’ä»¶-traceNativeså‰–æ","date":"2021-03-29T13:01:59.000Z","categories_index":"idaæ’ä»¶","tags_index":"idaæ’ä»¶","author_index":"YenKoc"},{"id":"6c1a2f5fee044dc2bb2b3084d9a71810","title":"apkleaksçš„å®‰è£…ä¸ä½¿ç”¨","content":"å‰è¨€ä¸Šæ¬¡å¼€ä¼šçš„æ—¶å€™ï¼Œå¬å°å¸…æœ‰ä¸ªå¯ä»¥ä»appä¸­æ‰¾æ¥å£çš„ä¸€ä¸ªgithubé¡¹ç›®ï¼Œæœ€è¿‘ä¸€ç›´å¿™èµ„äº§æ”¶é›†ï¼Œæ‰€ä»¥æ²¡ç©ºçœ‹ï¼Œä»Šæ™šåˆšå¥½æœ‰ç©ºï¼Œå°±cloneäº†ä¸€ä»½ï¼Œå¹¶å®‰è£…äº†ï¼Œæˆ‘ä¹ æƒ¯ç”¨kaliäº†ï¼Œæ‰€ä»¥è¿™é‡Œå®‰è£…ä¹Ÿæ˜¯ä»¥kaliä½œä¸ºä¸»åŠ›\nå®‰è£…æ–¹æ³•\ncloneä¸€ä»½åˆ°æœ¬åœ°\n\nè¿›å…¥ç›®å½•åï¼Œè¾“å…¥pip3 install -r requirement.txt\n\nç„¶åå°±å¯ä»¥ä½¿ç”¨python apkleads.py -f xx.apk\n\nå‘ç°æé†’æ²¡æœ‰jadxçš„è¯ï¼Œè¦é€‰yï¼Œå°±ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…ï¼Œåˆšåˆšå»githubç®€ä»‹ä¸‹çœ‹äº†ï¼Œä½œè€…è¯´æ˜¯apkleaksåŸºäºjadxæ¥åç¼–è¯‘çš„\n\n\n\nä¸‹è½½åï¼Œå°±ä¼šå‘ç°åŒç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ªjadxæ–‡ä»¶å¤¹äº†ï¼Œè‡³æ­¤å®‰è£…å®Œæˆ\nä½¿ç”¨æ–¹æ³•python apkleaks.py -f xxx.apk\nç„¶åå°±å¼€å§‹æ‰§è¡Œæ‰«æï¼Œä¼šå°†ipå’Œç«¯å£éƒ½æå–å‡ºæ¥ï¼Œä¸è¿‡æˆ‘å®æµ‹è¿˜æ˜¯ä¸å¤Ÿå‡†ç¡®çš„ï¼Œå¦‚æœåªæ‰¾æ¥å£çš„è¯ï¼Œæ€ä¹ˆä¼šè¿™ä¹ˆå¤šå…¶ä»–çš„ä¸œè¥¿æ‰«å‡ºæ¥å‘¢ã€‚ã€‚æˆ‘ä¹Ÿæ„Ÿè§‰å¥‡æ€ªï¼Œæˆ‘å»ºè®®åœ¨è¿™å¥å‘½ä»¤å-o xx.txt, æœ‰äº›appè¿˜æ˜¯æŒºå¤§çš„ï¼Œç»“æœä¼°è®¡ä¼šå¾ˆå¤šï¼Œæ‰¾ä¸ªæ–‡ä»¶ä¿å­˜æ¯”è¾ƒåˆé€‚\n\n","slug":"apkleaksçš„å®‰è£…ä¸ä½¿ç”¨","date":"2021-03-26T18:23:40.000Z","categories_index":"","tags_index":"androidå·¥å…·ä½¿ç”¨","author_index":"YenKoc"},{"id":"c08d96c88052e6a8de3a34b6361e6767","title":"å…³äºæŸsoå‡½æ•°çš„åŠ è§£å¯†ï¼Œä»¥åŠè‡ªä¿®å¤","content":"å‰è¨€ï¼šæ„å¤–åœ¨çœ‹é›ªä¸Šçœ‹åˆ°ä¸€é“é¢˜ï¼Œæ„Ÿè§‰æŒºä¸é”™çš„ï¼Œå°±è‡ªå·±æ‰‹åŠ¨å¤ç°äº†ä¸‹\nåˆ†æè¿‡ç¨‹0x01 è„±å£³è¿™é‡Œä½¿ç”¨jebæ‰“å¼€åï¼Œå‘ç°qihooçš„å­—æ ·ï¼Œæ˜æ˜¾æ˜¯æ•°å­—å£³ï¼Œè¿™é‡Œæ²¡ä½¿ç”¨fartå»è„±ï¼Œå› ä¸ºæˆ‘æ‰‹æœºç›®å‰æ²¡åˆ·æœºï¼Œä¹ æƒ¯dexdumpï¼Œè†œè‘«èŠ¦å¨ƒå¤§å“¥2333ï¼Œè¿™é‡Œä½¿ç”¨objectionåŠ è½½dexdumpæ’ä»¶çš„æ–¹å¼ï¼ŒæŒºæ–¹ä¾¿çš„ï¼Œè‡³äºä½¿ç”¨æ–¹æ³•ï¼Œè§githubï¼Œå…¨è®°ä¸Šé¢äº†ï¼ŒåŸºæœ¬å°±æ˜¯åŠ è½½æ’ä»¶ï¼Œç„¶åplugin dexdump searchï¼Œplugin dexdump dumpï¼Œæœ‰å¯èƒ½ä¼šæŠ¥é”™ï¼Œæœ€è¿‘è‚‰ä¸ä¹Ÿå‘äº†è¿™ä¸ªé—®é¢˜çš„è§£ç­”ï¼Œå…¶å®å°±æ˜¯dexdumpæš´åŠ›æœç´¢æ—¶ï¼Œå‘ç°å¹¶ä¸æ˜¯çœŸæ­£çš„dexï¼Œæ‰€ä»¥æ‰ä¼šå´©æºƒï¼Œå¯ä»¥æ— è§†ï¼Œè„±å®Œï¼Œå†ç”¨jebæ‰“å¼€å°±è¡Œ\n0x02 æ ¸å¿ƒé€»è¾‘åˆ†æç”¨jebæ‰“å¼€åï¼Œå‘ç°æ ¸å¿ƒçš„åˆ¤æ–­å‡½æ•°æ˜¯ä¸€ä¸ªjniå‡½æ•°ï¼Œæ‹¿å‡ºidaï¼Œå°†soæ‰“å¼€ï¼ŒæŒ‰ç…§é™æ€æ³¨å†Œæ–¹æ³•åæœç´¢ï¼Œå‘ç°å¹¶æ²¡æœ‰æ‰¾åˆ°ï¼Œè¯´æ˜æ˜¯åŠ¨æ€æ³¨å†Œäº†ï¼Œç›´æ¥æ‰¾JNI_Onload\n\nÂ è¿™é‡Œæˆ‘å°±ä¸è·Ÿè¿›å»äº†ï¼Œå…¶å®å°±æ˜¯åŠ¨æ€æ³¨å†Œï¼Œä¸è¿‡å‘¢ï¼Œä¸€äº›å‚æ•°éƒ½è¢«åŠ å¯†äº†ï¼Œæˆ‘ctrl+sçœ‹äº†ä¸‹æ®µï¼Œæœç„¶æœ‰ä¸ª.init_arrayæ®µï¼Œå¹¶ä¸”é‡Œé¢æœ‰æ“ä½œçš„\n\nå¥½å®¶ä¼™ï¼Œå…¨æ˜¯å¼‚æˆ–ï¼Œæˆ‘å°è¯•ç”¨idapythonè¿›è¡Œæ‰‹åŠ¨patchï¼ŒçœŸçš„éº»çƒ¦ï¼Œä¸è¿‡è¿™äº›å‚æ•°è§£å¯†åè¿˜æ˜¯å¾ˆç›´è§‚çš„ï¼Œä½œç”¨ä¹ŸæŒºå¤§\n![image-20210327011018899](/Users/mac/Library/Application Support/typora-user-images/image-20210327011018899.png)\nè¿™é‡Œç®—æ˜¯patchçš„ä¸€éƒ¨åˆ†äº†ï¼Œè¿˜æ˜¯æŒºä¸é”™çš„ï¼Œæ¥ä¸‹æ¥çœ‹é‚£ä¸ªåŠ¨æ€æ³¨å†Œçš„jniå‡½æ•°ï¼Œ\n![image-20210327011203804](/Users/mac/Library/Application Support/typora-user-images/image-20210327011203804.png)\n![image-20210327011225526](/Users/mac/Library/Application Support/typora-user-images/image-20210327011225526.png)\nå‘ç°ä»€ä¹ˆå‘¢ï¼Œå…¶å®å°±æ˜¯soå‡½æ•°çº§çš„åŠ è§£å¯†ï¼Œå¦‚æœå¯¹è¿™ä¸ªæµç¨‹ä¸ç†Ÿæ‚‰å’Œelfæ–‡ä»¶ç»“æ„ä¸ç†Ÿï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä¼šä¸€è„¸æ‡µé€¼ï¼Œæˆ‘ä¹‹å‰çœ‹å°é»„ä¹¦çš„æ—¶å€™ï¼Œè¿˜æœ‰å°è±¡ï¼ŒåŸºæœ¬å°±æ˜¯æŸ¥çœ‹å†…å­˜ç©ºé—´ï¼Œç„¶åé€šè¿‡å­—ç¬¦ä¸²æ“ä½œï¼Œå–å‡ºsoåŠ è½½åŸºåœ°å€ï¼Œç„¶åé€šè¿‡ç¨‹åºå¤´è¡¨ï¼Œæ‰¾åˆ°dymæ®µåç§»ï¼Œè·Ÿåˆ°å®é™…çš„dymæ®µï¼Œå› ä¸ºdymæ®µå…¶å®å°±ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œè¿™ä¸ªç»“æ„ä½“åŒ…æ‹¬äº†dymstrï¼Œdymsym.çš„ç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼Œç„¶åé€šè¿‡.hashæ®µæ¥è®¡ç®—å‡½æ•°åçš„hashï¼ŒæŸ¥æ‰¾dymsymä¸­å‡½æ•°ç»“æ„ä½“ï¼Œå–å‡ºå‡½æ•°åç§»å’Œå¤§å°\n\nç„¶åå°±æ˜¯å¯¹ooxxå‡½æ•°è¿›è¡Œè§£å¯†äº†ï¼Œæ”¹å˜å†…å­˜çš„å¯è¯»ï¼Œä½¿å…¶å¯å†™ï¼Œæ”¹å˜å®Œè¿˜æ˜¯éœ€è¦æ”¹å˜å›å»çš„\n![image-20210327012214500](/Users/mac/Library/Application Support/typora-user-images/image-20210327012214500.png)\næˆ‘ä»¬å‘ç°å…¶å®é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯å¼‚æˆ–äº†ä¸€ç»„æ•°ç»„ï¼Œç”¨fridaç›´æ¥dumpä¸‹æ¥ï¼Œæœ¬åœ°ä¿®å¤å°±å®Œäº‹äº†\nfunction main()\n&#123;\n    var soModule&#x3D;Process.findModuleByName(&quot;libnative-lib.so&quot;);\n    var keyadd&#x3D;ptr(Number(soModule.base)+0x1C180);\n    \n    \n    console.log(keyadd.readByteArray(464))\n    &#x2F;&#x2F; for(var i &#x3D;0;i&lt;486;i++)\n    &#x2F;&#x2F; &#123;\n    &#x2F;&#x2F;     keyadd&#x3D;keyadd+i;\n    &#x2F;&#x2F;     console.log(keyadd.;\n    &#x2F;&#x2F; &#125;\n&#125;\n\nsetImmediate(main);\n\nä¿®å¤çš„è„šæœ¬ï¼š\nimport mmap\n\nkey&#x3D;[0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,\n0x10,0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,\n0x20,0x21,0x22,0x23,0x24,0x25,0x26,0x27,0x28,0x29,0x2a,0x2b,0x2c,0x2d,0x2e,0x2f,\n0x30,0x31,0x32,0x33,0x34,0x35,0x36,0x37,0x38,0x39,0x3a,0x3b,0x3c,0x3d,0x3e,0x3f,\n0x40,0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,\n0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x5b,0x5c,0x5d,0x5e,0x5f,\n0x60,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,\n0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,0x7b,0x7c,0x7d,0x7e,0x7f,\n0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8a,0x8b,0x8c,0x8d,0x8e,0x8f,\n0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9a,0x9b,0x9c,0x9d,0x9e,0x9f,\n0xa0,0xa1,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,0xa8,0xa9,0xaa,0xab,0xac,0xad,0xae,0xaf,\n0xb0,0xb1,0xb2,0xb3,0xb4,0xb5,0xb6,0xb7,0xb8,0xb9,0xba,0xbb,0xbc,0xbd,0xbe,0xbf,\n0xc0,0xc1,0xc2,0xc3,0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xcb,0xcc,0xcd,0xce,0xcf,\n0xd0,0xd1,0xd2,0xd3,0xd4,0xd5,0xd6,0xd7,0xd8,0xd9,0xda,0xdb,0xdc,0xdd,0xde,0xdf,\n0xe0,0xe1,0xe2,0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,0xea,0xeb,0xec,0xed,0xee,0xef,\n0xf0,0xf1,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,0xf9,0xfa,0xfb,0xfc,0xfd,0xfe,0xff,\n0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,\n0x10,0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,\n0x20,0x21,0x22,0x23,0x24,0x25,0x26,0x27,0x28,0x29,0x2a,0x2b,0x2c,0x2d,0x2e,0x2f,\n0x30,0x31,0x32,0x33,0x34,0x35,0x36,0x37,0x38,0x39,0x3a,0x3b,0x3c,0x3d,0x3e,0x3f,\n0x40,0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f,\n0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x5b,0x5c,0x5d,0x5e,0x5f,\n0x60,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,\n0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,0x7b,0x7c,0x7d,0x7e,0x7f,\n0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8a,0x8b,0x8c,0x8d,0x8e,0x8f,\n0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9a,0x9b,0x9c,0x9d,0x9e,0x9f,\n0xa0,0xa1,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,0xa8,0xa9,0xaa,0xab,0xac,0xad,0xae,0xaf,\n0xb0,0xb1,0xb2,0xb3,0xb4,0xb5,0xb6,0xb7,0xb8,0xb9,0xba,0xbb,0xbc,0xbd,0xbe,0xbf,\n0xc0,0xc1,0xc2,0xc3,0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xcb,0xcc,0xcd,0xce,0xcf]\n\nfile_name&#x3D;&quot;libnative-lib.so&quot;\nprint(&quot;repair begin))&quot;)\nwith open(file_name,&quot;r+b&quot;) as file_descriptor:\n    memory_map&#x3D;mmap.mmap(file_descriptor.fileno(),0)\n    fuc_offest&#x3D;0x8dc5\n    fuc_size&#x3D;584\n    begin_funcc&#x3D;fuc_offest+59\n    end_funncc&#x3D;fuc_offest+fuc_size-61\n    size&#x3D;end_funncc-begin_funcc\n    for i in range(size):\n        orginal_byte&#x3D;int.from_bytes(memory_map[begin_funcc+i:begin_funcc+i+1],&quot;little&quot;)\n        new_byte&#x3D;orginal_byte^key[i]\n        memory_map[begin_funcc+i:begin_funcc+i+1]&#x3D;bytes([new_byte])\n        read_modified_byte &#x3D; int.from_bytes(memory_map[begin_funcc + i:begin_funcc + i + 1], &quot;little&quot;)\n        print(&quot;i: %d, original_byte: 0x%02x, modified_byte: 0x%02x, read_modified_byte: 0x%02x&quot;% (i, orginal_byte, new_byte,read_modified_byte))\n    memory_map.flush()\n    memory_map.close()\nprint(&quot;repair end!&quot;)\n\n\n\nä¿®å¤æ•ˆæœï¼š\n![image-20210327012502518](/Users/mac/Library/Application Support/typora-user-images/image-20210327012502518.png)\n","slug":"å…³äºæŸsoå‡½æ•°çš„åŠ è§£å¯†ï¼Œä»¥åŠè‡ªä¿®å¤","date":"2021-03-26T16:52:56.000Z","categories_index":"","tags_index":"soå±‚çš„åŠ è§£å¯†","author_index":"YenKoc"},{"id":"2deee02bdc0213108ea703030610df02","title":"åæ§½","content":"æ²¡æƒ³åˆ°å•Šï¼Œå…œå…œè½¬è½¬è¿˜æ˜¯æ¥gitpagesï¼Œå¼„åšå®¢äº†ï¼Œå…¶ä»–å¹³å°çœŸæ²¡githubç¨³ï¼Œåˆšå¥½ï¼ŒGitHubçš„å›¾åºŠé—®é¢˜æœåˆ°ä¸ªå°å·¥å…·è§£å†³äº†ï¼Œhhï¼Œæ­£å¼è½¬æˆ˜hexoï¼Œå†²å†²å†²","slug":"expression","date":"2021-03-22T03:15:30.000Z","categories_index":"","tags_index":"æ—¥å¸¸æ‚è°ˆ","author_index":"YenKoc"}]